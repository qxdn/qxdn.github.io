<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Welcome to qxdn Blog</title>
    <url>/2020/10/18/helloworld/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2>
<p>ä¿ç ”åæ— æ‰€äº‹äº‹ï¼ŒåŒæ—¶æƒ³èµ·æ¥è‡ªå·±çš„GitHub Pageä¸€ç›´æ²¡æœ‰ç”¨è¿‡ï¼Œå› æ­¤å€Ÿç”¨äº†<a href="https://github.com/Huxpro">Huxpro</a>çš„<a href="https://github.com/Huxpro/huxpro.github.io">Hux Blog</a>æ¥æ­å»ºè‡ªå·±çš„GitHub page</p>
<h2 id="æ­£æ–‡"><a class="markdownIt-Anchor" href="#æ­£æ–‡"></a> æ­£æ–‡</h2>
<p>Hello World</p>
<p>è¿™é‡Œæ˜¯<a href="https://github.com/qxdn">qxdn</a>çš„Blogï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ç¯‡Blog</p>
]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>ç”Ÿæ´»</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”µèµ›</title>
    <url>/2020/10/19/electronicDesignContest/</url>
    <content><![CDATA[<h2 id="ç”µèµ›é€‰é¢˜"><a class="markdownIt-Anchor" href="#ç”µèµ›é€‰é¢˜"></a> ç”µèµ›é€‰é¢˜</h2>
<p>æˆ‘ä½œä¸ºç»„é•¿å’Œ<a href="https://github.com/while0l1">æå¿—è±ª</a>ã€<a href="https://github.com/renruiwhut">ä»»ç¿</a>ä¸€èµ·å‚åŠ äº†2019å¹´çš„ç”µèµ›ã€‚è¯´åˆ°ç»„é•¿çš„é€‰æ‹©å…¶å®ä¹Ÿæ˜¯å¾ˆéšæ„ï¼Œå°±æ˜¯æŠ•éª°å­æ¯”å°ï¼Œæœ€å°çš„åšç»„é•¿ã€‚2019å¹´çš„é¢˜ç›®å¯ä»¥è§<a href="https://www.nuedc-training.com.cn/index/news/details/new_id/154.html">è¿™é‡Œ</a>ï¼Œæˆ‘ä»¬å½“æ—¶ä¸»è¦åœ¨Fé¢˜å’ŒHé¢˜é‡Œé¢çº ç»“ï¼Œæˆ‘ä¸»å¼ Fé¢˜ï¼Œè€Œæå¿—è±ªå¼ºçƒˆåå¯¹ï¼Œå› ä¸ºæˆ‘ä»¬ç¼ºå°‘ä¼ æ„Ÿå™¨ï¼Œè€Œä¸”ä¸€æ—¶æ²¡æœ‰è§£å†³æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©äº†Hé¢˜ã€‚</p>
<span id="more"></span>
<h2 id="é¢˜ç›®è¦æ±‚"><a class="markdownIt-Anchor" href="#é¢˜ç›®è¦æ±‚"></a> é¢˜ç›®è¦æ±‚</h2>
<p>é¢˜ç›®çš„å…·ä½“è¦æ±‚å’Œæµ‹è¯•ç»“æœè§<a href="https://www.nuedc-training.com.cn/index/news/details/new_id/153">è¿™</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.9/problem.png" alt="å‚è€ƒå›¾ç‰‡" /></p>
<h3 id="åŸºæœ¬è¦æ±‚"><a class="markdownIt-Anchor" href="#åŸºæœ¬è¦æ±‚"></a> åŸºæœ¬è¦æ±‚</h3>
<ol>
<li>ç”µç£ç‚®èƒ½å¤Ÿå°†å¼¹ä¸¸å°„å‡ºç‚®å£ã€‚</li>
<li>ç¯å½¢é¶æ”¾ç½®åœ¨é¶å¿ƒè·ç¦»å®šæ ‡ç‚¹200~300cmé—´ï¼Œä¸”åœ¨ä¸­å¿ƒè½´çº¿ä¸Šçš„ä½ç½®å¤„ï¼Œé”®ç›˜è¾“å…¥è·ç¦»då€¼ï¼Œç”µç£ç‚®å°†å¼¹ä¸¸å‘å°„è‡³è¯¥ä½ç½®ï¼Œè·ç¦»åå·®çš„ç»å¯¹å€¼ä¸å¤§äº50cmã€‚</li>
<li>ç”¨é”®ç›˜ç»™ç”µç£ç‚®è¾“å…¥ç¯å½¢é¶ä¸­å¿ƒä¸å®šæ ‡ç‚¹çš„è·ç¦»d åŠä¸ä¸­å¿ƒè½´çº¿çš„åç¦»è§’åº¦aï¼Œä¸€é”®å¯åŠ¨åï¼Œç”µç£ç‚®è‡ªåŠ¨ç„å‡†å°„å‡»ï¼ŒæŒ‰å‡»ä¸­ç¯å½¢é¶ç¯æ•°è®¡åˆ†ï¼›è‹¥è„±é¶åˆ™ä¸è®¡åˆ†ã€‚</li>
</ol>
<h3 id="å‘æŒ¥éƒ¨åˆ†"><a class="markdownIt-Anchor" href="#å‘æŒ¥éƒ¨åˆ†"></a> å‘æŒ¥éƒ¨åˆ†</h3>
<ol>
<li>åœ¨æŒ‡å®šèŒƒå›´å†…ä»»æ„ä½ç½®æ”¾ç½®ç¯å½¢é¶ï¼ˆæœ‰å¼•å¯¼æ ‡è¯†ï¼Œå‚è§è¯´æ˜2ï¼‰ï¼Œä¸€é”®å¯åŠ¨åï¼Œç”µç£ç‚®è‡ªåŠ¨æœå¯»ç›®æ ‡å¹¶ç‚®å‡»ç¯å½¢é¶ï¼ŒæŒ‰å‡»ä¸­ç¯å½¢é¶ç¯æ•°è®¡åˆ†ï¼Œå®Œæˆæ—¶é—´â‰¤30sã€‚</li>
<li>ç¯å½¢é¶ä¸å¼•å¯¼æ ‡è¯†ä¸€åŒæ”¾ç½®åœ¨è·ç¦»å®šæ ‡ç‚¹d=250cm çš„å¼§çº¿ä¸Šï¼ˆä»¥é¶å¿ƒå®šä½ï¼‰ï¼Œå¼•å¯¼æ ‡è¯†å¤„äºæœ€è¿œä½ç½®ã€‚ç”µç£ç‚®æ”¾ç½®åœ¨å®šæ ‡ç‚¹ï¼Œç‚®ç®¡æ°´å¹³æ–¹å‘ä¸ä¸­è½´çº¿å¤¹è§’a =-30Â°ã€ä»°è§’0Â°ã€‚ä¸€é”®å¯åŠ¨ç”µç£ç‚®ï¼Œç‚®ç®¡åœ¨æ°´å¹³æ–¹å‘ä¸ä¸­è½´çº¿å¤¹è§’aä»-30Â°è‡³30Â°ã€å†è¿”å›-30Â°åšå¾€å¤è½¬åŠ¨ï¼Œåœ¨è½¬åŠ¨è¿‡ç¨‹ä¸­ï¼ˆä¸­é€”ä¸å¾—åœé¡¿ï¼‰ç”µç£ç‚®è‡ªåŠ¨æœå¯»ç›®æ ‡å¹¶ç‚®å‡»ç¯å½¢é¶ï¼ŒæŒ‰å‡»ä¸­ç¯å½¢é¶ç¯æ•°è®¡åˆ†ï¼Œå¯åŠ¨è‡³å‡»å‘å®Œæˆæ—¶é—´â‰¤10sã€‚</li>
<li>å…¶ä»–ã€‚</li>
</ol>
<h2 id="åˆ¶ä½œç”µç£ç‚®"><a class="markdownIt-Anchor" href="#åˆ¶ä½œç”µç£ç‚®"></a> åˆ¶ä½œç”µç£ç‚®</h2>
<p>ä½¿ç”¨æ¼†åŒ…çº¿åŒ…è£¹å‘å°„ç®¡ï¼Œæˆ‘ä»¬åˆ¶ä½œäº†ç”µç£ç‚®çš„ç‚®ç®¡ã€‚ä½¿ç”¨Boostç”µè·¯åˆ¶ä½œå‡å‹ï¼Œç”µå®¹æ¥å­˜å‚¨èƒ½é‡ã€‚å…³äºæ§åˆ¶ç”µç£ç‚®å‘å°„è·ç¦»ä½¿ç”¨çš„æ˜¯å›ºå®šå‘å°„ç”µå‹ã€è°ƒæ•´å‘å°„è§’åº¦çš„æ–¹æ³•ï¼Œä½¿ç”¨çš„æ–¹æ³•æ˜¯ä½¿ç”¨MATLABè¿›è¡Œæ•°æ®æ‹Ÿåˆã€‚æµ‹é‡è·ç¦»ä½¿ç”¨openmvä¸­è·ç¦»å’Œåƒç´ çš„å¤§å°æˆåæ¯”çš„å…³ç³»ã€‚ç³»ç»Ÿç»“æ„å›¾ã€DC-DCç”µè·¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.9/structure.png" alt="ç³»ç»Ÿç»“æ„å›¾" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.9/DC-DC.png" alt="DC-DC" /></p>
<h2 id="å®ç‰©"><a class="markdownIt-Anchor" href="#å®ç‰©"></a> å®ç‰©</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.9/railgun.jpg" alt="railgun" /></p>
<h2 id="æŠ¥å‘Š"><a class="markdownIt-Anchor" href="#æŠ¥å‘Š"></a> æŠ¥å‘Š</h2>
<p><a href="/others/railgunReport.docx">æŠ¥å‘Š</a></p>
<h2 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h2>
<p>æˆ‘ä»¬ç»„çš„ç”µèµ›ä»£ç åœ¨<a href="https://github.com/qxdn/BIg-Ivan">è¿™</a>ï¼Œå–åå¤§ä¼Šä¸‡ï¼ˆç¬‘ï¼‰ã€‚è¿™é‡Œé¢è¿˜åŒ…å«ä¸€äº›è®­ç»ƒæ—¶æœŸçš„é¡¹ç›®ï¼Œéƒ½åœ¨gitåˆ†æ”¯é‡Œé¢ã€‚</p>
<h2 id="ç»“æœ"><a class="markdownIt-Anchor" href="#ç»“æœ"></a> ç»“æœ</h2>
<p>åœ¨çœèµ›å’Œå›½èµ›çš„æ—¶å€™éƒ½æ‰“äº†å…¨åç¯ï¼ˆä¸å¾—ä¸è¯´è¿æ°”çœŸå¥½ï¼‰ï¼Œç„¶åå…¬è´¹å»ä¸Šæµ·åŒæµç©äº†å‡ å¤©ã€‚æœ€ç»ˆç»“æœå°±æ˜¯è·å¾—äº†ä¸€ä¸ªHé¢˜çš„å›½ä¸€äº†ï¼Œä¸ç®—å›½å®¶å¥–å­¦é‡‘çš„è¯ï¼Œè¿™æ˜¯æˆ‘è·å¾—çš„ç¬¬ä¸€ä¸ªç«èµ›å›½å¥–ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.9/edc.jpg" alt="åŒæµç°åœº" /></p>
]]></content>
      <categories>
        <category>c</category>
      </categories>
      <tags>
        <tag>ç”µèµ›</tag>
        <tag>C</tag>
        <tag>C++</tag>
        <tag>è½¯ä»¶</tag>
        <tag>ç¡¬ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”µèµ›å‡†å¤‡</title>
    <url>/2020/10/19/electronicDesignContestPerpare/</url>
    <content><![CDATA[<h2 id="è¿›å…¥606å®éªŒå®¤"><a class="markdownIt-Anchor" href="#è¿›å…¥606å®éªŒå®¤"></a> è¿›å…¥606å®éªŒå®¤</h2>
<p>â€‚â€‚åŠ å…¥å®éªŒå®¤éœ€è¦ç»è¿‡ç¬”è¯•ä»¥åŠé¢è¯•ã€‚æ‹›ç”Ÿæ—¶é—´é€šå¸¸ä¸ºå¤§ä¸€ä¸‹åˆ°å¤§äºŒä¸Šè¿™æ®µæ—¶é—´ã€‚ç¬”è¯•æœŸé—´ä¸»è¦ä¸ºã€Šç”µè·¯åˆ†æã€‹ã€ã€Šæ¨¡æ‹Ÿç”µå­æŠ€æœ¯åŸºç¡€ã€‹å’Œã€Šæ•°å­—ç”µå­æŠ€æœ¯åŸºç¡€ã€‹é‡Œé¢çš„çŸ¥è¯†ï¼Œè¿˜åŒ…æ‹¬å•ç‰‡æœºã€Cè¯­éŸ³ä»¥åŠIDEçš„ä¸€äº›çŸ¥è¯†ã€‚é¢è¯•ä¸»è¦çœ‹ä¸€äº›ä¸ªäººé¡¹ç›®ã€‚æˆ‘ä¸»è¦å±•ç¤ºäº†ä¸€äº›åœ¨403å®éªŒå®¤åˆ¶ä½œçš„æ°´æ¸©æ§åˆ¶ç³»ç»Ÿã€ä¸‡å¹´å†è¿˜æœ‰ä¸ªäººåˆ¶ä½œçš„ç®€æ˜“ç¤ºæ³¢å™¨ï¼ˆå› ä¸ºå½“æ—¶å¯¹ADCä¸æ˜¯å¾ˆç†Ÿç»ƒï¼Œè€Œä¸”ä¸çŸ¥é“å¥ˆå¥æ–¯ç‰¹æŠ½æ ·å®šç†ï¼Œæ‰€ä»¥åšçš„å¾ˆå°´å°¬ï¼‰ã€‚è¿›å…¥å®éªŒå®¤åå’Œå­¦é•¿è¿›è¡ŒåŒé€‰ï¼Œå› ä¸ºå½“æ—¶å’Œå¼ ä¿Šä¼Ÿã€ææ´‹ä¸€èµ·è¢«åˆ†é…åšç”µæºï¼Œæ‰€ä»¥æ‰¾äº†ä½™ä¸–æ°‘å­¦é•¿åšç”µæºã€‚</p>
<h2 id="606å®éªŒå®¤å­¦ä¹ "><a class="markdownIt-Anchor" href="#606å®éªŒå®¤å­¦ä¹ "></a> 606å®éªŒå®¤å­¦ä¹ </h2>
<p>â€‚â€‚åœ¨å®éªŒå®¤çš„ä¸ŠåŠä¸ªå­¦æœŸä¸»è¦ä¸ºå­¦ä¹ ï¼Œä»¥åŠå®Œæˆå®éªŒå®¤çš„ä»»åŠ¡ã€‚å®éªŒå®¤æœ‰ç€æ·˜æ±°æœºåˆ¶ï¼Œæ²¡æœ‰å®Œæˆé˜¶æ®µä»»åŠ¡ï¼Œåœ¨æœ€åå°±ä¼šè¢«æ·˜æ±°ã€‚é˜¶æ®µä»»åŠ¡ä¸»è¦ä¸ºä¸‰æç®¡æ”¾å¤§ç”µè·¯ã€è¿æ”¾ç”µè·¯ã€æ»¤æ³¢å™¨ç­‰ã€‚è™½ç„¶é¢˜ç›®çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å®é™…åšèµ·æ¥è¿˜æ˜¯ä¸ä¹¦ä¸Šçš„ç†æƒ³æƒ…å†µä¸ä¸€æ ·ã€‚å¹¸å¥½æœ€åæ²¡æœ‰è¢«æ·˜æ±°ã€‚</p>
<h2 id="è½¬ä¸ºæ§åˆ¶ç»„"><a class="markdownIt-Anchor" href="#è½¬ä¸ºæ§åˆ¶ç»„"></a> è½¬ä¸ºæ§åˆ¶ç»„</h2>
<p>â€‚â€‚åœ¨ä¸€æ®µæ—¶é—´çš„ç”µæºåˆ¶ä½œï¼ˆå…¶å®æ²¡æœ‰ï¼‰åï¼Œæˆ‘åè€Œå¯¹æ§åˆ¶é¢˜ç›®æ¯”è¾ƒæ„Ÿå…´è¶£ï¼Œå°±åŠ å…¥äº†<a href="https://github.com/while0l1">æå¿—è±ª</a>ã€<a href="https://github.com/renruiwhut">ä»»ç¿</a>çš„å°ç»„ï¼Œä¸€èµ·åšæ§åˆ¶é¢˜ã€‚åˆ¶ä½œäº†ä¸€é˜¶å€’ç«‹æ‘†ã€è‡ªç”±æ‘†ã€æ¿çƒæ§åˆ¶ç³»ç»Ÿã€éº¦å…‹çº³å§†è½®å››è½®è½¦ã€æ‚¬æŒ‚ç³»ç»Ÿã€é£åŠ›æ‘†ã€äºŒè½®å¾ªè¿¹å¹³è¡¡è½¦ã€XYå†™å­—æœºå™¨äººç­‰é¡¹ç›®ã€‚</p>
<h2 id="å®ç‰©å›¾ç‰‡"><a class="markdownIt-Anchor" href="#å®ç‰©å›¾ç‰‡"></a> å®ç‰©å›¾ç‰‡</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.0/flb.gif" alt="é£åŠ›æ‘†" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.0/balanceCar.gif" alt="äºŒè½®å¹³è¡¡è½¦" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.0/XYWriter.gif" alt="XYå†™å­—æœºå™¨äºº" /></p>
<h2 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h2>
<p>â€‚â€‚è¿™äº›å°±æ˜¯æˆ‘ä»¬ç»„åœ¨ç”µèµ›æœŸé—´çš„ä¸€äº›å‡†å¤‡å†…å®¹ï¼Œä»£ç ä¸»è¦åœ¨<a href="https://github.com/while0l1/stm32f4_modules">ä»£ç 1</a>å’Œ<a href="https://github.com/qxdn/MYDS">ä»£ç 2</a>å’Œ<a href="https://github.com/qxdn/BIg-Ivan">è®­ç»ƒä»£ç </a></p>
]]></content>
      <categories>
        <category>c</category>
      </categories>
      <tags>
        <tag>ç”µèµ›</tag>
        <tag>C</tag>
        <tag>C++</tag>
        <tag>è½¯ä»¶</tag>
        <tag>ç¡¬ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>èŠ‚èƒ½å‡æ’</title>
    <url>/2020/10/19/energySaving/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2>
<p>åŸå…ˆçš„æ ¡å†…åˆé€‰ä¸­ï¼Œæˆ‘æœ€å…ˆå‚åŠ çš„ä¸èƒ½åŠ¨å­¦é™¢ä¸€èµ·çš„èŠ‚èƒ½å‡æ’åšçºµå€¾ä¼˜åŒ–çš„èˆ¹ï¼Œä½†æ˜¯æ²¡æœ‰é€šè¿‡åˆå®¡ã€‚äºæ˜¯å’Œæ±ªåšæ–‡ã€èµµä¹‹æ¸…ã€èƒ¡ç¾¤å¼ºã€ç‹ç‘æ—ã€ä»»ç¿ã€å­™æ–‡æ»¨ä¸€èµ·å‚åŠ èŠ‚èƒ½å‡æ’å¤§èµ›ï¼Œåˆ¶ä½œå…‰ä¼å±‹é¡¶ã€‚</p>
<h2 id="ç ”åˆ¶èƒŒæ™¯"><a class="markdownIt-Anchor" href="#ç ”åˆ¶èƒŒæ™¯"></a> ç ”åˆ¶èƒŒæ™¯</h2>
<p>ä¼ ç»Ÿå…‰ä¼å±‹é¡¶çš„å‘ç”µæ•ˆç‡æ¯”è¾ƒä½ï¼Œå› æ­¤æˆ‘ä»¬è€ƒè™‘å°†ä¸€éƒ¨åˆ†å…‰ä¼æ¿æ¢æˆå¤©çª—ä½¿ç”¨ã€‚ç”±äºå¤©çª—ä¼šæœ‰ç°å°˜é›¨æ°´ç­‰ï¼Œæ¯”è¾ƒå®¹æ˜“è„ï¼Œéœ€è¦äººåŠ›æ¸…é™¤æˆæœ¬ã€‚å› æ­¤æˆ‘ä»¬å¯¹å¤©çª—æŒ¡æ¿åšæ™ºèƒ½å¤„ç†ï¼Œèƒ½å¤Ÿæ ¹æ®å¤©æ°”å…‰ç…§è‡ªåŠ¨æ§åˆ¶å¼€åˆè§’åº¦ï¼Œä½¿å¾—å…‰ç…§æœ€å¤§åŒ–åŒæ—¶å‡å°‘äººåŠ›æ¸…ç†æˆæœ¬ã€‚æ ¹æ®è´¾åšæ–‡è€å¸ˆè¯´ï¼Œè¿™ä¸ªè²Œä¼¼æ˜¯æ ¹æ®ä»–åœ¨æ–°åŠ å¡çœ‹åˆ°çš„ç›´æ¥æ›´æ”¹çš„ã€‚</p>
<h2 id="å®ç‰©"><a class="markdownIt-Anchor" href="#å®ç‰©"></a> å®ç‰©</h2>
<p>æˆ‘ä»¬ä¸»è¦åˆ¶ä½œäº†<a href="http://101.133.235.188/">æ™ºèƒ½è®¾è®¡å¹³å°</a>(ç°åœ¨åº”è¯¥ä¸Šä¸å»äº†)ã€æ‰‹æœºæ§åˆ¶å¹³å°å’Œå…‰ä¼å±‹é¡¶ã€‚ä¸‰ä¸ªä¹‹é—´çš„é€šä¿¡ä¸»è¦æ˜¯ä½¿ç”¨MQTTåè®®ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.8/design.png" alt="æ™ºèƒ½è®¾è®¡ç½‘é¡µ" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.8/controller.png" alt="æ™ºèƒ½æ§åˆ¶å¹³å°" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.8/roof.gif" alt="å…‰ä¼å±‹é¡¶" /></p>
<h2 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h2>
<p><a href="https://github.com/qxdn/sunbest">æ™ºèƒ½è®¾è®¡å¹³å°</a>ã€<a href="https://github.com/qxdn/WindowController">å¤©çª—æ§åˆ¶å¹³å°</a>å’Œ<a href="https://github.com/qxdn/EnergySaveRoof">å®ç‰©ä¸8266ä»£ç </a>å› ä¸ºç–«æƒ…åŸå› è€Œä¸”ç»„å‘˜ä¹Ÿä¸æ˜¯å¾ˆä¼šå› æ­¤å®ç‰©ä»£ç æ¯”è¾ƒè€ã€ä½†æ˜¯8266çš„ä»£ç æ˜¯æœ€æ–°çš„ã€‚</p>
<h2 id="ç»“æœ"><a class="markdownIt-Anchor" href="#ç»“æœ"></a> ç»“æœ</h2>
<p>æœ€åè¿˜æ˜¯åªå¾—äº†ä¸€ä¸ªå›½ä¸‰ï¼Œå¦‚æœå†åšçš„å¥½ä¸€ç‚¹ä¹Ÿè®¸å°±èƒ½è¿‡äº†ç½‘ç”³å†²å‡»å›½äºŒã€å›½ä¸€äº†ã€‚</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>C</tag>
        <tag>C++</tag>
        <tag>è½¯ä»¶</tag>
        <tag>ç¡¬ä»¶</tag>
        <tag>èŠ‚èƒ½å‡æ’</tag>
        <tag>java</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨AlexNetå®ç°DogsVsCats</title>
    <url>/2020/10/23/DogsVsCatsAlexNet/</url>
    <content><![CDATA[<h2 id="alexnet-å®ç°çŒ«ç‹—å¤§æˆ˜"><a class="markdownIt-Anchor" href="#alexnet-å®ç°çŒ«ç‹—å¤§æˆ˜"></a> AlexNet å®ç°çŒ«ç‹—å¤§æˆ˜</h2>
<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2>
<p>æ—©å°±å¬è¯´è¿‡tensorflowçš„å¤§åï¼Œä½†ä¸€ç›´æ²¡æœ‰æ—¶é—´ä»”ç»†ç ”ç©¶ï¼Œè€Œä¸”ä¸€ç›´ç¼ºå°‘æ•°æ®é›†ï¼Œä¹Ÿå°±æ²¡æ€ä¹ˆäº†è§£ã€‚åŒæ—¶å› ä¸ºé‚£tensorflow1çš„å¤æ‚é™æ€å›¾ä¸€ç›´åŠé€€ã€‚å¦‚ä»Šæœ‰äº†æ—¶é—´ï¼Œè€Œä¸”tensorflow2æ›´åŠ æ˜“æ‡‚ï¼Œå› æ­¤ä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡ç‚¼ä¸¹ã€‚é¦–å…ˆæ˜¯åœ¨<a href="https://www.kaggle.com/">kaggle</a>ä¸‹è½½æ•°æ®é›†å°±éš¾åˆ°æˆ‘äº†ï¼Œæ²¡æƒ³åˆ°ç¿»äº†å¢™è¿˜è¢«å›°åœ¨æ‰‹æœºå·éªŒè¯ã€‚æœ€ååªèƒ½å€ŸåŠ©äºå¾®è½¯æä¾›çš„æ•°æ®é›†ä¸‹è½½ã€‚æœ€å¼€å§‹ç”¨è‡ªå·±çš„CPUè·‘åˆæ…¢åˆå¡ï¼Œè‡ªä»æˆ‘æ¢äº†ç¡¬ç›˜åŠ äº†å†…å­˜ä»¥æ¥ï¼Œå¥½ä¹…éƒ½æ²¡æœ‰è¿™ä¹ˆå¡è¿‡äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.7/overload.png" alt="overload" /></p>
<p>éšåæ¢ä¸Šäº†Googleçš„<a href="https://colab.research.google.com/notebooks/intro.ipynb#">colab</a>,ç”¨äº†å…è´¹GPUæ‰çŸ¥é“GPUçš„å¥½ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹æ­£æ–‡</p>
</blockquote>
<h2 id="1-æ•°æ®å‡†å¤‡"><a class="markdownIt-Anchor" href="#1-æ•°æ®å‡†å¤‡"></a> 1ã€æ•°æ®å‡†å¤‡</h2>
<p>åœ¨Colabä¸Šéœ€è¦ä¸‹è½½æ•°æ®å’Œå‡†å¤‡ç¯å¢ƒï¼Œå·²ç»å°†æ•°æ®ä¸Šä¼ åˆ°äº†Github</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!pip install tensorflow</span><br><span class="line">!wget https://github.com/qxdn/DogsVsCats/releases/download/v1<span class="number">.0</span><span class="number">.0</span>/data.<span class="built_in">zip</span></span><br><span class="line">!unzip data.<span class="built_in">zip</span></span><br><span class="line">!rm -rf data.<span class="built_in">zip</span></span><br></pre></td></tr></table></figure>
<p>AlexNetçš„è¾“å…¥æ˜¯<code>[227,227,3]</code>ï¼Œå› æ­¤è¦å¯¹è¾“å…¥è¿›è¡Œé¢„å¤„ç†ï¼Œä½¿å¾—ç¬¦åˆè§„èŒƒï¼ŒåŒæ—¶è¿˜éœ€è¦è¿›è¡Œè´´æ ‡ç­¾(dog=1,cat=0)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> layers,models</span><br><span class="line"></span><br><span class="line">BATCH_SIZE = <span class="number">125</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_image</span>(<span class="params">img_path,size=(<span class="params"><span class="number">227</span>,<span class="number">227</span></span>)</span>):</span><br><span class="line">    label = tf.constant(<span class="number">0</span>,tf.int8) <span class="keyword">if</span> tf.strings.regex_full_match(img_path,<span class="string">&quot;.*cat.*&quot;</span>) \</span><br><span class="line">            <span class="keyword">else</span> tf.constant(<span class="number">1</span>,tf.int8)</span><br><span class="line">    img = tf.io.read_file(img_path)</span><br><span class="line">    img = tf.image.decode_jpeg(img) </span><br><span class="line">    img = tf.image.resize(img,size)/<span class="number">255.0</span>  <span class="comment">#è½¬floatè¦å½’ä¸€</span></span><br><span class="line">    <span class="keyword">return</span>(img,label)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨å¹¶è¡ŒåŒ–é¢„å¤„ç†num_parallel_calls å’Œé¢„å­˜æ•°æ®prefetchæ¥æå‡æ€§èƒ½</span></span><br><span class="line"><span class="comment"># num_parallel_calls=tf.data.experimental.AUTOTUNE æ ¹æ®CPUåŠ¨æ€å¤„ç† æœªæŒ‡å®šå°±é¡ºåºå¤„ç†</span></span><br><span class="line"><span class="comment">#shuffle éšæœºé‡æ’</span></span><br><span class="line"><span class="comment">#batch()ä¸€æ¬¡å‡ºå¤šå°‘</span></span><br><span class="line"><span class="comment">#prefetch æå‰å–å‡ºå¤šå°‘æ‰¹batch</span></span><br><span class="line">ds_train = tf.data.Dataset.list_files(<span class="string">&quot;./data/train/*.jpg&quot;</span>) \</span><br><span class="line">           .<span class="built_in">map</span>(load_image, num_parallel_calls=tf.data.experimental.AUTOTUNE) \</span><br><span class="line">           .shuffle(buffer_size = <span class="number">1000</span>).batch(BATCH_SIZE) \</span><br><span class="line">           .prefetch(tf.data.experimental.AUTOTUNE)  </span><br><span class="line"></span><br><span class="line">ds_test = tf.data.Dataset.list_files(<span class="string">&quot;./data/test/*.jpg&quot;</span>) \</span><br><span class="line">           .<span class="built_in">map</span>(load_image, num_parallel_calls=tf.data.experimental.AUTOTUNE) \</span><br><span class="line">           .batch(BATCH_SIZE) \</span><br><span class="line">           .prefetch(tf.data.experimental.AUTOTUNE)  </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;svg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹è®­ç»ƒæ ·æœ¬</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt </span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">8</span>))  <span class="comment">#8*8 inch</span></span><br><span class="line"><span class="keyword">for</span> i,(img,label) <span class="keyword">in</span> <span class="built_in">enumerate</span>(ds_train.unbatch().take(<span class="number">9</span>)):  <span class="comment">#enumerate ç»„åˆæˆç´¢å¼•ã€æ•°æ®è¿­ä»£</span></span><br><span class="line">    ax=plt.subplot(<span class="number">3</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    ax.imshow(img.numpy())</span><br><span class="line">    ax.set_title(<span class="string">&quot;label = %d&quot;</span>%label)</span><br><span class="line">    ax.set_xticks([])</span><br><span class="line">    ax.set_yticks([]) </span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.7/output_7_0.svg" alt="" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> x,y <span class="keyword">in</span> ds_train.take(<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(x.shape,y.shape)</span><br></pre></td></tr></table></figure>
<pre><code>(125, 227, 227, 3) (125,)
</code></pre>
<h2 id="2-å®šä¹‰æ¨¡å‹"><a class="markdownIt-Anchor" href="#2-å®šä¹‰æ¨¡å‹"></a> 2ã€å®šä¹‰æ¨¡å‹</h2>
<p>AlexNetç›¸è¾ƒäºä»¥å‰çš„ç½‘ç»œä¸»è¦å¼•å…¥äº†Reluæ¿€æ´»å‡½æ•°ã€DropOutå±‚å’Œlrnå±€éƒ¨å“åº”</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># LRNå±‚</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LRN</span>(layers.Layer):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(LRN, self).__init__()</span><br><span class="line">        self.depth_radius=<span class="number">2</span></span><br><span class="line">        self.bias=<span class="number">1</span></span><br><span class="line">        self.alpha=<span class="number">1e-4</span></span><br><span class="line">        self.beta=<span class="number">0.75</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">call</span>(<span class="params">self,x</span>):</span><br><span class="line">        <span class="keyword">return</span> tf.nn.lrn(x,depth_radius=self.depth_radius,</span><br><span class="line">                         bias=self.bias,alpha=self.alpha,</span><br><span class="line">                         beta=self.beta)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tf.keras.backend.clear_session() <span class="comment">#æ¸…ç©ºä¼šè¯</span></span><br><span class="line"></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Conv2D(<span class="number">96</span>,kernel_size=(<span class="number">11</span>,<span class="number">11</span>),activation=<span class="string">&#x27;relu&#x27;</span>,strides=(<span class="number">4</span>,<span class="number">4</span>),input_shape=(<span class="number">227</span>,<span class="number">227</span>,<span class="number">3</span>)))</span><br><span class="line">model.add(layers.MaxPool2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>),strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">model.add(LRN())</span><br><span class="line">model.add(layers.Conv2D(<span class="number">256</span>,kernel_size=(<span class="number">5</span>,<span class="number">5</span>),activation=<span class="string">&#x27;relu&#x27;</span>,strides=(<span class="number">1</span>,<span class="number">1</span>),padding=<span class="string">&#x27;same&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPool2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>),strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">model.add(LRN())</span><br><span class="line">model.add(layers.Conv2D(<span class="number">384</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),activation=<span class="string">&#x27;relu&#x27;</span>,strides=(<span class="number">1</span>,<span class="number">1</span>),padding=<span class="string">&#x27;same&#x27;</span>))</span><br><span class="line">model.add(layers.Conv2D(<span class="number">384</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),activation=<span class="string">&#x27;relu&#x27;</span>,strides=(<span class="number">1</span>,<span class="number">1</span>),padding=<span class="string">&#x27;same&#x27;</span>))</span><br><span class="line">model.add(layers.Conv2D(<span class="number">256</span>,kernel_size=(<span class="number">3</span>,<span class="number">3</span>),activation=<span class="string">&#x27;relu&#x27;</span>,strides=(<span class="number">1</span>,<span class="number">1</span>),padding=<span class="string">&#x27;same&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPool2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>),strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line">model.add(layers.Flatten()) <span class="comment"># ä¸è¦å¿˜è®°æœ‰ä¸€å±‚é™ä¸ºä¸€ç»´</span></span><br><span class="line">model.add(layers.Dense(<span class="number">4096</span>,activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.25</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">4096</span>,activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dropout(<span class="number">0.25</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">2</span>,activation=<span class="string">&#x27;softmax&#x27;</span>))  <span class="comment">#çœŸå®çš„AlexNetä¼šåˆ†æˆ1000ç±»ï¼Œæ­¤å¤„åˆ†2ç±» sofmaxæ¥è®¡ç®—æ¦‚ç‡</span></span><br><span class="line"></span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 55, 55, 96)        34944     
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 27, 27, 96)        0         
_________________________________________________________________
lrn (LRN)                    (None, 27, 27, 96)        0         
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 27, 27, 256)       614656    
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 13, 13, 256)       0         
_________________________________________________________________
lrn_1 (LRN)                  (None, 13, 13, 256)       0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 13, 13, 384)       885120    
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 13, 13, 384)       1327488   
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 13, 13, 256)       884992    
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 6, 6, 256)         0         
_________________________________________________________________
flatten (Flatten)            (None, 9216)              0         
_________________________________________________________________
dense (Dense)                (None, 4096)              37752832  
_________________________________________________________________
dropout (Dropout)            (None, 4096)              0         
_________________________________________________________________
dense_1 (Dense)              (None, 4096)              16781312  
_________________________________________________________________
dropout_1 (Dropout)          (None, 4096)              0         
_________________________________________________________________
dense_2 (Dense)              (None, 2)                 8194      
=================================================================
Total params: 58,289,538
Trainable params: 58,289,538
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<h2 id="3-è®­ç»ƒæ¨¡å‹"><a class="markdownIt-Anchor" href="#3-è®­ç»ƒæ¨¡å‹"></a> 3ã€è®­ç»ƒæ¨¡å‹</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=tf.keras.optimizers.Adam(learning_rate=<span class="number">0.00001</span>),</span><br><span class="line">        loss=<span class="string">&#x27;sparse_categorical_crossentropy&#x27;</span>,</span><br><span class="line">        metrics=[<span class="string">&quot;accuracy&quot;</span>])</span><br><span class="line"></span><br><span class="line">checkpoint_save_path=<span class="string">&#x27;./checkpoint/AlexNet/AlexNet-&#123;epoch:02d&#125;.ckpt&#x27;</span></span><br><span class="line"><span class="comment">#tfç”Ÿæˆckptæ–‡ä»¶æ—¶ä¼šåŒæ­¥ç”Ÿæˆç´¢å¼•è¡¨ï¼Œé‚£ä¹ˆé€šè¿‡åˆ¤æ–­æ˜¯å¦æœ‰ç´¢å¼•è¡¨ï¼Œå°±çŸ¥é“æœ‰æ²¡æœ‰ä¿å­˜è¿‡å‚æ•°ã€‚</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(checkpoint_save_path+<span class="string">&#x27;.index&#x27;</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;----------------load the model--------------&#x27;</span>)</span><br><span class="line">    model.load_weights(checkpoint_save_path)</span><br><span class="line">cp_callback=tf.keras.callbacks.ModelCheckpoint(filepath=checkpoint_save_path,</span><br><span class="line">                            save_weights_only=<span class="literal">True</span>,</span><br><span class="line">                            save_best_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">history = model.fit(ds_train,epochs= <span class="number">20</span>,validation_data=ds_test,</span><br><span class="line">                    callbacks = [cp_callback],workers = <span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<pre><code>Epoch 1/20
184/184 [==============================] - 40s 219ms/step - loss: 0.6630 - accuracy: 0.5944 - val_loss: 0.6141 - val_accuracy: 0.6615
Epoch 2/20
184/184 [==============================] - 40s 220ms/step - loss: 0.5970 - accuracy: 0.6754 - val_loss: 0.5586 - val_accuracy: 0.7040
Epoch 3/20
184/184 [==============================] - 40s 219ms/step - loss: 0.5426 - accuracy: 0.7244 - val_loss: 0.5088 - val_accuracy: 0.7505
Epoch 4/20
184/184 [==============================] - 40s 219ms/step - loss: 0.4946 - accuracy: 0.7598 - val_loss: 0.4840 - val_accuracy: 0.7735
Epoch 5/20
184/184 [==============================] - 40s 220ms/step - loss: 0.4545 - accuracy: 0.7852 - val_loss: 0.4469 - val_accuracy: 0.8055
Epoch 6/20
184/184 [==============================] - 40s 220ms/step - loss: 0.4207 - accuracy: 0.8064 - val_loss: 0.4180 - val_accuracy: 0.8100
Epoch 7/20
184/184 [==============================] - 40s 219ms/step - loss: 0.3991 - accuracy: 0.8193 - val_loss: 0.4016 - val_accuracy: 0.8250
Epoch 8/20
184/184 [==============================] - 41s 220ms/step - loss: 0.3788 - accuracy: 0.8309 - val_loss: 0.3908 - val_accuracy: 0.8315
Epoch 9/20
184/184 [==============================] - 40s 219ms/step - loss: 0.3587 - accuracy: 0.8427 - val_loss: 0.3733 - val_accuracy: 0.8375
Epoch 10/20
184/184 [==============================] - 38s 207ms/step - loss: 0.3387 - accuracy: 0.8539 - val_loss: 0.3860 - val_accuracy: 0.8345
Epoch 11/20
184/184 [==============================] - 40s 220ms/step - loss: 0.3273 - accuracy: 0.8576 - val_loss: 0.3498 - val_accuracy: 0.8475
Epoch 12/20
184/184 [==============================] - 38s 207ms/step - loss: 0.3064 - accuracy: 0.8676 - val_loss: 0.3671 - val_accuracy: 0.8380
Epoch 13/20
184/184 [==============================] - 38s 208ms/step - loss: 0.2931 - accuracy: 0.8762 - val_loss: 0.3501 - val_accuracy: 0.8495
Epoch 14/20
184/184 [==============================] - 40s 220ms/step - loss: 0.2737 - accuracy: 0.8864 - val_loss: 0.3361 - val_accuracy: 0.8540
Epoch 15/20
184/184 [==============================] - 40s 219ms/step - loss: 0.2694 - accuracy: 0.8890 - val_loss: 0.3311 - val_accuracy: 0.8585
Epoch 16/20
184/184 [==============================] - 38s 208ms/step - loss: 0.2557 - accuracy: 0.8938 - val_loss: 0.3388 - val_accuracy: 0.8565
Epoch 17/20
184/184 [==============================] - 40s 219ms/step - loss: 0.2362 - accuracy: 0.9030 - val_loss: 0.3160 - val_accuracy: 0.8680
Epoch 18/20
184/184 [==============================] - 38s 207ms/step - loss: 0.2184 - accuracy: 0.9106 - val_loss: 0.3692 - val_accuracy: 0.8515
Epoch 19/20
184/184 [==============================] - 38s 207ms/step - loss: 0.2085 - accuracy: 0.9160 - val_loss: 0.3198 - val_accuracy: 0.8710
Epoch 20/20
184/184 [==============================] - 41s 222ms/step - loss: 0.1909 - accuracy: 0.9239 - val_loss: 0.3019 - val_accuracy: 0.8705
</code></pre>
<h2 id="4-è¯„ä¼°æ¨¡å‹"><a class="markdownIt-Anchor" href="#4-è¯„ä¼°æ¨¡å‹"></a> 4ã€è¯„ä¼°æ¨¡å‹</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;svg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot_metric</span>(<span class="params">history, metric</span>):</span><br><span class="line">    train_metrics = history.history[metric]</span><br><span class="line">    val_metrics = history.history[<span class="string">&#x27;val_&#x27;</span>+metric]</span><br><span class="line">    epochs = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(train_metrics) + <span class="number">1</span>)</span><br><span class="line">    plt.plot(epochs, train_metrics, <span class="string">&#x27;bo--&#x27;</span>)</span><br><span class="line">    plt.plot(epochs, val_metrics, <span class="string">&#x27;ro-&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;Training and validation &#x27;</span>+ metric)</span><br><span class="line">    plt.xlabel(<span class="string">&quot;Epochs&quot;</span>)</span><br><span class="line">    plt.ylabel(metric)</span><br><span class="line">    plt.legend([<span class="string">&quot;train_&quot;</span>+metric, <span class="string">&#x27;val_&#x27;</span>+metric])</span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plot_metric(history,<span class="string">&quot;loss&quot;</span>) <span class="comment">#ç»“æœçœ‹å¯ä»¥å†ç»ƒç»ƒ</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.7/output_16_0.svg" alt="" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plot_metric(history,<span class="string">&quot;accuracy&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.7/output_17_0.svg" alt="" /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯ä»¥ä½¿ç”¨evaluateå¯¹æ•°æ®è¿›è¡Œè¯„ä¼°</span></span><br><span class="line">val_loss,val_accuracy = model.evaluate(ds_test,workers=<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(val_loss,val_accuracy)</span><br></pre></td></tr></table></figure>
<pre><code>16/16 [==============================] - 2s 144ms/step - loss: 0.3019 - accuracy: 0.8705
0.3018629252910614 0.8705000281333923
</code></pre>
<h2 id="5-ä½¿ç”¨æ¨¡å‹"><a class="markdownIt-Anchor" href="#5-ä½¿ç”¨æ¨¡å‹"></a> 5ã€ä½¿ç”¨æ¨¡å‹</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">perpareImage</span>(<span class="params">img,sizes=(<span class="params">-<span class="number">1</span>,<span class="number">227</span>,<span class="number">227</span>,<span class="number">3</span></span>)</span>):</span><br><span class="line">  img = tf.reshape(img,shape=sizes)</span><br><span class="line">  <span class="keyword">return</span> img</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i,(img,label) <span class="keyword">in</span> <span class="built_in">enumerate</span>(ds_test.unbatch().take(<span class="number">1</span>)):</span><br><span class="line">  img=tf.reshape(img,shape=(-<span class="number">1</span>,<span class="number">227</span>,<span class="number">227</span>,<span class="number">3</span>))</span><br><span class="line">  p=model.predict(img)</span><br><span class="line">  <span class="built_in">print</span>(p)</span><br><span class="line">  p=tf.argmax(p,<span class="number">1</span>)</span><br><span class="line">  <span class="built_in">print</span>(p)</span><br><span class="line">  <span class="built_in">print</span>(p.shape)</span><br></pre></td></tr></table></figure>
<pre><code>[[0.91607434 0.08392565]]
tf.Tensor([0], shape=(1,), dtype=int64)
(1,)
</code></pre>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;svg&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹è®­ç»ƒæ ·æœ¬</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt </span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">8</span>))  <span class="comment">#8*8 inch</span></span><br><span class="line"><span class="keyword">for</span> i,(img,label) <span class="keyword">in</span> <span class="built_in">enumerate</span>(ds_test.unbatch().take(<span class="number">9</span>)):  <span class="comment">#enumerate ç»„åˆæˆç´¢å¼•ã€æ•°æ®è¿­ä»£</span></span><br><span class="line">    ax=plt.subplot(<span class="number">3</span>,<span class="number">3</span>,i+<span class="number">1</span>)</span><br><span class="line">    ax.imshow(img.numpy())</span><br><span class="line">    predict = model.predict(perpareImage(img))</span><br><span class="line">    ax.set_title(<span class="string">&quot;predict=%d,label=%d&quot;</span>%(tf.argmax(predict,<span class="number">1</span>),label))</span><br><span class="line">    ax.set_xticks([])</span><br><span class="line">    ax.set_yticks([]) </span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.7/output_22_0.svg" alt="" /></p>
<h2 id="6-ä¿å­˜æ¨¡å‹"><a class="markdownIt-Anchor" href="#6-ä¿å­˜æ¨¡å‹"></a> 6ã€ä¿å­˜æ¨¡å‹</h2>
<p>tensorflowåŸç”Ÿä¿å­˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜æ¨¡å‹ç»“æ„ä¸æ¨¡å‹å‚æ•°åˆ°æ–‡ä»¶,è¯¥æ–¹å¼ä¿å­˜çš„æ¨¡å‹å…·æœ‰è·¨å¹³å°æ€§ä¾¿äºéƒ¨ç½²</span></span><br><span class="line"></span><br><span class="line">model.save(<span class="string">&#x27;./model/tf_AlexNet_Model&#x27;</span>, save_format=<span class="string">&quot;tf&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;export saved model.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">model_loaded = tf.keras.models.load_model(<span class="string">&#x27;./model/tf_AlexNet_Model&#x27;</span>)</span><br><span class="line">model_loaded.evaluate(ds_test)</span><br></pre></td></tr></table></figure>
<pre><code>WARNING:tensorflow:From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/tracking/tracking.py:111: Model.state_updates (from tensorflow.python.keras.engine.training) is deprecated and will be removed in a future version.
Instructions for updating:
This property should not be used in TensorFlow 2.0, as updates are applied automatically.
WARNING:tensorflow:From /usr/local/lib/python3.6/dist-packages/tensorflow/python/training/tracking/tracking.py:111: Layer.updates (from tensorflow.python.keras.engine.base_layer) is deprecated and will be removed in a future version.
Instructions for updating:
This property should not be used in TensorFlow 2.0, as updates are applied automatically.
INFO:tensorflow:Assets written to: ./model/tf_AlexNet_Model/assets
export saved model.
16/16 [==============================] - 2s 147ms/step - loss: 0.3019 - accuracy: 0.5155





[0.301862895488739, 0.515500009059906]
</code></pre>
<h2 id="repo"><a class="markdownIt-Anchor" href="#repo"></a> repo</h2>
<p><a href="https://github.com/qxdn/DogsVsCats">DogsVsCats</a></p>
<h2 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h2>
<p>è¸©çš„å‘æœ‰ç‚¹ç‚¹å¤šï¼Œæ¯”å¦‚æ­å»ºç½‘ç»œæ—¶å€™å¿˜è®°æ‘Šå¹³ï¼Œé¢„æµ‹çš„æ—¶å€™å› ä¸ºå½¢çŠ¶ä¸å¯¹å¡äº†åŠå¤©ï¼ŒCPUè®­ç»ƒçš„æ—¶å€™losså’Œå‡†ç¡®åº¦ä¸å˜ï¼Œå·®ç‚¹ä»¥ä¸ºå¤±è´¥äº†ï¼Œä¸è¿‡æœ€åçœ‹æ¥è¿˜ç®—æˆåŠŸå§ã€‚èµç¾Google Colabã€‚</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>tensorflow</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>AlexNet</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡çº§åˆ°WSL2</title>
    <url>/2020/10/24/upgradeWSL2/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2>
<p>å› ä¸ºä¸€äº›ä¸ªäººåŸå› ï¼Œéœ€è¦å°†åŸå…ˆçš„WSL1å‡çº§åˆ°WSL2ï¼Œå‚è€ƒ<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10">å¾®è½¯æ–‡æ¡£</a>ï¼Œè®°å½•è¸©å‘</p>
<h2 id="ä¸€-æ£€æŸ¥ç‰ˆæœ¬"><a class="markdownIt-Anchor" href="#ä¸€-æ£€æŸ¥ç‰ˆæœ¬"></a> ä¸€ã€æ£€æŸ¥ç‰ˆæœ¬</h2>
<p>å¯¹äºx64ç³»ç»Ÿç›®å‰çš„è¦æ±‚æ˜¯<code>1903</code>æˆ–è€…æ›´é«˜,<code>Build 18362</code>æˆ–è€…æ›´é«˜ã€‚ä½¿ç”¨<code>win+R</code>è¾“å…¥<code>winver</code>æ¥æ£€æŸ¥è‡ªå·±çš„ç‰ˆæœ¬<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.6/version.png" alt="version" /></p>
<h2 id="äºŒ-å¯åŠ¨è™šæ‹ŸæœºåŠŸèƒ½"><a class="markdownIt-Anchor" href="#äºŒ-å¯åŠ¨è™šæ‹ŸæœºåŠŸèƒ½"></a> äºŒã€å¯åŠ¨è™šæ‹ŸæœºåŠŸèƒ½</h2>
<p>ç®¡ç†å‘˜æ¨¡å¼å¯åŠ¨powershellè¾“å…¥</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">dism.exe /online /<span class="built_in">enable-feature</span> /featurename:VirtualMachinePlatform /all /norestart</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.6/enableVMFeature.png" alt="å¯åŠ¨è™šæ‹ŸæœºåŠŸèƒ½" /><br />
<strong>ç„¶åé‡å¯ç”µè„‘</strong></p>
<h2 id="ä¸‰-ä¸‹è½½linuxå†…æ ¸å‡çº§åŒ…"><a class="markdownIt-Anchor" href="#ä¸‰-ä¸‹è½½linuxå†…æ ¸å‡çº§åŒ…"></a> ä¸‰ã€ä¸‹è½½Linuxå†…æ ¸å‡çº§åŒ…</h2>
<p>ä¸‹è½½æœ€æ–°<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">å‡çº§åŒ…</a><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.6/package.png" alt="package" /></p>
<h2 id="å››-è®¾ç½®wsl2ä½œä¸ºé»˜è®¤ç‰ˆæœ¬"><a class="markdownIt-Anchor" href="#å››-è®¾ç½®wsl2ä½œä¸ºé»˜è®¤ç‰ˆæœ¬"></a> å››ã€è®¾ç½®WSL2ä½œä¸ºé»˜è®¤ç‰ˆæœ¬</h2>
<p>ç®¡ç†å‘˜powershellä¸­è¿è¡Œ</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wsl <span class="literal">--set-default-version</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h2 id="äº”-è½¬æ¢wsl"><a class="markdownIt-Anchor" href="#äº”-è½¬æ¢wsl"></a> äº”ã€è½¬æ¢WSL</h2>
<p>ä½¿ç”¨è¯¥æŒ‡ä»¤æŸ¥çœ‹wslçŠ¶æ€</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wsl <span class="literal">-l</span> <span class="literal">-v</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘çš„è¾“å‡º</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">  NAME      STATE           VERSION</span><br><span class="line">* Ubuntu    Stopped         <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>è½¬æ¢WSL</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">wsl <span class="literal">--set-version</span> Ubuntu <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">æ­£åœ¨è¿›è¡Œè½¬æ¢ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´...</span><br><span class="line">æœ‰å…³ä¸ WSL <span class="number">2</span> çš„ä¸»è¦åŒºåˆ«çš„ä¿¡æ¯ï¼Œè¯·è®¿é—® https://aka.ms/wsl2</span><br><span class="line">è¯·å¯ç”¨è™šæ‹Ÿæœºå¹³å° Windows åŠŸèƒ½å¹¶ç¡®ä¿åœ¨ BIOS ä¸­å¯ç”¨è™šæ‹ŸåŒ–ã€‚</span><br><span class="line">æœ‰å…³ä¿¡æ¯ï¼Œè¯·è®¿é—® https://aka.ms/wsl2<span class="literal">-install</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåœ¨æˆ‘æœç´¢äº†<a href="https://github.com/microsoft/WSL/issues/5363">issue</a>åå‘ç°ä¸»è¦è¿˜æ˜¯Hyper-Vã€è™šæ‹Ÿå¹³å°ç­‰é—®é¢˜ï¼Œå¯ä»¥è¯•ä¸€è¯•ç®¡ç†å‘˜æ¨¡å¼è¿è¡Œä»¥ä¸‹æŒ‡ä»¤</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">DISM /Online /<span class="built_in">Enable-Feature</span> /All /FeatureName:Microsoft<span class="literal">-Hyper-V</span></span><br><span class="line">dism.exe /online /<span class="built_in">enable-feature</span> /featurename:Microsoft<span class="literal">-Windows-Subsystem-Linux</span> /all /norestart</span><br><span class="line">dism.exe /online /<span class="built_in">enable-feature</span> /featurename:VirtualMachinePlatform /all /norestart</span><br><span class="line">bcdedit /<span class="built_in">set</span> hypervisorlaunchtype auto</span><br></pre></td></tr></table></figure>
<p>æœ€ä¸»è¦çš„åº”è¯¥æ˜¯</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">DISM /Online /<span class="built_in">Enable-Feature</span> /All /FeatureName:Microsoft<span class="literal">-Hyper-V</span></span><br><span class="line">bcdedit /<span class="built_in">set</span> hypervisorlaunchtype auto</span><br></pre></td></tr></table></figure>
<p>é‡æ–°è½¬æ¢<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.6/converted.png" alt="è½¬æ¢å®Œæˆ" /></p>
<h2 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h2>
<p>VMwareè€ç‰ˆæœ¬ä¸Hyper-Vå†²çªï¼Œå¾—æ‰¾ä¸ªæ—¶é—´å»æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬å…¼å®¹</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Linux</tag>
        <tag>WSL</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆä¸€ï¼‰ç¯å¢ƒæ­å»º</title>
    <url>/2021/01/19/installpytorch/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2>
<p>ä½“éªŒè¿‡CPUå’ŒGPUé€Ÿåº¦ä¹‹åï¼Œå°±ä¸ä¼šå†æƒ³ä½¿ç”¨CPUç‰ˆæœ¬çš„æœºå™¨å­¦ä¹ æ¡†æ¶è¿›è¡Œè®­ç»ƒã€‚</p>
<h2 id="å®‰è£…cuda"><a class="markdownIt-Anchor" href="#å®‰è£…cuda"></a> å®‰è£…CUDA</h2>
<p>ç¬¬ä¸€æ­¥å°±æ˜¯è¦å®Œæˆcudaçš„å®‰è£…ï¼Œè¿›å…¥<code>NIVIDAæ§åˆ¶é¢æ¿</code>-&gt;<code>ç³»ç»Ÿä¿¡æ¯</code>-&gt;<code>ç»„ä»¶</code>ï¼ŒæŸ¥çœ‹<code>3Dè®¾ç½®</code>ä¸­çš„<code>NVCUDA64.DLL</code>ï¼Œè¿™é‡Œæ˜¾ç¤ºçš„å°±æ˜¯å½“å‰æ˜¾å¡é©±åŠ¨æ‰€æ”¯æŒçš„CUDAä¿¡æ¯ï¼Œæ‰€è¦å®‰è£…çš„CUDAç‰ˆæœ¬ä¸å¾—å¤§äºè¿™é‡Œæ˜¾ç¤ºçš„ç‰ˆæœ¬ã€‚ç„¶åå‰å¾€<a href="https://developer.nvidia.com/zh-cn/cuda-downloads">CUDAå®˜ç½‘</a>ä¸‹è½½CUDAã€‚å»ºè®®åœ¨ä¸‹è½½ä¹‹å‰å…ˆå»å…¶ä»–ä¸€äº›ç½‘å€çœ‹ä¸€ä¸‹æ”¯æŒçš„CUDAç‰ˆæœ¬ï¼Œä»¥å…åˆ°æ—¶å€™é‡æ–°å®‰è£…</p>
<ul>
<li><a href="https://tensorflow.google.cn/install/source_windows">tensorflow</a> (æ¢æˆEnglishå¯ä»¥çœ‹æœ€æ–°æ”¯æŒ)</li>
<li><a href="https://pytorch.org/get-started/locally/">pytorch</a></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/GPUInfo.png" alt="GPUä¿¡æ¯" /></p>
<p>å¦‚æœå‘ç°è‡ªå·±å®‰è£…çš„ç‰ˆæœ¬æ²¡æœ‰å·²ç»æ„å»ºå¥½çš„ç‰ˆæœ¬è¿˜æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p>
<ul>
<li>è‡ªè¡Œä»æºç ç¼–è¯‘ï¼Œè¿™ç‚¹ä¸æ¨èï¼Œæƒ³èµ·æ¥æˆ‘ä¹‹é—´è‡ªå·±åœ¨æ ‘è“æ´¾ä¸Šé¢ç¼–è¯‘opencvçš„ç»å†é¢œæ–‡å­—(à²¥ _ à²¥)ï¼Œå¼ºçƒˆä¸æ¨èã€‚</li>
<li>å¸è½½é‡è£…CUDA</li>
</ul>
<p>é‡è£…CUDAæ¯”è¾ƒç®€å•,è§ä¸‹å›¾ä¸­çš„NVIDIAåº”ç”¨é™¤äº†<code>NVIDIAçš„å›¾å½¢é©±åŠ¨ç¨‹åº</code>å’Œ<code>NVIDIA Physxç³»ç»Ÿè½¯ä»¶</code>éƒ½å¸è½½å°±è¡Œã€‚å¦‚æœä¸‹ä¸åŠ¨çš„å°±ä½¿ç”¨è¿…é›·11ï¼Œæ–°ç‰ˆè¿…é›·é…åˆç½‘ç›˜ç®€ç›´ç¥ä¸€èˆ¬çš„ä½“éªŒã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/uninstall.png" alt="GPUä¿¡æ¯" /></p>
<p>å®‰è£…å®Œæˆåå¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œé¢ä½¿ç”¨<code>nvcc -V</code>çœ‹çœ‹ç»“æœã€‚</p>
<h2 id="cudnnå®‰è£…"><a class="markdownIt-Anchor" href="#cudnnå®‰è£…"></a> cuDNNå®‰è£…</h2>
<p>cuDNNå®‰è£…æ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆè¿›å…¥<a href="https://developer.nvidia.com/rdp/cudnn-archive">å®˜ç½‘</a>ï¼Œé€‰æ‹©ä½ å®‰è£…çš„CUDAçš„å¯¹åº”ç‰ˆæœ¬å³å¯ã€‚ä¸‹è½½ä¹Ÿéœ€è¦è¿›è¡Œæ³¨å†Œï¼Œå¡«ä¸€ä¸ªè°ƒæŸ¥é—®å·ï¼Œä½†æ˜¯å› ä¸ºæˆ‘å®åœ¨è¿›ä¸å»ï¼Œå°±ä½¿ç”¨è¿…é›·æ¥ç®¡ä¸‹è½½é“¾æ¥ä¹‹é—´ä¸‹è½½ã€‚å°†è§£å‹åçš„<code>bin</code>ã€<code>include</code>ã€<code>lib</code>ä¸‰ä¸ªæ–‡ä»¶å¤åˆ¶è¿›å…¥<code>C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v11.0</code>å³å¯ã€‚æˆ‘å®‰è£…çš„ç‰ˆæœ¬æ˜¯<code>8.0.4</code></p>
<h2 id="pytorchå®‰è£…"><a class="markdownIt-Anchor" href="#pytorchå®‰è£…"></a> pytorchå®‰è£…</h2>
<p>å¬é—»pytorchå®¹æ˜“è°ƒè¯•ï¼Œä¸”æ­å»ºç½‘ç»œæ¯”è¾ƒå¿«ï¼Œè€Œæˆ‘æ­¤å‰åªæ˜¯ç”¨è¿‡tensorflow2.0ä¸­çš„kerasè¿›è¡Œè¿‡æ­å»ºï¼Œå› æ­¤æœ¬æ¬¡æ¯•è®¾åˆæ­¥æ‰“ç®—ä½¿ç”¨pytorchä½œä¸ºå·¥å…·ï¼Œä¹Ÿå¯èƒ½ä¸ç”¨å‘¢(ï¿£yâ–½,ï¿£)â•­ ã€‚ä½¿ç”¨pytorchæ¨èçš„condaå®‰è£…æ–¹æ³•</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">conda install pytorch torchvision torchaudio cudatoolkit=11.0 -c pytorch</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨æ¸…åé•œåƒæºçš„ï¼Œæ˜¯å¦è¦åŠ <code>-c pytorch</code>è¿˜æ˜¯çœ‹ä½ çš„<code>.condarc</code>æ€ä¹ˆå†™çš„ï¼Œå¦‚æœå†™äº†<code>custom_channels</code>ä¸”é‡Œé¢çš„<code>pytorch</code>ä¹Ÿæ˜¯ç”¨äº†æ¸…åæºçš„å¯ä»¥åŠ ï¼Œæ²¡æœ‰çš„è¯å°±å»æ‰<code>-c pytorch</code>ï¼Œç„¶è€Œæˆ‘é•œåƒæºä¹Ÿä¸‹ä¸äº†ï¼ˆåäº†ï¼‰ï¼Œå‘ç°æµè§ˆå™¨ä¹Ÿä¸‹ä¸äº†ï¼Œå°±åªèƒ½ç”¨è¿…é›·æ¥ç®¡ä¸‹è½½ï¼Œç„¶åæœ¬åœ°å®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æœ¬åœ°å®‰è£…</span></span><br><span class="line">conda install --use-local cudatoolkit-11.0.221-h74a9793_0.conda</span><br><span class="line">conda install --use-local pytorch-1.7.1-py3.8_cuda110_cudnn8_0.tar.bz2</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿›è¡Œæµ‹è¯•<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/verify.png" alt="verify" /></p>
<h2 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h2>
<p>ç¯å¢ƒçš„æ­å»ºå°±åˆ°æ­¤ä¸ºæ­¢ï¼Œå®‰è£…å¹¶ä¸éš¾ï¼Œåªæ˜¯æˆ‘æ²¡æƒ³åˆ°æˆ‘å°½ç„¶ä¼šè¿é•œåƒæºéƒ½ä¸‹ä¸åŠ¨ğŸ˜©ã€‚åç»­è§†æƒ…å†µå¯èƒ½ä¼šä½¿ç”¨GPUæœåŠ¡å™¨ï¼Œä½†æ˜¯ç°åœ¨å…ˆåœ¨æœ¬åœ°æ”¶é›†æ•°æ®é›†å’Œé¢„å…ˆå­¦ä¹ ã€‚</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆäºŒï¼‰darknetç¼–è¯‘</title>
    <url>/2021/03/05/builddarknet/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h2>
<p>å¯’å‡è®­ç»ƒäº†4ä¸ªç‰ˆæœ¬çš„yoloï¼Œå…¶ä¸­yolov4å’Œyolov4-tinyæ˜¯åŸºäºdarknetçš„ã€‚ç”±äºéƒ½æ˜¯åœ¨<a href="https://colab.research.google.com/notebooks/welcome.ipynb">colab</a>ä¸Šè®­ç»ƒçš„ï¼Œä¸å¥½å±•ç¤ºï¼Œæ‰€ä»¥æ‰“ç®—åœ¨win10ä¸Šè·‘ä¸€ä¸‹ï¼Œå› æ­¤æœ¬æ–‡æ—¨åœ¨win10ç¼–è¯‘darknetçš„è¸©å‘è®°å½•ã€‚</p>
<h2 id="å®‰è£…visual-studio"><a class="markdownIt-Anchor" href="#å®‰è£…visual-studio"></a> å®‰è£…Visual Studio</h2>
<p>è¿™ä¸ªä¸ç”¨å¤šè¯´ï¼Œå®‰è£…2017æˆ–è€…2019ç‰ˆå°±è¡Œï¼Œéœ€è¦å¼€å¯è‹±è¯­è¯­è¨€</p>
<h2 id="å®‰è£…cuda"><a class="markdownIt-Anchor" href="#å®‰è£…cuda"></a> å®‰è£…CUDA</h2>
<p>å‚è€ƒä¸Šä¸€ç¯‡å®‰è£…CUDAå°±è¡Œï¼Œéœ€è¦CUDAv10.0ä»¥ä¸Šï¼Œå¹¶ä¸”å®‰è£…æ—¶è¦ç‚¹VSé›†æˆ</p>
<h2 id="vcpkgå®‰è£…"><a class="markdownIt-Anchor" href="#vcpkgå®‰è£…"></a> vcpkgå®‰è£…</h2>
<p>å‚è€ƒvcpkgçš„å®˜æ–¹ä¸‹è½½æ–¹å¼ï¼Œ<code>powershell</code>ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/microsoft/vcpkg</span><br><span class="line"><span class="built_in">cd</span> vcpkg</span><br><span class="line">bootstrap<span class="literal">-vcpkg</span>.bat</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ‰§è¡Œ<code>bootstrap-vcpkg.bat</code>æ—¶ï¼Œä¸‹è½½<code>vcpkg.exe</code>é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥ç›´æ¥å»<code>release</code>é‡Œé¢ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶</p>
<h2 id="vcpkgå®‰è£…ä¾èµ–"><a class="markdownIt-Anchor" href="#vcpkgå®‰è£…ä¾èµ–"></a> vcpkgå®‰è£…ä¾èµ–</h2>
<p>æ ¹æ®AlexeyABçš„repoè¯´æ˜ï¼Œ<code>powershell</code>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">vcpkg install darknet[<span class="type">full</span>]:x64<span class="literal">-windows</span></span><br></pre></td></tr></table></figure>
<h3 id="é‡åˆ°çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#é‡åˆ°çš„é—®é¢˜"></a> é‡åˆ°çš„é—®é¢˜</h3>
<p><strong>äº‹åå¾—çŸ¥ï¼Œæ­¤å¤„é‡åˆ°çš„ç½‘ç»œé—®é¢˜å¯ä»¥è¯•ä¸€è¯•æ ¡å›­ç½‘ï¼Œæ ¡å›­ç½‘ä¼¼ä¹å¯¹ä»å¤–ç½‘ä¸‹è½½æ–‡ä»¶æœ‰è¾ƒå¥½çš„æ•ˆæœ</strong></p>
<p>å®‰è£…opencvæ—¶ï¼Œéœ€è¦ä»<code>raw.githubusercontent.com</code>ä¸‹è½½ä¸œè¥¿ï¼Œç„¶è€Œé‡åˆ°äº†hosté—®é¢˜ã€‚é¦–å…ˆå°è¯•ä¿®æ”¹äº†hostï¼Œç»“æœé‡åˆ°äº†<code>SSL connect error</code>é—®é¢˜ï¼Œäºæ˜¯åœ¨åŠ äº†å‡ ä¸ªhostå‘ç°è¿˜æ˜¯å¤±è´¥äº†ã€‚é‚å°è¯•ä½¿ç”¨VPNä»£ç†ï¼ŒæŒ‰ç…§è¾“å‡ºå°†<code>HTTP_PROXY</code>å’Œ<code>HTTPS_PROXY</code>åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ï¼Œä¾ç„¶ä¸è¡Œã€‚å°è¯•ç›´æ¥åœ¨powershellä¸­ä½¿ç”¨å˜é‡ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$env:HTTPS_PROXY</span>=<span class="string">&quot;https://127.0.0.1:7890/&quot;</span></span><br><span class="line"><span class="variable">$env:HTTP_PROXY</span>=<span class="string">&quot;http://127.0.0.1:7890/&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶çš„stausè¾“å‡ºä¸º</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Failed. Status: <span class="number">4</span>;<span class="string">&quot;A requested feature, protocol or option was not found built-in in this libcurl due to a build-time decision.&quot;</span></span><br><span class="line"></span><br><span class="line">Failed to download file.</span><br><span class="line"><span class="keyword">If</span> you use a proxy, please <span class="built_in">set</span> the HTTPS_PROXY and HTTP_PROXY environment variables to <span class="string">&quot;https://user:password@your-proxy-ip-address:port/&quot;</span>.</span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> error with status <span class="number">4</span> (Issue <span class="comment">#15434),</span></span><br><span class="line"><span class="keyword">try</span> setting <span class="string">&quot;http://user:password@your-proxy-ip-address:port/&quot;</span>.</span><br><span class="line"></span><br><span class="line">Otherwise, please submit an issue at https://github.com/Microsoft/vcpkg/issues</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å› æ­¤æ ¹æ®è¦æ±‚æ‰§è¡Œä¸‹é¢ä»£ç </p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$env:HTTPS_PROXY</span>=<span class="string">&quot;http://127.0.0.1:7890/&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶é‡æ–°æ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œå³å¯å®Œæˆä¸‹è½½ã€‚</p>
<p>å®‰è£…opencvæ—¶é‡åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CMake Error at scripts/cmake/vcpkg_execute_build_process.cmake:144 (message):</span><br><span class="line">    Command failed: C:/src/vcpkg/downloads/tools/cmake-3.19.2-windows/cmake-3.19.2-win32-x86/bin/cmake.exe --build . --config Debug --target install -- -v -j9</span><br><span class="line">    Working Directory: C:/src/vcpkg/buildtrees/opencv4/x64-windows-dbg</span><br><span class="line">    See logs for more information:</span><br><span class="line">      C:\src\vcpkg\buildtrees\opencv4\install-x64-windows-dbg-out.log</span><br><span class="line"></span><br><span class="line">Call Stack (most recent call first):</span><br><span class="line">  scripts/cmake/vcpkg_build_cmake.cmake:96 (vcpkg_execute_build_process)</span><br><span class="line">  scripts/cmake/vcpkg_install_cmake.cmake:27 (vcpkg_build_cmake)</span><br><span class="line">  ports/opencv4/portfile.cmake:385 (vcpkg_install_cmake)</span><br><span class="line">  scripts/ports.cmake:133 (include)</span><br></pre></td></tr></table></figure>
<p>å°è¯•å¦‚ä¸‹æŒ‡ä»¤</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">vcpkg install darknet[<span class="type">opencv</span>-<span class="type">base</span>,<span class="type">cuda</span>,<span class="type">cudnn</span>]:x64<span class="literal">-windows</span></span><br></pre></td></tr></table></figure>
<h2 id="ç¼–è¯‘darknet"><a class="markdownIt-Anchor" href="#ç¼–è¯‘darknet"></a> ç¼–è¯‘darknet</h2>
<p>æå‰å®‰è£…<a href="https://github.com/ninja-build/ninja">ninja</a>å¹¶æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</p>
<p>ä¿®æ”¹<code>Makefile</code></p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">GPU=1</span><br><span class="line">CUDNN=1</span><br><span class="line">CUDNN_HALF=1</span><br><span class="line">OPENCV=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘æ˜¯gtx1050ï¼Œæ ¹æ®makefileé‡Œé¢çš„æ³¨é‡Šè‡ªå·±çš„ä¿®æ”¹</span></span><br><span class="line">ARCH= -gencode arch=compute_61,code=sm_61 -gencode arch=compute_61,code=compute_61 </span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§AlexeyABçš„repoï¼Œæ‰§è¡Œå¦‚ä¸‹ä»£ç ï¼Œæ³¨æ„CMakeçš„ç‰ˆæœ¬ï¼Œè¿‡ä½å°†æ— æ³•ç¼–è¯‘ã€‚æ³¨æ„ä¸‹é¢çš„é¡ºåºï¼Œå¦‚æœæœ‰é—®é¢˜éœ€è¦æ¸…ç†ä¸€ä¸‹ç¼“å­˜ï¼Œä¸ç„¶ä¼šä¸€ç›´ç¼–è¯‘å¤±è´¥</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$env:VCPKG_ROOT</span>=<span class="string">&quot;vcpkgçš„ä½ç½®&quot;</span></span><br><span class="line">git clone https://github.com/AlexeyAB/darknet</span><br><span class="line"><span class="built_in">cd</span> darknet</span><br><span class="line">powershell <span class="literal">-ExecutionPolicy</span> Bypass <span class="operator">-File</span> .\build.ps1</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ­£ç¡®æ‰§è¡Œä¸Šè¿°æ­¥éª¤çš„è¯ï¼Œç¼–è¯‘æ˜¯ä¸ä¼šå‡ºé”™çš„</p>
<h2 id="æµ‹è¯•darknet"><a class="markdownIt-Anchor" href="#æµ‹è¯•darknet"></a> æµ‹è¯•darknet</h2>
<h3 id="åŸå›¾"><a class="markdownIt-Anchor" href="#åŸå›¾"></a> åŸå›¾</h3>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/origin.jpg" alt="origin" /></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">darknet.exe detector test cfg/coco.data cfg/yolov4.cfg yolov4.weights origin.jpg  <span class="literal">-thresh</span> <span class="number">0.25</span></span><br></pre></td></tr></table></figure>
<h3 id="è¾“å‡º"><a class="markdownIt-Anchor" href="#è¾“å‡º"></a> è¾“å‡º</h3>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CUDA-version: 11000 (11000), cuDNN: 8.0.4, GPU count: 1  </span><br><span class="line"> OpenCV version: 4.5.1</span><br><span class="line"> 0 : compute_capability = 610, cudnn_half = 0, GPU: GeForce GTX 1050 </span><br><span class="line">net.optimized_memory = 0 </span><br><span class="line">mini_batch = 1, batch = 8, time_steps = 1, train = 0</span><br><span class="line">   layer   filters  size/strd(dil)      input                output</span><br><span class="line">   0 Create CUDA-stream - 0</span><br><span class="line"> Create cudnn-handle 0 </span><br><span class="line">conv     32       3 x 3/ 1    608 x 608 x   3 -&gt;  608 x 608 x  32 0.639 BF</span><br><span class="line">   1 conv     64       3 x 3/ 2    608 x 608 x  32 -&gt;  304 x 304 x  64 3.407 BF</span><br><span class="line">   2 conv     64       1 x 1/ 1    304 x 304 x  64 -&gt;  304 x 304 x  64 0.757 BF</span><br><span class="line">   3 route  1                                      -&gt;  304 x 304 x  64 </span><br><span class="line">   4 conv     64       1 x 1/ 1    304 x 304 x  64 -&gt;  304 x 304 x  64 0.757 BF</span><br><span class="line">   5 conv     32       1 x 1/ 1    304 x 304 x  64 -&gt;  304 x 304 x  32 0.379 BF</span><br><span class="line">   6 conv     64       3 x 3/ 1    304 x 304 x  32 -&gt;  304 x 304 x  64 3.407 BF</span><br><span class="line">   7 Shortcut Layer: 4,  wt = 0, wn = 0, outputs: 304 x 304 x  64 0.006 BF</span><br><span class="line">   8 conv     64       1 x 1/ 1    304 x 304 x  64 -&gt;  304 x 304 x  64 0.757 BF</span><br><span class="line">   9 route  8 2                                    -&gt;  304 x 304 x 128 </span><br><span class="line">  10 conv     64       1 x 1/ 1    304 x 304 x 128 -&gt;  304 x 304 x  64 1.514 BF</span><br><span class="line">  11 conv    128       3 x 3/ 2    304 x 304 x  64 -&gt;  152 x 152 x 128 3.407 BF</span><br><span class="line">  12 conv     64       1 x 1/ 1    152 x 152 x 128 -&gt;  152 x 152 x  64 0.379 BF</span><br><span class="line">  13 route  11                                     -&gt;  152 x 152 x 128</span><br><span class="line">  14 conv     64       1 x 1/ 1    152 x 152 x 128 -&gt;  152 x 152 x  64 0.379 BF</span><br><span class="line">  15 conv     64       1 x 1/ 1    152 x 152 x  64 -&gt;  152 x 152 x  64 0.189 BF</span><br><span class="line">  16 conv     64       3 x 3/ 1    152 x 152 x  64 -&gt;  152 x 152 x  64 1.703 BF</span><br><span class="line">  17 Shortcut Layer: 14,  wt = 0, wn = 0, outputs: 152 x 152 x  64 0.001 BF</span><br><span class="line">  18 conv     64       1 x 1/ 1    152 x 152 x  64 -&gt;  152 x 152 x  64 0.189 BF</span><br><span class="line">  19 conv     64       3 x 3/ 1    152 x 152 x  64 -&gt;  152 x 152 x  64 1.703 BF</span><br><span class="line">  20 Shortcut Layer: 17,  wt = 0, wn = 0, outputs: 152 x 152 x  64 0.001 BF</span><br><span class="line">  21 conv     64       1 x 1/ 1    152 x 152 x  64 -&gt;  152 x 152 x  64 0.189 BF</span><br><span class="line">  22 route  21 12                                  -&gt;  152 x 152 x 128 </span><br><span class="line">  23 conv    128       1 x 1/ 1    152 x 152 x 128 -&gt;  152 x 152 x 128 0.757 BF</span><br><span class="line">  24 conv    256       3 x 3/ 2    152 x 152 x 128 -&gt;   76 x  76 x 256 3.407 BF</span><br><span class="line">  25 conv    128       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 128 0.379 BF</span><br><span class="line">  26 route  24                                     -&gt;   76 x  76 x 256</span><br><span class="line">  27 conv    128       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 128 0.379 BF</span><br><span class="line">  28 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  29 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  30 Shortcut Layer: 27,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  31 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  32 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  33 Shortcut Layer: 30,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  34 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  35 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  36 Shortcut Layer: 33,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  37 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  38 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  39 Shortcut Layer: 36,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  40 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  41 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  42 Shortcut Layer: 39,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  43 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  44 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  45 Shortcut Layer: 42,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  46 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  47 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  48 Shortcut Layer: 45,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  49 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  50 conv    128       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 1.703 BF</span><br><span class="line">  51 Shortcut Layer: 48,  wt = 0, wn = 0, outputs:  76 x  76 x 128 0.001 BF</span><br><span class="line">  52 conv    128       1 x 1/ 1     76 x  76 x 128 -&gt;   76 x  76 x 128 0.189 BF</span><br><span class="line">  53 route  52 25                                  -&gt;   76 x  76 x 256 </span><br><span class="line">  54 conv    256       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 256 0.757 BF</span><br><span class="line">  55 conv    512       3 x 3/ 2     76 x  76 x 256 -&gt;   38 x  38 x 512 3.407 BF</span><br><span class="line">  56 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line">  57 route  55                                     -&gt;   38 x  38 x 512</span><br><span class="line">  58 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line">  59 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  60 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  61 Shortcut Layer: 58,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  62 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  63 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  64 Shortcut Layer: 61,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  65 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  66 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  67 Shortcut Layer: 64,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  68 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  69 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  70 Shortcut Layer: 67,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  71 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  72 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  73 Shortcut Layer: 70,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  74 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  75 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  76 Shortcut Layer: 73,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  77 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  78 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  79 Shortcut Layer: 76,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  80 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  81 conv    256       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 1.703 BF</span><br><span class="line">  82 Shortcut Layer: 79,  wt = 0, wn = 0, outputs:  38 x  38 x 256 0.000 BF</span><br><span class="line">  83 conv    256       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 256 0.189 BF</span><br><span class="line">  84 route  83 56                                  -&gt;   38 x  38 x 512 </span><br><span class="line">  85 conv    512       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 512 0.757 BF</span><br><span class="line">  86 conv   1024       3 x 3/ 2     38 x  38 x 512 -&gt;   19 x  19 x1024 3.407 BF</span><br><span class="line">  87 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line">  88 route  86                                     -&gt;   19 x  19 x1024</span><br><span class="line">  89 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line">  90 conv    512       1 x 1/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.189 BF</span><br><span class="line">  91 conv    512       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 1.703 BF</span><br><span class="line">  92 Shortcut Layer: 89,  wt = 0, wn = 0, outputs:  19 x  19 x 512 0.000 BF</span><br><span class="line">  93 conv    512       1 x 1/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.189 BF</span><br><span class="line">  94 conv    512       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 1.703 BF</span><br><span class="line">  95 Shortcut Layer: 92,  wt = 0, wn = 0, outputs:  19 x  19 x 512 0.000 BF</span><br><span class="line">  96 conv    512       1 x 1/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.189 BF</span><br><span class="line">  97 conv    512       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 1.703 BF</span><br><span class="line">  98 Shortcut Layer: 95,  wt = 0, wn = 0, outputs:  19 x  19 x 512 0.000 BF</span><br><span class="line">  99 conv    512       1 x 1/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.189 BF</span><br><span class="line"> 100 conv    512       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 1.703 BF</span><br><span class="line"> 101 Shortcut Layer: 98,  wt = 0, wn = 0, outputs:  19 x  19 x 512 0.000 BF</span><br><span class="line"> 102 conv    512       1 x 1/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.189 BF</span><br><span class="line"> 103 route  102 87                                 -&gt;   19 x  19 x1024</span><br><span class="line"> 104 conv   1024       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x1024 0.757 BF</span><br><span class="line"> 105 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line"> 106 conv   1024       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x1024 3.407 BF</span><br><span class="line"> 107 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line"> 108 max                5x 5/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.005 BF</span><br><span class="line"> 109 route  107                                            -&gt;   19 x  19 x 512</span><br><span class="line"> 110 max                9x 9/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.015 BF</span><br><span class="line"> 111 route  107                                            -&gt;   19 x  19 x 512</span><br><span class="line"> 112 max               13x13/ 1     19 x  19 x 512 -&gt;   19 x  19 x 512 0.031 BF</span><br><span class="line"> 113 route  112 110 108 107                        -&gt;   19 x  19 x2048</span><br><span class="line"> 114 conv    512       1 x 1/ 1     19 x  19 x2048 -&gt;   19 x  19 x 512 0.757 BF</span><br><span class="line"> 115 conv   1024       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x1024 3.407 BF</span><br><span class="line"> 116 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line"> 117 conv    256       1 x 1/ 1     19 x  19 x 512 -&gt;   19 x  19 x 256 0.095 BF</span><br><span class="line"> 118 upsample                 2x    19 x  19 x 256 -&gt;   38 x  38 x 256</span><br><span class="line"> 119 route  85                                     -&gt;   38 x  38 x 512</span><br><span class="line"> 120 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 121 route  120 118                                -&gt;   38 x  38 x 512 </span><br><span class="line"> 122 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 123 conv    512       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 512 3.407 BF</span><br><span class="line"> 124 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 125 conv    512       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 512 3.407 BF</span><br><span class="line"> 126 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 127 conv    128       1 x 1/ 1     38 x  38 x 256 -&gt;   38 x  38 x 128 0.095 BF</span><br><span class="line"> 128 upsample                 2x    38 x  38 x 128 -&gt;   76 x  76 x 128</span><br><span class="line"> 129 route  54                                     -&gt;   76 x  76 x 256</span><br><span class="line"> 130 conv    128       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 128 0.379 BF</span><br><span class="line"> 131 route  130 128                                -&gt;   76 x  76 x 256</span><br><span class="line"> 132 conv    128       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 128 0.379 BF</span><br><span class="line"> 133 conv    256       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 256 3.407 BF</span><br><span class="line"> 134 conv    128       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 128 0.379 BF</span><br><span class="line"> 135 conv    256       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 256 3.407 BF</span><br><span class="line"> 136 conv    128       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 128 0.379 BF</span><br><span class="line"> 137 conv    256       3 x 3/ 1     76 x  76 x 128 -&gt;   76 x  76 x 256 3.407 BF</span><br><span class="line"> 138 conv    255       1 x 1/ 1     76 x  76 x 256 -&gt;   76 x  76 x 255 0.754 BF</span><br><span class="line"> 139 yolo</span><br><span class="line">[yolo] params: iou loss: ciou (4), iou_norm: 0.07, obj_norm: 1.00, cls_norm: 1.00, delta_norm: 1.00, scale_x_y: 1.20</span><br><span class="line">nms_kind: greedynms (1), beta = 0.600000</span><br><span class="line"> 140 route  136                                            -&gt;   76 x  76 x 128</span><br><span class="line"> 141 conv    256       3 x 3/ 2     76 x  76 x 128 -&gt;   38 x  38 x 256 0.852 BF</span><br><span class="line"> 142 route  141 126                                -&gt;   38 x  38 x 512 </span><br><span class="line"> 143 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 144 conv    512       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 512 3.407 BF</span><br><span class="line"> 145 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 146 conv    512       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 512 3.407 BF</span><br><span class="line"> 147 conv    256       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 256 0.379 BF</span><br><span class="line"> 148 conv    512       3 x 3/ 1     38 x  38 x 256 -&gt;   38 x  38 x 512 3.407 BF</span><br><span class="line"> 149 conv    255       1 x 1/ 1     38 x  38 x 512 -&gt;   38 x  38 x 255 0.377 BF</span><br><span class="line"> 150 yolo</span><br><span class="line">[yolo] params: iou loss: ciou (4), iou_norm: 0.07, obj_norm: 1.00, cls_norm: 1.00, delta_norm: 1.00, scale_x_y: 1.10</span><br><span class="line">nms_kind: greedynms (1), beta = 0.600000</span><br><span class="line"> 151 route  147                                            -&gt;   38 x  38 x 256</span><br><span class="line"> 152 conv    512       3 x 3/ 2     38 x  38 x 256 -&gt;   19 x  19 x 512 0.852 BF</span><br><span class="line"> 153 route  152 116                                -&gt;   19 x  19 x1024</span><br><span class="line"> 154 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line"> 155 conv   1024       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x1024 3.407 BF</span><br><span class="line"> 156 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line"> 157 conv   1024       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x1024 3.407 BF</span><br><span class="line"> 158 conv    512       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 512 0.379 BF</span><br><span class="line"> 159 conv   1024       3 x 3/ 1     19 x  19 x 512 -&gt;   19 x  19 x1024 3.407 BF</span><br><span class="line"> 160 conv    255       1 x 1/ 1     19 x  19 x1024 -&gt;   19 x  19 x 255 0.189 BF</span><br><span class="line"> 161 yolo</span><br><span class="line">[yolo] params: iou loss: ciou (4), iou_norm: 0.07, obj_norm: 1.00, cls_norm: 1.00, delta_norm: 1.00, scale_x_y: 1.05</span><br><span class="line">nms_kind: greedynms (1), beta = 0.600000</span><br><span class="line">Total BFLOPS 128.459</span><br><span class="line">avg_outputs = 1068395</span><br><span class="line"> Allocate additional workspace_size = 52.43 MB</span><br><span class="line">Loading weights from yolov4.weights...</span><br><span class="line"> seen 64, trained: 32032 K-images (500 Kilo-batches_64)</span><br><span class="line">Done! Loaded 162 layers from weights-file </span><br><span class="line"> Detection layer: 139 - type = 28 </span><br><span class="line"> Detection layer: 150 - type = 28 </span><br><span class="line"> Detection layer: 161 - type = 28</span><br><span class="line">origin.jpg: Predicted in 184.923000 milli-seconds.</span><br><span class="line">person: 98%</span><br><span class="line">car: 94%</span><br><span class="line">truck: 31%</span><br><span class="line">car: 88%</span><br><span class="line">car: 99%</span><br><span class="line">person: 99%</span><br><span class="line">person: 37%</span><br><span class="line">car: 99%</span><br><span class="line">bus: 57%</span><br><span class="line">truck: 60%</span><br><span class="line">car: 99%</span><br></pre></td></tr></table></figure>
<h3 id="ç»“æœ"><a class="markdownIt-Anchor" href="#ç»“æœ"></a> ç»“æœ</h3>
<p>å¯ä»¥çœ‹åˆ°é¢„æµ‹ç»“æœï¼ŒåŒæ—¶darkneté‡Œé¢ä¹Ÿè¾“å‡ºäº†GPUçš„ä¿¡æ¯<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/predictions.jpg" alt="predictions" /></p>
<h2 id="ç»“è®º"><a class="markdownIt-Anchor" href="#ç»“è®º"></a> ç»“è®º</h2>
<p>win10ç‰ˆæœ¬çš„darknet gpuç‰ˆæœ¬å®‰è£…å®Œæˆã€‚é“è·¯åå·ï¼Œè®°å½•ä¸‹è¸©è¿‡çš„å‘</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
        <tag>darknet</tag>
      </tags>
  </entry>
  <entry>
    <title>win10å®¶åº­ç‰ˆä¸‹å®‰è£…docker</title>
    <url>/2021/03/18/installDocker/</url>
    <content><![CDATA[<p>å› ä¸ºè£…è½¯ä»¶ã€è£…ç¯å¢ƒè€æ˜¯æŠ˜è…¾ï¼Œå°±å¼€å§‹æ€è€ƒå„ä¸ªç”Ÿäº§ç¯å¢ƒä¹‹é—´éš”ç¦»æˆ–è€…ç›´æ¥ä½¿ç”¨ä»–äººé…å¥½çš„ç¯å¢ƒã€‚å› è€Œæƒ³åˆ°äº†äººä»¬å¸¸è¯´çš„dockerã€‚å› æ­¤æ‰“ç®—å®‰è£…æ¥ä½“éªŒä¸€ä¸‹</p>
<span id="more"></span>
<h1 id="ç³»ç»Ÿè¦æ±‚"><a class="markdownIt-Anchor" href="#ç³»ç»Ÿè¦æ±‚"></a> ç³»ç»Ÿè¦æ±‚</h1>
<p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œ<code>Docker Desktop on Windows</code>éœ€è¦win10ä¸“ä¸šç‰ˆã€ä¼ä¸šç‰ˆæˆ–è€…æ•™è‚²ç‰ˆ(Build 17134 or later)ã€‚è€Œæˆ‘çš„ç”µè„‘ä¸ºwin10å®¶åº­ç‰ˆï¼Œå› æ­¤é€‰æ‹©å¦ä¸€å¥—æ–¹æ¡ˆã€‚</p>
<p>win10å®¶åº­ç‰ˆçš„ç³»ç»Ÿè¦æ±‚å¦‚ä¸‹</p>
<ul>
<li>win10 v1903ç‰ˆæœ¬æˆ–è€…æ›´é«˜</li>
<li>å¼€å¯WSL2
<ul>
<li>64ä½å¤„ç†å™¨ä¸”æœ‰SLATæŒ‡ä»¤</li>
<li>4Gå†…å­˜</li>
<li>BIOSå¼€å¯è™šæ‹ŸåŒ–</li>
</ul>
</li>
<li>ä¸‹è½½å¹¶å‡çº§<a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10#step-4---download-the-linux-kernel-update-package">linuxå†…æ ¸åŒ…</a></li>
</ul>
<h1 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h1>
<ol>
<li>ä¸‹è½½<a href="https://desktop.docker.com/win/stable/Docker%20Desktop%20Installer.exe">Docker Desktop Installer</a>å¹¶åŒå‡»è¿è¡Œ</li>
<li>ç¡®ä¿WSL2é‚£ä¸ªç‰¹æ€§æ‰“å¼€<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.5/dockerInstallerConfig.png" alt="enable WSL2" /></li>
<li>è·Ÿç€å®‰è£…å¸®åŠ©å³å¯</li>
</ol>
<h2 id="é”™è¯¯"><a class="markdownIt-Anchor" href="#é”™è¯¯"></a> é”™è¯¯</h2>
<p>æˆ‘å°±çŸ¥é“å®‰è£…æ²¡æœ‰è¿™ä¹ˆå®¹æ˜“ï¼Œæœç„¶ç¢°åˆ°äº†é—®é¢˜ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.5/error.png" alt="error" /><br />
é€šè¿‡<code>everything</code>æˆ‘æ‰¾åˆ°äº†<code>install-log.txt</code>ã€‚ç„¶è€Œé‡Œé¢çš„å…³é”®ä¿¡æ¯å°±è¿™ä¹ˆç‚¹ã€‚æ˜æ˜å·²ç»ç”¨ç®¡ç†å‘˜è¿è¡Œäº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœªæˆæƒã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Exception type: System.Exception, Exception message: Component CommunityInstaller.AutoStartAction failed: å°è¯•æ‰§è¡Œæœªç»æˆæƒçš„æ“ä½œã€‚, StackTrace:</span><br><span class="line">   åœ¨ CommunityInstaller.InstallWorkflow.&lt;DoHandleD4WPackageAsync&gt;d__29.MoveNext()</span><br><span class="line">--- å¼•å‘å¼‚å¸¸çš„ä¸Šä¸€ä½ç½®ä¸­å †æ ˆè·Ÿè¸ªçš„æœ«å°¾ ---</span><br><span class="line">   åœ¨ System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()</span><br><span class="line">   åœ¨ System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)</span><br><span class="line">   åœ¨ CommunityInstaller.InstallWorkflow.&lt;DoProcessAsync&gt;d__23.MoveNext()</span><br></pre></td></tr></table></figure>
<p>å°±åœ¨æˆ‘ä¸€ç­¹è«å±•çš„æ—¶å€™ï¼Œæˆ‘çœ‹åˆ°äº†ä¸€ä¸ªæœåŠ¡å™¨éƒ¨ç½²win10æœåŠ¡æœªæˆæƒè§£å†³çš„æ–‡ç« ï¼Œè¯´æ˜¯360é˜»æ–­äº†ã€‚äºæ˜¯æˆ‘å°è¯•å°†æˆ‘çš„è”æƒ³ç”µè„‘ç®¡å®¶å…³é—­ï¼Œæœç„¶å®‰è£…æˆåŠŸäº†ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.5/docker.png" alt="docker" /></p>
<h1 id="å‚è€ƒæ¡£æ¡ˆ"><a class="markdownIt-Anchor" href="#å‚è€ƒæ¡£æ¡ˆ"></a> å‚è€ƒæ¡£æ¡ˆ</h1>
<p><a href="https://docs.docker.com/docker-for-windows/install/">docker for win10 pro</a></p>
<p><a href="https://docs.docker.com/docker-for-windows/install-windows-home/">docker for win10 home</a></p>
<p><a href="https://qianxu.run/2020/10/23/upgradeWSL2/">WSL2å®‰è£…</a></p>
<p><a href="https://blog.csdn.net/qq736150416/article/details/80137675">çµæ„Ÿ</a></p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>MinGWç¼–è¯‘C++æ— æ³•è¾“å‡ºstring</title>
    <url>/2021/03/19/mingw64problem/</url>
    <content><![CDATA[<p>åœ¨è°ƒè¯•ç¨‹åºçš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªå¥‡è‘©çš„é—®é¢˜ï¼ŒC++æ— æ³•ä½¿ç”¨stringã€‚æœ€åå‘ç°å±…ç„¶æ˜¯MinGW64çš„é—®é¢˜</p>
<span id="more"></span>
<h1 id="èµ·å› "><a class="markdownIt-Anchor" href="#èµ·å› "></a> èµ·å› </h1>
<p>åœ¨å¸®åŠ©åˆ«äººè°ƒè¯•<a href="https://github.com/hediet/vscode-debug-visualizer">vscode-debug-visualizer</a>è¿™ä¸ªæ’ä»¶çš„æ—¶å€™ï¼Œé‡åˆ°äº†æ— æ³•å‡ºç»“æœçš„é—®é¢˜ã€‚ç»è¿‡ä¸€ç³»åˆ—å®šä½åå‘ç°ï¼Œå±…ç„¶æ˜¯ä½¿ç”¨äº†stringå°±æ— æ³•è¿è¡Œï¼Œè€Œç¼–è¯‘ä¸ä¼šå‡ºé”™ã€‚</p>
<h1 id="æµ‹è¯•ç¨‹åº"><a class="markdownIt-Anchor" href="#æµ‹è¯•ç¨‹åº"></a> æµ‹è¯•ç¨‹åº</h1>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//main.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// visualize `myGraphJson`!</span></span><br><span class="line">    string myGraphJson = <span class="string">&quot;&#123;\&quot;kind\&quot;:&#123;\&quot;graph\&quot;:true&#125;,&quot;</span></span><br><span class="line">        <span class="string">&quot;\&quot;nodes\&quot;:[&#123;\&quot;id\&quot;:\&quot;1\&quot;&#125;,&#123;\&quot;id\&quot;:\&quot;2\&quot;&#125;],&quot;</span></span><br><span class="line">        <span class="string">&quot;\&quot;edges\&quot;:[&#123;\&quot;from\&quot;:\&quot;1\&quot;,\&quot;to\&quot;:\&quot;2\&quot;&#125;]&#125;&quot;</span>;</span><br><span class="line">    cout &lt;&lt; myGraphJson;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="é”™è¯¯ç°è±¡"><a class="markdownIt-Anchor" href="#é”™è¯¯ç°è±¡"></a> é”™è¯¯ç°è±¡</h1>
<p>ä½¿ç”¨ç¼–è¯‘æŒ‡ä»¤å¦‚ä¸‹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">g++ <span class="literal">-g</span> main.c <span class="literal">-o</span> main.exe</span><br></pre></td></tr></table></figure>
<p>ç»“æœæ­£å¸¸ï¼Œè¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.\main.exe</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºä¸ºç©º</p>
<p>ä½¿ç”¨gdbè¿›è¡Œdebugã€‚é”™è¯¯å¦‚ä¸‹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ERROR: Unable to <span class="built_in">start</span> debugging. Unexpected GDB output from command <span class="string">&quot;-exec-run&quot;</span>. During startup program exited with code <span class="number">0</span>xc0000139.</span><br></pre></td></tr></table></figure>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ¡ˆ"></a> è§£å†³æ–¹æ¡ˆ</h1>
<p>åœ¨<a href="https://stackoverflow.com/questions/18668003/the-procedure-entry-point-gxx-personality-v0-could-not-be-located">stackoverflow</a>ä¸Šæ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä»<code>MinGW</code>çš„å®‰è£…ç›®å½•é‡Œé¢æ‰¾åˆ°<code>bin</code>æ–‡ä»¶å¤¹ã€‚å°†é‡Œé¢çš„<code>libstdc++-6.dll</code>æ‹·è´åˆ°å·¥ä½œç›®å½•ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">+ .vscode</span><br><span class="line">    launch.json</span><br><span class="line">    tasks.json</span><br><span class="line">libstdc++-6.dll</span><br><span class="line">main.cpp</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡è¿›è¡Œç¼–è¯‘ã€è¿è¡Œ</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">g++ <span class="literal">-g</span> main.c <span class="literal">-o</span> main.exe</span><br><span class="line">.\main.exe</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">&quot;kind&quot;</span>:&#123;<span class="string">&quot;graph&quot;</span>:true&#125;,<span class="string">&quot;nodes&quot;</span>:[&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;,&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2&quot;</span>&#125;],<span class="string">&quot;edges&quot;</span>:[&#123;<span class="string">&quot;from&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;to&quot;</span>:<span class="string">&quot;2&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure>
<p>gdbçš„debugç»“æœæ­£å¸¸</p>
<h1 id="åæ§½"><a class="markdownIt-Anchor" href="#åæ§½"></a> åæ§½</h1>
<p>è¿™ä¸ªé—®é¢˜åœ¨7å¹´å‰å°±è¢«æå‡ºäº†ï¼Œå±…ç„¶ç°åœ¨è¿˜æœ‰ã€‚MinGWçœŸæ˜¯å‘å•Šï¼Œç”¨äº†ç¯å¢ƒå˜é‡ä¹Ÿæ²¡ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…tensorflow-gpuç‰ˆæœ¬</title>
    <url>/2021/03/26/install-tensorflow-gpu/</url>
    <content><![CDATA[<p>å¯¹äºä¸ªäººè€Œè¨€ï¼Œè¿˜æ˜¯æ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨tensorflowçš„keras</p>
<span id="more"></span>
<h1 id="å®‰è£…cudaå’Œcudnn"><a class="markdownIt-Anchor" href="#å®‰è£…cudaå’Œcudnn"></a> å®‰è£…cudaå’Œcudnn</h1>
<p>å®‰è£…æ–¹æ³•å¯ä»¥è§<a href="https://qianxu.run/2021/01/18/installpytorch/">pytorchçš„å®‰è£…</a>ï¼Œå¯¹äºtensorflowå·²æœ‰çš„gpuæ”¯æŒå¯ä»¥è§<a href="https://tensorflow.google.cn/install/source_windows#gpu">æ­¤</a>ã€‚ä¸æå‰è£…cudaå’Œcudnnçš„æ–¹æ³•è§<a href="#%E4%BD%BF%E7%94%A8conda%E5%AE%89%E8%A3%85cuda%E5%92%8Ccudnn">ä½¿ç”¨condaå®‰è£…cudaå’Œcudnn</a></p>
<h1 id="å®‰è£…tensorflow-gpu"><a class="markdownIt-Anchor" href="#å®‰è£…tensorflow-gpu"></a> å®‰è£…tensorflow-gpu</h1>
<p>ç”±äºæˆ‘åˆšå¥½ç¬¦åˆ<code>tensorflow-gpu 2.4.0</code>ï¼Œè€Œ<code>conda</code>è¿˜æ²¡æœ‰è¿™ä¸ªåŒ…ï¼Œå› æ­¤ä½¿ç”¨<code>pip</code>è¿›è¡Œå®‰è£…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install tensorflow-gpu==<span class="number">2.4</span><span class="number">.0</span> -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>
<p>é•œåƒæºå¯èƒ½ä¸‹è½½é€Ÿåº¦è¿˜æ˜¯ä¸è¡Œï¼Œå¯ä»¥ç›´æ¥æœ¬åœ°å®‰è£…</p>
<h1 id="éªŒè¯gpu"><a class="markdownIt-Anchor" href="#éªŒè¯gpu"></a> éªŒè¯gpu</h1>
<p>è¿è¡Œä»£ç </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tf.__version__)</span><br><span class="line"><span class="built_in">print</span>(tf.config.list_physical_devices())</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">35.277510</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cudart64_110.dll2.<span class="number">4.0</span></span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.259583</span>: I tensorflow/compiler/jit/xla_cpu_device.cc:<span class="number">41</span>] Not creating XLA devices, tf_xla_enable_xla_devices not <span class="built_in">set</span></span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.261539</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library nvcuda.dll      </span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.307535</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1720</span>] Found device <span class="number">0</span> with properties: </span><br><span class="line">pciBusID: <span class="number">0000</span>:<span class="number">01</span>:<span class="number">00.0</span> name: GeForce GTX <span class="number">1050</span> computeCapability: <span class="number">6.1</span></span><br><span class="line">coreClock: <span class="number">1.493</span>GHz coreCount: <span class="number">5</span> deviceMemorySize: <span class="number">2.00</span>GiB deviceMemoryBandwidth: <span class="number">104.43</span>GiB/s</span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.308404</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cudart64_110.dll2021<span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.322068</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cublas64_11.dll </span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.322414</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cublasLt64_11.dll</span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.329903</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cufft64_10.dll  </span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.332538</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library curand64_10.dll </span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.347776</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cusolver64_10.dll</span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.357722</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cusparse64_11.dll</span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.362238</span>: I tensorflow/stream_executor/platform/default/dso_loader.cc:<span class="number">49</span>] Successfully opened dynamic library cudnn64_8.dll   </span><br><span class="line"><span class="number">2021</span><span class="literal">-03-26</span> <span class="number">17</span>:<span class="number">00</span>:<span class="number">39.362701</span>: I tensorflow/core/common_runtime/gpu/gpu_device.cc:<span class="number">1862</span>] Adding visible gpu devices: <span class="number">0</span></span><br><span class="line">[<span class="type">PhysicalDevice</span>(<span class="type">name</span>=<span class="string">&#x27;/physical_device:CPU:0&#x27;</span>, <span class="type">device_type</span>=<span class="string">&#x27;CPU&#x27;</span>), <span class="type">PhysicalDevice</span>(<span class="type">name</span>=<span class="string">&#x27;/physical_device:GPU:0&#x27;</span>, <span class="type">device_type</span>=<span class="string">&#x27;GPU&#x27;</span>)]</span><br></pre></td></tr></table></figure>
<h1 id="ä½¿ç”¨condaå®‰è£…cudaå’Œcudnn"><a class="markdownIt-Anchor" href="#ä½¿ç”¨condaå®‰è£…cudaå’Œcudnn"></a> ä½¿ç”¨condaå®‰è£…cudaå’Œcudnn</h1>
<p>äº‹å®ä¸Šä½¿ç”¨condaçš„æ—¶å€™ä¸æå‰è£…cudaå’Œcudnnä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br />
æ‰§è¡Œä»¥ä¸‹ä»£ç å³å¯ã€‚æ³¨æ„å¯¹æ¯”tensorflowçš„gpuæ”¯æŒç‰ˆæœ¬ï¼Œè§<a href="https://tensorflow.google.cn/install/source_windows#gpu">æ­¤</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">conda install cudatoolkit=<span class="number">10.1</span> cudnn=<span class="number">7.6</span><span class="number">.5</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>tmux vs screen</title>
    <url>/2021/03/28/tmux-vs-screen/</url>
    <content><![CDATA[<p>æœ¬æ–‡å°†å¯¹tmuxä¸screenå‘½ä»¤çš„ä½¿ç”¨è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ç®€å•çš„è¿›è¡Œå¯¹æ¯”ã€‚</p>
<p>å°é¢å›¾ç‰‡æ¥æºã€Šå¦„æƒ³ç ´ç»½ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>ä½ æ˜¯å¦æœ‰è¿‡åœ¨SSHè¿æ¥è¿œç¨‹ç»ˆç«¯çš„æ—¶å€™ï¼Œéœ€è¦åŒæ—¶åå°è¿è¡Œå¤šä¸ªç¨‹åºï¼ŒæŠ‘æˆ–æ˜¯éœ€è¦å¼€å¯å¤šä¸ªç»ˆç«¯è¿›è¡Œè§‚å¯Ÿã€‚é‚£ä¹ˆä½ éœ€è¦ä¸€ä¸ªç»ˆç«¯å¤ç”¨ç¨‹åºï¼Œæ¯”å¦‚<code>tmux</code>æˆ–è€…<code>screen</code>ã€‚<code>tmux</code>å’Œ<code>screen</code>å‘½ä»¤å·®ä¸å¤šï¼Œéƒ½æ˜¯ç»ˆç«¯å¤ç”¨ç¨‹åºï¼Œä½ è¿˜å¯ä»¥åœ¨SSHæ–­å¼€åé‡æ–°è¿æ¥ç«¯å£ç»§ç»­æ‰§è¡Œå‘½ä»¤ã€‚</p>
<h1 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h1>
<p>å¦‚æœä½ çš„Ubuntuæ²¡æœ‰<code>tmux</code>æˆ–è€…<code>screen</code>ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…</p>
<p><code>tmux</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install tmux</span><br></pre></td></tr></table></figure>
<p><code>screen</code>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install screen</span><br></pre></td></tr></table></figure>
<h1 id="ä½¿ç”¨"><a class="markdownIt-Anchor" href="#ä½¿ç”¨"></a> ä½¿ç”¨</h1>
<h2 id="tmux"><a class="markdownIt-Anchor" href="#tmux"></a> tmux</h2>
<h3 id="ç®€å•åˆ›å»º"><a class="markdownIt-Anchor" href="#ç®€å•åˆ›å»º"></a> ç®€å•åˆ›å»º</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/simple-tmux.png" alt="æ•ˆæœå›¾" /></p>
<p>[0]0:zsh* : æ„å‘³ç€ç°åœ¨æ˜¯session nameä¸º0ï¼Œsession numberä¸º0ï¼Œç¯å¢ƒä¸ºzshï¼Œ*æ„å‘³ç€å½“å‰çª—å£</p>
<p>â€œDESKTOP-7A4A8RDâ€ : hostname</p>
<p>18:59 28-Mar-21 : å½“å‰æ—¶é—´</p>
<h3 id="åˆ›å»ºä¸€ä¸ªæœ‰åå­—çš„session"><a class="markdownIt-Anchor" href="#åˆ›å»ºä¸€ä¸ªæœ‰åå­—çš„session"></a> åˆ›å»ºä¸€ä¸ªæœ‰åå­—çš„session</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux new -s &lt;session-name&gt;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°åŸæœ¬[0]é‡Œé¢çš„0å˜æˆäº†è®¾ç½®çš„session-name</p>
<h3 id="ç«–ç›´åˆ†ç¦»çª—å£"><a class="markdownIt-Anchor" href="#ç«–ç›´åˆ†ç¦»çª—å£"></a> ç«–ç›´åˆ†ç¦»çª—å£</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>%</code><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/tmux-vertically.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="æ°´å¹³åˆ†ç¦»çª—å£"><a class="markdownIt-Anchor" href="#æ°´å¹³åˆ†ç¦»çª—å£"></a> æ°´å¹³åˆ†ç¦»çª—å£</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>&quot;</code><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/tmux-horizontally.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="å±•ç¤ºä¼šè¯ç¼–å·"><a class="markdownIt-Anchor" href="#å±•ç¤ºä¼šè¯ç¼–å·"></a> å±•ç¤ºä¼šè¯ç¼–å·</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>q</code><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/tmux-number.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="åˆ‡æ¢çª—å£"><a class="markdownIt-Anchor" href="#åˆ‡æ¢çª—å£"></a> åˆ‡æ¢çª—å£</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>o</code></p>
<h3 id="å…³é—­çª—å£"><a class="markdownIt-Anchor" href="#å…³é—­çª—å£"></a> å…³é—­çª—å£</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>x</code>æˆ–è€…<code>ctrl+d</code></p>
<h3 id="åˆ—å‡ºå·²æœ‰tmux"><a class="markdownIt-Anchor" href="#åˆ—å‡ºå·²æœ‰tmux"></a> åˆ—å‡ºå·²æœ‰tmux</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>s</code><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/tmux-list.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="åˆ†ç¦»ä¼šè¯"><a class="markdownIt-Anchor" href="#åˆ†ç¦»ä¼šè¯"></a> åˆ†ç¦»ä¼šè¯</h3>
<p>åœ¨<code>tmux</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+b</code>ç„¶åå†æŒ‰ä¸‹<code>d</code>æˆ–è€…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux detach</span><br></pre></td></tr></table></figure>
<h3 id="é‡è¿ä¼šè¯"><a class="markdownIt-Anchor" href="#é‡è¿ä¼šè¯"></a> é‡è¿ä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux attach -t &lt;session-name&gt;</span><br></pre></td></tr></table></figure>
<h3 id="æ€æ­»ä¼šè¯"><a class="markdownIt-Anchor" href="#æ€æ­»ä¼šè¯"></a> æ€æ­»ä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tmux kill-session -t &lt;session-name&gt;</span><br></pre></td></tr></table></figure>
<h2 id="screen"><a class="markdownIt-Anchor" href="#screen"></a> screen</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen [-AmRvx -<span class="built_in">ls</span> -wipe][-d &lt;ä½œä¸šåç§°&gt;][-h &lt;è¡Œæ•°&gt;][-r &lt;ä½œä¸šåç§°&gt;][-s &lt;shell&gt;][-S &lt;ä½œä¸šåç§°&gt;]</span><br></pre></td></tr></table></figure>
<p>wslä¸­ä½¿ç”¨<code>screen</code>æç¤ºæƒé™ä¸è¶³å¯ä»¥å‚è€ƒæœ¬æ–‡æœ«å°¾çš„<a href="#wsl%E4%B8%AD%E6%8F%90%E7%A4%BAscreen%E9%9C%80%E8%A6%81root%E6%9D%83%E9%99%90%E8%A7%A3%E5%86%B3">wslä¸­æç¤ºscreenéœ€è¦rootæƒé™è§£å†³</a></p>
<h3 id="åˆ›å»ºç®€å•çª—å£"><a class="markdownIt-Anchor" href="#åˆ›å»ºç®€å•çª—å£"></a> åˆ›å»ºç®€å•çª—å£</h3>
<p>åœ¨<code>screen</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+a</code>ç„¶åå†æŒ‰ä¸‹<code>c</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/simple-screen.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="åˆ›å»ºç»ˆç«¯å¹¶è¿è¡Œå‘½ä»¤"><a class="markdownIt-Anchor" href="#åˆ›å»ºç»ˆç«¯å¹¶è¿è¡Œå‘½ä»¤"></a> åˆ›å»ºç»ˆç«¯å¹¶è¿è¡Œå‘½ä»¤</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen vi main.c</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/screen-simple-command.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="ç¦»å¼€screenç»ˆç«¯"><a class="markdownIt-Anchor" href="#ç¦»å¼€screenç»ˆç«¯"></a> ç¦»å¼€screenç»ˆç«¯</h3>
<p>åœ¨<code>screen</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+a</code>ç„¶åå†æŒ‰ä¸‹<code>d</code></p>
<h3 id="æ˜¾ç¤ºå·²ç»åˆ›å»ºçš„screen"><a class="markdownIt-Anchor" href="#æ˜¾ç¤ºå·²ç»åˆ›å»ºçš„screen"></a> æ˜¾ç¤ºå·²ç»åˆ›å»ºçš„screen</h3>
<p>åœ¨<code>screen</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+a</code>ç„¶åå†æŒ‰ä¸‹<code>&quot;</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen -<span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/screen-list.png" alt="æ•ˆæœå›¾" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/screen-list2.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="é‡æ–°è¿æ¥ä¼šè¯"><a class="markdownIt-Anchor" href="#é‡æ–°è¿æ¥ä¼šè¯"></a> é‡æ–°è¿æ¥ä¼šè¯</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">screen -r &lt;<span class="built_in">id</span>&gt;</span><br></pre></td></tr></table></figure>
<h3 id="æ°´å¹³åˆ†å‰²"><a class="markdownIt-Anchor" href="#æ°´å¹³åˆ†å‰²"></a> æ°´å¹³åˆ†å‰²</h3>
<p>åœ¨<code>screen</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+a</code>ç„¶åå†æŒ‰ä¸‹<code>|</code>ï¼Œåªä¼šåˆ†å‰²è€Œä¸ä¼šåˆ›å»ºæ–°çš„sessionã€‚ä½¿ç”¨<code>ctrl+a</code>ç„¶åæŒ‰ä¸‹<code>tab</code>åˆ‡æ¢çª—å£ï¼Œ<code>ctrl+a</code>ç„¶åæŒ‰ä¸‹<code>c</code>æ–°å»ºsessionã€‚ä¸‹åŒ<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/screen-horizontally.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="screenç«–ç›´åˆ†å‰²"><a class="markdownIt-Anchor" href="#screenç«–ç›´åˆ†å‰²"></a> screenç«–ç›´åˆ†å‰²</h3>
<p>åœ¨<code>screen</code>çª—å£ä¸­æŒ‰ä¸‹<code>ctrl+a</code>ç„¶åå†æŒ‰ä¸‹<code>S</code>ã€‚æ³¨æ„å¤§å†™<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.2/screen-vertically.png" alt="æ•ˆæœå›¾" /></p>
<h3 id="åˆ†å‰²ä¸­åˆ‡æ¢çª—å£"><a class="markdownIt-Anchor" href="#åˆ†å‰²ä¸­åˆ‡æ¢çª—å£"></a> åˆ†å‰²ä¸­åˆ‡æ¢çª—å£</h3>
<p>ä½¿ç”¨<code>ctrl+a</code>ç„¶åæŒ‰ä¸‹<code>tab</code>åˆ‡æ¢çª—å£</p>
<h3 id="æ€æ­»session"><a class="markdownIt-Anchor" href="#æ€æ­»session"></a> æ€æ­»session</h3>
<p>ä½¿ç”¨<code>ctrl+d</code></p>
<h1 id="å¯¹æ¯”"><a class="markdownIt-Anchor" href="#å¯¹æ¯”"></a> å¯¹æ¯”</h1>
<p><code>screen</code>å’Œ<code>tmux</code>éƒ½æ˜¯ç»ˆç«¯å¤ç”¨ï¼Œå¤§ä½“çš„åŠŸèƒ½ä¸Šéƒ½å·®ä¸å¤šï¼Œ<code>tmux</code>æ˜¯BSDåè®®ï¼Œ<code>screen</code>æ˜¯GNUåè®®ã€‚ä»ä¸ªäººæ„Ÿè§‰ä¸Š<code>tmux</code>å¯¹ä¸ªäººæ›´å‹å¥½ï¼Œåœ¨åˆ†å‰²çª—å£ æ—¶å€™è‡ªåŠ¨åˆ›å»ºæ–°ä¼šè¯ï¼ŒåŒæ—¶æœ‰çŠ¶æ€æ¡æ˜¾ç¤ºï¼Œè¿˜å¯ä»¥è‡ªåŠ¨å‘½åçª—å£ï¼Œè¿™æ˜¯<code>screen</code>æ²¡æœ‰çš„ã€‚<code>screen</code>å¯ä»¥å’Œå…¶ä»–ç”¨æˆ·åˆ†äº«ä¼šè¯ï¼Œè€Œ<code>tmux</code>ä¸è¡Œã€‚</p>
<h1 id="wslä¸­æç¤ºscreenéœ€è¦rootæƒé™è§£å†³"><a class="markdownIt-Anchor" href="#wslä¸­æç¤ºscreenéœ€è¦rootæƒé™è§£å†³"></a> wslä¸­æç¤ºscreenéœ€è¦rootæƒé™è§£å†³</h1>
<p>å‚è€ƒ<a href="https://superuser.com/questions/1195962/cannot-make-directory-var-run-screen-permission-denied">superuser</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/.screen &amp;&amp; <span class="built_in">chmod</span> 700 ~/.screen</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥æŠŠä¸‹é¢è¿™ä¸€å¥æ”¾è¿›<code>~/.bashrc</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> SCREENDIR=<span class="variable">$HOME</span>/.screen</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://linuxhint.com/tmux_vs_screen/">Tmux vs. Screen tool comparison</a><br />
<a href="https://www.howtogeek.com/671422/how-to-use-tmux-on-linux-and-why-its-better-than-screen/">How to Use tmux on Linux (and Why Itâ€™s Better Than Screen)</a><br />
<a href="https://blog.csdn.net/yuanxinfei920/article/details/78712990">ä½¿ç”¨tmuxåˆ†å±ï¼ˆæ—¢å¯ä»¥å·¦å³åˆ†å±ï¼Œä¹Ÿå¯ä»¥ä¸Šä¸‹åˆ†å±ï¼‰</a><br />
<a href="http://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmux ä½¿ç”¨æ•™ç¨‹</a><br />
<a href="https://www.runoob.com/linux/linux-comm-screen.html">Linux screenå‘½ä»¤</a><br />
<a href="https://superuser.com/questions/1195962/cannot-make-directory-var-run-screen-permission-denied">Cannot make directory â€˜/var/run/screenâ€™: Permission denied</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Network in Network å­¦ä¹ ç¬”è®°</title>
    <url>/2021/03/29/NIN-Note/</url>
    <content><![CDATA[<p>å› ä¸ºåœ¨YOLOé‡Œé¢çœ‹åˆ°äº†ä½¿ç”¨Global Average Poolingæ›¿æ¢å…¨è¿æ¥å±‚ï¼ŒåŒæ—¶ä¹Ÿåœ¨å…¶ä»–ç½‘ç»œé‡Œé¢å‘ç°ä¹Ÿéƒ½ä½¿ç”¨äº†Global Average Poolingæ›¿æ¢å…¨è¿æ¥å±‚ã€‚å› æ­¤ï¼Œæ‰“ç®—æ¥è¯»ä¸€ä¸‹è¿™ç¯‡æå‡ºäº†Global Average Poolingçš„Network in Networkã€‚</p>
<p>å°é¢æ¥æºã€Š9nineã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>â€ƒâ€ƒ<a href="https://arxiv.org/abs/1312.4400">Network in Network</a>ï¼ˆä¸‹é¢ç®€ç§°NINï¼‰è®¤ä¸ºCNNä¸­çš„å·ç§¯æ ¸æ˜¯åŸºç¡€æ•°æ®è¡¥ä¸çš„å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼ˆGLMï¼‰ï¼ŒåŒæ—¶ä»–è®¤ä¸ºGLMçš„æŠ½è±¡å±‚æ¬¡æ¯”è¾ƒä½ã€‚ç”¨æ›´æœ‰æ•ˆçš„éçº¿æ€§å‡½æ•°é€¼è¿‘å™¨ä»£æ›¿GLMï¼Œå¯ä»¥æé«˜å±€éƒ¨æ¨¡å‹çš„æŠ½è±¡èƒ½åŠ›ã€‚å½“æ½œåœ¨æ¦‚å¿µçš„æ ·æœ¬çº¿æ€§å¯åˆ†ç¦»æ—¶ï¼ŒGLMå¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„æŠ½è±¡ç¨‹åº¦ï¼Œå³æ¦‚å¿µçš„å˜ä½“éƒ½å­˜åœ¨äºGLMå®šä¹‰çš„åˆ†ç¦»å¹³é¢çš„ä¸€ä¾§ã€‚å› æ­¤ï¼Œä¼ ç»Ÿçš„CNNéšå¼åœ°å‡è®¾æ½œåœ¨æ¦‚å¿µæ˜¯çº¿æ€§å¯åˆ†çš„ã€‚ç„¶è€Œï¼ŒåŒä¸€æ¦‚å¿µçš„æ•°æ®å¾€å¾€å­˜åœ¨äºéçº¿æ€§æµå½¢ä¸Šï¼Œå› æ­¤æ•è·è¿™äº›æ¦‚å¿µçš„è¡¨ç¤ºé€šå¸¸æ˜¯è¾“å…¥çš„é«˜åº¦éçº¿æ€§çš„å‡½æ•°ã€‚åœ¨NINä¸­ä½¿ç”¨äº†ä¸€ç§é€šç”¨çš„éçº¿æ€§å‡½æ•°é€¼è¿‘å™¨çš„â€œå¾®å‹ç½‘ç»œâ€ç»“æœæ¥æ›¿ä»£GLMã€‚åœ¨NINä¸€æ–‡ä¸­å°±æ˜¯é€‰æ‹©äº†å¤šå±‚æ„ŸçŸ¥å™¨MLPä½œä¸ºéçº¿æ€§å‡½æ•°é€¼è¿‘å™¨ã€‚<br />
â€ƒâ€ƒåœ¨NINä¸€æ–‡ä¸­æå‡ºäº†ä¸¤ä¸ªåˆ›æ–°ç‚¹ï¼šMlpconvå’ŒGlobal Average Pooling</p>
<h1 id="mlpconv"><a class="markdownIt-Anchor" href="#mlpconv"></a> Mlpconv</h1>
<p>â€ƒâ€ƒåœ¨æ²¡æœ‰å…³äºæ½œåœ¨å…ˆéªŒåˆ†å¸ƒçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨é€šç”¨å‡½æ•°é€¼è¿‘å™¨æ¥æå–å±€éƒ¨è¡¥ä¸çš„ç‰¹å¾æ˜¯å¯è¡Œçš„ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿé€¼è¿‘æ½œåœ¨æ¦‚å¿µçš„æ›´æŠ½è±¡çš„è¡¨ç¤ºã€‚å¾„å‘åŸºç½‘ç»œï¼ˆRadial basis networkï¼‰å’Œå¤šå±‚æ„ŸçŸ¥å™¨ï¼ˆmultilayer perceptronï¼‰æ˜¯ä¸¤ä¸ªçŸ¥åçš„é€šç”¨å‡½æ•°é€¼è¿‘å™¨ã€‚NINä¸€æ–‡ä¸­é€‰æ‹©ä½¿ç”¨å¤šå±‚æ„ŸçŸ¥æ˜¯åŸºäºä»¥ä¸‹ä¸¤ä¸ªåŸå› ã€‚è¿™ç§æ–°å‹çš„å±‚å°±å«åšmlpconvã€‚</p>
<ol>
<li>å¤šå±‚æ„ŸçŸ¥å™¨å’Œå·ç§¯ç¥ç»ç½‘ç»œä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡åå‘ä¼ æ’­è¿›è¡Œè®­ç»ƒ</li>
<li>å¤šå±‚æ„ŸçŸ¥å™¨è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªæ·±åº¦æ¨¡å‹ï¼Œç¬¦åˆç‰¹å¾å†åˆ©ç”¨çš„åŸåˆ™</li>
</ol>
<h2 id="ä¼ ç»Ÿå·ç§¯"><a class="markdownIt-Anchor" href="#ä¼ ç»Ÿå·ç§¯"></a> ä¼ ç»Ÿå·ç§¯</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.1/linear-conv.png" alt="" /><br />
GLMä¸­çš„å·ç§¯ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä»¥æ¿€æ´»å‡½æ•°ä¸ºReluä¸ºä¾‹å­ï¼Œå…¶è®¡ç®—å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><mi>k</mi></mrow></msub><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msubsup><mi>Ï‰</mi><mi>k</mi><mi>T</mi></msubsup><msub><mi>x</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f_{i,j,k} = max(\omega_k^Tx_{i,j},0)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.177439em;vertical-align:-0.286108em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï‰</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span></span></p>
<h2 id="mlpå·ç§¯"><a class="markdownIt-Anchor" href="#mlpå·ç§¯"></a> mlpå·ç§¯</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.1/mlpconv-layer.png" alt="" /><br />
mlpä¸­çš„å·ç§¯æ ¼å¼å¦‚ä¸Šæ‰€ç¤ºï¼Œä»¥Reluæ¿€æ´»å‡½æ•°ä¸ºä¾‹å­ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><msub><mi>k</mi><mn>1</mn></msub></mrow><mn>1</mn></msubsup><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msup><msubsup><mi>Ï‰</mi><msub><mi>k</mi><mn>1</mn></msub><mn>1</mn></msubsup><mi>T</mi></msup><msub><mi>x</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msub><mi>b</mi><msub><mi>k</mi><mn>1</mn></msub></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi mathvariant="normal">â‹®</mi><mpadded height="+0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo separator="true">,</mo><msub><mi>k</mi><mi>n</mi></msub></mrow><mi>n</mi></msubsup><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msup><msubsup><mi>Ï‰</mi><msub><mi>k</mi><mi>n</mi></msub><mi>n</mi></msubsup><mi>T</mi></msup><msubsup><mi>f</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msubsup><mo>+</mo><msub><mi>b</mi><msub><mi>k</mi><mi>n</mi></msub></msub><mo separator="true">,</mo><mn>0</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{matrix}
f_{i,j,k_1}^1 = max({\omega_{k_1}^1}^Tx_{i,j}+b_{k_1},0)\\ 
\vdots \\
f_{i,j,k_n}^n = max({\omega_{k_n}^n}^Tf_{i,j}^{n-1}+b_{k_n},0)
\end{matrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.639393999999999em;vertical-align:-2.0696969999999997em;"></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5696969999999997em;"><span style="top:-5.211857999999999em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4168920000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4192159999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï‰</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-2.4168920000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3832079999999999em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0453389999999998em;"><span style="top:-3.267008em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span><span style="top:-3.2926419999999994em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">â‹®</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-2.0370190000000004em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4168920000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4192159999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï‰</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-2.4168920000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3832079999999999em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.895623em;"><span style="top:-3.117292em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.854239em;"><span style="top:-2.4231360000000004em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1031310000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:-0.03148em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">0</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.0696969999999997em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>â€ƒâ€ƒè¿™ç§è·¨é€šé“å‚æ•°æ± åŒ–å±‚ä¸1Ã—1çš„å·ç§¯æ ¸ç­‰æ•ˆï¼Œå®é™…ä¸Šå°±æ˜¯1Ã—1çš„å·ç§¯å®ç°ã€‚è¿™ä½¿å¾—NINçš„ç»“æ„å®¹æ˜“ç†è§£ã€‚</p>
<h2 id="å…³äº11å·ç§¯"><a class="markdownIt-Anchor" href="#å…³äº11å·ç§¯"></a> å…³äº1Ã—1å·ç§¯</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.1/conv.gif" alt="conv" /><br />
â€ƒâ€ƒå·ç§¯æ ¸çš„è®¡ç®—å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¾“å‡ºé€šé“ä¸å·ç§¯æ ¸çš„ä¸ªæ•°æ˜¯ç›¸ç­‰çš„ã€‚å¯¹äºè¾“å…¥å•é€šé“çš„å•ä¸ª1Ã—1å·ç§¯æ ¸ï¼Œæ­¤æ—¶å°±ç›¸å½“äºfeature mapä¹˜ä»¥ä¸€ä¸ªç³»æ•°ï¼Œè€Œå½“è¾“å…¥ä¸ºå¤šä¸ªé€šé“çš„æ—¶å€™ï¼Œç›¸å½“äºæŠŠå¤šä¸ªfeature mapçº¿æ€§åŠ æƒæ±‚å’Œå†é€šè¿‡ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼Œå…¶åŠŸèƒ½ä¸å…¨è¿æ¥ç›¸ä¼¼ï¼Œæƒé‡å…±äº«ï¼Œå‚æ•°æ›´å°‘ã€‚</p>
<h1 id="global-average-pooling"><a class="markdownIt-Anchor" href="#global-average-pooling"></a> Global Average Pooling</h1>
<p>â€ƒâ€ƒä¼ ç»Ÿçš„å·ç§¯ç¥ç»ç½‘ç»œåœ¨åšåˆ†ç±»ä»»åŠ¡çš„æ—¶å€™ï¼Œä¼šå¯¹æœ€åä¸€ä¸ªå·ç§¯å±‚å¾—åˆ°çš„ç‰¹å¾å›¾å‘é‡åŒ–å¹¶é€å…¥å…¨è¿æ¥å±‚ï¼Œå†ç»è¿‡ä¸€ä¸ªsoftmaxé€»è¾‘å›å½’ã€‚ä½†æ˜¯å…¨è¿æ¥å±‚å®¹æ˜“è¿‡æ‹Ÿåˆï¼Œé˜»ç¢ç½‘ç»œæ³›åŒ–æ€§ï¼Œç›´åˆ°Hintonç­‰äººæå‡ºdropoutï¼Œæå‡äº†å…¶æ³›åŒ–èƒ½åŠ›ï¼Œé¢„é˜²è¿‡æ‹Ÿåˆã€‚<br />
â€ƒâ€ƒNINä¸­æå‡ºäº†å¦ä¸€ç§ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯å…¨å±€å¹³å‡æ± åŒ–æ¥æ›¿ä»£å…¨è¿æ¥ã€‚åœ¨æœ€åä¸€ä¸ªmlpconvå±‚ç”Ÿæˆçš„æ¯å¼ ç‰¹å¾å›¾ç›´æ¥æ±‚å¹³å‡ï¼Œå¾—åˆ°ç»“æœå‘é‡è¾“å…¥åˆ°softmaxã€‚å…¨å±€å¹³å‡æ± åŒ–ç›¸æ¯”å…¨è¿æ¥å±‚çš„ä¼˜ç‚¹åœ¨äºé€šè¿‡å¢å¼ºç‰¹å¾å›¾ä¸ç±»æ¯”é—´çš„å¯¹åº”å…³ç³»ä½¿å·ç§¯ç»“æ„ä¿ç•™çš„æ›´å¥½ï¼Œä½¿ç‰¹å¾å›¾åˆ†ç±»æ˜¯å¯ä¿¡çš„å¾—åˆ°å¾ˆå¥½çš„è§£é‡Šï¼›å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯å…¨å±€å¹³å‡æ± åŒ–å±‚ä¸­æ²¡æœ‰å‚æ•°éœ€è¦ä¼˜åŒ–ï¼Œå› æ­¤é¿å…äº†è¿‡æ‹Ÿåˆï¼›æ­¤å¤–ï¼Œå…¨å±€å¹³å‡æ± åŒ–æ±‡èšäº†ç©ºé—´ä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹è¾“å…¥çš„ç©ºé—´è½¬æ¢æ›´æœ‰é²æ£’æ€§ã€‚</p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<ol>
<li>æ”¹å˜å·ç§¯ç»“æ„ï¼Œä½¿ç”¨1Ã—1å·ç§¯ï¼Œç›¸å½“äºä¸€ä¸ªå¾®å‹çš„å…¨è¿æ¥å±‚ï¼Œæé«˜å·ç§¯å±‚æŠ½è±¡èƒ½åŠ›ã€‚</li>
<li>ä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–æ›¿ä»£å…¨è¿æ¥é¿å…è¿‡æ‹Ÿåˆï¼Œå¯¹è¾“å…¥çš„ç©ºé—´è½¬æ¢æ›´æœ‰é²æ£’æ€§ã€‚</li>
</ol>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p>[1] Lin M ,  Chen Q ,  Yan S . Network In Network[J]. Computer Science, 2013.</p>
]]></content>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>YOLOv4å­¦ä¹ ç¬”è®°</title>
    <url>/2021/04/07/YOLOv4-Note/</url>
    <content><![CDATA[<p>å› ä¸ºä¸€ç›´æ²¡æœ‰æ‡‚yolov4ï¼Œå› æ­¤è¿™æ¬¡é‡æ–°é˜…è¯»YOLOv4å¹¶ä¸”ç•™ä¸‹ä¸€ç‚¹ç‚¹ç¬”è®°ã€‚å…¶å®åŸºæœ¬æ˜¯ç®€è¦ç¿»è¯‘(é€ƒ)ï¼Œç»“æœæ²¡ç®€è¦åˆ°å“ªé‡Œå»å»ºè®®ç›´æ¥çœ‹<a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.0/Comparison-of-YOLOv4.png" alt="YOLOv4å’Œå…¶ä»–æœ€å…ˆè¿›çš„æ£€æµ‹å™¨å¯¹æ¯”" /><br />
å°é¢æ¥æºã€Š9nineã€‹</p>
<span id="more"></span>
<h1 id="ä¸»è¦å·¥ä½œ"><a class="markdownIt-Anchor" href="#ä¸»è¦å·¥ä½œ"></a> ä¸»è¦å·¥ä½œ</h1>
<p>â€ƒâ€ƒä½œè€…åœ¨è¿™æ–¹é¢æŒ‡å‡ºäº†ï¼Œå¤§å¤šæ•°åŸºäºCNNçš„æ£€æµ‹å™¨å¤§é‡éƒ¨ç½²äºæ¨èç³»ç»Ÿã€‚æé«˜å®æ—¶å¯¹è±¡æ£€æµ‹å™¨çš„å‡†ç¡®åº¦ä¸ä»…å¯ä»¥ç”¨äºæ¨èç³»ç»Ÿç”Ÿæˆæç¤ºï¼Œè¿˜å¯ä»¥ç”¨äºç‹¬ç«‹çš„è¿‡ç¨‹ç®¡ç†å’Œå‡å°‘äººå·¥è¾“å…¥ã€‚ä¼ ç»Ÿå›¾å½¢å¤„ç†å•å…ƒ(GPU)ä¸Šçš„å®æ—¶ç›®æ ‡æ£€æµ‹å™¨æ“ä½œå…è®¸ä»¥ç»æµå®æƒ çš„ä»·æ ¼å¤§è§„æ¨¡ä½¿ç”¨ã€‚æœ€å‡†ç¡®çš„ç°ä»£ç¥ç»ç½‘ç»œä¸èƒ½å®æ—¶è¿›è¡Œæ“ä½œï¼Œä¸”éœ€è¦å¤§é‡çš„GPUè¿›è¡Œå°æ‰¹æ¬¡çš„è®­ç»ƒã€‚<br />
â€ƒâ€ƒä½œè€…å¸Œæœ›èƒ½å¤Ÿä½¿å¾—YOLOv4æ˜“äºè®­ç»ƒï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„GPUæ¥è·å¾—å®æ—¶çš„é«˜è´¨é‡ä¸”ä»¤äººä¿¡æœçš„æ£€æµ‹æ•ˆæœã€‚<br />
â€ƒâ€ƒå…¶å·¥ä½œæ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¼€å‘äº†ä¸€ä¸ªé«˜æ•ˆä¸”å¼ºå¤§çš„ç‰©ä½“æ£€æµ‹æ¨¡å‹ã€‚ä½¿å¾—ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨1080 Tiæˆ–è€…2080 Ti GPUæ¥è®­ç»ƒä¸€ä¸ªè¶…å¿«ä¸”å‡†ç¡®çš„ç‰©ä½“æ£€æµ‹å™¨ã€‚</li>
<li>åœ¨è®­ç»ƒæ£€æµ‹å™¨çš„æ—¶å€™ï¼ŒéªŒè¯äº†æœ€å…ˆè¿›çš„ç‰©ä½“æ£€æµ‹ä¸­çš„Bag of Freebieså’ŒBag of Specialsæ–¹æ³•(å…³äºè¿™ä¸¤ä¸ªè¯ï¼Œå¯ä»¥è§<a href="#bag-of-freebies">Bag of freebies</a>å’Œ<a href="#bag-of-specials">Bag of speicals</a>)</li>
<li>ä¿®æ”¹äº†æœ€å…ˆè¿›çš„æ–¹æ³•ï¼Œä½¿å…¶æ›´é«˜æ•ˆï¼Œæ›´é€‚åˆå•ä¸ªGPUè®­ç»ƒï¼ŒåŒ…å«äº†CBN,PAN,SAMç­‰</li>
</ol>
<h1 id="ç›¸å…³å·¥ä½œ"><a class="markdownIt-Anchor" href="#ç›¸å…³å·¥ä½œ"></a> ç›¸å…³å·¥ä½œ</h1>
<h2 id="ç‰©ä½“æ£€æµ‹æ–¹æ³•"><a class="markdownIt-Anchor" href="#ç‰©ä½“æ£€æµ‹æ–¹æ³•"></a> ç‰©ä½“æ£€æµ‹æ–¹æ³•</h2>
<p>â€ƒâ€ƒåœ¨æ­¤å¤„ï¼Œä½œè€…å¯¹ç°ä»£çš„ä¸€äº›æ£€æµ‹æ–¹æ³•è¿›è¡Œäº†ç®€å•çš„ä»‹ç»ã€‚ç°ä»£çš„æ£€æµ‹å™¨é€šå¸¸ç”±ä¸¤éƒ¨åˆ†ç»„æˆã€‚ä¸€ä¸ªåœ¨ImageNetä¸Šç»è¿‡é¢„è®­ç»ƒçš„éª¨æ¶(backbone)å’Œä¸€ä¸ªç”¨äºé¢„æµ‹ç±»å’Œç‰©ä½“è¾¹ç•Œæ¡†çš„å¤´(head)ã€‚å¯¹äºé‚£äº›è¿è¡Œåœ¨GPUå¹³å°ä¸Šçš„æ£€æµ‹å™¨ï¼Œå…¶backboneå¯èƒ½æ˜¯VGGã€ResNetã€ResNeXtæˆ–è€…DenseNetã€‚å¯¹äºé‚£äº›è¿è¡Œåœ¨CPUå¹³å°ä¸Šçš„æ£€æµ‹å™¨ï¼Œå…¶backboneå¯èƒ½æ˜¯SqueezeNetï¼ŒMobileNetæˆ–è€…ShuffleNetã€‚å¯¹äºheadéƒ¨åˆ†ï¼Œå…¶é€šå¸¸å¯ä»¥è¢«åˆ†ç±»ä¸ºä¸¤ç§ï¼Œå³one-stageçš„ç‰©ä½“æ£€æµ‹å™¨å’Œtwo-stageçš„ç‰©ä½“æ£€æµ‹å™¨ã€‚æœ€å…·ä»£è¡¨æ€§çš„two-stageç‰©ä½“æ£€æµ‹å™¨æ˜¯R-CNNç³»åˆ—ï¼ŒåŒ…å«fast R-CNNï¼Œfaster R-CNN,R-FCNå’ŒLibra R-CNNã€‚ä¹Ÿå¯ä»¥ä½¿å¾—two-stageç‰©ä½“æ£€æµ‹å™¨å˜æˆä¸€ä¸ªanchor-free(æ— é”šæ¡†)çš„ç‰©ä½“æ£€æµ‹å™¨ï¼Œæ¯”å¦‚RepPointsã€‚å¯¹äºone-stageæ£€æµ‹å™¨ï¼Œæœ€å…·ä»£è¡¨æ€§çš„å°±æ˜¯YOLO,SSDå’ŒRetinaNetã€‚æœ€è¿‘å‡ å¹´ä¹Ÿæœ‰anchor-freeçš„one-stageæ£€æµ‹å™¨ï¼Œæ¯”å¦‚CenterNetï¼ŒCornerNet,FCOSç­‰ã€‚è¿‘å¹´æ¥çš„ç‰©ä½“æ£€æµ‹å‘å±•ä¸­ï¼Œç»å¸¸åœ¨headå’Œbackboneä¹‹é—´æ’å…¥ä¸€äº›å±‚ï¼Œè¿™äº›å±‚è¢«ç§°ä¸ºæ£€æµ‹å™¨çš„é¢ˆéƒ¨(neck)ã€‚é€šå¸¸neckç”±å‡ ä¸ªbottom-upè·¯å¾„å’Œå‡ ä¸ªtop-downè·¯å¾„ç»„æˆã€‚ä½¿ç”¨è¿™ç§é…ç½®çš„ç½‘ç»œåŒ…å«Feature Pyramid Network(FPN),Path Aggregation Network(PAN)BiFPNå’ŒNAS-FPNã€‚é™¤äº†ä¸Šè¿°æ¨¡å‹ï¼Œä¸€äº›ç ”ç©¶è€…è¿˜ä¸“æ³¨äºç›´æ¥æ­å»ºä¸€ä¸ªæ–°çš„backbone(DetNet,DetNAS)æˆ–è€…ä¸€ä¸ªå…¨æ–°çš„ç‰©ä½“æ£€æµ‹æ¨¡å‹(SpineNetï¼ŒHitDetector)ã€‚</p>
<h2 id="æ™®é€šç›®æ ‡æ£€æµ‹å™¨çš„ç»„æˆéƒ¨åˆ†"><a class="markdownIt-Anchor" href="#æ™®é€šç›®æ ‡æ£€æµ‹å™¨çš„ç»„æˆéƒ¨åˆ†"></a> æ™®é€šç›®æ ‡æ£€æµ‹å™¨çš„ç»„æˆéƒ¨åˆ†</h2>
<ul>
<li><strong>Input:</strong> Image,Patches,Image Pyramid</li>
<li><strong>Backbone:</strong> VGG16,ResNet,SpineNet,EfficientNet-B0/B7,CSPResNeXt50,CSPDarknet53</li>
<li><strong>Neck:</strong>
<ul>
<li><strong>Additional block:</strong> SPP,ASPP,RFB,SAM</li>
<li>**Path-aggregation block:**FPN,BiFPN,ASFF,SFAM</li>
</ul>
</li>
<li><strong>Heads:</strong>
<ul>
<li><strong>Dense Prediction(one-stage):</strong>
<ul>
<li>RPN,SSD,YOLO,RetinaNet(anchor based)</li>
<li>CornerNet,CenterNet,MatrixNet,FCOS(anchor free)</li>
</ul>
</li>
<li><strong>Sparse Prediction(two-stage):</strong>
<ul>
<li>Faster R-CNN,R-FCN,Mask R-CNN(anchor based)</li>
<li>RepPoints(anchor free)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="bag-of-freebies"><a class="markdownIt-Anchor" href="#bag-of-freebies"></a> Bag-of-freebies</h2>
<p>â€ƒâ€ƒé€šå¸¸ï¼Œä¸€ä¸ªå¸¸è§„çš„ç‰©ä½“æ£€æµ‹å™¨æ˜¯ç¦»çº¿è®­ç»ƒçš„ã€‚å› æ­¤ç ”ç©¶è€…ç»å¸¸åˆ©ç”¨è¿™ä¸€ä¼˜åŠ¿ï¼Œä½¿ç”¨æ›´å¥½çš„è®­ç»ƒæ–¹æ³•ï¼Œåœ¨ä¸å¢åŠ æ¨ç†æˆæœ¬çš„æƒ…å†µä¸‹è·å¾—æ›´å¥½çš„å‡†ç¡®ç‡ã€‚æˆ‘ä»¬å°†è¿™ç§åªæ”¹å˜äº†è®­ç»ƒç­–ç•¥æˆ–è€…åªå¢åŠ äº†è®­ç»ƒæˆæœ¬çš„æ–¹æ³•ç§°ä¸ºâ€Bag of freebiesâ€œã€‚ç‰©ä½“æ£€æµ‹å¸¸ç”¨çš„ä¸”ç¬¦åˆä»¥ä¸Šå®šä¹‰çš„æ–¹æ³•æ˜¯æ•°æ®å¢å¼ºã€‚æ•°æ®å¢å¼ºçš„ç›®çš„æ˜¯å¢åŠ è¾“å…¥å›¾åƒçš„å¤šæ ·æ€§ï¼Œä»è€Œä½¿å¾—æ¨¡å‹åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹æœ‰ç€é«˜é²æ£’æ€§ã€‚æ¯”å¦‚ï¼Œphotometric distoitionså’Œgeometric distortionsæ˜¯ç”¨æ¥æ•°æ®å¢å¼ºæ–¹æ³•çš„ä¸¤ä¸ªå¸¸ç”¨çš„æ‰‹æ®µã€‚åœ¨å¤„ç†photometric distortionä¸­ï¼Œæˆ‘ä»¬ä¼šè°ƒæ•´å›¾åƒçš„äº®åº¦ï¼Œå¯¹æ¯”åº¦ï¼Œè‰²è°ƒï¼Œé¥±å’Œåº¦ä»¥åŠå™ªå£°ã€‚å¯¹äºgeometric distortionï¼Œæˆ‘ä»¬ä¼šéšæœºå¢åŠ å°ºåº¦å˜åŒ–ï¼Œè£å‰ªï¼Œç¿»è½¬ä»¥åŠæ—‹è½¬ã€‚<br />
â€ƒâ€ƒä¸Šè¿°æåˆ°çš„æ•°æ®å¢å¼ºéƒ½æ˜¯åƒç´ çº§åˆ«çš„è°ƒæ•´ï¼Œä»–ä¿ç•™äº†è°ƒæ•´åŒºåŸŸçš„æ‰€æœ‰åŸå§‹åƒç´ çš„ä¿¡æ¯ã€‚ä¸€äº›å­¦è€…åœ¨æ•°æ®å¢å¼ºæ–¹é¢ä¸“æ³¨äºæ¨¡æ‹Ÿç‰©ä½“è¢«é®æŒ¡ã€‚ä»–ä»¬åœ¨å›¾åƒåˆ†ç±»å’Œç‰©ä½“æ£€æµ‹ä¸Šæœ‰å¥½çš„æ•ˆæœã€‚æ¯”å¦‚ï¼Œrandom eraseå’ŒCutOutå¯ä»¥éšæœºé€‰æ‹©çŸ©å½¢åŒºåŸŸèåˆæˆ–è€…é›¶å¡«å……ã€‚å¯¹äºhide-and-seekå’Œgrid maskï¼Œå®ƒä»¬éšæœºæˆ–è€…å‡åŒ€çš„é€‰æ‹©å¤šä¸ªçŸ©å½¢åŒºåŸŸï¼Œå¹¶ä»¥é›¶æ›¿æ¢ã€‚å¦‚æœå°†ç›¸ä¼¼çš„æ¦‚å¿µç”¨æ¥ç‰¹å¾å›¾ä¸­ï¼Œåˆ™æœ‰DropOut, DropConnectå’ŒDropBlockæ–¹æ³•ã€‚æ­¤å¤–ï¼Œä¸€äº›ç ”ç©¶è€…è¿˜æå‡ºä½¿ç”¨å¤šå¼ å›¾ç‰‡è¿›è¡Œæ•°æ®å¢å¼ºã€‚æ¯”å¦‚ï¼ŒMixUpä½¿ç”¨ä¸¤å¼ å›¾ç‰‡ç›¸ä¹˜å¹¶ä»¥ä¸åŒçš„ç³»æ•°è¿›è¡Œé‡å ï¼Œå¹¶è°ƒæ•´æ ‡ç­¾ã€‚å¯¹äºCutMixï¼Œå®ƒå°†è£å‰ªçš„å›¾ç‰‡è¦†ç›–åˆ°å…¶ä»–å›¾ç‰‡çš„çŸ©å½¢åŒºåŸŸï¼Œç„¶åæ ¹æ®æ··åˆåŒºåŸŸçš„å¤§å°è°ƒæ•´æ ‡ç­¾ã€‚é™¤äº†ä»¥ä¸Šæ–¹æ³•ï¼Œstyle transfer GANä¹Ÿå¯ä»¥ç”¨äºæ•°æ®å¢å¼ºã€‚è¿™ç§ç”¨æ³•å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘CNNæ‰€å­¦ä¹ çš„çº¹ç†åå·®ã€‚<br />
â€ƒâ€ƒä¸ä¸Šè¿°æåˆ°çš„å„ç§æ–¹æ³•ä¸åŒï¼Œå…¶ä»–ä¸€äº›bag of freebiesç”¨äºè§£å†³æ•°æ®é›†ä¸­çš„è¯­ä¹‰åˆ†å¸ƒå¯èƒ½å­˜åœ¨åå·®çš„é—®é¢˜ï¼Œå¤„ç†è¯­ä¹‰åˆ†å¸ƒå­˜åœ¨åå·®é—®é¢˜ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜å°±æ˜¯ä¸åŒç±»åˆ«ç›´æ¥çš„æ•°æ®ä¸å¹³è¡¡ï¼Œè¿™ä¸ªé—®é¢˜åœ¨two-stageç‰©ä½“æ£€æµ‹å™¨ä¸­é€šè¿‡å›°éš¾è´Ÿæ ·æœ¬æŒ–æ˜æˆ–è€…åœ¨çº¿å›°éš¾æ ·æœ¬æŒ–æ˜è§£å†³ã€‚ä½†æ˜¯æ ·æœ¬æŒ–æ˜ä¸é€‚åˆäºone-stageæ£€æµ‹å™¨ï¼Œå› ä¸ºè¿™ç±»æ£€æµ‹å™¨å±äºdense prediction architectureç»“æ„ã€‚å› æ­¤Linç­‰äººæå‡ºfocal lossæ¥è§£å†³ä¸åŒç±»åˆ«æ•°æ®ä¸å‡è¡¡é—®é¢˜ï¼Œå¦å¤–ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜å°±æ˜¯one-hotç¼–ç å¾ˆéš¾æè¿°ä¸åŒç±»åˆ«ä¹‹é—´çš„å…³è”åº¦å…³ç³»ã€‚label smoothingæå‡ºåœ¨è®­ç»ƒæ—¶å°†ç¡¬æ ‡ç­¾è½¬æ¢ä¸ºè½¯æ ‡ç­¾ï¼Œä½¿å¾—æ¨¡å‹æ›´å…·æœ‰é²æ£’æ€§ã€‚ä¸ºäº†è·å¾—æ›´å¥½çš„è½¯æ ‡ç­¾ï¼ŒIslamç­‰äººæå‡ºäº†çŸ¥è¯†è’¸é¦çš„æ¦‚å¿µæ¥è®¾è®¡æ ‡ç­¾ç»†åŒ–ç½‘ç»œã€‚<br />
â€ƒâ€ƒæœ€åä¸€ä¸ªbag of freebiesæ˜¯è®¾è®¡è¾¹ç•Œæ¡†å›å½’çš„ç›®æ ‡å‡½æ•°ã€‚ä¼ ç»Ÿç‰©ä½“æ£€æµ‹å™¨é€šå¸¸ä½¿ç”¨MSEå¯¹è¾¹æ¡†çš„ä¸­å¿ƒåæ ‡ã€é«˜ã€å®½<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi></mrow></msub><mo separator="true">,</mo><mi>w</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{x_{center},y_{center},w,h\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">h</span><span class="mclose">}</span></span></span></span>æˆ–è€…å·¦ä¸Šè§’å’Œå³ä¸‹è§’ä¸¤ä¸ªåæ ‡ç‚¹<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>o</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>b</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>o</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{x_{top\_left},y_{top\_left},x_{bottom\_left},y_{bottom\_right}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">p</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">p</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">m</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">m</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>ã€‚ä½¿ç”¨anchor-basedæ–¹æ³•ï¼Œå…¶è°ƒæ•´ä¸ºé¢„æµ‹åå·®offset<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>w</mi><mrow><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>h</mi><mrow><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{x_{center\_offset},y_{center\_offset},w_{offset},h_{offset}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><msub><mi>x</mi><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>t</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>o</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>b</mi><mi>o</mi><mi>t</mi><mi>t</mi><mi>o</mi><mi>m</mi><mi mathvariant="normal">_</mi><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi mathvariant="normal">_</mi><mi>o</mi><mi>f</mi><mi>f</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{x_{top\_left\_offset},y_{top\_right\_offset},x_{bottom\_left\_offset},y_{bottom\_right\_offset}\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-0.367em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">p</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">t</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">p</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">m</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.01968em;">l</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">t</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">m</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span><span class="mord mathdefault mtight">h</span><span class="mord mathdefault mtight">t</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>ä½†æ˜¯ï¼Œç›´æ¥ä¼°è®¡bboxçš„æ¯ä¸ªç‚¹åæ ‡å€¼æ˜¯å°†è¿™äº›ç‚¹ä½œä¸ºç‹¬ç«‹çš„å˜é‡ï¼Œæ²¡æœ‰è€ƒè™‘å°†ç›®æ ‡ç‰©ä½“å½“æˆä¸€ä¸ªæ•´ä½“è¿›è¡Œé¢„æµ‹ã€‚ä¸ºäº†æ›´å¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€äº›å­¦è€…æå‡ºäº†IoUå‡½æ•°ï¼Œå°†BBoxåŒºåŸŸå’Œground trueçš„BBoxåŒºåŸŸä½œä¸ºæ•´ä½“ã€‚IoU losséœ€è¦è®¡ç®—BBoxå››ä¸ªåæ ‡ç‚¹ä»¥åŠground truthçš„IoUã€‚å› ä¸ºIoUå…·æœ‰å°ºåº¦ä¸å˜æ€§ï¼Œå®ƒå¯ä»¥è§£å†³ä¼ ç»Ÿç®—æ³•æ¯”å¦‚è®¡ç®—<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">{</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo separator="true">,</mo><mi>w</mi><mo separator="true">,</mo><mi>h</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\{x,y,w,h\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">h</span><span class="mclose">}</span></span></span></span><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>l</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">l_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>l</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">l_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„æŸå¤±å‡½æ•°æ—¶å­˜åœ¨çš„é—®é¢˜ï¼Œè¿™ä¸ªæŸå¤±å‡½æ•°ä¼šéšç€å°ºåº¦çš„å˜åŒ–è€Œå‘ç”Ÿå˜åŒ–ã€‚ä¸€äº›å­¦è€…ç»§ç»­æå‡IoU losså‡½æ•°ï¼Œæ¯”å¦‚ï¼ŒGIoU lossåŒ…å«äº†ç›®æ ‡ç‰©ä½“çš„å½¢çŠ¶å’Œåæ ‡ï¼Œä»–ä»¬æå‡ºæ‰¾åˆ°åŒæ—¶åŒ…å«é¢„æµ‹åŒºåŸŸBBoxå’Œground true BBoxçš„æœ€å°åŒºåŸŸï¼Œç„¶åç”¨è¿™ä¸ªBBoxæ›¿ä»£IoU lossåŸæ¥çš„åˆ†æ¯ã€‚DIoU lossé¢å¤–è€ƒè™‘äº†ç›®æ ‡ç‰©ä½“çš„ä¸­å¿ƒè·ç¦»ï¼ŒCIoUå¦ä¸€æ–¹é¢åŒæ—¶å°†è¦†ç›–åŒºåŸŸï¼Œä¸­å¿ƒç‚¹è·ç¦»å’Œçºµæ¨ªæ¯”è€ƒè™‘åœ¨å†…ã€‚CIoUåœ¨BBoxå›å½’é—®é¢˜ä¸Šå¯ä»¥è·å¾—æœ€å¥½çš„æ”¶æ•›é€Ÿåº¦å’Œå‡†ç¡®ç‡ã€‚DIoU lossé¢å¤–è€ƒè™‘äº†ç‰©ä½“ä¸­å¿ƒè·ç¦»ã€‚å¦ä¸€æ–¹é¢ï¼ŒCIoUåŒæ—¶å°†è¦†ç›–åŒºåŸŸï¼Œä¸­å¿ƒç‚¹è·ç¦»å’Œçºµæ¨ªæ¯”è€ƒè™‘åœ¨å†…ã€‚CIoUåœ¨BBoxå›å½’é—®é¢˜ä¸Šå¯ä»¥è·å¾—æœ€å¥½çš„æ”¶æ•›é€Ÿåº¦å’Œå‡†ç¡®ç‡ã€‚</p>
<h2 id="bag-of-specials"><a class="markdownIt-Anchor" href="#bag-of-specials"></a> Bag-of-specials</h2>
<p>â€ƒâ€ƒå¯¹äºé‚£äº›ç¨å¾®å¢åŠ äº†æ¨ç†æˆæœ¬ï¼Œä½†æ˜¯å¯ä»¥æå¤§åœ°æå‡ç›®æ ‡æ£€æµ‹çš„å‡†ç¡®ç‡çš„æ’ä»¶æ¨¡å—å’Œåå¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œbag of specialsâ€ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›æ’ä»¶æ¨¡å—ç”¨æ¥æé«˜ä¸€ä¸ªæ¨¡å‹ä¸­ç‰¹å®šçš„å±æ€§ï¼Œæ¯”å¦‚å¢åŠ æ„Ÿå—é‡ï¼Œå¼•å…¥æ³¨æ„åŠ›æœºåˆ¶æˆ–è€…æé«˜ç‰¹å¾æ•´åˆçš„èƒ½åŠ›ç­‰ï¼Œåå¤„ç†æ–¹å¼æ˜¯ç”¨æ¥æŠ‘åˆ¶æ¨¡å‹é¢„æµ‹ç»“æœçš„ä¸€ç§æ–¹æ³•ã€‚<br />
å¸¸ç”¨çš„æå‡æ„Ÿå—é‡çš„æ–¹æ³•æ˜¯SPPï¼ŒASPPå’ŒRFBã€‚SPPæ¨¡å‹æ¥æºäºç©ºé—´é‡‘å­—å¡”åŒ¹é…(SPM)ï¼ŒSPMåŸæœ¬çš„æ–¹æ³•æ˜¯å°†ç‰¹å¾å›¾åˆ’åˆ†æˆdÃ—dä¸ªç›¸ç­‰çš„å—ï¼Œå…¶ä¸­då¯ä»¥æ˜¯{1,2,3,â€¦}ï¼Œå› æ­¤å¯ä»¥å½¢æˆç©ºé—´é‡‘å­—å¡”ï¼Œç„¶åæå–bag-of-wordçš„ç‰¹å¾ã€‚SPPå°†SPMåº”ç”¨åœ¨CNNä¸­ï¼Œç„¶åä½¿ç”¨max-poolingä»£æ›¿bag-of-wordè¿ç®—ã€‚å› ä¸ºSPPè¾“å‡ºçš„æ˜¯ä¸€ç»´ç‰¹å¾å‘é‡ï¼Œæ‰€ä»¥å…¶ä¸èƒ½è¿ç”¨åœ¨å…¨å·ç§¯ç½‘ç»œ(FCN)ä¸­ã€‚å› æ­¤ï¼Œåœ¨YOLOv3ä¸­ï¼ŒRedmonå’ŒFarhadiæ”¹è¿›äº†SPPæ¨¡å—ï¼Œå°†max-poolingçš„è¾“å‡ºå’Œå†…æ ¸ä¸ºkÃ—kè¿æ¥ï¼Œkä¸º{1,5,9,13}ï¼Œstrikeä¸º1ã€‚<br />
â€ƒâ€ƒASPPæ¨¡å—å’Œæ”¹è¿›SPPæ¨¡å—çš„åŒºåˆ«ä¸»è¦åœ¨äºåŸå§‹çš„kÃ—kçš„å†…æ ¸å¤§å°ï¼Œmax-poolingçš„æœ€å¤§æ­¥é•¿ä¸º1åˆ°3Ã—3å†…æ ¸ï¼Œè†¨èƒ€æ¯”ä¸ºkï¼Œæ‹“å±•å·ç§¯è¿ç®—æ­¥é•¿ä¸º1ã€‚RFBæ¨¡å—ä½¿ç”¨ä¸€äº›Ã—kçš„å†…æ ¸ï¼Œè†¨èƒ€æ¯”ä¸ºkï¼Œæ­¥é•¿ä¸º1çš„æ‹“å±•å·ç§¯ï¼Œå®ƒæ¯”ASPPè·å¾—äº†æ›´å…¨é¢çš„ç©ºé—´è¦†ç›–ç‡ã€‚ï¼ˆè¿™æ®µä¸€ç›´æ²¡æ‡‚ï¼‰<br />
ç‰©ä½“æ£€æµ‹ä¸Šå¸¸ç”¨çš„attentionæ¨¡å‹ä¸»è¦åˆ†æˆchannel-wise attentionæ¨¡å—å’Œpoint-wise attentionæ¨¡å—ï¼Œä¸¤ä¸ªæ¨¡å—çš„ä»£è¡¨æ€§æ¨¡å‹æ˜¯Squeeze-and-Excitation(SE)å’ŒSpatial Attention Module(SAM)ã€‚SEæ¨¡å—è™½ç„¶åœ¨ImageNetä¸Šä»…ä»…å¢åŠ äº†2%çš„è®¡ç®—é‡å’Œ1%çš„top-1å‡†ç¡®ç‡ï¼Œä½†æ˜¯åœ¨GPUä¸Šæé«˜äº†10%çš„æ¨ç†æ—¶é—´ï¼Œå› æ­¤SEæ›´é€‚åˆåœ¨ç§»åŠ¨è®¾å¤‡è¿è¡Œã€‚è€Œå¯¹äºSAMï¼Œåœ¨ImageNetåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œå®ƒåªéœ€è¦0.1%çš„é¢å¤–è®¡ç®—å°±èƒ½æå‡ResNet50-SE 0.5%çš„top-1çš„å‡†ç¡®ç‡ï¼Œå®ƒåœ¨GPUä¸Šæ²¡æœ‰æœ‰æ•ˆåœ°å½±å“æ¨ç†é€Ÿåº¦ã€‚<br />
â€ƒâ€ƒå…³äºç‰¹å¾èåˆï¼Œæ—©æœŸå®éªŒä½¿ç”¨skip connectionæˆ–è€…hyper-columnæ¥å°†ä½å±‚ç‰©ç†ç‰¹å¾å’Œé«˜å±‚è¯­ä¹‰ç‰¹å¾èåˆã€‚å› ä¸ºå¤šå°ºåº¦é¢„æµ‹æ–¹æ³•æ¯”å¦‚FPNå˜çš„æµè¡Œï¼Œå› æ­¤è®¸å¤šå°†ä¸åŒå°†ç‰¹å¾é‡‘å­—å¡”èåˆçš„è½»é‡çº§æ¨¡å‹è¢«æå‡ºã€‚è¿™äº›æ¨¡å‹åŒ…å«äº†SFAMï¼ŒASFFå’ŒBiFPNã€‚SFAMçš„ä¸»è¦æ€æƒ³æ˜¯åœ¨å¤šå°ºåº¦è¿æ¥ç‰¹å¾å›¾ä¸Šä½¿ç”¨channel-wiseçº§åˆ«çš„è°ƒæ•´ã€‚å¯¹äºASFFï¼Œå®ƒä½¿ç”¨softmaxä½œä¸ºpoint-wiseçº§åˆ«çš„è°ƒæ•´ï¼Œç„¶åå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾åŠ åœ¨ä¸€èµ·ã€‚åœ¨BiFPNä¸­ï¼Œæå‡ºä½¿ç”¨å¤šè¾“å…¥æƒé‡æ®‹å·®è¿æ¥å»æ‰§è¡Œscale-wiseçº§åˆ«çš„è°ƒæ•´ï¼Œç„¶åå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾åŠ åœ¨ä¸€èµ·ã€‚<br />
â€ƒâ€ƒåœ¨æœ€è¿‘çš„ä¸€äº›ç ”ç©¶ä¸­ï¼Œä¸€äº›ç ”ç©¶è€…å°†æ³¨æ„åŠ›æ”¾åœ¨äº†å¯»æ‰¾ä¼˜ç§€çš„æ¿€æ´»å‡½æ•°ã€‚ä¸€ä¸ªå¥½çš„æ¿€æ´»å‡½æ•°å¯ä»¥å°†æ¢¯åº¦æ›´æœ‰æ•ˆçš„è¿›è¡Œä¼ æ’­ï¼ŒåŒæ—¶ä¸ä¼šå¢åŠ é¢å¤–çš„è®¡ç®—é‡ã€‚åœ¨2010å¹´ï¼ŒNairå’ŒHintonæå‡ºäº†ReLUæ¥è§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ä¼ ç»Ÿçš„tanhå’Œsigmodæ¿€æ´»å‡½æ•°ä¸­ç»å¸¸ä¼šé‡åˆ°ã€‚éšåï¼ŒLReLu,PReLU,ReLU6,Scaled Exponential Linear Unit(SELU),Swish,hard-Swishå’ŒMishç­‰æ¿€æ´»å‡½æ•°è¢«æå‡ºï¼Œä»–ä»¬ç”¨äºè§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚LReLUå’ŒPReLUä¸»è¦ç”¨æ¥è§£å†³å½“è¾“å‡ºå°äºé›¶çš„æ—¶å€™ï¼ŒReLUçš„æ¢¯åº¦ä¸ºé›¶çš„é—®é¢˜ã€‚ReLU6å’Œhard-Swishä¸»è¦ä¸ºé‡åŒ–ç½‘ç»œè€Œè®¾è®¡ã€‚å¯¹äºç¥ç»ç½‘ç»œçš„è‡ªå½’ä¸€åŒ–ï¼Œæå‡ºSELUæ¿€æ´»å‡½æ•°å»å®ç°è¿™ä¸ªç›®çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯Swishå’ŒMishéƒ½æ˜¯è¿ç»­å¯å¯¼çš„æ¿€æ´»å‡½æ•°ã€‚<br />
â€ƒâ€ƒåŸºäºæ·±åº¦å­¦ä¹ çš„ç‰©ä½“æ£€æµ‹ä¸­å¸¸ç”¨çš„åå¤„ç†æ–¹æ³•æ˜¯NMSï¼Œå¯ä»¥è¿‡æ»¤æ‰æ•ˆæœä¸å¥½çš„BBoxï¼Œä¿ç•™æ•ˆæœè¾ƒå¥½çš„BBoxã€‚NMSå°è¯•æ”¹è¿›çš„æ–¹æ³•å’Œä¼˜åŒ–ç›®æ ‡æ–¹ç¨‹çš„æ–¹æ³•ç±»ä¼¼ã€‚NMSæå‡ºçš„æœ€åˆçš„æ–¹æ³•å¹¶æ²¡æœ‰å°†ä¸Šä¸‹æ–‡ä¿¡æ¯è€ƒè™‘åœ¨å†…ï¼Œå› æ­¤Girshickç­‰äººåœ¨R-CNNä¸­æ·»åŠ äº†åˆ†ç±»ç½®ä¿¡åº¦ä½œä¸ºå‚è€ƒï¼Œç„¶åæ ¹æ®ç½®ä¿¡åº¦å¾—åˆ†çš„é¡ºåºï¼Œç”±é«˜åˆ°ä½æ‰§è¡Œgreedy NMSï¼ŒDIoU NMSçš„å¼€å‘è€…å°†é‡å¿ƒåæ ‡çš„è·ç¦»ä¿¡æ¯æ·»åŠ åˆ°Bboxçš„ç­›é€‰å¤„ç†ä¸­äº†ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸Šé¢æåˆ°çš„åå¤„ç†æ–¹æ³•ä¸­éƒ½ä¸ç›´æ¥å¼•ç”¨æ•è·çš„å›¾åƒç‰¹å¾ï¼Œåç»­çš„anchor-freeæ–¹æ³•å¼€å‘ä¸­ä¸å†éœ€è¦åå¤„ç†ã€‚</p>
<h1 id="yolov4-ç½‘ç»œç»“æ„-bof-bosé€‰æ‹©"><a class="markdownIt-Anchor" href="#yolov4-ç½‘ç»œç»“æ„-bof-bosé€‰æ‹©"></a> YOLOv4 ç½‘ç»œç»“æ„ã€BoFã€BoSé€‰æ‹©</h1>
<p>â€ƒâ€ƒç»è¿‡å¤§é‡çš„å®éªŒéªŒè¯ï¼Œä½œè€…ä½¿ç”¨CSPDarknet53ä½œä¸ºéª¨æ¶ï¼Œåˆ©ç”¨SPPæé«˜å…¶æ„Ÿå—é‡ï¼ŒPANetä½œä¸ºNeckï¼ŒYOLOv3ä½œä¸ºheadã€‚å¯¹äºè®­ç»ƒæ¿€æ´»å‡½æ•°ï¼Œå› ä¸ºPReLUå’ŒSELUéš¾ä»¥è®­ç»ƒï¼Œå¹¶ä¸”ReLU6æ˜¯ä¸“é—¨ä¸ºé‡åŒ–ç½‘ç»œè®¾è®¡çš„ï¼Œæˆ‘ä»¬å› æ­¤ä¸è€ƒè™‘è¿™è¿™ä¸‰ä¸ªæ¿€æ´»å‡½æ•°ã€‚æ­£åˆ™åŒ–æ–¹é¢ï¼Œé€‰æ‹©äº†DropBlockï¼Œå› ä¸ºå®ƒæ¯”å…¶ä»–æ­£åˆ™åŒ–æ–¹æ³•æ•ˆæœå¥½ã€‚å› ä¸ºåªå…³æ³¨åœ¨ä¸€å—GPUä¸Šè®­ç»ƒï¼Œå› æ­¤ä¸è€ƒè™‘CGBNã€SyncBNã€‚<br />
â€ƒâ€ƒæ­¤å¤–ï¼Œä½œè€…è¿˜æå‡ºäº†ä»¥ä¸‹é¢å¤–çš„æ”¹è¿›</p>
<ul>
<li>æ–°çš„æ•°æ®å¢å¼ºæ–¹æ³•ï¼šMosaicå’ŒSelf-Adversarial Training(SAT)</li>
<li>ä½¿ç”¨é—ä¼ ç®—æ³•é€‰æ‹©æœ€ä¼˜è¶…å‚æ•°</li>
<li>æ”¹è¿›ç°æœ‰ç®—æ³•ï¼Œä½¿å…¶æ›´é€‚åˆYOLOv4é«˜æ•ˆè®­ç»ƒå’Œæ£€æµ‹ï¼šæ”¹è¿›äº†SAMã€PANå’ŒCross mini-Batch Normalization(CmBN)</li>
</ul>
<h2 id="mosaic"><a class="markdownIt-Anchor" href="#mosaic"></a> Mosaic</h2>
<p>â€ƒâ€ƒMosaicæ˜¯ä¸€ç§æ–°å‹çš„æ•°æ®å¢å¹¿çš„ç®—æ³•ï¼Œå®ƒæ··åˆäº†å››å¼ è®­ç»ƒå›¾ç‰‡ã€‚å› æ­¤æœ‰å››ç§ä¸åŒçš„ä¸Šä¸‹æ–‡è¿›è¡Œèåˆï¼Œç„¶è€ŒCutMixä»…ä»…å°†ä¸¤å¼ å›¾ç‰‡è¿›è¡Œèåˆã€‚æ­¤å¤–ï¼Œbatch normalizationåœ¨æ¯ä¸ªç½‘ç»œå±‚ä¸­è®¡ç®—å››å¼ ä¸åŒå›¾ç‰‡çš„æ¿€æ´»ç»Ÿè®¡ã€‚è¿™æå¤§å‡å°‘äº†ä¸€ä¸ªå¤§çš„mini-batchå°ºå¯¸çš„éœ€æ±‚ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.0/mosaic.png" alt="mosaic" /></p>
<h2 id="sat"><a class="markdownIt-Anchor" href="#sat"></a> SAT</h2>
<p>â€ƒâ€ƒè‡ªé€‚åº”å¯¹æŠ—è®­ç»ƒ(SAT)ä¹Ÿè¡¨ç¤ºäº†ä¸€ä¸ªæ–°çš„æ•°æ®å¢å¹¿çš„æŠ€å·§ï¼Œå®ƒåœ¨å‰åä¸¤é˜¶æ®µä¸Šè¿›è¡Œæ“ä½œã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œç¥ç»ç½‘ç»œä»£æ›¿åŸå§‹çš„å›¾ç‰‡è€Œéç½‘ç»œçš„æƒé‡ã€‚ç”¨è¿™ç§æ–¹å¼ï¼Œç¥ç»ç½‘ç»œè‡ªå·±è¿›è¡Œå¯¹æŠ—è®­ç»ƒï¼Œä»£æ›¿åŸå§‹çš„å›¾ç‰‡å»åˆ›å»ºå›¾ç‰‡ä¸­æ­¤å¤„æ²¡æœ‰æœŸæœ›ç‰©ä½“çš„æè¿°ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼Œç¥ç»ç½‘ç»œä½¿ç”¨å¸¸è§„çš„æ–¹æ³•è¿›è¡Œè®­ç»ƒï¼Œåœ¨ä¿®æ”¹ä¹‹åçš„å›¾ç‰‡ä¸Šè¿›æ£€æµ‹ç‰©ä½“ã€‚</p>
<h2 id="cmbn"><a class="markdownIt-Anchor" href="#cmbn"></a> CmBN</h2>
<p>â€ƒâ€ƒCmBNï¼ˆCross mini-Batch Normalizationï¼‰ä»£è¡¨CBNæ”¹è¿›çš„ç‰ˆæœ¬ã€‚å®ƒåªæ”¶é›†äº†ä¸€ä¸ªæ‰¹æ¬¡ä¸­çš„mini-batchesä¹‹é—´çš„ç»Ÿè®¡æ•°æ®ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.0/CmBN.png" alt="CmBN" /></p>
<h2 id="sampan"><a class="markdownIt-Anchor" href="#sampan"></a> SAM,PAN</h2>
<p>â€ƒâ€ƒæˆ‘ä»¬å°†SAMçš„spatial-wiseæ³¨æ„åŠ›å˜æˆäº†point-wiseæ³¨æ„åŠ›æœºåˆ¶ï¼Œç„¶åå°†PANä¸­çš„shortcutè¿æ¥å˜æˆäº†concatenationè¿æ¥ï¼Œæ­£å¦‚ä¸‹å›¾æ‰€è¡¨ç¤ºçš„é‚£æ ·ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.0/SAM.png" alt="SAM" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.3.0/PAN.png" alt="PAN" /></p>
<h1 id="yolov4ç»†èŠ‚"><a class="markdownIt-Anchor" href="#yolov4ç»†èŠ‚"></a> YOLOv4ç»†èŠ‚</h1>
<table>
<thead>
<tr>
<th style="text-align:center">ç½‘ç»œç»“æ„</th>
<th style="text-align:center">é‡‡ç”¨æ¨¡å—</th>
<th style="text-align:center">BoF</th>
<th style="text-align:center">BoS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Backbone</td>
<td style="text-align:center">CSPDarknet53</td>
<td style="text-align:center">CutMix,Mosaic data augmentation,DropBlock regularization,Class label smoothing</td>
<td style="text-align:center">Mish activation,Cross-stage partial connections(CSP),Multi-input weight residual connections(MiWRC)</td>
</tr>
<tr>
<td style="text-align:center">Neck</td>
<td style="text-align:center">SPP,PAN</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">Head</td>
<td style="text-align:center">YOLOv3</td>
<td style="text-align:center">CIoU-loss,CmBN,DropBlock regulariztion,Mosaic data augementation,Self-Adversarial Training,Eliminate grid sensitivity,Using multiple anchors for a single ground truth, Cosine annealing scheduler, Optimal hyperparameters, Random training shapes</td>
<td style="text-align:center">Mish activation, SPP-block, SAM-block, PAN path-aggregation block, DIoU-NMS</td>
</tr>
</tbody>
</table>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>â€ƒâ€ƒYOLOv4è¿™ä¸€è®ºæ–‡ï¼Œå…ˆæ˜¯è®²è¿°äº†ä¸€äº›ç°ä»£ç›®æ ‡æ£€æµ‹ç®—æ³•çš„å‘å±•ï¼Œè®²è¿°äº†backboneã€Neckã€Headçš„ç»„æˆå’Œä½œç”¨ï¼Œè®²è¿°äº†ç›®æ ‡æ£€æµ‹å™¨çš„ç»„æˆéƒ¨åˆ†ï¼Œè§<a href="#%E6%99%AE%E9%80%9A%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E5%99%A8%E7%9A%84%E7%BB%84%E6%88%90%E9%83%A8%E5%88%86">æ™®é€šç›®æ ‡æ£€æµ‹å™¨çš„ç»„æˆéƒ¨åˆ†</a>ã€‚<br />
â€ƒâ€ƒéšåè®²è§£äº†Bag of freebiesï¼Œå…¶åŸºæœ¬åªæ”¹å˜è®­ç»ƒç­–ç•¥ã€‚è€ŒBag of specialsåŸºæœ¬ä¸ºæ¨¡å—å’Œåå¤„ç†æ–¹æ³•ï¼Œæå‡äº†æ£€æµ‹å‡†ç¡®åº¦ã€‚BoF,BoSçš„æ€»ç»“å¯ä»¥è§ä¸‹ã€‚è¿™é‡Œéƒ¨åˆ†å¯ä»¥çœ‹ä½œæ˜¯ç›®æ ‡æ£€æµ‹é¢†åŸŸçš„å‘å±•äº†ï¼Œä¹Ÿå¯ä»¥äº†è§£åˆ°å„ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹å’ŒåŸç†ã€‚åœ¨ä¹‹åçš„å†…å®¹ä¸­ä½œè€…å¯¹å„ç§ç»“æ„è¿›è¡Œäº†å®éªŒå¹¶æŒ‘é€‰ç½‘ç»œç»“æ„ï¼Œè¿˜è‡ªè¡Œæå‡ºäº†ä¸€å®šçš„åˆ›æ–°ï¼Œå¦‚Mosaicæ•°æ®å¢å¼º,è‡ªé€‚åº”å¯¹æŠ—è®­ç»ƒ(SAT)ï¼Œåˆ©ç”¨é—ä¼ ç®—æ³•é€‰æ‹©æœ€ä¼˜è¶…å‚æ•°ï¼Œæ”¹è¿›äº†CmBNã€SAMå’ŒPANã€‚æœ€ç»ˆçš„YOLOv4ä½¿ç”¨çš„å†…å®¹å¯ä»¥è§<a href="#YOLOv4%E7%BB%86%E8%8A%82">YOLOv4ç»†èŠ‚</a>ã€‚<br />
â€ƒâ€ƒYOLOv4è¿™ç¯‡å†…å®¹è®²äº†è®¸å¤šæŠ€æœ¯å†…å®¹ï¼Œå¦‚æœèƒ½å¼„æ‡‚è¿™äº›åè¯çš„è¯ä¹Ÿç›¸å½“äºæ˜¯å¼„æ‡‚äº†ç‰©ä½“æ£€æµ‹çš„å…¥é—¨çŸ¥è¯†äº†ã€‚<br />
â€ƒâ€ƒæœ€åæ”¾ä¸€å¼ YOLOv4ç»“æ„å›¾ï¼Œå‡ºå¤„<a href="https://www.pianshen.com/article/10371541073/">Windowsç‰ˆYOLOv4ç›®æ ‡æ£€æµ‹ï¼šåŸç†ä¸æºç è§£æ</a><br />
<img src="/images/YOLOv4-Note/YOLOv4.jpg" alt="structure" /></p>
<h2 id="bag-of-freebies-2"><a class="markdownIt-Anchor" href="#bag-of-freebies-2"></a> bag of freebies</h2>
<ul>
<li><strong>bag of freebies</strong>
<ul>
<li><strong>æ•°æ®å¢å¼º</strong>
<ul>
<li><strong>åƒç´ çº§åˆ«</strong>
<ul>
<li>photometric distortions</li>
<li>geometric distortions</li>
</ul>
</li>
<li><strong>ç‰©ä½“é®æŒ¡</strong>
<ul>
<li>random erase</li>
<li>CutOut</li>
<li>hide and seek</li>
<li>grid mask</li>
<li>DropOut</li>
<li>DropConnect</li>
<li>DropBlock</li>
</ul>
</li>
<li><strong>å›¾ç‰‡èåˆ</strong>
<ul>
<li>MixUP</li>
<li>CutMix</li>
<li>style transfer GAN</li>
</ul>
</li>
</ul>
</li>
<li><strong>æ ·æœ¬ä¸å‡è¡¡</strong>
<ul>
<li><strong>two-stage</strong>
<ul>
<li>hard negative example mining</li>
<li>online hard example mining</li>
</ul>
</li>
<li><strong>one-stage</strong>
<ul>
<li>focal loss</li>
</ul>
</li>
</ul>
</li>
<li><strong>ç±»åˆ«å…³è”åº¦éš¾ä»¥æè¿°</strong>
<ul>
<li>label smoothing</li>
</ul>
</li>
<li><strong>è¾¹ç•Œæ¡†å›å½’ç›®æ ‡å‡½æ•°</strong>
<ul>
<li>MSE</li>
<li>GIoU</li>
<li>DIoU</li>
<li>CIoU</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="bag-of-specials-2"><a class="markdownIt-Anchor" href="#bag-of-specials-2"></a> Bag of specials</h2>
<ul>
<li><strong>bag of specials</strong>
<ul>
<li><strong>plugins modules</strong>
<ul>
<li><strong>æé«˜æ„Ÿå—é‡</strong>
<ul>
<li>SPP</li>
<li>ASPP</li>
<li>RFB</li>
</ul>
</li>
<li><strong>attentionæ¨¡å—</strong>
<ul>
<li><strong>channel-wise</strong>
<ul>
<li>Squeeze-and-Excitation(SE)</li>
</ul>
</li>
<li><strong>point-wise</strong>
<ul>
<li>Spatial Attention Module(SAM)</li>
</ul>
</li>
</ul>
</li>
<li><strong>ç‰¹å¾èåˆ</strong>
<ul>
<li>skip connection</li>
<li>hyper-column</li>
<li>FPN</li>
<li>SFAM</li>
<li>ASFF</li>
<li>BiFPN</li>
</ul>
</li>
<li><strong>æ¿€æ´»å‡½æ•°</strong>
<ul>
<li>tanh</li>
<li>sigmod</li>
<li>ReLU</li>
<li>LReLU</li>
<li>PReLU</li>
<li>ReLU6</li>
<li>SELU</li>
<li>Swish</li>
<li>hard-Swish</li>
<li>Mish</li>
</ul>
</li>
</ul>
</li>
<li><strong>åå¤„ç†æ–¹æ³•</strong>
<ul>
<li>NMS</li>
<li>greedy NMS</li>
<li>DIoU NMS</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="åæ§½"><a class="markdownIt-Anchor" href="#åæ§½"></a> åæ§½</h2>
<p>â€ƒâ€ƒåé¢çš„å®éªŒç»“æœå°±ä¸å†ç¿»è¯‘äº†ã€‚å…ˆåç³Ÿä¸€ä¸‹è‡ªå·±ï¼Œæœ¬æ¥æ˜¯æƒ³å†™å†™æ¦‚è¦çš„ç»“æœå˜æˆäº†ç®€è¦ç¿»è¯‘ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰ç®€è¦åˆ°å“ªé‡Œå»ï¼Œå°´å°¬ã€‚</p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://arxiv.org/abs/2004.10934">[1]Bochkovskiy A, Wang C Y, Liao H Y M. Yolov4: Optimal speed and accuracy of object detection[J]. arXiv preprint arXiv:2004.10934, 2020.</a><br />
<a href="https://blog.csdn.net/qq_38316300/article/details/105759305">YOLOv4åŸæ–‡ç¿»è¯‘ - v4å®ƒç»ˆäºæ¥äº†ï¼</a><br />
<a href="https://www.pianshen.com/article/10371541073/">Windowsç‰ˆYOLOv4ç›®æ ‡æ£€æµ‹ï¼šåŸç†ä¸æºç è§£æ</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆä¸‰ï¼‰BDD100Kæ•°æ®é›†è½¬yoloæ ¼å¼</title>
    <url>/2021/04/09/bdd100k2yolo/</url>
    <content><![CDATA[<p>å°†bdd100kæ•°æ®é›†è½¬æ¢ä¸ºyoloæ ¼å¼<br />
å°é¢å›¾ã€Šè¦‹ä¸Šã’ã¦ã”ã‚‰ã‚“ã€å¤œç©ºã®æ˜Ÿã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºåŸå…ˆä»COCOä¸­æå–çš„æ•°æ®é›†çš„æ£€æµ‹æ•ˆæœä¸€ç›´ä¸å¥½ï¼Œåœ¨è§‚å¯Ÿäº†å‡ ä¸ªæ•°æ®é›†åå‘ç°ï¼ŒCOCOæ•°æ®é›†çš„å›¾ç‰‡ä¸­æˆ‘éœ€è¦çš„ç›®æ ‡éƒ½æ¯”è¾ƒå°ï¼Œä¸”æˆ‘éœ€è¦çš„ä¸€äº›ç±»æ ·æœ¬ä¸å‡è¡¡ï¼Œæ¯”å¦‚truckç±»å°±ç‰¹åˆ«å°‘ï¼Œå°½ç®¡YOLOv4çš„è®ºæ–‡ä¸­è¯´å¯ä»¥ä½¿ç”¨focal lossæ¥è§£å†³æ ·æœ¬ä¸å‡è¡¡ï¼Œä½†æ˜¯æœ€ç®€å•çš„è¿˜æ˜¯æ¢ä¸€ä¸ªæ•°æ®é›†ï¼Œå› æ­¤æ‰“ç®—æ–°åšä¸€ä¸ªæ•°æ®é›†ã€‚</p>
<h1 id="bdd100kæ•°æ®é›†"><a class="markdownIt-Anchor" href="#bdd100kæ•°æ®é›†"></a> BDD100Kæ•°æ®é›†</h1>
<p>å®˜ç½‘ï¼š<a href="https://bdd-data.berkeley.edu/">https://bdd-data.berkeley.edu/</a><br />
è®ºæ–‡ï¼š<a href="https://arxiv.org/abs/1805.04687">https://arxiv.org/abs/1805.04687</a><br />
githubï¼š<a href="https://github.com/bdd100k/bdd100k">https://github.com/bdd100k/bdd100k</a><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/bdd100k.gif" alt="bdd100k" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/compare.jpg" alt="compare" /></p>
<p>BDD100Kæ˜¯ä¼¯å…‹åˆ©å¤§å°AIå®éªŒå®¤å‘å¸ƒçš„ä¸€ä¸ªè‡ªåŠ¨é©¾é©¶é¢†åŸŸçš„æ•°æ®é›†ã€‚å…·ä½“å†…å®¹å¯ä»¥çœ‹è®ºæ–‡ï¼Œåœ¨æ­¤æˆ‘åªå…³å¿ƒæˆ‘éœ€è¦çš„å†…å®¹ï¼Œå„ä¸ªç±»åˆ«çš„æ•°æ®é‡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/categories.png" alt="ç±»åˆ«æ•°é‡" /><br />
BDD100Kä¸­è½¦è¾†è¡Œäººçš„æ•°é‡éƒ½å¾ˆå¤šï¼Œtruckæœ‰4296ä¸ªï¼ŒBusæœ‰16505ä¸ªã€‚è€ŒCOCOä¸­æˆ‘æƒ³è¦2000ä¸ªtruckæœ€ååªè¿”å›äº†æˆ‘1400å·¦å³ï¼Œå› æ­¤åœ¨COCOæå–è®­ç»ƒé›†è®­ç»ƒæµ‹è¯•ç»“æœçš„æ—¶å€™å‘ç°truckå’Œbusåˆ†ä¸æ¸…ï¼Œä¸”truckçš„AP50å¾ˆä½ã€‚</p>
<h1 id="æ•°æ®é›†è½¬æ¢"><a class="markdownIt-Anchor" href="#æ•°æ®é›†è½¬æ¢"></a> æ•°æ®é›†è½¬æ¢</h1>
<p>ç”±äºBDD100Kçš„æ•°æ®é›†æ ¼å¼å’Œdarknetéœ€è¦çš„yoloæ ¼å¼ä¸ä¸€æ ·ï¼Œå› æ­¤éœ€è¦å°†labelè¿›è¡Œè½¬æ¢ï¼Œé¡ºä¾¿å¯¹labelè¿›è¡Œä¸€ä¸‹æå–ï¼Œå»æ‰å‡ ä¸ªæˆ‘ä¸éœ€è¦çš„ç±»ã€‚<br />
BDD100Kçš„æ ‡ç­¾æ–‡ä»¶æ ¼å¼éµå¾ª<a href="https://doc.scalabel.ai/format.html">Scalabel Format</a>ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€äº›BDD100Kè‡ªå·±çš„æ ¼å¼ï¼Œä¸è¿‡ä¸æˆ‘çš„éœ€æ±‚æ²¡æœ‰å…³ç³»ã€‚å› æ­¤å…ˆæ¥çœ‹ä¸€ä¸‹scalabelæ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">- name: string</span><br><span class="line">- url: string</span><br><span class="line">- videoName: string (optional)</span><br><span class="line">- attributes: a dictionary of frame attributes</span><br><span class="line">- intrinsics</span><br><span class="line">    - focal: [x, y]</span><br><span class="line">    - center: [x, y]</span><br><span class="line">    - nearClip:</span><br><span class="line">- extrinsics</span><br><span class="line">    - location</span><br><span class="line">    - rotation</span><br><span class="line">- timestamp: int64 (epoch time ms)</span><br><span class="line">- frameIndex: int (optional, frame index in this video)</span><br><span class="line">- labels [ ]:</span><br><span class="line">    - id: string</span><br><span class="line">    - category: string (classification)</span><br><span class="line">    - manualShape: boolean</span><br><span class="line">    - manualAttributes: boolean</span><br><span class="line">    - score: float</span><br><span class="line">    - attributes: a dictionary of label attributes</span><br><span class="line">    - box2d:</span><br><span class="line">        - x1: float</span><br><span class="line">        - y1: float</span><br><span class="line">        - x2: float</span><br><span class="line">        - y2: float</span><br><span class="line">    - box3d:</span><br><span class="line">        - alpha:</span><br><span class="line">        - orientation:</span><br><span class="line">        - location: ()</span><br><span class="line">        - dimension: (3D point, height, width, length)</span><br><span class="line">    - poly2d: an array of objects, with the structure</span><br><span class="line">        - vertices: [][]float (list of 2-tuples [x, y])</span><br><span class="line">        - types: string</span><br><span class="line">        - closed: boolean</span><br></pre></td></tr></table></figure>
<p>å†çœ‹ä¸€çœ‹å®é™…æ–‡ä»¶ï¼Œè¿˜æ˜¯ç¬¦åˆçš„<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/bdd100k_labels.png" alt="compare" /></p>
<h1 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h1>
<p>å‚è€ƒäº†githubçš„ä¸€ä¸ªç°æœ‰<a href="https://github.com/km23630/bdd100k_to_yolo_converter">è½¬æ¢è„šæœ¬</a>è¿›è¡Œäº†ä¸€å®šçš„ä¿®æ”¹ï¼Œæ·»åŠ äº†å‘½ä»¤è¡Œæ”¯æŒå’Œç±»åˆ«æå–ã€‚ä»£ç å¦‚ä¸‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"></span><br><span class="line">TRAIN_LABEL_NAME = <span class="string">&#x27;bdd100k_labels_images_train.json&#x27;</span></span><br><span class="line">VAL_LABEL_NAME = <span class="string">&#x27;bdd100k_labels_images_val.json&#x27;</span></span><br><span class="line"></span><br><span class="line">classes = [</span><br><span class="line">    <span class="string">&quot;person&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bike&quot;</span>,</span><br><span class="line">    <span class="string">&quot;car&quot;</span>,</span><br><span class="line">    <span class="string">&quot;motor&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bus&quot;</span>,</span><br><span class="line">    <span class="string">&quot;truck&quot;</span>,</span><br><span class="line">    <span class="string">&quot;rider&quot;</span>,</span><br><span class="line">    <span class="string">&quot;train&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">counter = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> classes:</span><br><span class="line">    counter[c] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_args</span>():</span><br><span class="line">    <span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--images&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;images path&quot;</span>,</span><br><span class="line">                        <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;./images/100k&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-l&#x27;</span>, <span class="string">&#x27;--labels&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;labels path&quot;</span>,</span><br><span class="line">                        <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&quot;./labels&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;--type&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;type of dataset&quot;</span>,</span><br><span class="line">                        choices=[<span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;val&#x27;</span>], default=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parser.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convertBdd100k2yolo</span>(<span class="params">imageFileName, label</span>):</span><br><span class="line">    img = cv2.imread(imageFileName)</span><br><span class="line">    width, height = img.shape[<span class="number">1</span>], img.shape[<span class="number">0</span>]</span><br><span class="line">    dw = <span class="number">1.0</span>/width</span><br><span class="line">    dh = <span class="number">1.0</span>/height</span><br><span class="line"></span><br><span class="line">    catName = label[<span class="string">&#x27;category&#x27;</span>]</span><br><span class="line">    classIndex = classes.index(catName)</span><br><span class="line">    roi = label[<span class="string">&#x27;box2d&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    w = roi[<span class="string">&#x27;x2&#x27;</span>]-roi[<span class="string">&#x27;x1&#x27;</span>]</span><br><span class="line">    h = roi[<span class="string">&#x27;y2&#x27;</span>]-roi[<span class="string">&#x27;y1&#x27;</span>]</span><br><span class="line">    x_center = roi[<span class="string">&#x27;x1&#x27;</span>] + w/<span class="number">2</span></span><br><span class="line">    y_center = roi[<span class="string">&#x27;y1&#x27;</span>] + h/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    x_center, y_center, w, h = x_center*dw, y_center*dh, w*dw, h*dh</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125; &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(classIndex, x_center, y_center, w, h)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    args = get_args()</span><br><span class="line">    <span class="comment"># è½¬ä¸ºæ–‡ä»¶ä½ç½®</span></span><br><span class="line">    <span class="keyword">if</span> args.<span class="built_in">type</span> == <span class="string">&#x27;train&#x27;</span>:</span><br><span class="line">        imageRootPath = os.path.join(args.images, <span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">        labelFilePath = os.path.join(args.labels, TRAIN_LABEL_NAME)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        imageRootPath = os.path.join(args.images, <span class="string">&#x27;val&#x27;</span>)</span><br><span class="line">        labelFilePath = os.path.join(args.labels, VAL_LABEL_NAME)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(labelFilePath) <span class="keyword">as</span> file:</span><br><span class="line">        lines = json.load(file)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;loaded labels&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> tqdm(lines):</span><br><span class="line">        <span class="comment"># å›¾åƒå</span></span><br><span class="line">        name = line[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        labels = line[<span class="string">&#x27;labels&#x27;</span>]</span><br><span class="line">        imagePath = os.path.join(imageRootPath, name)</span><br><span class="line">        labelPath = imagePath.replace(<span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(os.path.realpath(imagePath)):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(labelPath, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            <span class="comment"># éå†label</span></span><br><span class="line">            <span class="keyword">for</span> label <span class="keyword">in</span> labels:</span><br><span class="line">                cat = label[<span class="string">&#x27;category&#x27;</span>]</span><br><span class="line">                <span class="keyword">if</span> cat <span class="keyword">in</span> classes:</span><br><span class="line">                    counter[cat] += <span class="number">1</span></span><br><span class="line">                    file.write(convertBdd100k2yolo(imagePath,label))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(counter)</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼Œè®­ç»ƒé›†å› ä¸ºä¸­é€”ç¼©æ”¾äº†ä¸€ä¸‹vscodeçª—å£ï¼Œæ‰€ä»¥è¿›åº¦æ¡å°±è¿™æ ·äº†ã€‚é™¤å»ä¸€ä¸ª20%é‡çš„testï¼Œç±»åˆ«æ•°é‡è¿˜æ˜¯å’Œè®ºæ–‡é‡Œé¢çš„å·®ä¸å¤šçš„ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/bdd100k_train_convert.png" alt="train" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/bdd100k_val_convert.png" alt="val" /></p>
<h1 id="åˆ é™¤æ— æ ‡ç­¾å›¾ç‰‡"><a class="markdownIt-Anchor" href="#åˆ é™¤æ— æ ‡ç­¾å›¾ç‰‡"></a> åˆ é™¤æ— æ ‡ç­¾å›¾ç‰‡</h1>
<p>ç»è¿‡è®­ç»ƒå‘ç°å­˜åœ¨ä¸€äº›æ— æ ‡ç­¾å›¾ç‰‡ï¼Œå› æ­¤éœ€è¦è¿›è¡Œåˆ é™¤ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_args</span>():</span><br><span class="line">    <span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--images&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;images path&quot;</span>,</span><br><span class="line">                        <span class="built_in">type</span>=<span class="built_in">str</span>, default=<span class="string">&#x27;./images/100k&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;--type&#x27;</span>, <span class="built_in">help</span>=<span class="string">&quot;type of dataset&quot;</span>,</span><br><span class="line">                        choices=[<span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;val&#x27;</span>], default=<span class="string">&#x27;train&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> parser.parse_args()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getFileList</span>(<span class="params"><span class="built_in">dir</span>, extract</span>):</span><br><span class="line">    fileList = []</span><br><span class="line">    filenames = os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        ext = os.path.splitext(filename)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> ext == extract:</span><br><span class="line">            fileList.append(filename)</span><br><span class="line">    <span class="keyword">return</span> fileList</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    args = get_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.<span class="built_in">type</span> == <span class="string">&#x27;train&#x27;</span>:</span><br><span class="line">        imageRootPath = os.path.join(args.images, <span class="string">&#x27;train&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        imageRootPath = os.path.join(args.images, <span class="string">&#x27;val&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    imageName = getFileList(imageRootPath, <span class="string">&#x27;.jpg&#x27;</span>)</span><br><span class="line">    labelName = getFileList(imageRootPath, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    labelName = [label.replace(<span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;.jpg&quot;</span>) <span class="keyword">for</span> label <span class="keyword">in</span> labelName]</span><br><span class="line">    lackImages = <span class="built_in">set</span>(imageName) - <span class="built_in">set</span>(labelName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> lackImages:</span><br><span class="line">        os.remove(os.path.join(imageRootPath,file))</span><br><span class="line">        <span class="comment">#print(os.path.join(imageRootPath,file))</span></span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>æ ‡ç­¾è½¬æ¢å®Œæˆï¼Œæ¥ä¸‹æ¥ç”Ÿæˆtrain.txtå’Œval.txtå°±å’Œä¹‹å‰çš„coco2yoloä¸€æ ·äº†ã€‚éšåçš„æ•ˆæœå°±å¾—è®­ç»ƒåæ‰èƒ½çŸ¥é“äº†ã€‚</p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p>[1]Yu F, Chen H, Wang X, et al. Bdd100k: A diverse driving dataset for heterogeneous multitask learning[C]//Proceedings of the IEEE/CVF conference on computer vision and pattern recognition. 2020: 2636-2645.<br />
[2]<a href="https://blog.csdn.net/jocelyn870/article/details/81207448">BDD100Kï¼šä¸€ä¸ªå¤§è§„æ¨¡ã€å¤šæ ·åŒ–çš„é©¾é©¶è§†é¢‘æ•°æ®é›†</a><br />
[3]<a href="https://github.com/km23630/bdd100k_to_yolo_converter">bdd100k_to_yolo_converter</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
      </tags>
  </entry>
  <entry>
    <title>win10é”å±é¡µé¢è·å–</title>
    <url>/2021/05/03/win10-lock/</url>
    <content><![CDATA[<p>å› ä¸ºè§‰å¾—win10é”å±é¡µé¢æ¯”è¾ƒå¥½çœ‹ï¼Œæœ‰æ—¶å€™èƒ½å¤Ÿæ ¹æ®æ—¥æœŸå˜æ¢ï¼Œå› æ­¤å†™ä¸ªè„šæœ¬è·å–é”å±é¡µé¢<br />
å°é¢ã€Šå†¬å¤©çš„è°è¨€ -Snow World End-ã€‹</p>
<span id="more"></span>
<h1 id="win10åŸç”Ÿé”å±"><a class="markdownIt-Anchor" href="#win10åŸç”Ÿé”å±"></a> win10åŸç”Ÿé”å±</h1>
<p>æ ¹æ®æŸ¥é˜…èµ„æ–™ï¼Œwin10çš„é”å±å›¾ç‰‡ä¿å­˜åœ¨<code>C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Packages\Microsoft.Windows.ContentDeliveryManager_cw5n1h2txyewy\LocalState\Assets</code>ï¼Œæ ¹æ®win10ç¤¾åŒºæ‰€è¯´<code>cw5n1h2txyewy</code>æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¸è¿‡æˆ‘å‘ç°çš„éƒ½æ˜¯è¿™ä¸ªï¼Œä¹Ÿè®¸å…¶ä»–ç‰ˆæœ¬çš„win10ä¸å¤ªä¸€æ ·å§ã€‚è¿™é‡Œé¢çš„æ–‡ä»¶éœ€è¦æ·»åŠ <code>.jpg</code>åç¼€æ‰æ˜¯æˆ‘ä»¬éœ€è¦çš„å›¾ç‰‡ã€‚</p>
<h2 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># win10 screen lock version</span></span><br><span class="line"></span><br><span class="line">src = os.path.expanduser(</span><br><span class="line">    <span class="string">&quot;~\AppData\Local\Packages\Microsoft.Windows.ContentDeliveryManager_cw5n1h2txyewy\LocalState\Assets&quot;</span>)</span><br><span class="line"></span><br><span class="line">dst = os.path.expanduser(<span class="string">&quot;~\Pictures\Saved Pictures\lock&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--dst&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;dst path&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=dst)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    dst = args.dst</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dst):</span><br><span class="line">        os.mkdir(dst)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># remove duplicate filename</span></span><br><span class="line">    srcFilenames = <span class="built_in">set</span>(os.listdir(src))</span><br><span class="line">    dstFilenames = os.listdir(dst)</span><br><span class="line">    dstFilenames = [filename.replace(<span class="string">&#x27;.jpg&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">for</span> filename <span class="keyword">in</span> dstFilenames]</span><br><span class="line">    dstFilenames = <span class="built_in">set</span>(dstFilenames)</span><br><span class="line">    lackFilenames = srcFilenames - dstFilenames</span><br><span class="line"></span><br><span class="line">    <span class="comment"># copy file</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> lackFilenames:</span><br><span class="line">        srcFile = os.path.join(src, filename)</span><br><span class="line">        dstFile = os.path.join(dst, filename)+<span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">        shutil.copyfile(srcFile, dstFile)</span><br></pre></td></tr></table></figure>
<h1 id="lenovoé”å±"><a class="markdownIt-Anchor" href="#lenovoé”å±"></a> Lenovoé”å±</h1>
<p>è”æƒ³ç”µè„‘åŠ©æ‰‹ä¼šæ¥ç®¡win10çš„åŸç”Ÿé”å±ï¼Œé€šè¿‡everythingè§‚å¯Ÿæ–‡ä»¶å˜åŒ–å¯ä»¥æŸ¥åˆ°è”æƒ³é”å±çš„ä½ç½®åœ¨<code>C:\ProgramData\Lenovo\devicecenter\LockScreen\cache</code>ï¼Œä¸”ä»¥jpgæ ¼å¼å­˜å¥½äº†ï¼Œå¯æƒœçš„æ˜¯å¤§éƒ¨åˆ†å›¾ç‰‡åŸæœ¬å°±æœ‰è”æƒ³çš„äºŒç»´ç æˆ–è€…æ°´å°ã€‚</p>
<h2 id="ä»£ç -2"><a class="markdownIt-Anchor" href="#ä»£ç -2"></a> ä»£ç </h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="comment"># lenovo screen lock version</span></span><br><span class="line"></span><br><span class="line">src = <span class="string">&quot;C:\ProgramData\Lenovo\devicecenter\LockScreen\cache&quot;</span></span><br><span class="line"></span><br><span class="line">dst = os.path.expanduser(<span class="string">&quot;~\Pictures\Saved Pictures\lock&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_filelist</span>(<span class="params"><span class="built_in">dir</span>, extract</span>):</span><br><span class="line">    filelist = []</span><br><span class="line">    filenames = os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        ext = os.path.splitext(filename)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> ext == extract:</span><br><span class="line">            filelist.append(filename)</span><br><span class="line">    <span class="keyword">return</span> filelist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--dst&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;dst path&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=dst)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;--src&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;src path&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=src)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    dst = args.dst</span><br><span class="line">    src = args.src</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(src):</span><br><span class="line">        exit(<span class="string">&quot;src path not found&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dst):</span><br><span class="line">        os.mkdir(dst)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ignore zip</span></span><br><span class="line">    srcFilenames = <span class="built_in">set</span>(get_filelist(src, <span class="string">&#x27;.jpg&#x27;</span>))</span><br><span class="line">    dstFilenames = <span class="built_in">set</span>(os.listdir(dst))</span><br><span class="line">    <span class="comment"># remove duplicate filename</span></span><br><span class="line">    lackFilenames = srcFilenames - dstFilenames</span><br><span class="line"></span><br><span class="line">    <span class="comment"># copy file</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> lackFilenames:</span><br><span class="line">        srcFile = os.path.join(src, filename)</span><br><span class="line">        dstFile = os.path.join(dst, filename)</span><br><span class="line">        shutil.copyfile(srcFile, dstFile)</span><br></pre></td></tr></table></figure>
<h1 id="å¼€æœºè‡ªå¯åŠ¨"><a class="markdownIt-Anchor" href="#å¼€æœºè‡ªå¯åŠ¨"></a> å¼€æœºè‡ªå¯åŠ¨</h1>
<p>å¼€æœºè‡ªå¯åŠ¨åªéœ€è¦å°†è„šæœ¬æ”¾åœ¨<code>C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code>æ–‡ä»¶å¤¹ï¼Œç»è¿‡ä¸ªäººç”µè„‘æµ‹è¯•ï¼Œpowershellå¯ä»¥ç›´æ¥è¿è¡Œpythonè„šæœ¬ï¼Œå¦‚æœä¸è¡Œï¼Œå¯ä»¥å†™batè„šæœ¬è¿›è¡Œå¤„ç†ã€‚</p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>ç›®å‰ç°åœ¨æš‚æ—¶ä½¿ç”¨lenovoçš„ç¨‹åºï¼Œåé¢è€ƒè™‘çˆ¬å–å›¾ç‰‡æ›´æ¢ã€‚ç›®å‰ä»£ç ä»“åº“åœ¨<a href="https://github.com/qxdn/win10-lock-fetch">repo</a></p>
]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>ç”Ÿæ´»</tag>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>MobileNetsè®ºæ–‡ç¬”è®°</title>
    <url>/2021/05/20/mobilenets-note/</url>
    <content><![CDATA[<p>å› ä¸ºå¬è¯´äº†MobileNetsä¸­çš„æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„å¤§åï¼Œå› æ­¤æ‹œè¯»äº†ä¸€ä¸‹è®ºæ–‡<br />
å°é¢ã€Šå…¬ä¸»è¿ç»“Re:diveã€‹ï¼Œä½œè€…<a href="https://www.pixiv.net/users/6657532">QuAn_</a></p>
<span id="more"></span>
<h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1>
<p>â€ƒâ€ƒåœ¨è®¸å¤šåµŒå…¥å¼è®¾å¤‡ä¸Šï¼Œå—é™äºæœ‰é™çš„è®¡ç®—èµ„æºï¼Œå¾€å¾€æ— æ³•è·‘ä¸€äº›æ•ˆæœè¾ƒå¥½çš„å¤§æ¨¡å‹ã€‚åœ¨MobileNetä»¥å‰ï¼Œè®¸å¤šè®ºæ–‡éƒ½æ˜¯é›†ä¸­äºå‡å°‘æ¨¡å‹ä½“ç§¯ï¼Œè€Œä¸æ˜¯é€Ÿåº¦ã€‚<br />
â€ƒâ€ƒMobileNetsæ˜¯åŸºäºæ·±åº¦å¯åˆ†ç¦»å·ç§¯(depthwise separable convolutions)ï¼Œè¿™åœ¨Inception Modelã€Falattened networksä¸­éƒ½æœ‰æåˆ°ã€‚é™ä½æ¨¡å‹ä½“ç§¯çš„æ–¹æ³•æœ‰å‰ªæã€å‹ç¼©ã€å“ˆå¸Œã€éœå¤«æ›¼ç¼–ç å’Œè’¸é¦ç­‰ç­‰ã€‚</p>
<h1 id="åˆ›æ–°ç‚¹"><a class="markdownIt-Anchor" href="#åˆ›æ–°ç‚¹"></a> åˆ›æ–°ç‚¹</h1>
<p>â€ƒâ€ƒMobileNetæå‡ºäº†ä¸€ç§æ·±åº¦å¯åˆ†ç¦»å·ç§¯ç»“æ„ï¼Œå°†æ ‡å‡†å·ç§¯åˆ†ä¸ºäº†æ·±åº¦å·ç§¯(depthwise convolution)å’Œé€ç‚¹å·ç§¯(pointwise convolution)ä¸¤æ­¥ã€‚ä¼ ç»Ÿæ ‡å‡†å·ç§¯å¾€å¾€åœ¨è¿›è¡Œè®¡ç®—çš„æ—¶å€™ä¼šåŒæ—¶æ”¹å˜é€šé“æ•°å’Œç‰¹å¾å›¾çš„å¤§å°ã€‚è€Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„ç¬¬ä¸€æ­¥æ·±åº¦å·ç§¯åˆ™æ˜¯ä¸æ”¹å˜è¾“å‡ºçš„é€šé“æ•°ï¼Œåªæ”¹å˜ç‰¹å¾å›¾çš„å¤§å°ï¼Œç¬¬äºŒæ­¥é€ç‚¹å·ç§¯åˆ™æ˜¯ä»¥1*1å¤§å°çš„å·ç§¯æ ¸å¯¹ç‰¹å¾å›¾åšå¤„ç†ï¼Œåªæ”¹å˜è¾“å‡ºçš„é€šé“æ•°ä¸æ”¹å˜ç‰¹å¾å›¾çš„å¤§å°ã€‚</p>
<h1 id="è®¡ç®—é‡å¯¹æ¯”"><a class="markdownIt-Anchor" href="#è®¡ç®—é‡å¯¹æ¯”"></a> è®¡ç®—é‡å¯¹æ¯”</h1>
<p>â€ƒâ€ƒå‡å®šå·ç§¯çš„è¾“å…¥ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><mi>M</mi></mrow><annotation encoding="application/x-tex">D_F*D_F*M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span>çš„ç‰¹å¾å›¾ï¼Œè¾“å‡ºä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">D_F*D_F*N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>çš„ç‰¹å¾å›¾ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">D_F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºç‰¹å¾å›¾çš„é•¿å®½ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span>ä¸ºç‰¹å¾å›¾çš„é€šé“æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>ä¸ºè¾“å‡ºçš„é€šé“æ•°ã€‚<br />
â€ƒâ€ƒä¼ ç»Ÿå·ç§¯éœ€è¦ä¸€ä¸ªå¤§å°ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">M*D_K*D_K*N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>çš„å·ç§¯æ ¸ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>K</mi></msub></mrow><annotation encoding="application/x-tex">D_K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºå…¶å†…æ ¸å¤§å°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span></span></span></span>ä¸ºè¾“å…¥é€šé“æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>ä¸ºè¾“å‡ºé€šé“æ•°ã€‚åˆ™å…¶è®¡ç®—é‡å¦‚ä¸‹ã€‚</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><mi>M</mi><mo>âˆ—</mo><mi>N</mi><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub></mrow><annotation encoding="application/x-tex">D_K*D_K*M*N*D_F*D_F
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>â€ƒâ€ƒå¯¹äºæ·±åº¦å¯åˆ†ç¦»å·ç§¯æ¥è¯´éœ€è¦ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M*D_K*D_K*1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>çš„æ·±åº¦å·ç§¯æ ¸æ ¸ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>âˆ—</mo><mn>1</mn><mo>âˆ—</mo><mn>1</mn><mo>âˆ—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">M*1*1*N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span>çš„é€ç‚¹å·ç§¯æ ¸ã€‚å…¶è®¡ç®—é‡å¦‚ä¸‹ï¼Œå¼å­å·¦è¾¹ä¸ºæ·±åº¦å·ç§¯çš„è®¡ç®—é‡ï¼Œå³è¾¹ä¸ºé€ç‚¹å·ç§¯çš„è®¡ç®—é‡ã€‚</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><mi>M</mi><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>+</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><mi>M</mi><mo>âˆ—</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">D_K*D_K*M*D_F*D_F+D_F*D_F*M*N
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span></span></p>
<p>â€ƒâ€ƒç»è¿‡å¯¹æ¯”å¯ä»¥å¾—çŸ¥å…¶å‹ç¼©é‡å¦‚ä¸‹ã€‚</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><mi>M</mi><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>+</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><mi>M</mi><mo>âˆ—</mo><mi>N</mi></mrow><mrow><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>K</mi></msub><mo>âˆ—</mo><mi>M</mi><mo>âˆ—</mo><mi>N</mi><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub><mo>âˆ—</mo><msub><mi>D</mi><mi>F</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><mo>+</mo><mfrac><mn>1</mn><msubsup><mi>D</mi><mi>K</mi><mn>2</mn></msubsup></mfrac></mrow><annotation encoding="application/x-tex">\frac{D_K*D_K*M*D_F*D_F+D_F*D_F*M*N}{D_K*D_K*M*N*D_F*D_F} = \frac{1}{N}+\frac{1}{D_K^2}  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.3009709999999997em;vertical-align:-0.9795309999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.4064690000000004em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.29353099999999993em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9795309999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>â€ƒâ€ƒç”±äºç¥ç»ç½‘ç»œä¸­ç»å¸¸ä½¿ç”¨3*3çš„å·ç§¯æ ¸ï¼Œå› æ­¤å¯ä»¥å‡å°‘å¤§çº¦8åˆ°9å€çš„è®¡ç®—é‡ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.8/DW_CONV.png" alt="æ ‡å‡†å·ç§¯æ ¸æ·±åº¦å¯åˆ†ç¦»å·ç§¯ç»“æ„å¯¹æ¯”" /></p>
<h1 id="å®éªŒç»“æœ"><a class="markdownIt-Anchor" href="#å®éªŒç»“æœ"></a> å®éªŒç»“æœ</h1>
<p>è¿™ä¸€éƒ¨åˆ†æœ‰å¤§é‡çš„å¯¹æ¯”å®éªŒè¯¦ç»†å¯ä»¥çœ‹<a href="https://arxiv.org/abs/1704.04861">åŸæ–‡</a>ã€‚ä½¿ç”¨å…¨å·ç§¯å’Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„MobileNetå¯¹æ¯”å¦‚ä¸‹å›¾ï¼Œå‡†ç¡®ç‡ä¸‹é™äº†1%ï¼Œè®¡ç®—é‡ä¸‹é™åˆ°äº†åŸæ¥çš„11%ï¼Œå‚æ•°é‡ä¸‹é™åˆ°äº†4.2%ã€‚<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.8/compare.png" alt="å…¨å·ç§¯å’Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯MobileNetå¯¹æ¯”" /></p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>â€ƒâ€ƒæ·±åº¦å¯åˆ†ç¦»å·ç§¯åªæ˜¯ä¸€ç§è½»é‡çº§çš„ç½‘ç»œç»“æœï¼Œä¸æ˜¯æ¨¡å‹å‹ç¼©æ–¹æ³•ã€‚ä½†æ˜¯å…¶é™ä½è®¡ç®—é‡çš„æ•ˆæœçš„ç†è®ºæ”¯æŒåˆç†æœ‰æ®ï¼Œè™½ç„¶ä¸ªäººè§‰å¾—å‡†ç¡®ç‡éƒ¨åˆ†å¯èƒ½æœ‰ç‚¹ç‚¹å¤¸å¼ ï¼Œéœ€è¦åç»­è‡ªè¡Œå®éªŒéªŒè¯ä¸€ä¸‹ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p>[1]Howard A G, Zhu M, Chen B, et al. Mobilenets: Efficient convolutional neural networks for mobile vision applications[J]. arXiv preprint arXiv:1704.04861, 2017.</p>
]]></content>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>pythonè£…é¥°å™¨</title>
    <url>/2021/05/26/python-decorator/</url>
    <content><![CDATA[<p>ç”±äºå‰å‡ å¤©äº†è§£åˆ°äº†pythonçš„è£…é¥°å™¨ï¼Œæ„Ÿè§‰æœ‰ç‚¹ç‚¹ç±»ä¼¼äºAOPæ€æƒ³ï¼Œå› æ­¤è®°å½•ä¸€ä¸‹å­¦ä¹ ç¬”è®°ã€‚<br />
å°é¢ã€Šé‡‘è‰²ãƒ©ãƒ–ãƒªãƒƒãƒã‚§ã€‹</p>
<span id="more"></span>
<h1 id="é—­åŒ…closure"><a class="markdownIt-Anchor" href="#é—­åŒ…closure"></a> é—­åŒ…(closure)</h1>
<p>åœ¨è®²pythonè£…é¥°å™¨å‰ï¼Œéœ€è¦å…ˆä»‹ç»ä¸€ä¸‹é—­åŒ…</p>
<blockquote>
<p>In programming languages, a closure, also lexical closure or function closure, is a technique for implementing lexically scoped name binding in a language with first-class functions. Operationally, a closure is a record storing a function together with an environment. The environment is a mapping associating each free variable of the function (variables that are used locally, but defined in an enclosing scope) with the value or reference to which the name was bound when the closure was created.</p>
</blockquote>
<p>ç›´æ¥å±•ç¤ºä¾‹å­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    x=<span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">y</span>):</span><br><span class="line">        <span class="keyword">return</span> x + y</span><br><span class="line">    <span class="comment"># è¿”å›é—­åŒ…</span></span><br><span class="line">    <span class="keyword">return</span> g  </span><br><span class="line"></span><br><span class="line">closure = f()</span><br><span class="line"><span class="comment"># è¾“å‡º3</span></span><br><span class="line"><span class="built_in">print</span>(closure(<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>æœ¬æ¥åœ¨<code>f()</code>æ‰§è¡Œå®Œåï¼Œxå°±ä¼šè¢«å†…å­˜å›æ”¶ï¼Œä½†æ˜¯å†…éƒ¨å‡½æ•°ä½¿ç”¨äº†xï¼Œå› æ­¤xå†…å­˜ä¸ä¼šè¢«å›æ”¶ã€‚<br />
é—­åŒ…çš„å¥½å¤„åœ¨äºå‡½æ•°å†…çš„å‚æ•°ä¸ä¼šè¢«å†…å­˜å›æ”¶ï¼Œå¯ä»¥éšè—ä¸€äº›å†…å®¹ï¼ŒåŒæ—¶é¿å…äº†å‘½åå†²çªã€‚ç¼ºç‚¹åœ¨äºå†…å­˜æ— æ³•è‡ªåŠ¨å›æ”¶ï¼Œå®¹æ˜“æº¢å‡ºã€‚</p>
<h1 id="è£…é¥°å™¨decorator"><a class="markdownIt-Anchor" href="#è£…é¥°å™¨decorator"></a> è£…é¥°å™¨(decorator)</h1>
<p>å…ˆæ¥çœ‹çœ‹ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ä¾‹å­</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment"># å¤–éƒ¨</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="comment">#å†…éƒ¨</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wapper</span>(<span class="params">*args,**kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        ans = func(*args,**kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(end - start)</span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line">    <span class="keyword">return</span> wapper</span><br><span class="line"><span class="meta">@timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>(<span class="params">nums</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over&quot;</span>)</span><br><span class="line">loop(<span class="number">55555555</span>)</span><br><span class="line"><span class="built_in">print</span>(loop.__name__)</span><br></pre></td></tr></table></figure>
<p>å…¶è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">over</span><br><span class="line">1.4170827865600586</span><br><span class="line">wapper</span><br></pre></td></tr></table></figure>
<p>å…¶è°ƒç”¨æ–¹å¼æ‹†åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">wapper = timer(loop)</span><br><span class="line">wapper(<span class="number">55555555</span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè£…é¥°å™¨æ¥å¢å¼ºäº†loopæ–¹æ³•ï¼Œä¸ºå…¶æ·»åŠ äº†è®¡ç®—è€—æ—¶çš„åŠŸèƒ½ã€‚å¤–éƒ¨å‡½æ•°ä¼ è¿›å»çš„æ˜¯å‡½æ•°ï¼Œå†…éƒ¨å‡½æ•°ä¼ è¿›çš„æ˜¯å‚æ•°ã€‚argså’Œkwargså¯ä»¥çœ‹<a href="https://stackoverflow.com/questions/36901/what-does-double-star-asterisk-and-star-asterisk-do-for-parameters">è¿™</a>ã€‚ç®€å•æ¥è¯´å°±æ˜¯argsæ˜¯ä»¥å…ƒç»„ä¼ å‚ï¼Œkwargsæ˜¯ä»¥é”®å€¼å¯¹æ¥ä¼ å‚ã€‚<br />
å¦å¤–è¿™ç§å®ç°è£…é¥°å™¨çš„æ–¹æ³•å¾ˆç®€å•ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç¼ºé™·ï¼Œå°±æ˜¯__name__å±æ€§å‘ç”Ÿäº†å˜åŒ–ã€‚è¿™å¯¹ä¸€äº›ä½¿ç”¨__name__çš„åº“æ¥è¯´æœ‰ç¼ºé™·ã€‚å¯ä»¥ä½¿ç”¨è‡ªå¸¦functoolsåº“æ¥å®Œæˆã€‚</p>
<h2 id="ä¿®å¤__name__"><a class="markdownIt-Anchor" href="#ä¿®å¤__name__"></a> ä¿®å¤__name__</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wapper</span>(<span class="params">*args,**kwargs</span>):</span><br><span class="line">        start = time.time()</span><br><span class="line">        ans = func(*args,**kwargs)</span><br><span class="line">        end = time.time()</span><br><span class="line">        <span class="built_in">print</span>(end - start)</span><br><span class="line">        <span class="keyword">return</span> ans  </span><br><span class="line">    <span class="keyword">return</span> wapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>(<span class="params">nums</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over&quot;</span>)</span><br><span class="line">loop(<span class="number">55555555</span>)</span><br><span class="line"><span class="built_in">print</span>(loop.__name__)</span><br></pre></td></tr></table></figure>
<p>å…¶è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">over</span><br><span class="line">1.1916275024414062</span><br><span class="line">loop</span><br></pre></td></tr></table></figure>
<p>functools.warps(func)å°†åŸå‡½æ•°çš„__module__,__name__,__doc__,__dict__ç­‰æ‹·è´funcä¸­ã€‚<br />
å¯ä»¥çœ‹åˆ°ä½¿ç”¨functoolså__name__ä¿¡æ¯å˜æˆäº†åŸå‡½æ•°çš„åå­—</p>
<h2 id="å¸¦å‚æ•°çš„è£…é¥°å™¨"><a class="markdownIt-Anchor" href="#å¸¦å‚æ•°çš„è£…é¥°å™¨"></a> å¸¦å‚æ•°çš„è£…é¥°å™¨</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">timer_with_parm</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timer</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">        @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wapper</span>(<span class="params">*args,**kwargs</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;this is:&quot;</span>+name)</span><br><span class="line">            start = time.time()</span><br><span class="line">            ans = func(*args,**kwargs)</span><br><span class="line">            end = time.time()</span><br><span class="line">            <span class="built_in">print</span>(end - start)</span><br><span class="line">            <span class="keyword">return</span> ans</span><br><span class="line">        <span class="keyword">return</span> wapper</span><br><span class="line">    <span class="keyword">return</span> timer</span><br><span class="line"><span class="meta">@timer_with_parm(<span class="params"><span class="string">&quot;timer1&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loop</span>(<span class="params">nums</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(nums):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;over&quot;</span>)</span><br><span class="line">loop(<span class="number">55555555</span>)</span><br><span class="line"><span class="built_in">print</span>(loop.__name__)</span><br></pre></td></tr></table></figure>
<p>å…¶è¾“å‡ºç»“æœå¦‚ä¸‹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">this is:timer1</span><br><span class="line">over</span><br><span class="line">1.2349653244018555</span><br><span class="line">loop</span><br></pre></td></tr></table></figure>
<p>å…¶è°ƒç”¨æ–¹å¼æ‹†åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">timer = timer_with_parm(<span class="string">&quot;timer1&quot;</span>)</span><br><span class="line">wapper = timer(loop)</span><br><span class="line">wapper(<span class="number">55555555</span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°decoratorä¸­çš„å‚æ•°å·²ç»è¢«ä¼ å…¥äº†ï¼Œä¸”é€šè¿‡wapperå‡½æ•°è¾“å‡ºäº†ã€‚</p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>pythonçš„è£…é¥°å™¨å®ç°äº†AOPæ¨¡å‹ï¼Œç®€åŒ–äº†ä»£ç </p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p>[1]<a href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">é—­åŒ…wiki</a><br />
[2]<a href="https://stackoverflow.com/questions/36901/what-does-double-star-asterisk-and-star-asterisk-do-for-parameters">argså’Œkwargs</a><br />
[3]<a href="https://www.jianshu.com/p/ee82b941772a">ç†è§£Pythonè£…é¥°å™¨(Decorator)</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxç¬”è®°</title>
    <url>/2021/06/10/nginx-starter/</url>
    <content><![CDATA[<p>æ—©å°±å¬è¯´äº†nginxçš„å¤§åï¼ŒåŒæ—¶æœ€è¿‘çš„å¥½å¤šå¤„é—®é¢˜éƒ½è¯´æœ€å¥½ç”¨nginxåå‘ä»£ç†è§£å†³ï¼Œå› æ­¤å­¦ä¹ ä¸€ä¸‹ã€‚<br />
å°é¢å›¾ã€Šè¦‹ä¸Šã’ã¦ã”ã‚‰ã‚“ã€å¤œç©ºã®æ˜Ÿã€‹</p>
<span id="more"></span>
<h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1>
<p>nginxï¼ˆengine Xï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½webæœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚å¯¹äºç”¨æˆ·æ¥è¯´åªçŸ¥é“åå‘ä»£ç†æœåŠ¡å™¨ï¼Œè€Œä¸çŸ¥é“å…¶èƒŒåçš„æœåŠ¡å™¨é›†ç¾¤ï¼Œå› æ­¤å¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.6/Reverse_proxy.jpg" alt="Reverse proxy" /></p>
<h1 id="å¸¸ç”¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#å¸¸ç”¨å‘½ä»¤"></a> å¸¸ç”¨å‘½ä»¤</h1>
<h2 id="å¯åŠ¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨"></a> å¯åŠ¨</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#éœ€è¦æ³¨æ„çš„æ˜¯nginxå¯¹è·¯å¾„æœ‰è¦æ±‚ï¼Œå°½é‡ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ŒLinuxä¸­æ³¨æ„è¦sudo</span></span><br><span class="line">[nginx place] -c [nginx conf]</span><br></pre></td></tr></table></figure>
<p>å¯¹äºwindowsç³»ç»Ÿéœ€è¦ä¸‹é¢æŒ‡ä»¤ï¼Œå¦å¤–windowsç³»ç»Ÿéœ€è¦</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">start nginx</span><br></pre></td></tr></table></figure>
<h2 id="æŸ¥è¯¢è¿›ç¨‹"><a class="markdownIt-Anchor" href="#æŸ¥è¯¢è¿›ç¨‹"></a> æŸ¥è¯¢è¿›ç¨‹</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#windows</span></span><br><span class="line">tasklist /fi <span class="string">&quot;imagename eq nginx.exe&quot;</span></span><br><span class="line"><span class="comment">#Linux</span></span><br><span class="line">ps -ax | grep nginx</span><br></pre></td></tr></table></figure>
<h2 id="å…¶ä»–å‘½ä»¤"><a class="markdownIt-Anchor" href="#å…¶ä»–å‘½ä»¤"></a> å…¶ä»–å‘½ä»¤</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ ¼å¼ nginx -s signal</span></span><br><span class="line">nginx -s stop <span class="comment">#å¿«é€Ÿå…³é—­nginx</span></span><br><span class="line">nginx -s quit <span class="comment">#ç¼“æ…¢å…³é—­nginx</span></span><br><span class="line">nginx -s reload <span class="comment">#é‡å¯nginx</span></span><br><span class="line">nginx -s reopen <span class="comment">#é‡æ–°æ‰“å¼€log</span></span><br><span class="line">nginx -t <span class="comment">#æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®</span></span><br><span class="line">nginx -T <span class="comment">#ä¸-tæ•ˆæœä¸€è‡´ï¼Œä½†æ˜¯è¾“å‡ºåˆ°æ ‡å‡†æµ</span></span><br><span class="line">nginx -v <span class="comment">#è¾“å‡ºnginxç‰ˆæœ¬</span></span><br><span class="line">nginx -V <span class="comment">#è¾“å‡ºnginxç‰ˆæœ¬ã€ç¼–è¯‘å™¨å’Œé…ç½®å‚æ•°</span></span><br></pre></td></tr></table></figure>
<h1 id="é…ç½®æ–‡ä»¶è§£æ"><a class="markdownIt-Anchor" href="#é…ç½®æ–‡ä»¶è§£æ"></a> é…ç½®æ–‡ä»¶è§£æ</h1>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è¿è¡Œç”¨æˆ·</span></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="comment">#å¯åŠ¨è¿›ç¨‹æ•°</span></span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¨å±€error log</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#PIDæ–‡ä»¶ nginxçš„pid</span></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#httpæœåŠ¡å™¨</span></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment">#å…¨å±€å—</span></span><br><span class="line">    <span class="comment">#è®¾å®šmimeç±»å‹</span></span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#è®¾ç½®æ—¥å¿—æ ¼å¼</span></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#sendfile æŒ‡ä»¤æŒ‡å®š Nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œ</span></span><br><span class="line">    <span class="comment">#å¿…é¡»è®¾ä¸º onï¼Œå¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜ IO é‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œ I/O å¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„ uptime.</span></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzipå‹ç¼©</span></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#httpæœåŠ¡å™¨</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment">#ç›‘å¬ç«¯å£</span></span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="comment">#å®šä¹‰ä½¿ç”¨localhostè®¿é—®</span></span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># / urlä¸‹çš„</span></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="comment"># è·¯å¾„</span></span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="comment">#é»˜è®¤é¦–é¡µ</span></span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#error_page  404              /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    proxy_pass   http://127.0.0.1;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ \.php$ &#123;</span></span><br><span class="line">        <span class="comment">#    root           html;</span></span><br><span class="line">        <span class="comment">#    fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">        <span class="comment">#    fastcgi_index  index.php;</span></span><br><span class="line">        <span class="comment">#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span></span><br><span class="line">        <span class="comment">#    include        fastcgi_params;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># deny access to .htaccess files, if Apache&#x27;s document root</span></span><br><span class="line">        <span class="comment"># concurs with nginx&#x27;s one</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        <span class="comment">#location ~ /\.ht &#123;</span></span><br><span class="line">        <span class="comment">#    deny  all;</span></span><br><span class="line">        <span class="comment">#&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># another virtual host using mix of IP-, name-, and port-based configuration</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       8000;</span></span><br><span class="line">    <span class="comment">#    listen       somename:8080;</span></span><br><span class="line">    <span class="comment">#    server_name  somename  alias  another.alias;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># HTTPS server</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#server &#123;</span></span><br><span class="line">    <span class="comment">#    listen       443 ssl;</span></span><br><span class="line">    <span class="comment">#    server_name  localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_certificate      cert.pem;</span></span><br><span class="line">    <span class="comment">#    ssl_certificate_key  cert.key;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_session_cache    shared:SSL:1m;</span></span><br><span class="line">    <span class="comment">#    ssl_session_timeout  5m;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span></span><br><span class="line">    <span class="comment">#    ssl_prefer_server_ciphers  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#    location / &#123;</span></span><br><span class="line">    <span class="comment">#        root   html;</span></span><br><span class="line">    <span class="comment">#        index  index.html index.htm;</span></span><br><span class="line">    <span class="comment">#    &#125;</span></span><br><span class="line">    <span class="comment">#&#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å®æˆ˜"><a class="markdownIt-Anchor" href="#å®æˆ˜"></a> å®æˆ˜</h1>
<p>æœ¬æ¬¡ä½¿ç”¨nginxæ¥ä»£ç†hexoæœåŠ¡å™¨<br />
é¦–å…ˆå¯åŠ¨hexo</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo server --drafts</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨nginxï¼Œå®Œæ•´é…ç½®æ–‡ä»¶è§åæ–‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\14642\nginx-1.20.1\nginx.exe  -c D:\LearnCode\qxdn.github.io\nginx.conf</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æ‰“å¼€æµè§ˆå™¨è®¿é—®localhostæ—¢å¯ä»¥å‘ç°80ç«¯å£å˜æˆäº†åšå®¢ï¼Œåå‘ä»£ç†æˆåŠŸã€‚</p>
<h2 id="nginxå®Œæ•´é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#nginxå®Œæ•´é…ç½®æ–‡ä»¶"></a> nginxå®Œæ•´é…ç½®æ–‡ä»¶</h2>
<p>æ³¨æ„é‡Œé¢çš„proxy</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">worker_processes</span>  auto;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       C:/Users/<span class="number">14642</span>/nginx-<span class="number">1</span>.<span class="number">20</span>.<span class="number">1</span>/conf/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        </span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="comment"># ä»£ç†</span></span><br><span class="line">            <span class="attribute">proxy_pass</span>   http://127.0.0.1:4000;</span><br><span class="line">            <span class="comment"># è½¬å‘</span></span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>:<span class="variable">$server_port</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>æœ¬æ¬¡å®éªŒåˆæ­¥å®Œæˆnginxä»£ç†åšå®¢ï¼Œåç»­å°†è¿›ä¸€æ­¥å®ŒæˆdockeråŒ–ï¼Œå‰åç«¯åˆ†ç¦»å’Œå­åŸŸååˆ©ç”¨ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p>[1]<a href="http://nginx.org/en/docs/beginners_guide.html">nginx doc</a><br />
[2]<a href="https://mp.weixin.qq.com/s?__biz=MzA5OTAyNzQ2OA==&amp;mid=2649719878&amp;idx=1&amp;sn=78a5a3b37a5a9bfb2eda34e31a801174&amp;scene=58&amp;subscene=0">ä¸€ç¯‡æ–‡ç« ä¸Šæ‰‹nginx</a></p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Linux</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­å»ºéƒ¨ç½²live2d api</title>
    <url>/2021/06/14/live2d-api/</url>
    <content><![CDATA[<p>æ­å»ºéƒ¨ç½²live2d api<br />
å°é¢ã€Šæ˜¥éŸ³ã‚¢ãƒªã‚¹*ã‚°ãƒ©ãƒ ã€‹</p>
<span id="more"></span>
<h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1>
<p>æƒ³è¦æ ¹æ®<a href="https://github.com/fghrsh/live2d_api">live2d api</a>æ­å»ºè‡ªå·±çš„apiã€‚æˆ‘æƒ³è¦ä½¿ç”¨dockeræ–¹ä¾¿éƒ¨ç½²ï¼Œä½†æ˜¯ä¸ä¼šphpå’Œnginxç¯å¢ƒæ­å»ºï¼Œè¿˜å¯¹dockeræ¯”è¾ƒé™Œç”Ÿã€‚å› æ­¤å†™ä¸‹è¿™ç¯‡æ–‡ç« ã€‚å› ä¸ºè¿™ä¸‰ä»¶éƒ½ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè½»å–·ã€‚</p>
<h1 id="dockeré…ç½®"><a class="markdownIt-Anchor" href="#dockeré…ç½®"></a> dockeré…ç½®</h1>
<p>é¦–å…ˆå°†live2d apiä»“åº“å…‹éš†ä¸‹æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/fghrsh/live2d_api.git</span><br><span class="line">cd live2d_api</span><br></pre></td></tr></table></figure>
<h2 id="docke-composeç¼–å†™"><a class="markdownIt-Anchor" href="#docke-composeç¼–å†™"></a> docke-composeç¼–å†™</h2>
<p>åˆ›å»º<code>docker-compose.yaml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">php:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">php:8-fpm</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./:/var/www/html</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./:/usr/share/nginx/html</span></span><br></pre></td></tr></table></figure>
<h2 id="nginxé…ç½®"><a class="markdownIt-Anchor" href="#nginxé…ç½®"></a> nginxé…ç½®</h2>
<p>åˆ›å»º<code>nginx.conf</code>æ–‡ä»¶ï¼Œæ³¨æ„ä¸­é—´çš„è·¨åŸŸè¯·æ±‚é…ç½®ï¼ŒåŒæ—¶server nameè¿™äº›è¯·æ ¹æ®è‡ªå·±çš„éœ€æ±‚é…ç½®</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#user  nobody;</span></span><br><span class="line"><span class="attribute">worker_processes</span>  auto;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/error.log;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="comment">#error_log  logs/error.log  info;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">    <span class="comment">#                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#access_log  logs/access.log  main;</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line">    <span class="comment">#tcp_nopush     on;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#keepalive_timeout  0;</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#gzip  on;</span></span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="attribute">root</span>   /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#è·¨åŸŸ</span></span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span> <span class="string">&#x27;*&#x27;</span>; </span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Methods&#x27;</span> <span class="string">&#x27;GET, POST, OPTIONS, PUT, DELETE&#x27;</span>;</span><br><span class="line">        <span class="attribute">add_header</span> <span class="string">&#x27;Access-Control-Allow-Headers&#x27;</span> <span class="string">&#x27;Content-Type&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123; </span><br><span class="line">            <span class="attribute">index</span> index.php;</span><br><span class="line">            <span class="attribute">autoindex</span> <span class="literal">off</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#è½¬å‘</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">            <span class="comment">#fastcgi_pass   127.0.0.1:9000;</span></span><br><span class="line">            <span class="attribute">root</span> /var/www/html;</span><br><span class="line">            <span class="attribute">fastcgi_pass</span> php:<span class="number">9000</span>;</span><br><span class="line">            <span class="attribute">fastcgi_index</span>  index.php;</span><br><span class="line">            <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">            <span class="attribute">fastcgi_param</span> PATH_INFO <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line">            <span class="attribute">fastcgi_param</span> PATH_TRANSLATED <span class="variable">$document_root</span><span class="variable">$fastcgi_path_info</span>;</span><br><span class="line">            <span class="attribute">include</span>  fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="éƒ¨ç½²"><a class="markdownIt-Anchor" href="#éƒ¨ç½²"></a> éƒ¨ç½²</h1>
<p>ä½¿ç”¨dockeréƒ¨ç½²æ¯”è¾ƒç®€å•</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker compose up -d</span><br><span class="line">#æˆ–è€…å¯ä»¥ç”¨ä¸‹é¢çš„</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<h1 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h1>
<p>éƒ¨ç½²åä½¿ç”¨æµè§ˆå™¨æ‰“å¼€<code>http://localhost/get/?id=1-23</code>ç»“æœå¦‚ä¸‹<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.5/get.png" alt="get api" /><br />
æµ‹è¯•ä½¿ç”¨stevenjoezhangçš„<a href="https://github.com/stevenjoezhang/live2d-widget">live2d-widget</a>ï¼Œå°†å…¶ä¸­çš„<code>apiPath</code>æ›¿æ¢ä¸º<code>http://localhost/</code>ï¼Œæ‰“å¼€demo.htmlï¼Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°è¯·æ±‚çš„urlä¸ºlocalhostï¼Œapiæµ‹è¯•æˆåŠŸã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.5/apitest.png" alt="api test" /></p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>æœ¬æ¬¡å®Œæˆäº†å¯¹live2d apiçš„dockeråŒ–ã€‚ä½†æ˜¯åªåœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šè¿›è¡Œäº†æµ‹è¯•ï¼Œåç»­å°†å¯¹è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ã€‚</p>
]]></content>
      <categories>
        <category>docker</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>nginx</tag>
        <tag>php</tag>
      </tags>
  </entry>
  <entry>
    <title>HK416æ‰‹åŠå¼€ç®±</title>
    <url>/2021/06/15/HK416-GK/</url>
    <content><![CDATA[<p>æ¯•ä¸šæ—¶ä¹°çš„HK416 æ˜Ÿä¹‹èŒ§æ‰‹åŠåšä¸ºè‡ªå·±ç¤¼ç‰©çš„å¼€ç®±è®°å½•</p>
<span id="more"></span>
<h1 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€"></a> å¼•è¨€</h1>
<p>åœ¨é€›æ·˜å®çš„æ—¶å€™å¶ç„¶çœ‹åˆ°äº†HK416 æ˜Ÿä¹‹èŒ§çš„æ‰‹åŠï¼Œå•†åº—å›¾å¦‚ä¸‹æ‰€ç¤ºã€‚ä¸å¾—ä¸è¯´å¤ªæˆ³æˆ‘xpç³»ç»Ÿäº†ï¼Œè™½ç„¶æˆ‘ä¸ç©å°‘å¥³å‰çº¿ï¼Œä½†æ˜¯è¿™ä¸ªå®åœ¨æ˜¯å¤ªå¥½çœ‹äº†ï¼Œäºæ˜¯å°±ä¹°ä¸‹æ¥å½“æˆ‘çš„æ¯•ä¸šç¤¼ç‰©ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/shop.jpg" alt="å•†åº—å›¾" /></p>
<h1 id="åŒ…è£…ç®±"><a class="markdownIt-Anchor" href="#åŒ…è£…ç®±"></a> åŒ…è£…ç®±</h1>
<p>ç®±å­å›¾å¦‚ä¸‹æ‰€ç¤ºï¼Œå¤–é¢çš„416å¾ˆå¯çˆ±ã€‚ä¸‹é¢å››å¼ åˆ†åˆ«ä¸ºåŒ…è£…ç®±çš„æ­£é¢ã€åé¢ã€ä¾§é¢å’Œå†…ä¾§çš„å›¾ç‰‡ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/box.jpg" alt="åŒ…è£…ç®±æ­£é¢" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/box2.jpg" alt="åŒ…è£…ç®±åé¢" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/box3.jpg" alt="åŒ…è£…ç®±ä¾§é¢" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/box4.jpg" alt="åŒ…è£…ç®±é‡Œä¾§" /></p>
<h1 id="é…ä»¶"><a class="markdownIt-Anchor" href="#é…ä»¶"></a> é…ä»¶</h1>
<p>é…ä»¶ä¸€å…±ä¸¤ä»½ï¼Œä¸€ä¸ªæ˜¯è¯´æ˜ä¹¦ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ç¼–å·å¡ã€å…‘æ¢ç <br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/part1.jpg" alt="è¯´æ˜ä¹¦" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/part2.jpg" alt="ç¼–å·å¡ç­‰" /></p>
<h1 id="æ­£ä½“"><a class="markdownIt-Anchor" href="#æ­£ä½“"></a> æ­£ä½“</h1>
<p>æœ¬æ¬¡å¼€ç®±çš„æœ¬ä½“å¦‚ä¸‹ï¼Œè¯·åŸè°…ä¸€ä¸‹æˆ‘çš„æ‹ç…§æŠ€æœ¯ã€‚å®é™…ä¸Šè¿˜æ˜¯ç‰¹åˆ«å¥½çœ‹çš„ï¼Œæªç›’å¯ä»¥è£…ä¸€æŠŠhk416æ¨¡å‹ï¼Œæ­¤å¤–ä¸ºäº†å’ŒåŒä¸€ç³»åˆ—ä¹‹å‰ä¸¤æ¬¾åˆå¹¶è¿˜æœ‰ä¸€ä¸ªå¢é«˜ç›˜ã€‚å®é™…ä¸Šåˆ°æ‰‹çš„æ—¶å€™å¢é«˜ç›˜å’Œ416çš„åº•ç›˜æ˜¯ç”¨èƒ¶æ°´ç²˜æ­»çš„ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/HK416.jpg" alt="HK416" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/gun_box.jpg" alt="æªç›’" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.4/bottom.jpg" alt="å¢é«˜ç›˜" /></p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>ä½œä¸ºä¸€ä¸ªæ¯•ä¸šé€ç»™è‡ªå·±çš„å°ç¤¼ç‰©ï¼Œä»·é’±æˆ‘è§‰å¾—è¿˜æ˜¯éå¸¸å€¼çš„ï¼Œå®åœ¨æ˜¯å¤ªå¥½çœ‹äº†ã€‚</p>
]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>ç”Ÿæ´»</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆå››ï¼‰åŸºäºæ·±åº¦å­¦ä¹ ç®—æ³•YOLOçš„è¡Œäººè½¦è¾†æ£€æµ‹â€”â€”å¼€é¢˜æŠ¥å‘Š</title>
    <url>/2021/06/26/YOLO-openreport/</url>
    <content><![CDATA[<h1 id="ç›®çš„åŠæ„ä¹‰å«å›½å†…å¤–çš„ç ”ç©¶ç°çŠ¶åˆ†æ"><a class="markdownIt-Anchor" href="#ç›®çš„åŠæ„ä¹‰å«å›½å†…å¤–çš„ç ”ç©¶ç°çŠ¶åˆ†æ"></a> ç›®çš„åŠæ„ä¹‰ï¼ˆå«å›½å†…å¤–çš„ç ”ç©¶ç°çŠ¶åˆ†æï¼‰</h1>
<h2 id="ç ”ç©¶ç›®çš„"><a class="markdownIt-Anchor" href="#ç ”ç©¶ç›®çš„"></a> ç ”ç©¶ç›®çš„</h2>
<p>â€ƒâ€ƒæœ¬æ¬¡æ¯•ä¸šè®¾è®¡æ‹Ÿå¯¹COCOæ•°æ®é›†è¿›è¡Œæå–ï¼Œå¹¶ç»“åˆå…¶ä»–è‡ªåˆ¶æ•°æ®é›†è¡¥å……ï¼Œå¾—åˆ°è¡Œäººè½¦è¾†çš„å›¾ç‰‡å’Œæ ‡ç­¾ï¼Œæ­å»ºYou Only Look Once(YOLO)ç½‘ç»œæ¨¡å‹ï¼Œè®­ç»ƒå¾—åˆ°é’ˆå¯¹è½¦è¾†å’Œè¡Œäººçš„ç›®æ ‡æ£€æµ‹æ¨¡å‹ã€‚</p>
<h2 id="ç ”ç©¶æ„ä¹‰"><a class="markdownIt-Anchor" href="#ç ”ç©¶æ„ä¹‰"></a> ç ”ç©¶æ„ä¹‰</h2>
<p>â€ƒâ€ƒç›®æ ‡æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰ä¸­çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ï¼Œå¸¸ç”¨çš„æ–¹æ³•æœ‰R-CNN<sup><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></sup>ã€Fast R-CNN<sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></sup>ã€Faster R-CNN<sup><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup></sup>ã€YOLO<sup><sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup></sup>ã€SSD<sup><sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup></sup>ç­‰ã€‚åœ¨è¿™äº›ç®—æ³•ä¹‹ä¸­ï¼ŒYOLOä»¥å…¶è¾ƒé«˜çš„å‡†ç¡®ç‡ã€å®æ—¶æ€§å’Œè¾ƒå°çš„æ¨¡å‹è€Œè¾ƒä¸ºå‡ºåã€‚YOLOv4 tiny<sup><sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup></sup>çš„æ¨¡å‹å¤§å°å¯ä»¥åˆ°è¾¾åˆ°23 MBï¼Œè€Œä¸”Intersection over Unionï¼ˆIoUï¼‰åœ¨50%ä»¥ä¸Šçš„average precisionï¼ˆAPï¼‰å¯ä»¥è¾¾åˆ°40.2%ï¼ŒåŸºäºYOLOæ¨¡å‹è®­ç»ƒå‡ºæ¥çš„è½¦è¾†ä¸è¡Œäººæ£€æµ‹æ¨¡å‹ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ä¸€äº›åµŒå…¥å¼è®¾å¤‡ä¸­ï¼Œä»è€Œè¿ç”¨åœ¨è‡ªåŠ¨é©¾é©¶é¢†åŸŸã€‚</p>
<h2 id="å›½å†…å¤–ç ”ç©¶ç°çŠ¶"><a class="markdownIt-Anchor" href="#å›½å†…å¤–ç ”ç©¶ç°çŠ¶"></a> å›½å†…å¤–ç ”ç©¶ç°çŠ¶</h2>
<p>â€ƒâ€ƒè‡ª2012å¹´Hintonè®¾è®¡çš„AlexNetè·å¾—ImageNetç«èµ›å† å†›ä»¥æ¥ï¼Œäººä»¬ä¾¿å¼€å§‹æ›´å¤šçš„å…³æ³¨å·ç§¯ç¥ç»ç½‘ç»œCNNï¼Œä¹‹åä¹Ÿå¯å‘äº†VGGã€GoogLeNetç­‰çŸ¥åçš„å·ç§¯ç¥ç»ç½‘ç»œï¼Œè€ŒYOLOv1å°±æ˜¯åŸºäºGoogLeNetçš„backboneè¿›è¡Œæ”¹è¿›ã€‚åœ¨YOLOv1æå‡ºä»¥å‰ï¼Œå¸¸ç”¨çš„åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸ºR-CNNç³»åˆ—ï¼Œå…¶æ–¹æ³•å¯ä»¥è®¤ä¸ºå…ˆä½¿ç”¨Region Proposal Networkï¼ˆRPNï¼‰ç½‘ç»œç”Ÿæˆä¸€ç³»åˆ—æ ·æœ¬çš„å€™é€‰æ¡†ï¼Œç„¶åä½¿ç”¨CNNç½‘ç»œå¯¹å€™é€‰æ¡†è¿›è¡Œè¯†åˆ«å¹¶åˆ†ç±»ã€‚è¿™ç§æ–¹æ³•çš„ç²¾ç¡®åº¦å–å†³äºå…¶å€™é€‰æ¡†çš„æå–ï¼Œè€Œä¸”è€—æ—¶å¤§ï¼ŒFaster R-CNNç½‘ç»œåœ¨GPUä¸Šæ£€æµ‹PASCAL VOCçš„é€Ÿåº¦è¾¾åˆ°5 frame per second(FPS)ï¼Œè€Œmean average precision(mAP)è¾¾åˆ°73.2%<sup><sup class="footnote-ref"><a href="#fn3" id="fnref3:1">[3:1]</a></sup></sup>ã€‚è¿™ç§æ–¹æ³•å› ä¸ºéœ€è¦ä¸¤æ­¥è¿›è¡Œæ£€æµ‹ï¼Œæ‰€ä»¥è¢«ç§°ä¸ºtwo-stageæ–¹æ³•ã€‚<br />
â€ƒâ€ƒJoseph Redmonæå‡ºçš„YOLOv1æ¨¡å‹åŸºäºGoogLeNetè¿›è¡Œæ”¹å–„ï¼Œå¼€åˆ›æ€§çš„å°†å€™é€‰æ¡†å’Œå„ä¸ªç±»çš„è¯†åˆ«ç»“æœåˆåœ¨ä¸€èµ·è¾“å‡ºï¼Œå¹¶é’ˆå¯¹losså‡½æ•°è¿›è¡Œäº†é‡æ–°è®¾è®¡ã€‚è¿™ç§å°†two-stageæ–¹æ³•ä¸­çš„ä¸¤æ­¥åˆä¸ºä¸€æ­¥çš„æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºone-stageæ–¹æ³•ã€‚è¿™ç§å¼€åˆ›æ€§çš„è®¾è®¡ä½¿å¾—YOLOv1åœ¨GPUä¸Šæ£€æµ‹PASCAL VOCçš„é€Ÿåº¦è¾¾åˆ°45 FPSï¼ŒåŠ é€Ÿç‰ˆæœ¬YOLOè¿˜å¯ä»¥è¾¾åˆ°150 FPSï¼Œå¹¶ä¸”mAPè¾¾åˆ°63.4ã€‚ç›¸è¾ƒäºFaster R-CNNï¼Œè™½ç„¶mAPå˜å°äº†ï¼Œä½†æ˜¯æ¨¡å‹çš„fpså¾—äº†æå¤§çš„æå‡ï¼Œå¯ä»¥è¿ç”¨äºå®æ—¶ç³»ç»Ÿ<sup><sup class="footnote-ref"><a href="#fn4" id="fnref4:1">[4:1]</a></sup></sup>ã€‚<br />
â€ƒâ€ƒä¸ºäº†æå‡æ¨¡å‹çš„ç²¾ç¡®åº¦ï¼ŒYOLOv2åœ¨æ‰€æœ‰å·ç§¯å±‚ä¸­ä½¿ç”¨äº†Batch Normalizationï¼ˆBNï¼‰å±‚ï¼Œå‡å°‘äº†è®­ç»ƒæ—¶æ¨¡å‹å¯¹åˆå§‹åŒ–æƒé‡çš„æ•æ„Ÿç¨‹åº¦ï¼Œé¿å…æ¨¡å‹è¿‡æ‹Ÿåˆã€‚ä¸ºäº†å‡å°‘ç½‘ç»œå¯¹ä¸åŒåˆ†è¾¨ç‡è¾“å…¥çš„æ•æ„Ÿç¨‹åº¦ï¼ŒYOLOv2å¯¹ç½‘ç»œè¿›è¡Œäº†å¤šä¸ªåˆ†è¾¨ç‡å°ºåº¦çš„è®­ç»ƒã€‚å—åˆ°äº†Faster R-CNNçš„å¯å‘ï¼ŒYOLOv2ä½¿ç”¨é¢„åˆ¶çš„Anchor Boxå»é¢„æµ‹Bounding Boxå¹¶å»æ‰äº†å…¨è¿æ¥å±‚ï¼ŒåŠ å¿«äº†è®¡ç®—ï¼Œé¢„åˆ¶çš„Anchor Boxé€šè¿‡å¯¹æ•°æ®é›†ä¸­çš„ç‰©ä½“æ¡†ä½¿ç”¨K-meanèšç±»ç®—æ³•è·å¾—ã€‚ä¸ºäº†æé«˜å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœï¼Œä½œè€…æå‡ºäº†passthroughå±‚ï¼Œè·å–æ›´ç»†çš„ç‰¹å¾<sup><sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup></sup>ã€‚<br />
â€ƒâ€ƒYOLOv1å’ŒYOLOv2å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœä¸€ç›´ä¸å¥½ï¼Œä¸ºäº†æå‡YOLOç½‘ç»œå¯¹å°ç›®æ ‡çš„æ£€æµ‹æ€§èƒ½ï¼ŒYOLOv3å€Ÿé‰´ç‰¹å¾é‡‘å­—å¡”<sup><sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup></sup>ï¼Œä¸€å…±æœ‰ä¸‰ä¸ªå°ºå¯¸çš„ç‰¹å¾å›¾ç”¨äºæ£€æµ‹ç›®æ ‡ï¼Œå°å°ºå¯¸çš„ç‰¹å¾å›¾æ£€æµ‹å¤§ç‰©ä½“ï¼Œå¤§å°ºå¯¸çš„ç‰¹å¾å›¾æ£€æµ‹å°ç‰©ä½“ã€‚ä¸ºäº†æå‡ç½‘ç»œæ€§èƒ½ï¼Œå‚è€ƒäº†ResNetç»“æ„,å¼•å…¥äº†æ®‹å·®å—<sup><sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup></sup>ã€‚<br />
â€ƒâ€ƒYOLOv4ä½¿ç”¨äº†è¿‘å¹´æ¥æ·±åº¦å­¦ä¹ æ–¹é¢çš„è®¸å¤šæŠ€å·§ï¼ŒåŒ…å«äº†mishæ¿€æ´»å‡½æ•°ã€CIoU losså‡½æ•°ã€mosaicæ•°æ®å¢å¼ºç­‰ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›æŠ€å·§ï¼ŒYOLOv4åœ¨COCOæ•°æ®é›†ä¸Šçš„mAPè¾¾åˆ°äº†65.7%,è€Œé€Ÿåº¦è¾¾åˆ°äº†62 FPS<sup><sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup></sup>ã€‚</p>
<h1 id="ç ”ç©¶è®¾è®¡çš„åŸºæœ¬å†…å®¹-ç›®æ ‡-æ‹Ÿé‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆåŠæªæ–½"><a class="markdownIt-Anchor" href="#ç ”ç©¶è®¾è®¡çš„åŸºæœ¬å†…å®¹-ç›®æ ‡-æ‹Ÿé‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆåŠæªæ–½"></a> ç ”ç©¶ï¼ˆè®¾è®¡ï¼‰çš„åŸºæœ¬å†…å®¹ã€ç›®æ ‡ã€æ‹Ÿé‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆåŠæªæ–½</h1>
<h2 id="ç ”ç©¶çš„åŸºæœ¬å†…å®¹"><a class="markdownIt-Anchor" href="#ç ”ç©¶çš„åŸºæœ¬å†…å®¹"></a> ç ”ç©¶çš„åŸºæœ¬å†…å®¹</h2>
<p>ï¼ˆ1ï¼‰æ·±å…¥äº†è§£å­¦ä¹ æ·±åº¦å­¦ä¹ çš„ç†è®ºåŸºç¡€çŸ¥è¯†<br />
ï¼ˆ2ï¼‰å­¦ä¹ YOLOç½‘ç»œçš„è¯„ä»·æŒ‡æ ‡å’Œç½‘ç»œä¸­çš„backboneã€neckã€headã€bounding boxã€anchorã€mosaicæ•°æ®å¢å¼ºã€losså‡½æ•°è®¾è®¡ç­‰æŠ€æœ¯æ–¹é¢çš„ç»†èŠ‚<br />
ï¼ˆ3ï¼‰é’ˆå¯¹ç°æœ‰æ•°æ®é›†çš„æ£€æµ‹ç»“æœå¯¹YOLOç½‘ç»œè¿›è¡Œè°ƒæ•´ä¼˜åŒ–ï¼Œç›®å‰åœ¨è¿™æ–¹é¢å·²ç»æœ‰ç ”ç©¶å‚è€ƒ<sup><sup class="footnote-ref"><a href="#fn11" id="fnref11">[11]</a></sup></sup><sup><sup class="footnote-ref"><a href="#fn12" id="fnref12">[12]</a></sup></sup><sup><sup class="footnote-ref"><a href="#fn13" id="fnref13">[13]</a></sup></sup><sup><sup class="footnote-ref"><a href="#fn14" id="fnref14">[14]</a></sup></sup>ã€‚</p>
<h2 id="ç ”ç©¶ç›®æ ‡"><a class="markdownIt-Anchor" href="#ç ”ç©¶ç›®æ ‡"></a> ç ”ç©¶ç›®æ ‡</h2>
<p>ï¼ˆ1ï¼‰æ”¶é›†è½¦è¾†å’Œè¡Œäººç›¸å…³æ•°æ®é›†<br />
ï¼ˆ2ï¼‰å¤ç°YOLOç½‘ç»œ<br />
ï¼ˆ3ï¼‰æ ¹æ®ç°æœ‰æ•°æ®é›†çš„ç‰¹ç‚¹ï¼Œä½¿ç”¨K-meansèšç±»æ–¹æ³•è·å¾—åˆé€‚çš„anchorä»¥æå‡ç½‘ç»œæ£€æµ‹æ€§èƒ½<br />
ï¼ˆ4ï¼‰æ­å»ºYOLOç½‘ç»œå¹¶è¿›è¡Œè®­ç»ƒï¼Œå®ç°å¯¹è¡Œäººå’Œè½¦è¾†çš„æ£€æµ‹</p>
<h2 id="æœ¬æ–‡æ‹Ÿé‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆåŠæªæ–½"><a class="markdownIt-Anchor" href="#æœ¬æ–‡æ‹Ÿé‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆåŠæªæ–½"></a> æœ¬æ–‡æ‹Ÿé‡‡ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆåŠæªæ–½</h2>
<p>ï¼ˆ1ï¼‰æ–‡çŒ®ç ”ç©¶æ³•<br />
åˆ©ç”¨å›¾ä¹¦é¦†ã€ç½‘ç»œç­‰é€”å¾„ï¼Œå¹¿æ³›æ”¶é›†ç›¸å…³çš„æ–‡çŒ®èµ„æ–™ï¼ŒåŠ ä»¥é˜…è¯»å’Œåˆ†æï¼Œä»¥äº†è§£ç›®æ ‡æ£€æµ‹çš„å‘å±•å†å²ï¼Œäº†è§£ç›®æ ‡æ£€æµ‹ç®—æ³•çš„å„ç±»æŠ€å·§çš„åŸç†ï¼Œä»¥ä¾¿æ·±åˆ»äº†è§£YOLOç½‘ç»œä½¿ç”¨å’Œæ”¹è¿›çš„æŠ€å·§ã€‚<br />
ï¼ˆ2ï¼‰æ•°æ®é›†æ”¶é›†<br />
å¯¹äºæ·±åº¦å­¦ä¹ æ¥è¯´ï¼Œæ•°æ®é›†ä¸­æ ·æœ¬çš„æ•°é‡å¯¹æ¨¡å‹çš„æ€§èƒ½æœ‰è¾ƒå¤§å½±å“ã€‚å› æ­¤æ•°æ®é›†çš„é€‰æ‹©å°±æ¯”è¾ƒé‡è¦ã€‚COCOæ•°æ®é›†æ˜¯å¾®è½¯å›¢é˜Ÿæ¨å‡ºçš„ä¸€ä¸ªæ•°æ®é›†ï¼Œç›¸è¾ƒäºä»¥å‰å¸¸ç”¨çš„PASCAL VOC,COCOçš„ç±»åˆ«ä»¥åŠæ¯å¼ å›¾çš„å®ä¾‹å’Œæ ‡ç­¾éƒ½è¦å¤š<sup><sup class="footnote-ref"><a href="#fn15" id="fnref15">[15]</a></sup></sup>ã€‚å› æ­¤ç°åœ¨è®¸å¤šç ”ç©¶ä½¿ç”¨COCOæ¥è®­ç»ƒæ¨¡å‹<sup><sup class="footnote-ref"><a href="#fn9" id="fnref9:1">[9:1]</a></sup></sup><sup><sup class="footnote-ref"><a href="#fn10" id="fnref10:1">[10:1]</a></sup></sup>ã€‚å› æ­¤æœ¬æ¬¡è®¾è®¡å°†ä»COCOæ•°æ®é›†ä¸­æå–è¡Œäººä»¥åŠå„ä¸ªè½¦è¾†çš„å›¾ç‰‡ã€æ ‡æ³¨ï¼ŒåŒæ—¶ä»å…¶ä»–æ•°æ®é›†å’Œç½‘ç»œå›¾ç‰‡æ ‡æ³¨ç­‰æ–¹å¼å¡«å……æ›´å¤šæ•°æ®ä½œä¸ºæœ¬æ¬¡è®¾è®¡çš„æ•°æ®é›†ã€‚<br />
ï¼ˆ3ï¼‰YOLOç½‘ç»œ<br />
YOLOæ˜¯ä¸€ä¸ªç›®æ ‡æ£€æµ‹ç®—æ³•ï¼ŒYOLOç½‘ç»œå°†ç›®æ ‡æ£€æµ‹é—®é¢˜è½¬æ¢ä¸ºå›å½’é—®é¢˜ï¼Œç›´æ¥åˆ©ç”¨å·ç§¯ç¥ç»ç½‘ç»œé¢„æµ‹ç›®æ ‡çš„Bounding Boxå’Œå„ä¸ªç±»åˆ«çš„ç½®ä¿¡æ¦‚ç‡ï¼Œä½¿å¾—ç®—æ³•çš„è®¡ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œä¸”YOLOç»“æ„ç®€å•ã€æ¨¡å‹å°å¯ä»¥éƒ¨ç½²åœ¨ä¸€äº›åµŒå…¥è®¾å¤‡ä¸Šé¢ã€‚æœ¬æ¬¡æ¯•ä¸šè®¾è®¡æ‹Ÿä½¿ç”¨æ”¶é›†åˆ°çš„è¡Œäººè½¦è¾†æ•°æ®å¯¹YOLOæ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œå¹¶æ ¹æ®æ£€æµ‹æ•ˆæœè°ƒæ•´ç½‘ç»œçš„è¶…å‚æ•°ä»¥åšåˆ°æ›´å¥½çš„æ£€æµ‹æ•ˆæœã€‚</p>
<h2 id="æŠ€æœ¯è·¯çº¿å›¾"><a class="markdownIt-Anchor" href="#æŠ€æœ¯è·¯çº¿å›¾"></a> æŠ€æœ¯è·¯çº¿å›¾</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/roadmap.png" alt="å›¾1 æŠ€æœ¯è·¯çº¿å›¾" /></p>
<h1 id="è¿›åº¦å®‰æ’"><a class="markdownIt-Anchor" href="#è¿›åº¦å®‰æ’"></a> è¿›åº¦å®‰æ’</h1>
<p>2021.3.1-2021.3.31 å­¦ä¹ æ·±åº¦å­¦ä¹ ç›¸å…³çŸ¥è¯†ï¼Œè®¾è®¡å¹¶å¼€å‘ç®—æ³•é›å½¢<br />
2021.4.1-2021.4.30 é’ˆå¯¹ç°æœ‰ç®—æ³•è¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä¸”å°è¯•å¯¹ç½‘ç»œå‚æ•°è¿›è¡Œä¿®æ”¹å’Œå¾®è°ƒ<br />
2021.5.1-2021.5.20 æ’°å†™å¹¶ä¿®æ”¹æ¯•ä¸šè®ºæ–‡<br />
2021.5.21-2021.5.31 å‡†å¤‡ç­”è¾©</p>
<h1 id="é˜…è¯»çš„å‚è€ƒæ–‡çŒ®ä¸å°‘äº15ç¯‡å…¶ä¸­è¿‘äº”å¹´å¤–æ–‡æ–‡çŒ®ä¸å°‘äº3ç¯‡"><a class="markdownIt-Anchor" href="#é˜…è¯»çš„å‚è€ƒæ–‡çŒ®ä¸å°‘äº15ç¯‡å…¶ä¸­è¿‘äº”å¹´å¤–æ–‡æ–‡çŒ®ä¸å°‘äº3ç¯‡"></a> é˜…è¯»çš„å‚è€ƒæ–‡çŒ®ä¸å°‘äº15ç¯‡ï¼ˆå…¶ä¸­è¿‘äº”å¹´å¤–æ–‡æ–‡çŒ®ä¸å°‘äº3ç¯‡ï¼‰</h1>
<hr class="footnotes-sep" />
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>Girshick R, Donahue J, Darrell T, et al. Rich feature hierarchies for accurate object detection and semantic segmentation[C] CVPR. 2014: 580-587. <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn2" class="footnote-item"><p>Girshick R. Fast r-cnn[C] IEEE international conference on computer vision. 2015: 1440-1448. <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn3" class="footnote-item"><p>Ren S , He K , Girshick R , et al. Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks[J]. IEEE Transactions on Pattern Analysis &amp; Machine Intelligence, 2017, 39(6):1137-1149. <a href="#fnref3" class="footnote-backref">â†©ï¸</a> <a href="#fnref3:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn4" class="footnote-item"><p>Redmon J , Divvala S , Girshick R , et al. You Only Look Once: Unified, Real-Time Object Detection[C]CVPR. IEEE, 2015:779-788. <a href="#fnref4" class="footnote-backref">â†©ï¸</a> <a href="#fnref4:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn5" class="footnote-item"><p>Liu W, Anguelov D, Erhan D, et al. Ssd: Single shot multibox detector[C] Springer, Cham, 2016: 21-37. <a href="#fnref5" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn6" class="footnote-item"><p>Wang C Y, Bochkovskiy A, Liao H Y M. Scaled-YOLOv4: Scaling Cross Stage Partial Network[J]. arXiv preprint arXiv:2011.08036, 2020. <a href="#fnref6" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn7" class="footnote-item"><p>Redmon J , Farhadi A . YOLO9000: Better, Faster, Stronger[J]. 2017:6517-6525. <a href="#fnref7" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn8" class="footnote-item"><p>Lin T Y , DollÃ¡r, Piotr, Girshick R , et al. Feature Pyramid Networks for Object Detection[C]CVPR.2017:2117-2125. <a href="#fnref8" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn9" class="footnote-item"><p>Redmon J , Farhadi A . YOLOv3: An Incremental Improvement[J]. arXiv preprint arXiv:1804.02767, 2018. <a href="#fnref9" class="footnote-backref">â†©ï¸</a> <a href="#fnref9:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn10" class="footnote-item"><p>Bochkovskiy A , Wang C Y , Liao H Y M . YOLOv4: Optimal Speed and Accuracy of Object Detection [J]. arXiv preprint arXiv:2004.10934, 2020. <a href="#fnref10" class="footnote-backref">â†©ï¸</a> <a href="#fnref10:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn11" class="footnote-item"><p>èƒ¡è‡£è¾°,é™ˆè´¤å¯Œ.åŸºäºYOLOæ”¹è¿›æ®‹å·®ç½‘ç»œç»“æ„çš„è½¦è¾†æ£€æµ‹æ–¹æ³•[J].ä¿¡æ¯æŠ€æœ¯ä¸ç½‘ç»œå®‰å…¨,2020,39(09):56-60. <a href="#fnref11" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn12" class="footnote-item"><p>é é»˜ç„¶,ç½—æµ·æ³¢,ç‹ä»²åš,ä½•æ·¼,å¸¸é“®,æƒ æ–Œ.æ”¹è¿›çš„YOLO V3ç®—æ³•åŠå…¶åœ¨å°ç›®æ ‡æ£€æµ‹ä¸­çš„åº”ç”¨[J].å…‰å­¦å­¦æŠ¥,2019,39(07):253-260. <a href="#fnref12" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn13" class="footnote-item"><p>ä»˜äº‘éœ.åŸºäºYOLOç®—æ³•çš„è¡Œäººæ£€æµ‹[J].ç§‘å­¦æŠ€æœ¯åˆ›æ–°,2020(29):110-111. <a href="#fnref13" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn14" class="footnote-item"><p>é¡¾æ­,å¾æ—­ä¸œ.æ”¹è¿›YOLOv3çš„è½¦è¾†å®æ—¶æ£€æµ‹ä¸ä¿¡æ¯è¯†åˆ«æŠ€æœ¯[J].è®¡ç®—æœºå·¥ç¨‹ä¸åº”ç”¨,2020,56(22):173-184. <a href="#fnref14" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn15" class="footnote-item"><p>Lin T Y , Maire M , Belongie S , et al. Microsoft COCO: Common Objects in Context[C] European Conference on Computer Vision. Springer International Publishing, 2014: 740-755. <a href="#fnref15" class="footnote-backref">â†©ï¸</a></p>
</li>
</ol>
</section>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆäº”ï¼‰YOLO9000ç¿»è¯‘</title>
    <url>/2021/06/28/YOLO9000-translate/</url>
    <content><![CDATA[<p>æ¸£ç¿»ï¼Œè½»å–·ã€‚ä¸‹æ¬¡å†ä¹Ÿä¸ç©wordè½¬markdownäº†ï¼Œéš¾å—</p>
<span id="more"></span>
<h1 id="æ‘˜è¦"><a class="markdownIt-Anchor" href="#æ‘˜è¦"></a> æ‘˜è¦</h1>
<p>è®©æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹YOLO9000ï¼ŒYOLO9000æ˜¯ä¸€ä¸ªæœ€å…ˆè¿›çš„ï¼Œèƒ½å¤Ÿæ£€æµ‹è¶…è¿‡9000ä¸ªç‰©ä½“ç±»åˆ«çš„å®æ—¶ç‰©ä½“æ£€æµ‹ç³»ç»Ÿã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æå‡ºè®¸å¤šæ–°é¢–ä¸”å–æè‡ªå…ˆå‰å·¥ä½œçš„æ–¹æ³•å»æå‡YOLOçš„æ£€æµ‹æ•ˆæœã€‚æå‡åçš„æ¨¡å‹å°±æ˜¯YOLOv2ï¼Œåœ¨æ ‡å‡†çš„æ£€æµ‹ä»»åŠ¡å¦‚PASCAL VOCå’ŒCOCOä¸­æ•ˆæœæ˜¯æœ€å¥½çš„ã€‚é€šè¿‡ä½¿ç”¨æ–°é¢–çš„å¤šå°ºåº¦è®­ç»ƒæ–¹æ³•ï¼ŒYOLOv2æ¨¡å‹å¯ä»¥åœ¨å¤šç§è¾“å…¥å°ºå¯¸ä¸Šè¿è¡Œï¼Œå¹¶ä¸”åœ¨é€Ÿåº¦å’Œå‡†ç¡®ç‡ä¸Šåšåˆ°ç®€å•çš„æŠ˜ä¸­ã€‚åœ¨é€Ÿåº¦67 FPSçš„æ—¶å€™ï¼ŒYOLOv2åœ¨VOC 2007æ•°æ®é›†ä¸Šè·å¾—äº†76.8 mAPçš„æ•ˆæœã€‚åœ¨40 FPSçš„æ—¶å€™ï¼ŒYOLOv2è·å¾—äº†78.6 mAPï¼Œæ€§èƒ½ä¼˜äºæœ€å…ˆè¿›çš„æ–¹æ³•ï¼Œå¦‚Faster R-CNNã€ResNetå’ŒSSDï¼ŒåŒæ—¶è¿è¡Œé€Ÿåº¦è¿˜å¿«çš„æ˜æ˜¾ã€‚æœ€åï¼Œæˆ‘ä»¬æå‡ºä¸€ç§æ–¹æ³•å¯ä»¥è”åˆè®­ç»ƒç‰©ä½“æ£€æµ‹å’Œåˆ†ç±»ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨COCOæ£€æµ‹æ•°æ®é›†å’ŒImageNetåˆ†ç±»æ•°æ®é›†ä¸ŠåŒæ—¶è®­ç»ƒYOLO9000ã€‚æˆ‘ä»¬çš„è”åˆè®­ç»ƒä½¿å¾—YOLO9000èƒ½å¤Ÿé¢„æµ‹æ²¡æœ‰æ ‡ç­¾æ•°æ®çš„ç›®æ ‡ç±»ã€‚æˆ‘ä»¬åœ¨ImageNetæ£€æµ‹ä»»åŠ¡ä¸ŠéªŒè¯äº†æˆ‘ä»¬çš„æ–¹æ³•ï¼ŒYOLO9000åœ¨COCOæ•°æ®é›†ä¸Šæœ‰çš„44ä¸ªç±»ä¸­ï¼Œè·å¾—äº†19.7 mAPçš„æˆç»©ã€‚è€Œåœ¨COCOè®­ç»ƒé›†æ²¡æœ‰çš„156ä¸ªç±»ä¸Šï¼ŒYOLO9000è·å¾—äº†16.0 mAPã€‚è€Œä¸”ï¼ŒYOLO9000å¯ä»¥åœ¨ä¿æŒå®æ—¶çš„æƒ…å†µä¸‹ï¼Œè¯†åˆ«è¶…è¿‡9000ä¸ªä¸åŒçš„ç±»ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-1.png" alt="å›¾ 1ï¼šYOLO9000ã€‚YOLO9000å¯ä»¥å®æ—¶æ£€æµ‹å¤§é‡çš„ç‰©ä½“ç±»" /></p>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>ç‰©ä½“æ£€æµ‹ç®—æ³•é€šå¸¸è¦æ±‚å¿«é€Ÿã€å‡†ç¡®å’Œæœ‰èƒ½åŠ›è¯†åˆ«å¤§é‡çš„ç‰©ä½“ã€‚è‡ªä»ç¥ç»ç½‘ç»œçš„å¼•å…¥ï¼Œæ£€æµ‹ç®—æ³•å˜å¾—è¶Šæ¥è¶Šå¿«é€Ÿã€å‡†ç¡®ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æ£€æµ‹æ–¹æ³•ä»ç„¶å—é™äºå°‘æ•°ç‰©ä½“ã€‚<br />
å½“å‰çš„ç‰©ä½“æ£€æµ‹æ•°æ®é›†ä¸å…¶ä»–åˆ†ç±»æ•°æ®é›†å’Œæ ‡æ³¨æ•°æ®é›†ï¼Œæ•°æ®é›†çš„é‡å¾ˆå°‘ã€‚æœ€å¸¸è§çš„æ£€æµ‹æ•°æ®é›†å«æœ‰æ•°åƒåˆ°æ•°åä¸‡å¼ å›¾ç‰‡ï¼ŒåŒ…å«å‡ ååˆ°æ•°ç™¾ä¸ªæ ‡ç­¾ã€‚åˆ†ç±»æ•°æ®é›†å«æœ‰ç™¾ä¸‡å¼ å›¾ç‰‡ï¼ŒåŒ…å«æ•°åæˆ–è€…æ•°ç™¾æˆ–è€…æ•°åƒä¸ªç±»åˆ«ã€‚<br />
æˆ‘ä»¬å¸Œæœ›æ£€æµ‹æ•°æ®é›†çš„è§„æ¨¡èƒ½è¾¾åˆ°åˆ†ç±»æ•°æ®é›†çš„è§„æ¨¡ã€‚ä½†æ˜¯ï¼Œä¸ºæ£€æµ‹æ•°æ®é›†æ‰“æ ‡ç­¾æ¯”åˆ†ç±»æˆ–è€…æ ‡æ³¨ï¼ˆæ ‡æ³¨é€šå¸¸æ˜¯ç”¨æˆ·å…è´¹æä¾›ï¼‰çš„æ•°æ®é›†è¦èŠ±è´¹æ›´å¤šã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸å¤ªå¯èƒ½åœ¨è¿‘æœªæ¥çœ‹åˆ°æ£€æµ‹æ•°æ®é›†å’Œåˆ†ç±»æ•°æ®é›†æœ‰ç›¸åŒçš„è§„æ¨¡ã€‚<br />
æˆ‘ä»¬æå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ³•åˆ©ç”¨å·²æœ‰çš„å¤§é‡åˆ†ç±»æ•°æ®é›†ï¼Œå¹¶ä½¿ç”¨å…¶å»æ‹“å±•å½“å‰æ£€æµ‹ç³»ç»Ÿçš„è§„æ¨¡ã€‚æˆ‘ä»¬çš„æ–¹æ³•ä½¿ç”¨äº†ä¸€ä¸ªå¯¹è±¡åˆ†ç±»çš„å±‚æ¬¡è§†å›¾ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿå°†ä¸åŒçš„æ•°æ®é›†åˆèµ·æ¥ã€‚<br />
æˆ‘ä»¬è¿˜æå‡ºäº†ä¸€ç§è”åˆè®­ç»ƒç®—æ³•ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ£€æµ‹æ•°æ®å’Œåˆ†ç±»æ•°æ®ä¸Šè®­ç»ƒæˆ‘ä»¬çš„ç‰©ä½“æ£€æµ‹å™¨ã€‚æˆ‘ä»¬çš„æ–¹æ³•åˆ©ç”¨å·²ç»æ‰“å¥½æ ‡ç­¾çš„æ£€æµ‹å›¾åƒå»å­¦ä¹ å®šä½ç‰©ä½“çš„å‡†ç¡®åº¦ï¼ŒåŒæ—¶åˆ©ç”¨åˆ†ç±»å›¾åƒå»æå‡å…¶è¯æ±‡é‡å’Œé²æ£’æ€§ã€‚<br />
é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è®­ç»ƒäº†ä¸€ä¸ªå®æ—¶çš„ç‰©ä½“æ£€æµ‹å™¨YOLO9000ï¼Œå®ƒå¯ä»¥æ£€æµ‹è¶…è¿‡9000ä¸ªç‰©ä½“ç±»åˆ«ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åŸºäºYOLOæ£€æµ‹ç³»ç»Ÿè¿›è¡Œæå‡å¹¶è·å¾—äº†ä¸€ä¸ªæœ€å…ˆè¿›çš„å®æ—¶æ£€æµ‹å™¨YOLOv2ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„æ•°æ®é›†ç»„åˆæ–¹æ³•å’Œè”åˆè®­ç»ƒç®—æ³•åœ¨è¶…è¿‡9000ä¸ªç±»çš„ImageNetå’ŒCOCOçš„ç‰©ä½“æ£€æµ‹é›†ä¸Šè®­ç»ƒä¸€ä¸ªæ¨¡å‹ã€‚<br />
æ‰€æœ‰çš„ä»£ç å’Œé¢„è®­ç»ƒæ¨¡å‹åœ¨<a href="http://pjreddie.com/yolo9000/">http://pjreddie.com/yolo9000/</a>ã€‚</p>
<h1 id="æ›´å¥½"><a class="markdownIt-Anchor" href="#æ›´å¥½"></a> æ›´å¥½</h1>
<p>YOLOä¸æœ€å…ˆè¿›çš„æ£€æµ‹ç³»ç»Ÿç›¸æ¯”ï¼Œæœ‰å¤§é‡çš„ç¼ºç‚¹ã€‚ä¸Fast R-CNNç›¸æ¯”ï¼ŒYOLOçš„è¯¯å·®åˆ†æè¡¨æ˜YOLOäº§ç”Ÿäº†å¤§é‡çš„å®šä½é”™è¯¯ã€‚æ­¤å¤–ï¼Œä¸åŸºäºåŒºåŸŸå»ºè®®æ–¹æ³•ç›¸æ¯”ï¼ŒYOLOçš„å¬å›ç‡ç›¸å¯¹è¾ƒä½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸»è¦æå‡å¬å›ç‡å’Œå®šä½å‡†ç¡®ç‡åŒæ—¶ä¿æŒåˆ†ç±»çš„å‡†ç¡®ç‡ã€‚<br />
è®¡ç®—æœºè§†è§‰é€šå¸¸å€¾å‘äºæ›´å¤§ï¼Œæ›´æ·±çš„ç½‘ç»œã€‚æ›´å¥½çš„è¡¨ç°é€šå¸¸å–å†³äºè®­ç»ƒæ›´å¤§çš„ç½‘ç»œæˆ–è€…å°†å¤šä¸ªæ¨¡å‹åˆåœ¨ä¸€èµ·ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›æ›´å‡†ç¡®çš„æ£€æµ‹å™¨åŒæ—¶æ£€æµ‹ä¾ç„¶é€Ÿåº¦å¾ˆå¿«ã€‚æˆ‘ä»¬ç®€åŒ–äº†ç½‘ç»œï¼Œä½¿å…¶æ›´å®¹æ˜“è®­ç»ƒï¼Œè€Œä¸æ˜¯æ‰©å¤§æˆ‘ä»¬çš„ç½‘ç»œã€‚æˆ‘ä»¬å°†è¿‡å»å·¥ä½œä¸­çš„å¤§é‡æƒ³æ³•å’Œæˆ‘ä»¬è‡ªå·±çš„æ–°é¢–çš„æ€æƒ³ç»“åˆèµ·æ¥å»æå‡YOLOçš„è¡¨ç°ã€‚ç»“æœçš„æ¦‚è¦åœ¨è¡¨2ä¸­ã€‚<br />
<strong>Batch Normalizationï¼ˆæ‰¹æ¬¡å½’ä¸€åŒ–ï¼‰.</strong><br />
æ‰¹æ¬¡å½’ä¸€åŒ–ä½¿å¾—æ¨¡å‹åœ¨æ”¶æ•›æ€§æ–¹é¢æœ‰æ˜¾è‘—çš„æå‡ï¼ŒåŒæ—¶æ¶ˆé™¤äº†å…¶ä»–å½¢å¼çš„æ­£åˆ™åŒ–ã€‚é€šè¿‡åœ¨YOLOçš„å…¨éƒ¨å·ç§¯å±‚ä¸­å¢åŠ æ‰¹æ¬¡å½’ä¸€åŒ–ï¼Œæˆ‘ä»¬è·å¾—äº†è¶…è¿‡2%<br />
mAPçš„æå‡ã€‚æ‰¹æ¬¡å½’ä¸€åŒ–è¿˜æœ‰åŠ©äºæ­£åˆ™åŒ–æ¨¡å‹ã€‚é€šè¿‡ä½¿ç”¨æ‰¹æ¬¡å½’ä¸€åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ¨¡å‹ä¸­å»é™¤dropoutå±‚ï¼ŒåŒæ—¶ä¸ä¼šè¿‡æ‹Ÿåˆã€‚<br />
<strong>High Resolution Classifierï¼ˆé«˜åˆ†è¾¨ç‡åˆ†ç±»å™¨ï¼‰.</strong><br />
æ‰€æœ‰æœ€å…ˆè¿›çš„æ£€æµ‹æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨åœ¨ImageNetä¸Šé¢„è®­ç»ƒå¥½çš„åˆ†ç±»å™¨ã€‚ä»AlexNetå¼€å§‹ï¼Œå¤§å¤šæ•°åˆ†ç±»å™¨å¯¹è¾“å…¥å¤§å°å°äº256Ã—256çš„å›¾åƒè¿›è¡Œæ“ä½œã€‚åŸå§‹YOLOåœ¨224Ã—224åˆ†è¾¨ç‡ä¸‹è®­ç»ƒåˆ†ç±»ç½‘ç»œï¼Œæå‡åˆ†è¾¨ç‡åˆ°448æ¥è®­ç»ƒæ£€æµ‹ç½‘ç»œã€‚è¿™æ„å‘³ç€ç½‘ç»œå¿…é¡»åŒæ—¶åˆ‡æ¢åˆ°å­¦ä¹ ç‰©ä½“æ£€æµ‹å¹¶è°ƒæ•´åˆ°æ–°çš„è¾“å…¥åˆ†è¾¨ç‡ã€‚<br />
å¯¹äºYOLOv2ï¼Œæˆ‘ä»¬é¦–å…ˆåœ¨ImageNetä¸Šä»¥448Ã—448åˆ†è¾¨ç‡è®­ç»ƒäº†10ä¸ªæ—¶æœŸè¿›è¡Œå¾®è°ƒï¼Œè¿™ç»™äº†ç½‘ç»œæ—¶é—´å»è°ƒæ•´å…¶å·ç§¯æ ¸ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨æ›´é«˜çš„åˆ†è¾¨ç‡ä¸Šè¡¨ç°çš„æ›´å¥½ã€‚ç„¶åæ ¹æ®æ£€æµ‹ç»“æœå¯¹ç½‘ç»œè¿›è¡Œå¾®è°ƒã€‚è¿™ä¸ªé«˜åˆ†è¾¨ç‡åˆ†ç±»ç½‘ç»œç»™äº†æˆ‘ä»¬å¤§æ¦‚4%<br />
mAPçš„æå‡ã€‚<br />
<strong>Convolutional With Anchor Boxesï¼ˆé”šæ¡†å·ç§¯ï¼‰.</strong><br />
YOLOç›´æ¥ä½¿ç”¨å…¨è¿æ¥å±‚åœ¨å·ç§¯ç‰¹å¾æå–å™¨çš„é¡¶ç«¯é¢„æµ‹è¾¹æ¡†çš„åæ ‡ã€‚Faster R-CNNæ²¡æœ‰ç›´æ¥é¢„æµ‹åæ ‡ï¼Œè€Œæ˜¯ä½¿ç”¨æ‰‹é€‰çš„å…ˆéªŒæ¡†æ¥é¢„æµ‹è¾¹æ¡†ã€‚Faster R-CNNä¸­çš„åŒºåŸŸå»ºè®®ç½‘ç»œï¼ˆRPNï¼‰åªä½¿ç”¨å·ç§¯å±‚æ¥é¢„æµ‹é”šæ¡†çš„åå·®å€¼å’Œç½®ä¿¡åº¦ã€‚å› ä¸ºé¢„æµ‹å±‚æ˜¯å·ç§¯çš„ï¼Œæ‰€ä»¥RPNåœ¨ç‰¹å¾å›¾çš„æ¯ä¸ªä½ç½®é¢„æµ‹è¿™äº›åå·®ã€‚é¢„æµ‹åå·®è€Œä¸æ˜¯é¢„æµ‹åæ ‡ç®€åŒ–äº†é—®é¢˜ï¼Œå¹¶ä½¿å¾—ç½‘ç»œæ›´å®¹æ˜“å­¦ä¹ ã€‚<br />
æˆ‘ä»¬ä½¿ç”¨é”šæ¡†å»é¢„æµ‹è¾¹æ¡†ï¼Œå¹¶å»é™¤äº†å…¨è¿æ¥å±‚ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å»é™¤äº†ä¸€ä¸ªæ± åŒ–å±‚ä½¿å¾—ç½‘ç»œè¾“å‡ºçš„å·ç§¯å±‚æœ‰äº†æ›´é«˜çš„åˆ†è¾¨ç‡ã€‚æˆ‘ä»¬è¿˜å°†ç½‘ç»œçš„è¾“å…¥ä»448Ã—448ç¼©å°åˆ°äº†416ã€‚æˆ‘ä»¬è¿™ä¹ˆåšæ˜¯å¸Œæœ›æˆ‘ä»¬çš„ç‰¹å¾å›¾æœ‰å¥‡æ•°ä¸ªä½ç½®ï¼Œè¿™æ ·å°±æœ‰å•ä¸ªä¸­å¿ƒæ ¼ã€‚ç‰©ä½“ï¼Œç‰¹åˆ«æ˜¯å¤§ç‰©ä½“ï¼Œå€¾å‘äºå æ®å›¾åƒçš„ä¸­å¿ƒï¼Œæ‰€ä»¥æœ€å¥½ç”¨ä¸­å¿ƒçš„å•ä¸ªæ ¼å­å»é¢„æµ‹è¿™äº›ç‰©ä½“è€Œä¸æ˜¯ä½¿ç”¨ç›¸é‚»çš„å››ä¸ªæ ¼å­ã€‚YOLOçš„å·ç§¯å±‚ä½¿ç”¨å› å­32å¯¹å›¾åƒè¿›è¡Œé™é‡‡æ ·ï¼Œæ‰€ä»¥é€šè¿‡è¾“å…¥åˆ†è¾¨ç‡ä¸º416çš„å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°13Ã—13å¤§å°çš„ç‰¹å¾å›¾ã€‚<br />
å½“æˆ‘ä»¬ç§»åŠ¨é”šæ¡†çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜å°†ç±»é¢„æµ‹æœºåˆ¶ä»ç©ºé—´ä½ç½®å’Œæ¯ä¸ªé”šæ¡†çš„é¢„æµ‹ç±»å’Œç‰©ä½“æ€§ä¸­è§£è€¦ã€‚ç»§ç»­YOLOï¼Œç‰©ä½“æ€§é¢„æµ‹ä¾ç„¶é¢„æµ‹æ­£ç¡®æ ‡ç­¾ä¸å»ºè®®æ¡†ä¹‹é—´çš„IOUï¼Œåˆ†ç±»é¢„æµ‹å™¨å»é¢„æµ‹æ¡†ä¸­ç‰©ä½“æ˜¯ä»€ä¹ˆç±»åˆ«çš„æ¡ä»¶æ¦‚ç‡ã€‚<br />
ä½¿ç”¨é”šæ¡†ä½¿æˆ‘ä»¬çš„å‡†ç¡®ç‡å¾—åˆ°äº†å°å°çš„ä¸‹é™ã€‚YOLOåªèƒ½ä¸ºæ¯ä¸ªå›¾åƒé¢„æµ‹98ä¸ªæ¡†ï¼Œä½†æ˜¯ä½¿ç”¨é”šæ¡†æˆ‘ä»¬çš„æ¨¡å‹å¯ä»¥é¢„æµ‹è¶…è¿‡1000ä¸ªã€‚ä¸ä½¿ç”¨é”šæ¡†ï¼Œæˆ‘ä»¬çš„ä¸­ç­‰æ¨¡å‹è·å¾—69.5 mAPå’Œ81%çš„å¬å›ç‡ã€‚ä½¿ç”¨é”šæ¡†ï¼Œæˆ‘ä»¬çš„æ¨¡å‹è·å¾—69.2 mAPå’Œ88%çš„å¬å›ç‡ã€‚è™½ç„¶mAPä¸‹é™äº†ï¼Œä½†å¬å›ç‡çš„ä¸Šå‡æ„å‘³ç€æˆ‘ä»¬çš„æ¨¡å‹æœ‰æ›´å¤šç©ºé—´å»æå‡ã€‚<br />
<strong>Dimension Clustersï¼ˆå°ºå¯¸èšç±»ï¼‰.</strong><br />
å½“æˆ‘ä»¬ä½¿ç”¨æœ‰é”šæ¡†çš„YOLOæ—¶ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸¤ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯æ¡†çš„å°ºå¯¸æ˜¯æ‰‹é€‰çš„ã€‚ç¥ç»ç½‘ç»œå¯ä»¥å­¦ä¹ é€‚å½“çš„è°ƒæ•´æ¡†ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨å¼€å§‹çš„æ—¶å€™æŒ‘é€‰æ›´å¥½çš„å…ˆéªŒæ¡†ï¼Œå°±å¯ä»¥ä½¿ç½‘ç»œæ›´å®¹æ˜“å­¦ä¹ å»é¢„æµ‹å¥½çš„æ£€æµ‹ã€‚<br />
æˆ‘ä»¬åœ¨è®­ç»ƒé›†çš„è¾¹æ¡†ä¸Šä½¿ç”¨k-meansèšç±»ç®—æ³•å»è‡ªåŠ¨å¯»æ‰¾æœ€ä½³å…ˆéªŒè€Œä¸æ˜¯æ‰‹åŠ¨æŒ‘é€‰ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„ä½¿ç”¨æ¬§å‡ é‡Œå¾·è·ç¦»çš„k-meansç®—æ³•ï¼Œæ›´å¤§çš„æ¡†ä¼šæ¯”å°çš„æ¡†äº§ç”Ÿæ›´å¤šçš„é”™è¯¯ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„åŸºäºIOUåˆ†æ•°çš„å…ˆéªŒï¼Œè€ŒIOUåˆ†æ•°ç‹¬ç«‹äºæ¡†çš„å¤§å°ã€‚å› æ­¤ï¼Œå¯¹äºæˆ‘ä»¬çš„è·ç¦»åº¦é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨ï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mrow><mo fence="true">(</mo><mi>b</mi><mi>o</mi><mi>x</mi><mo separator="true">,</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo fence="true">)</mo></mrow><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mi>I</mi><mi>O</mi><mi>U</mi><mrow><mo fence="true">(</mo><mi>b</mi><mi>o</mi><mi>x</mi><mo separator="true">,</mo><mtext>Â </mtext><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>i</mi><mi>d</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">d\left( box,centroid \right) = 1 - IOU\left( box,\ centroid \right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">b</span><span class="mord mathdefault">o</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">b</span><span class="mord mathdefault">o</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace">Â </span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p>æˆ‘ä»¬ä½¿ç”¨äº†ä¸åŒçš„kå€¼æ¥è·‘k-meansç®—æ³•ï¼Œå¹¶ç»˜åˆ¶æœ€è¿‘è´¨å¿ƒçš„å¹³å‡IOUï¼Œè§å›¾2ã€‚æƒè¡¡æ¨¡å‹å¤æ‚åº¦å’Œé«˜å¬å›ç‡ä¹‹é—´ï¼Œæˆ‘ä»¬é€‰æ‹©äº†k=5ã€‚èšç±»çš„è´¨å¿ƒä¸æ‰‹å·¥é€‰å–çš„é”šæ¡†æœ‰æ˜¾è‘—å·®å¼‚ã€‚çŸ­è€Œå®½çš„æ¡†å¾ˆå°‘ï¼Œè€Œé«˜ç˜¦çš„æ¡†å¾ˆå¤šã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-2.png" alt="å›¾ 2ï¼šVOCå’ŒCOCOæ•°æ®ä¸Šçš„èšç±»æ¡†å°ºå¯¸ã€‚æˆ‘ä»¬åœ¨è¾¹æ¡†ä¸Šè¿è¡Œk-meansç®—æ³•å»è·å¾—æˆ‘ä»¬æ¨¡å‹çš„ä¸€ä¸ªè¾ƒå¥½çš„å…ˆéªŒã€‚å·¦è¾¹çš„å›¾åƒå±•ç¤ºäº†ä¸åŒçš„kå€¼æƒ…å†µä¸‹çš„å¹³å‡IOUã€‚æˆ‘ä»¬å‘ç°å½“k=5æ—¶ï¼Œåœ¨å¬å›ç‡å’Œæ¨¡å‹å¤æ‚åº¦ä¹‹é—´æœ‰ä¸€ä¸ªè¾ƒå¥½çš„å¹³è¡¡ã€‚å³è¾¹çš„å›¾åƒå±•ç¤ºäº†VOCå’ŒCOCOæ•°æ®é›†ä¸Šçš„ç›¸å…³è´¨å¿ƒã€‚ä¸¤ä¸ªæ•°æ®é›†çš„å…ˆéªŒéƒ½åå‘äºç˜¦é«˜æ¡†ã€‚è€ŒCOCOçš„æ¡†æ¯”VOCçš„æ¡†å¤§ä¸€äº›ã€‚" /><br />
åœ¨è¡¨1ä¸­æˆ‘ä»¬å¯¹æ¯”äº†æˆ‘ä»¬èšç±»æ”¿ç­–é€‰æ‹©çš„æœ€è¿‘è´¨å¿ƒå’Œæ‰‹é€‰çš„é”šæ¡†çš„å¹³å‡IOUã€‚åœ¨åªæœ‰5ä¸ªå…ˆéªŒè´¨å¿ƒçš„è¡¨ç°ä¸ºå¹³å‡IOU 61.0ä¸9ä¸ªé”šæ¡†çš„è¡¨ç°å¹³å‡IOU 60.9ç›¸ä¼¼ã€‚è¿™è¡¨æ˜ä½¿ç”¨k-meansæ¥ç”Ÿæˆè¾¹æ¡†å¼€å§‹ä½¿å¾—æ¨¡å‹æœ‰æ›´å¥½çš„è¡¨ç°ï¼Œå¹¶ä½¿ä»»åŠ¡æ›´æ˜“äºå­¦ä¹ ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-3.png" alt="è¡¨ 1:VOC 2007ä¸Šæœ€è¿‘å…ˆéªŒçš„å¹³å‡IOUã€‚VOC2007ä¸Šå¯¹è±¡çš„å¹³å‡IOUä¸ä½¿ç”¨ä¸åŒç”Ÿæˆæ–¹æ³•ä¹‹å‰æœ€æ¥è¿‘ã€æœªä¿®æ”¹çš„IOUã€‚èšç±»æ¯”ä½¿ç”¨æ‰‹å·¥æŒ‘é€‰çš„å…ˆéªŒæœ‰æ›´å¥½çš„ç»“æœã€‚" /><br />
<strong>Direct location predictionï¼ˆç›´æ¥ä½ç½®é¢„æµ‹ï¼‰.</strong><br />
YOLOä½¿ç”¨é”šæ¡†åï¼Œæˆ‘ä»¬é‡åˆ°çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼šæ¨¡å‹ä¸ç¨³å®šï¼Œç‰¹åˆ«æ˜¯åœ¨æ—©æœŸè¿­ä»£çš„æ—¶å€™ã€‚å¤§å¤šæ•°ä¸ç¨³å®šçš„åŸå› æ¥è‡ªé¢„æµ‹æ¡†çš„ï¼ˆxï¼Œyï¼‰ä½ç½®ã€‚åœ¨åŒºåŸŸå»ºè®®ç½‘ç»œä¸­ï¼Œç½‘ç»œé¢„æµ‹<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">t_{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">t_{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œä¸­å¿ƒåæ ‡ï¼ˆxï¼Œyï¼‰çš„è®¡ç®—å¦‚ä¸‹ï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>=</mo><mrow><mo fence="true">(</mo><msub><mi>t</mi><mi>x</mi></msub><mo>Ã—</mo><msub><mi>Ï‰</mi><mi>a</mi></msub><mo fence="true">)</mo></mrow><mo>âˆ’</mo><msub><mi>x</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">x = \left( t_{x} \times \omega_{a} \right) - x_{a}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï‰</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mrow><mo fence="true">(</mo><msub><mi>t</mi><mi>y</mi></msub><mo>Ã—</mo><msub><mi>h</mi><mi>a</mi></msub><mo fence="true">)</mo></mrow><mo>âˆ’</mo><msub><mi>y</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">y = \left( t_{y} \times h_{a} \right) - y_{a}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>æ¯”å¦‚ï¼Œé¢„æµ‹<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>x</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_{x} = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>æ—¶ä¼šå‘å³ç§»åŠ¨ä¸€ä¸ªé”šæ¡†çš„å®½åº¦ï¼Œé¢„æµ‹<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>x</mi></msub><mo>=</mo><mtext>Â </mtext><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">t_{x} = \  - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace">Â </span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span></span></span></span>æ—¶ä¼šå‘å·¦ç§»åŠ¨åŒæ ·çš„ä¸€ä¸ªé”šæ¡†å®½åº¦ã€‚<br />
è¿™ä¸ªå…¬å¼å¹¶æ²¡æœ‰ä»»ä½•çº¦æŸï¼Œæ‰€ä»¥ä»»ä½•ä¸€ä¸ªé”šæ¡†å¯ä»¥å‡ºç°åœ¨å›¾åƒçš„ä»»ä½•ä¸€ä¸ªç‚¹ï¼Œè€Œä¸ç”¨ç®¡ä½ç½®é¢„æµ‹æ¡†ã€‚åœ¨éšæœºåˆå§‹åŒ–æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œæ¨¡å‹è¦èŠ±å¾ˆé•¿æ—¶é—´æ‰èƒ½ç¨³å®šçš„å»é¢„æµ‹æ•æ„Ÿåå·®ã€‚<br />
æˆ‘ä»¬æ²¡æœ‰é¢„æµ‹åç§»é‡ï¼Œè€Œæ˜¯é‡‡ç”¨YOLOçš„æ–¹æ³•ï¼Œé¢„æµ‹ç›¸å¯¹äºç½‘æ ¼å•å…ƒä½ç½®çš„ä½ç½®åæ ‡ã€‚è¿™å°†æ­£ç¡®æ ‡ç­¾çš„å€¼é™åˆ¶åœ¨0å’Œ1ä¹‹é—´ã€‚æˆ‘ä»¬ä½¿ç”¨é€»è¾‘æ¿€æ´»å‡½æ•°æ¥é™åˆ¶ç½‘ç»œçš„é¢„æµ‹åœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚<br />
ç½‘ç»œåœ¨è¾“å‡ºç‰¹å¾å›¾çš„æ¯ä¸ªå•å…ƒæ ¼é¢„æµ‹5ä¸ªè¾¹æ¡†ã€‚ç½‘ç»œä¸ºæ¯ä¸ªè¾¹æ¡†é¢„æµ‹5ä¸ªåæ ‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">t_{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">t_{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">t_{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">t_{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>o</mi></msub></mrow><annotation encoding="application/x-tex">t_{o}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚å¦‚æœå•å…ƒæ ¼ä¸å›¾åƒå·¦ä¸Šè§’çš„åç§»é‡ä¸ºï¼ˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">c_{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">c_{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ï¼‰ï¼Œä¸”è¾¹æ¡†å…·æœ‰å®½åº¦å’Œé«˜åº¦<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">p_{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">p_{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œåˆ™é¢„æµ‹å€¼å…¬å¼ä¸ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>x</mi></msub><mo>=</mo><mi>Ïƒ</mi><mrow><mo fence="true">(</mo><msub><mi>t</mi><mi>x</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><msub><mi>c</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">b_{x} = \sigma\left( t_{x} \right) + c_{x}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>y</mi></msub><mo>=</mo><mi>Ïƒ</mi><mrow><mo fence="true">(</mo><msub><mi>t</mi><mi>y</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><msub><mi>c</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">b_{y} = \sigma\left( t_{y} \right) + c_{y}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>w</mi></msub><mo>=</mo><msub><mi>p</mi><mi>w</mi></msub><msup><mi>e</mi><msub><mi>t</mi><mi>w</mi></msub></msup></mrow><annotation encoding="application/x-tex">b_{w} = p_{w}e^{t_{w}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.037996em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.16454285714285719em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>h</mi></msub><mo>=</mo><msub><mi>p</mi><mi>h</mi></msub><msup><mi>e</mi><msub><mi>t</mi><mi>h</mi></msub></msup></mrow><annotation encoding="application/x-tex">b_{h} = p_{h}e^{t_{h}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.037996em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.843556em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mtext>Object</mtext><mo fence="true">)</mo></mrow><mo>âˆ—</mo><mi>I</mi><mi>O</mi><mi>U</mi><mrow><mo fence="true">(</mo><mi>b</mi><mo separator="true">,</mo><mi>o</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo fence="true">)</mo></mrow><mo>=</mo><mi>Ïƒ</mi><mrow><mo fence="true">(</mo><msub><mi>t</mi><mi>o</mi></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_{r}\left( \text{Object} \right)*IOU\left( b,object \right) = \sigma\left( t_{o} \right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord text"><span class="mord">Object</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p>å› ä¸ºæˆ‘ä»¬çº¦æŸäº†ä½ç½®é¢„æµ‹ï¼Œæ‰€ä»¥å‚æ•°æ›´å®¹æ˜“å­¦ä¹ ï¼Œä½¿å¾—æ¨¡å‹æ›´ç¨³å®šã€‚ä½¿ç”¨å°ºå¯¸èšç±»å’Œç›´æ¥é¢„æµ‹è¾¹æ¡†çš„ä¸­å¿ƒä½ç½®æ¯”ä½¿ç”¨é”šæ¡†çš„ç‰ˆæœ¬æå‡äº†YOLOå¤§æ¦‚5%çš„ç²¾ç¡®åº¦ã€‚<br />
<strong>Fine-Grained Featuresï¼ˆç»†ç²’åº¦ç‰¹å¾ï¼‰.</strong><br />
è¿™ä¸ªæ”¹è¿›çš„YOLOåœ¨13Ã—13çš„ç‰¹å¾å›¾ä¸Šè¿›è¡Œæ£€æµ‹ã€‚è™½ç„¶è¿™å¯¹å¤§å‹ç‰©ä½“å……è¶³ï¼Œä½†æ›´ç»†çš„ç‰¹å¾å¯¹å°ç‰©ä½“æœ‰å¥½æ•ˆæœã€‚Faster R-CNNå’ŒSSDéƒ½åœ¨ç½‘ç»œä¸­çš„ç‰¹å¾å›¾ä¸Šè¿è¡Œä»–ä»¬çš„åŒºåŸŸå»ºè®®ç½‘ç»œä»¥è·å¾—ä¸€ç³»åˆ—åˆ†è¾¨ç‡ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ç§ä¸åŒçš„æ–¹æ³•ï¼Œç®€å•æ·»åŠ ä¸€ä¸ªpassthroughå±‚ä»ä¹‹å‰å‡ å±‚è·å¾—26Ã—26åˆ†è¾¨ç‡çš„ç‰¹å¾ã€‚<br />
åƒResNetçš„æ’ç­‰æ˜ å°„ä¸€æ ·ï¼Œpassthroughå±‚é€šè¿‡ç›¸é‚»çš„ç‰¹å¾å åŠ åˆ°ä¸åŒçš„é€šé“è€Œä¸æ˜¯ç©ºé—´ä½ç½®æ¥è¿æ¥æ›´é«˜åˆ†è¾¨ç‡çš„ç‰¹å¾å’Œä½åˆ†è¾¨ç‡çš„ç‰¹å¾ã€‚è¿™å°†26Ã—26Ã—512çš„ç‰¹å¾å›¾è½¬æ¢å±‚13Ã—13Ã—2048çš„ç‰¹å¾å›¾ï¼Œè¿™ä½¿å¾—å…¶å¯ä»¥è¢«åŸå…ˆçš„ç‰¹å¾å›¾è¿æ¥ã€‚æˆ‘ä»¬çš„æ£€æµ‹å™¨åœ¨è¿™ä¸ªæ‹“å±•åçš„ç‰¹å¾å›¾ä¸Šè¿è¡Œï¼Œè¿™æ ·èƒ½è·å¾—æ›´ç»†çš„ç‰¹å¾ã€‚è¿™ä½¿å¾—æ€§èƒ½æœ‰1%çš„æå‡ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-4.png" alt="å›¾ 3ï¼šæœ‰å°ºå¯¸å…ˆéªŒä¸ä½ç½®é¢„æµ‹çš„è¾¹æ¡†ã€‚æˆ‘ä»¬ä»èšç±»è´¨å¿ƒçš„åç§»é‡é¢„æµ‹æ¡†çš„å®½é«˜ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªsigmoidå‡½æ•°æ¥é¢„æµ‹æ¡†ç›¸å¯¹äºæ»¤æ³¢å™¨åº”ç”¨ä½ç½®çš„ä¸­å¿ƒåæ ‡ã€‚" /><br />
<strong>Multi-Scale Trainingï¼ˆå¤šå°ºåº¦è®­ç»ƒï¼‰.</strong><br />
æœ€åˆçš„YOLOä½¿ç”¨448Ã—448åˆ†è¾¨ç‡çš„è¾“å…¥ã€‚éšç€é”šæ¡†åŠ å…¥ç½‘ç»œï¼Œæˆ‘ä»¬å°†åˆ†è¾¨ç‡æ”¹åˆ°416Ã—416ã€‚ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„æ¨¡å‹åªä½¿ç”¨å·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œæ‰€ä»¥å®ƒå¯ä»¥è¢«åŠ¨æ€çš„è°ƒæ•´ã€‚æˆ‘ä»¬YOLOv2èƒ½å¤Ÿåœ¨ä¸åŒå¤§å°çš„å›¾åƒä¸Šè¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ ·è®­ç»ƒæ¨¡å‹ã€‚<br />
æˆ‘ä»¬æ¯éš”å‡ æ¬¡å°è¿­ä»£å°±æ”¹å˜ç½‘ç»œè€Œä¸æ˜¯å›ºå®šç½‘ç»œçš„è¾“å…¥å›¾åƒå¤§å°ã€‚æˆ‘ä»¬çš„ç½‘ç»œæ¯10ä¸ªæ‰¹æ¬¡å°±éšæœºé€‰æ‹©ä¸€ä¸ªæ–°çš„å›¾åƒå°ºå¯¸ã€‚å› ä¸ºæˆ‘ä»¬çš„æ¨¡å‹ä»¥32çš„å€ç‡è¿›è¡Œé™é‡‡æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥32çš„å€æ•°å˜åŒ–ï¼š{320ï¼Œ352ï¼Œâ€¦ï¼Œ608}ã€‚å› æ­¤ï¼Œæœ€å°çš„å¯é€‰è¾“å…¥æ—¶320Ã—320ï¼Œæœ€å¤§çš„æ˜¯608Ã—608ã€‚æˆ‘ä»¬é‡è®¾ç½‘ç»œåˆ°é‚£ä¸ªå°ºå¯¸å¹¶ç»§ç»­è®­ç»ƒã€‚<br />
è¿™ç§æœºåˆ¶è¿«ä½¿ç½‘ç»œå­¦ä¼šåœ¨ä¸åŒçš„è¾“å…¥å°ºå¯¸ä¸Šè¿›è¡Œé¢„æµ‹ã€‚è¿™æ„å‘³ç€åŒä¸€ä¸ªç½‘ç»œå¯ä»¥åœ¨ä¸åŒçš„åˆ†è¾¨ç‡ä¸‹é¢„æµ‹æ£€æµ‹ã€‚ç½‘ç»œåœ¨æ›´å°çš„å°ºå¯¸ä¸‹è¿è¡Œå¾—æ›´å¿«ï¼Œæ‰€ä»¥YOLOv2åœ¨é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´æä¾›äº†ä¸€ä¸ªç®€å•çš„æŠ˜è¡·ã€‚<br />
åœ¨ä½åˆ†è¾¨ç‡ä¸‹ï¼ŒYOLOv2æ˜¯ä¸€ç§å»‰ä»·ã€ç›¸å½“ç²¾ç¡®çš„æ¢æµ‹å™¨ã€‚åœ¨288Ã—288çš„åˆ†è¾¨ç‡ä¸‹ï¼Œå…¶è¿è¡Œé€Ÿåº¦è¶…è¿‡90 FPSè€ŒmAPå’ŒFast R-CNNä¸€æ ·å¥½ã€‚è¿™ä½¿å¾—å…¶éå¸¸é€‚åˆè¾ƒå°çš„GPUã€é«˜åˆ†è¾¨ç‡è§†é¢‘æˆ–è€…å¤šä¸ªè§†é¢‘æµã€‚<br />
åœ¨é«˜åˆ†è¾¨ç‡ä¸‹YOLOv2æ˜¯æœ€å…ˆè¿›çš„æ£€æµ‹å™¨ï¼Œåœ¨VOC2007æ•°æ®é›†ä¸Šæœ‰78.6çš„mAPåŒæ—¶è¿˜ä¿æŒç€å®æ—¶çš„é€Ÿåº¦ã€‚YOLOv2ä¸å…¶ä»–æ¡†æ¶åœ¨VOC2007çš„æ¯”è¾ƒè§è¡¨3å’Œå›¾4ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-5.png" alt="å›¾ 4 VOC 2007ä¸Šçš„å‡†ç¡®ç‡å’Œé€Ÿåº¦" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-6.png" alt="è¡¨ 3 åœ¨PASCAL VOC2007ä¸Šçš„æ£€æµ‹æ¡†æ¶ã€‚YOLOv2æ¯”ä»¥å‰çš„æ£€æµ‹æ–¹æ³•æ›´å¿«æ›´å‡†ç¡®ã€‚å®ƒè¿˜å¯ä»¥è¿è¡Œåœ¨ä¸åŒçš„åˆ†è¾¨ç‡ä¹‹é—´æ¥å¹³è¡¡é€Ÿåº¦å’Œå‡†ç¡®æ€§ã€‚æ¯ä¸ªYOLOv2å…¥å£å®é™…ä¸Šæ˜¯ç›¸åŒçš„è®­ç»ƒæ¨¡å‹ï¼Œå…·æœ‰ç›¸åŒçš„æƒé‡ï¼Œåªæ˜¯åœ¨ä¸åŒçš„å¤§å°ä¸‹è¿›è¡Œè¯„ä¼°ã€‚æ‰€æœ‰çš„æ—¶é—´ä¿¡æ¯éƒ½åœ¨Geforce GTX Titan Xï¼ˆåŸå§‹ï¼Œä¸æ˜¯Pascalæ¨¡å‹ï¼‰ä¸Šã€‚" /><br />
<strong>Further Experimentsï¼ˆè¿›ä¸€æ­¥å®éªŒï¼‰.</strong><br />
æˆ‘ä»¬åœ¨VOC2012ä¸Šè®­ç»ƒäº†YOLOv2æ£€æµ‹å™¨ã€‚è¡¨4æ˜¾ç¤ºäº†YOLOv2ä¸å…¶ä»–æœ€å…ˆè¿›çš„æ£€æµ‹ç³»ç»Ÿçš„æ€§èƒ½æ¯”è¾ƒã€‚YOLOv2å®ç°73.4 mAPï¼ŒåŒæ—¶è¿è¡Œé€Ÿåº¦è¿œè¿œå¿«äºç«äº‰çš„æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜åœ¨COCOæ•°æ®é›†ä¸Šè®­ç»ƒäº†æˆ‘ä»¬çš„æ¨¡å‹å¹¶å’Œå…¶ä»–çš„æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœåœ¨è¡¨5ã€‚åœ¨VOCè¯„ä¼°ï¼ˆIOU=.5ï¼‰ä¸Šï¼ŒYOLOv2å¾—åˆ°44.0 mAPï¼Œä¸SSDå’ŒFaster R-CNNç›¸å½“ã€‚</p>
<h1 id="æ›´å¿«"><a class="markdownIt-Anchor" href="#æ›´å¿«"></a> æ›´å¿«</h1>
<p>æˆ‘ä»¬å¸Œæœ›æ£€æµ‹èƒ½å‡†ç¡®ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å¤Ÿå¿«ã€‚å¤§å¤šæ•°ç”¨äºæ¢æµ‹çš„åº”ç”¨ï¼Œå¦‚æœºå™¨äººæˆ–è‡ªåŠ¨é©¾é©¶ï¼Œä¾èµ–äºä½å»¶è¿Ÿé¢„æµ‹ã€‚ä¸ºäº†æœ€å¤§é™åº¦åœ°æé«˜æ€§èƒ½ï¼Œä¸ºäº†ä½¿YOLOv2å¿«ï¼Œæˆ‘ä»¬ä»å¤´å¼€å§‹è®¾è®¡ã€‚å¤§å¤šæ•°æ£€æµ‹æ¡†æ¶éƒ½ä¾èµ–VGG-16ä½œä¸ºåŸºæœ¬çš„ç‰¹å¾æå–å™¨ã€‚VGG-16æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€å‡†ç¡®çš„åˆ†ç±»ç½‘ç»œï¼Œä½†å®ƒä¸å¿…è¦çš„å¤æ‚ã€‚VGG-16çš„å·ç§¯å±‚éœ€è¦306.9äº¿ä¸ªæµ®ç‚¹è¿ç®—å»å¤„ç†å•ä¸ª224Ã—224åˆ†è¾¨ç‡çš„å›¾åƒã€‚<br />
YOLOæ¡†æ¶ä½¿ç”¨åŸºäºGoogLeNetæ¶æ„çš„å®šåˆ¶ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œæ¯”VGG-16å¿«ï¼Œä»…ä½¿ç”¨85.2äº¿ä¸ªè¿ç®—å»å‰å‘ä¼ æ’­ã€‚ç„¶è€Œï¼Œå®ƒçš„å‡†ç¡®åº¦æ¯”VGG-16ç¨å·®ã€‚åœ¨ImageNetä¸Šï¼Œå¯¹äºå•å¼ è£å‰ªå›¾åƒï¼Œ224Ã—224åˆ†è¾¨ç‡ä¸‹çš„top-5å‡†ç¡®ç‡ï¼ŒYOLOçš„è‡ªå®šä¹‰æ¨¡å‹è·å¾—äº†88.0%ï¼Œè€ŒVGG-16åˆ™ä¸º90.0%ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-7.png" alt="è¡¨ 2 YOLOåˆ°YOLOv2çš„è·¯å¾„ã€‚å¤§å¤šæ•°åˆ—å‡ºçš„è®¾è®¡å†³ç­–éƒ½ä¼šå¯¼è‡´mAPçš„æ˜¾è‘—å¢åŠ ã€‚ä¸¤ä¸ªä¾‹å¤–æ˜¯æ¢åˆ°å¸¦æœ‰å…¨å·ç§¯ç½‘ç»œçš„é”šæ¡†å’Œä½¿ç”¨æ–°ç½‘ç»œã€‚åœ¨ä½¿ç”¨æ–°çš„ç½‘ç»œåˆ‡å‰²è®¡ç®—æ—¶ï¼Œåˆ‡æ¢åˆ°é”šæ¡†æ–¹æ³•åœ¨ä¸æ”¹å˜mAPçš„æƒ…å†µä¸‹æé«˜äº†å¬å›ç‡33%ã€‚" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-8.png" alt="è¡¨ 4 PASCAL VOC2012æµ‹è¯•æ£€æµ‹çš„ç»“æœã€‚YLOV2çš„æ€§èƒ½ä¸æœ€å…ˆè¿›çš„æ¢æµ‹å™¨ï¼ˆå¦‚Faster R-CNNï¼ŒResNetå’ŒSSD512ï¼‰ä¸€æ ·ï¼Œä¸”é€Ÿåº¦å¿«2-10å€ã€‚" /><br />
<strong>Darknet-19.</strong><br />
æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ–°åˆ†ç±»æ¨¡å‹ä½œä¸ºYOLOv2çš„åŸºç¡€ã€‚æˆ‘ä»¬çš„æ¨¡å‹å»ºç«‹åœ¨å…ˆå‰çš„ç½‘ç»œè®¾è®¡çš„å·¥ä½œä»¥åŠè¯¥é¢†åŸŸçš„å…±åŒçŸ¥è¯†çš„åŸºç¡€ä¸Šã€‚ä¸VGGæ¨¡å‹ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨3Ã—3å·ç§¯æ ¸ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡æ± åŒ–ä¹‹åå°†é€šé“æ•°å¢åŠ ä¸€å€ã€‚åœ¨ç½‘ç»œä¸­ç½‘ç»œï¼ˆNINï¼‰çš„è¾“å‡ºåï¼Œæˆ‘ä»¬ä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–é¢„æµ‹ï¼ŒæŠŠ1Ã—1çš„å·ç§¯æ ¸ç½®äº3Ã—3çš„å·ç§¯æ ¸ä¹‹é—´ï¼Œç”¨æ¥å‹ç¼©ç‰¹å¾ã€‚æˆ‘ä»¬ä½¿ç”¨æ‰¹æ¬¡å½’ä¸€åŒ–ç¨³å®šæ¨¡å‹è®­ç»ƒï¼ŒåŠ é€Ÿæ”¶æ•›å’Œæ­£åˆ™åŒ–æ¨¡å‹ã€‚<br />
æˆ‘ä»¬æœ€ç»ˆçš„æ¨¡å‹ï¼Œå«Darknet-19ï¼Œæ‹¥æœ‰19ä¸ªå·ç§¯å±‚å’Œ5ä¸ªæœ€å¤§æ± åŒ–å±‚ã€‚å®Œæ•´çš„ç½‘ç»œæè¿°è§è¡¨6ã€‚Darknet-19åªéœ€è¦55.8äº¿æ¬¡è¿ç®—å»å¤„ç†ä¸€å¼ å›¾åƒã€‚ä½†åœ¨ImageNetä¸Šå´è¾¾åˆ°äº†72.9%çš„top-1å‡†ç¡®ç‡å’Œ91.2%çš„top-5å‡†ç¡®ç‡ã€‚<br />
<strong>Training for classificationï¼ˆåˆ†ç±»è®­ç»ƒï¼‰.</strong><br />
æˆ‘ä»¬ä½¿ç”¨Darknetç¥ç»ç½‘ç»œæ¡†æ¶ï¼Œåœ¨æ ‡å‡†ImageNet 1000åˆ†ç±»æ•°æ®é›†ä¸Šä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆèµ·å§‹å­¦ä¹ é€Ÿç‡ä¸º0:1ï¼‰ã€å¤šé¡¹å¼é€Ÿç‡è¡°å‡ï¼ˆå¹‚ä¸º4ï¼‰ã€æƒé‡è¡°å‡ä¸º0:0005å’ŒåŠ¨é‡ä¸º0:9å¯¹ç½‘ç»œè¿›è¡Œ160ä¸ªæ—¶æœŸçš„è®­ç»ƒã€‚åœ¨è®­ç»ƒæœŸé—´ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„æ•°æ®å¢å¼ºæŠ€å·§ï¼ŒåŒ…æ‹¬éšæœºè£å‰ªã€æ—‹è½¬ã€è‰²è°ƒã€é¥±å’Œåº¦å’Œæ›å…‰å˜åŒ–ã€‚<br />
å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨æˆ‘ä»¬å¯¹224Ã—224çš„å›¾åƒè¿›è¡Œåˆå§‹è®­ç»ƒä¹‹åï¼Œæˆ‘ä»¬åœ¨æ›´å¤§çš„å°ºå¯¸448ä¸Šå¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚å¯¹äºè¿™æ¬¡å¾®è°ƒï¼Œæˆ‘ä»¬è®­ç»ƒäº†ä¸Šè¿°å‚æ•°ä½†æ˜¯åªä½¿ç”¨äº†10ä¸ªæ—¶æœŸå¹¶ä¸”ä»¥çš„å­¦ä¹ ç‡å¼€å§‹ã€‚åœ¨è¿™ç§æ›´é«˜åˆ†è¾¨ä¸‹ï¼Œæˆ‘ä»¬çš„ç½‘ç»œè¾¾åˆ°äº†top-1å‡†ç¡®ç‡76.5%ï¼Œtop-5å‡†ç¡®ç‡93.3%ã€‚<br />
<strong>Training for detectionï¼ˆæ£€æµ‹è®­ç»ƒï¼‰.</strong><br />
æˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªç½‘ç»œè¿›è¡Œæ£€æµ‹ï¼Œåˆ é™¤äº†æœ€åä¸€ä¸ªå·ç§¯å±‚ï¼Œä½œä¸ºæ›¿ä»£æ·»åŠ äº†3ä¸ªæœ‰1024ä¸ªæ»¤æ³¢å™¨çš„3Ã—3å·ç§¯å±‚ï¼Œç„¶åå†åŠ ä¸Šæœ€åä¸€ä¸ª1Ã—1çš„å·ç§¯å±‚ï¼Œè¾“å‡ºä¸æˆ‘ä»¬æ£€æµ‹éœ€è¦çš„è¾“å‡ºä¸€æ ·ã€‚å¯¹äºVOCï¼Œæˆ‘ä»¬é¢„æµ‹5ä¸ªæ¡†ï¼Œæ¯ä¸ªæ¡†æœ‰5ä¸ªåæ ‡å’Œ20ä¸ªç±»åˆ«ï¼Œæ‰€ä»¥æœ‰125ä¸ªæ»¤æ³¢å™¨ã€‚æˆ‘ä»¬è¿˜åœ¨æœ€åçš„3Ã—3Ã—512å±‚å’Œå€’æ•°ç¬¬äºŒä¸ªå·ç§¯å±‚ä¹‹é—´åŠ äº†ä¸€ä¸ªpassthroughå±‚ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„æ¨¡å‹å¯ä»¥ä½¿ç”¨ç»†ç²’çš„ç‰¹å¾ã€‚<br />
æˆ‘ä»¬è®­ç»ƒç½‘ç»œ160ä¸ªæ—¶æœŸï¼Œä»¥å­¦ä¹ ç‡å¼€å§‹ï¼Œå¹¶åœ¨ç¬¬60å’Œ90ä¸ªæ—¶æœŸçš„æ—¶å€™é™¤ä»¥10ã€‚æˆ‘ä»¬ä½¿ç”¨0.0005çš„æƒé‡è¡°å‡å’Œ0.9çš„åŠ¨é‡ã€‚æˆ‘ä»¬å¯¹YOLOå’ŒSSDè¿›è¡Œç±»ä¼¼çš„æ•°æ®å¢å¼ºï¼Œéšæœºè£å‰ªï¼Œè‰²å½©åç§»ç­‰ã€‚æˆ‘ä»¬å¯¹COCOå’ŒVOCä½¿ç”¨ç›¸åŒçš„è®­ç»ƒç­–ç•¥ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-9.png" alt="è¡¨ 5 COCO test-dev2015ä¸Šçš„æµ‹è¯•ç»“æœ" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-10.png" alt="è¡¨ 6 Darknet-19" /></p>
<h1 id="æ›´å¼º"><a class="markdownIt-Anchor" href="#æ›´å¼º"></a> æ›´å¼º</h1>
<p>æˆ‘ä»¬æå‡ºä¸€ç§å†åˆ†ç±»æ•°æ®å’Œæ£€æµ‹æ•°æ®ä¸Šè”åˆè®­ç»ƒçš„æœºåˆ¶ã€‚æˆ‘ä»¬çš„æ–¹æ³•ä½¿ç”¨æ ‡è®°ä¸ºæ£€æµ‹çš„å›¾åƒæ¥å­¦ä¹ è¾¹æ¡†åæ ‡é¢„æµ‹å’Œç›®æ ‡ä¹‹ç±»çš„ç‰¹å®šæ£€æµ‹ä¿¡æ¯ä»¥åŠå¦‚ä½•å¯¹å¸¸è§ç›®æ ‡è¿›è¡Œåˆ†ç±»ã€‚å®ƒä½¿ç”¨ä»…å…·æœ‰ç±»åˆ«æ ‡ç­¾çš„å›¾åƒæ¥æ‰©å±•å¯æ£€æµ‹ç±»åˆ«çš„æ•°é‡ã€‚<br />
åœ¨è®­ç»ƒæœŸé—´ï¼Œæˆ‘ä»¬æ··åˆæ£€æµ‹æ•°æ®é›†å’Œåˆ†ç±»æ•°æ®é›†çš„å›¾åƒã€‚å½“æˆ‘ä»¬çš„ç½‘ç»œçœ‹åˆ°äº†æ ‡è®°ä¸ºæ£€æµ‹çš„å›¾åƒæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨å®Œæ•´çš„YOLOv2 losså‡½æ•°è¿›è¡Œåå‘ä¼ æ’­ï¼Œå½“å®ƒçœ‹è§ä¸€ä¸ªåˆ†ç±»å›¾åƒæ—¶ï¼Œæˆ‘ä»¬åªæ˜¯ç”¨åˆ†ç±»ç‰¹å®šçš„losså‡½æ•°è¿›è¡Œåå‘ä¼ æ’­ã€‚<br />
è¿™ç§æ–¹æ³•é‡åˆ°äº†ä¸€ç‚¹æŒ‘æˆ˜ã€‚æ£€æµ‹æ•°æ®é›†åªæœ‰é€šç”¨ç›®æ ‡å’Œé€šç”¨æ ‡ç­¾ï¼Œå¦‚â€œç‹—â€æˆ–â€œèˆ¹â€ã€‚åˆ†ç±»æ•°æ®é›†æœ‰æ›´å¹¿æ›´æ·±çš„æ ‡ç­¾èŒƒå›´ã€‚ImageNetæœ‰è¶…è¿‡ä¸€ç™¾ç§å“ç§çš„ç‹—ï¼ŒåŒ…æ‹¬â€œè¯ºç¦å…‹ã¹´çŠ¬â€ï¼Œâ€œçº¦å…‹å¤ã¹´â€å’Œâ€œè´æ—ç™»çŠ¬â€ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šè®­ç»ƒï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¿è´¯çš„æ–¹å¼æ¥åˆå¹¶è¿™äº›æ ‡ç­¾ã€‚<br />
å¤§å¤šæ•°åˆ†ç±»æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªsoftmaxå±‚å»è®¡ç®—æ‰€æœ‰å¯èƒ½ç±»çš„æœ€ç»ˆæ¦‚ç‡åˆ†å¸ƒã€‚ä½¿ç”¨softmaxå‡å®šç±»åˆ«ä¹‹é—´æ—¶ç›¸äº’æ’æ–¥çš„ã€‚è¿™ç»™æ•°æ®é›†ç»„åˆå¸¦æ¥äº†é—®é¢˜ï¼Œæ¯”å¦‚ä½ ä¸æƒ³ç”¨è¿™ä¸ªæ¨¡å‹ç»„åˆImageNetå’ŒCOCOï¼Œå› ä¸ºâ€œè¯ºç¦å…‹ã¹´çŠ¬â€å’Œâ€œç‹—â€ä¸æ˜¯äº’æ–¥çš„ã€‚<br />
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¤šæ ‡ç­¾çš„æ¨¡å‹æ¥ç»„åˆå‡å®šä¸äº’åŠ©çš„æ•°æ®é›†ã€‚è¿™ä¸ªæ–¹æ³•æ— è§†æˆ‘ä»¬æ‰€çŸ¥é“çš„æ•°æ®çš„å…¨éƒ¨ç»“æ„ï¼Œæ¯”å¦‚COCOä¸­æ‰€æœ‰çš„ç±»æ˜¯äº’æ–¥çš„ã€‚<br />
<strong>Hierarchical classificationï¼ˆåˆ†å±‚åˆ†ç±»ï¼‰.</strong><br />
ImageNetçš„æ ‡ç­¾ä»WordNetæå–ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºæ¦‚å¿µåŠå…¶å…³ç³»çš„è¯­è¨€æ•°æ®åº“ã€‚åœ¨WordNetä¸­ï¼Œâ€œè¯ºç¦å…‹ã¹´çŠ¬â€å’Œâ€œçº¦å…‹å¤ã¹´â€éƒ½æ˜¯â€œã¹´â€çš„ä¸‹ä¹‰è¯ï¼Œâ€œã¹´â€æ˜¯â€œçŒçŠ¬â€çš„ä¸€ç§ï¼Œâ€œçŒçŠ¬â€æ˜¯â€œç‹—â€çš„ä¸€ç§ï¼Œâ€œç‹—â€æ˜¯â€œçŠ¬ç±»åŠ¨ç‰©â€çš„ä¸€ç§ç­‰ç­‰ã€‚ç»å¤§å¤šæ•°çš„åˆ†ç±»æ–¹æ³•å‡å®šæ ‡ç­¾æ˜¯ä¸€ä¸ªæ‰å¹³ç»“æ„ï¼Œä½†æ˜¯å¯¹äºè”åˆæ•°æ®é›†ï¼Œç»“æ„æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚<br />
WordNetçš„ç»“æ„å°±åƒä¸€ä¸ªæœ‰å‘å›¾ï¼Œè€Œä¸æ˜¯æ ‘ï¼Œå› ä¸ºè¯­è¨€æ˜¯å¤æ‚çš„ã€‚æ¯”å¦‚â€œç‹—â€æ—¢æ˜¯â€œçŠ¬ç§‘åŠ¨ç‰©â€çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯â€œå®¶ç•œâ€çš„ä¸€ç§ï¼Œè¿™ä¸¤ä¸ªåœ¨WordNetä¸­éƒ½æ˜¯åŒä¹‰è¯ã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å®Œæ•´çš„å›¾ç»“æ„ï¼Œè€Œæ˜¯é€šè¿‡ImageNetçš„æ¦‚å¿µæ„å»ºä¸€ä¸ªåˆ†å±‚æ ‘æ¥ç®€åŒ–é—®é¢˜ã€‚<br />
ä¸ºäº†æ„å»ºè¿™æ£µæ ‘ï¼Œæˆ‘ä»¬æ£€æµ‹äº†ImageNetä¸­çš„è§†è§‰åè¯ï¼Œå¹¶æŸ¥çœ‹å®ƒä»¬é€šè¿‡WordNetå›¾åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„ï¼Œæœ¬ä¾‹ä¸­ä¸ºâ€œç‰©ç†ç‰©ä½“â€ã€‚è®¸å¤šåŒä¹‰è¯åœ¨å›¾ä¸­åªæœ‰ä¸€æ¡è·¯å¾„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå°†æ‰€æœ‰è¿™äº›è·¯å¾„æ·»åŠ åˆ°æˆ‘ä»¬çš„æ ‘ä¸­ã€‚ç„¶åæˆ‘ä»¬åå¤æ£€æŸ¥æˆ‘ä»¬ç•™ä¸‹çš„æ¦‚å¿µï¼Œå¹¶åœ¨æ ‘ä¸Šæ·»åŠ å°½å¯èƒ½å°‘çš„è·¯å¾„ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªæ¦‚å¿µæœ‰ä¸¤æ¡è·¯å¾„åˆ°æ ¹èŠ‚ç‚¹ï¼Œä¸€æ¡è·¯å¾„ä¼šç»™æ ‘å¢åŠ ä¸‰æ¡è¾¹ï¼Œå¦ä¸€æ¡è·¯å¾„åªå¢åŠ ä¸€æ¡è¾¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬é€‰æ‹©æ›´çŸ­çš„è·¯å¾„ã€‚<br />
æœ€ç»ˆçš„ç»“æœå°±æ˜¯WordTreeï¼Œä¸€ä¸ªè§†è§‰æ¦‚å¿µåˆ†å±‚æ¨¡å‹ã€‚ä¸ºäº†ä½¿ç”¨WordTreeè¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬é¢„æµ‹æ¯ä¸ªèŠ‚ç‚¹çš„æ¡ä»¶æ¦‚ç‡ï¼Œä»¥å¾—åˆ°åŒä¹‰è¯é›†åˆä¸­æ¯ä¸ªåŒä¹‰è¯ä¸‹ä¹‰è¯çš„æ¦‚ç‡ã€‚æ¯”å¦‚ï¼Œåœ¨â€œã¹´â€èŠ‚ç‚¹æˆ‘ä»¬é¢„æµ‹ï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>f</mi><mi>o</mi><mi>l</mi><mi>k</mi><mtext>Â </mtext><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mtext>Â </mtext><mi mathvariant="normal">âˆ£</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_{r}\left( Norfolk\ terrier\ |terrier \right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace">Â </span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mspace">Â </span><span class="mord">âˆ£</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mi>Y</mi><mi>o</mi><mi>r</mi><mi>k</mi><mi>s</mi><mi>h</mi><mi>i</mi><mi>r</mi><mi>e</mi><mtext>Â </mtext><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">âˆ£</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_{r}\left( Yorkshire\ terrier|terrier \right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mspace">Â </span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">âˆ£</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mi>B</mi><mi>e</mi><mi>d</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>o</mi><mi>n</mi><mtext>Â </mtext><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">âˆ£</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_{r}\left( Bedlington\ terrier|terrier \right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">t</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mspace">Â </span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">âˆ£</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦è®¡ç®—ä¸€ä¸ªç‰¹å®šèŠ‚ç‚¹çš„ç»å¯¹æ¦‚ç‡ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„éšç€é€šé“åˆ°æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œå¹¶ä¹˜ä»¥æ¡ä»¶æ¦‚ç‡ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦çŸ¥é“ä¸€å¼ å›¾æ˜¯ä¸æ˜¯ä¸ºâ€œè¯ºç¦å…‹ã¹´çŠ¬â€æˆ‘ä»¬è®¡ç®—ï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mtext>NorfolkÂ terrier</mtext><mo fence="true">)</mo></mrow><mo>=</mo><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mi>N</mi><mi>o</mi><mi>r</mi><mi>f</mi><mi>o</mi><mi>l</mi><mi>k</mi><mtext>Â </mtext><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">âˆ£</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo fence="true">)</mo></mrow><mo>Ã—</mo><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mi>t</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">âˆ£</mi><mi>h</mi><mi>u</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>n</mi><mi>g</mi><mtext>Â </mtext><mi>d</mi><mi>o</mi><mi>g</mi><mo fence="true">)</mo></mrow><mo>Ã—</mo><mo>â€¦</mo><mo>Ã—</mo><msub><mi>P</mi><mi>r</mi></msub><mo stretchy="false">(</mo><mi>m</mi><mi>a</mi><mi>m</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">âˆ£</mi><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mtext>animal</mtext><mo fence="true">)</mo></mrow><mo>Ã—</mo><msub><mi>P</mi><mi>r</mi></msub><mrow><mo fence="true">(</mo><mi>a</mi><mi>n</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>l</mi><mi mathvariant="normal">âˆ£</mi><mi>p</mi><mi>h</mi><mi>y</mi><mi>s</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>l</mi><mtext>Â </mtext><mi>o</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">P_{r}\left( \text{Norfolk\ terrier} \right) = P_{r}\left( Norfolk\ terrier|terrier \right) \times P_{r}\left( terrier|hunting\ dog \right) \times \ldots \times P_{r}(mammal|P_{r}\left( \text{animal} \right) \times P_{r}\left( animal|physical\ object \right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord text"><span class="mord">NorfolkÂ terrier</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mspace">Â </span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">âˆ£</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord">âˆ£</span><span class="mord mathdefault">h</span><span class="mord mathdefault">u</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace">Â </span><span class="mord mathdefault">d</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord text"><span class="mord">animal</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord">âˆ£</span><span class="mord mathdefault">p</span><span class="mord mathdefault">h</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace">Â </span><span class="mord mathdefault">o</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p>å¯¹äºåˆ†ç±»ç›®çš„ï¼Œæˆ‘ä»¬å‡å®šå›¾åƒå«æœ‰ä¸€ä¸ªç›®æ ‡ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mi>r</mi></msub><mrow><mo stretchy="false">(</mo><mtext>physicalÂ object</mtext></mrow><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">P_{r}\left. (\text{physical\ object} \right.) = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen nulldelimiter"></span><span class="mopen">(</span><span class="mord text"><span class="mord">physicalÂ object</span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>ã€‚<br />
ä¸ºäº†éªŒè¯è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨äº†1000ç±»çš„ImageNetæ„å»ºçš„WordTreeä¸Šè®­ç»ƒDarknet-19ã€‚ä¸ºäº†æ„å»ºWordTree1kï¼Œæˆ‘ä»¬æ·»åŠ äº†æ‰€æœ‰å°†æ ‡ç­¾ç©ºé—´ä»1000æ‰©å±•åˆ°1369çš„ä¸­é—´èŠ‚ç‚¹ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ­£ç¡®æ ‡ç­¾å‘æ ‘åå‘ä¼ æ’­ï¼Œä»¥ä¾¿å¦‚æœå›¾åƒè¢«æ ‡è®°ä¸ºâ€œè¯ºç¦å…‹ã¹´çŠ¬â€ï¼Œåˆ™å®ƒä¹Ÿè¢«æ ‡è®°ä¸ºâ€œç‹—â€å’Œâ€œå“ºä¹³åŠ¨ç‰©â€ç­‰ã€‚ä¸ºäº†è®¡ç®—æ¡ä»¶æ¦‚ç‡ï¼Œæˆ‘ä»¬çš„æ¨¡å‹é¢„æµ‹ä¸€ä¸ªæœ‰1369ä¸ªå€¼çš„å‘é‡ï¼Œå¹¶ä¸”æˆ‘ä»¬è®¡ç®—äº†ç›¸åŒæ¦‚å¿µçš„ä¸‹ä¹‰è¯åœ¨æ‰€æœ‰åŒä¹‰è¯é›†ä¸Šçš„softmaxï¼Œè§å›¾5ã€‚<br />
ä½¿ç”¨ä¸ä¹‹å‰ç›¸åŒçš„è®­ç»ƒå‚æ•°ï¼Œæˆ‘ä»¬çš„åˆ†å±‚Darknet-19è¾¾åˆ°äº†top-1 71.9%çš„å‡†ç¡®æ€§ï¼Œtop-5 90.4%çš„å‡†ç¡®æ€§ã€‚å°½ç®¡å¢åŠ äº†369ä¸ªé¢å¤–æ¦‚å¿µï¼Œæˆ‘ä»¬çš„ç½‘ç»œé¢„æµ‹äº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ï¼Œæˆ‘ä»¬çš„å‡†ç¡®ç‡ä»…ä¸‹é™äº†ä¸€ç‚¹ç‚¹ã€‚ä»¥è¿™ç§æ–¹å¼è¿›è¡Œåˆ†ç±»ä¹Ÿæœ‰ä¸€äº›å¥½å¤„ã€‚ä»¥è¿™ç§æ–¹å¼è¿›è¡Œåˆ†ç±»ä¹Ÿæœ‰ä¸€äº›å¥½å¤„ã€‚åœ¨æ–°çš„æˆ–æœªçŸ¥çš„ç›®æ ‡ç±»åˆ«ä¸Šæ€§èƒ½ä¼šé™ä½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœç½‘ç»œçœ‹åˆ°ä¸€åªç‹—çš„ç…§ç‰‡ï¼Œä½†ä¸ç¡®å®šå®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„ç‹—ï¼Œå®ƒä»ç„¶ä¼šæ›´é«˜ç½®ä¿¡åº¦åœ°é¢„æµ‹â€œç‹—â€ï¼Œä½†æ˜¯åœ¨ä¸‹ä¹‰ä½æ‰©å±•ä¹‹é—´æœ‰æ›´ä½çš„ç½®ä¿¡åº¦ã€‚<br />
è¿™ä¸ªå…¬å¼åŒæ ·é€‚ç”¨äºæ£€æµ‹ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨YOLOv2çš„ç‰©ä½“é¢„æµ‹å™¨ç»™æˆ‘ä»¬ä¸€ä¸ªçš„å€¼ï¼Œè€Œä¸æ˜¯å‡å®šæ¯å¼ å›¾éƒ½æœ‰ä¸€ä¸ªç‰©ä½“ã€‚æ£€æµ‹å™¨é¢„æµ‹ä¸€ä¸ªè¾¹æ¡†å’Œæ¦‚ç‡æ ‘ã€‚æˆ‘ä»¬å‘ä¸‹éå†æ ‘ï¼Œæˆ‘ä»¬å–æœ€é«˜ç½®ä¿¡åº¦çš„è·¯å¾„åˆ†å‰²ï¼Œç›´åˆ°è¾¾åˆ°ä¸€ä¸ªé˜ˆå€¼ï¼Œç„¶åæˆ‘ä»¬é¢„æµ‹ç‰©ä½“ç±»ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-11.png" alt="å›¾ 5 ImageNetå’ŒWordTreeé¢„æµ‹å¯¹æ¯”ã€‚å¤§å¤šæ•°ImageNetæ¨¡å‹ä½¿ç”¨å•ä¸ªå¤§çš„softmaxå‡½æ•°å»é¢„æµ‹æ¦‚ç‡åˆ†å¸ƒã€‚ä½¿ç”¨WordTreeï¼Œæˆ‘ä»¬å¯¹ä¸Šä¸‹ä¹‰è¯æ‰§è¡Œå¤šä¸ªsoftmaxæ“ä½œã€‚" /><br />
<strong>Dataset combination with WordTreeï¼ˆæ•°æ®é›†ä¸è¯è¯­æ ‘ç»“åˆï¼‰.</strong><br />
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆç†çš„WordTreeå°†å¤šä¸ªæ•°æ®é›†ä»¥åˆç†çš„æ–¹å¼ç»„åˆåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ•°æ®é›†ä¸­çš„ç±»åˆ«æ˜ å°„åˆ°æ•°ä¸­çš„è¯­æ³•é›†ã€‚å›¾6å±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨WordTreeç»„åˆImageNetå’ŒCOCOçš„ä¾‹å­ã€‚WordTreeæ˜¯éå¸¸å¤šæ ·åŒ–çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†æ­¤é¡¹æŠ€æœ¯ç”¨äºå¤§å¤šæ•°æ•°æ®é›†ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-12.png" alt="å›¾ 6 ä½¿ç”¨WordTreeå±‚æ¬¡ç»“æ„ç»„åˆæ•°æ®é›†ã€‚ä½¿ç”¨WordNetæ¦‚å¿µå›¾ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªè§†è§‰æ¦‚å¿µçš„å±‚æ¬¡æ ‘ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†æ•°æ®é›†ä¸­çš„ç±»æ˜ å°„åˆ°æ ‘ä¸­çš„åŒä¹‰è¯æ¥åˆå¹¶æ•°æ®é›†ã€‚è¿™æ˜¯WordTreeä¸ºäº†ä¾¿äºè¯´æ˜çš„ç®€åŒ–è§†å›¾" /><br />
<strong>Joint classification and detectionï¼ˆåˆ†ç±»æ£€æµ‹è”åˆï¼‰.</strong><br />
ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨WordTreeå»ç»„åˆæ•°æ®é›†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†ç±»å’Œæ£€æµ‹æ•°æ®é›†ä¸Šè®­ç»ƒæˆ‘ä»¬çš„è”åˆæ¨¡å‹ã€‚æˆ‘ä»¬æƒ³è¦è®­ç»ƒä¸€ä¸ªéå¸¸å¤§è§„æ¨¡çš„æ£€æµ‹å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨COCOæ£€æµ‹æ•°æ®é›†å’Œå®Œæ•´ç‰ˆæœ¬ImageNetçš„å‰9000ä¸ªç±»åˆ›å»ºæˆ‘ä»¬çš„ç»„åˆæ•°æ®é›†ã€‚æˆ‘ä»¬è¿˜æƒ³è¯„ä¼°æˆ‘ä»¬çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ ä»»æ„ImageNetæŒ‘æˆ˜ä¸­æœªåŒ…å«çš„ç±»ã€‚ç›¸åº”çš„è¿™ä¸ªæ•°æ®é›†çš„WordTreeæœ‰9418ä¸ªç±»åˆ«ã€‚ImageNetæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡å¯¹COCOè¿›è¡Œè¿‡é‡‡æ ·æ¥å¹³è¡¡æ•°æ®é›†ï¼Œä½¿å¾—ImageNetåªæ¯”COCOæ•°æ®é›†å¤§äº4å€ã€‚<br />
ä½¿ç”¨è¿™ä¸ªæ•°æ®é›†ï¼Œæˆ‘ä»¬è®­ç»ƒäº†YOLO9000ã€‚ç”±äºå—åˆ°è¾“å‡ºå¤§å°çš„é™åˆ¶ï¼Œæˆ‘ä»¬ä½¿ç”¨YOLOv2çš„åŸºç¡€ç»“æ„ä½†æ˜¯åªæœ‰3ä¸ªå…ˆéªŒè€Œä¸æ˜¯5ä¸ªã€‚å½“æˆ‘ä»¬çš„ç½‘ç»œçœ‹åˆ°ä¸€ä¸ªæ£€æµ‹å›¾åƒæ—¶ï¼Œæˆ‘ä»¬æ­£å¸¸çš„åå‘ä¼ æ’­lossã€‚å¯¹äºåˆ†ç±»lossï¼Œæˆ‘ä»¬åªåœ¨æ ‡ç­¾æ›´é«˜ç­‰çº§ä¸Šåå‘ä¼ æ’­å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ ‡ç­¾æ˜¯â€œdogâ€ï¼Œæˆ‘ä»¬ä¼šå°†ä»»ä½•é”™è¯¯åˆ†é…ç»™æ ‘ä¸‹é¢çš„é¢„æµ‹ï¼Œâ€œå¾·å›½ç‰§ç¾ŠçŠ¬â€å’Œâ€œé‡‘æ¯›çŒçŠ¬â€ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰è¿™äº›ä¿¡æ¯ã€‚<br />
å½“å®ƒçœ‹åˆ°åˆ†ç±»å›¾åƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åªåå‘ä¼ æ’­åˆ†ç±»lossã€‚è¦åšåˆ°è¿™ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°è¿™ä¸ªç±»æœ€é«˜æ¦‚ç‡çš„è¾¹æ¡†ï¼Œç„¶åè®¡ç®—é¢„æµ‹æ ‘ä¸Šçš„lossã€‚æˆ‘ä»¬è¿˜å‡å®šé¢„æµ‹æ¡†å’Œæ ‡ç­¾æ¡†é‡å è‡³å°‘0.3ä¸ªIOUï¼Œå¹¶åŸºäºæ­¤å‡è®¾åå‘ä¼ æ’­å¯¹è±¡æ€§lossã€‚<br />
ä½¿ç”¨è¿™ç§è”åˆè®­ç»ƒï¼ŒYOLO9000å­¦ä¹ ä½¿ç”¨COCOä¸­çš„æ£€æµ‹æ•°æ®æ¥æŸ¥æ‰¾å›¾åƒä¸­çš„ç›®æ ‡ï¼Œå¹¶å­¦ä¹ ä½¿ç”¨ImageNetçš„æ•°æ®å¯¹è¿™äº›ç›®æ ‡è¿›è¡Œåˆ†ç±»ã€‚<br />
æˆ‘ä»¬åœ¨ImageNetæ£€æµ‹ä»»åŠ¡ä¸Šè¯„ä¼°YOLO9000ã€‚ImageNetçš„æ£€æµ‹ä»»åŠ¡ä¸COCOå…±äº«44ä¸ªç›®æ ‡ç±»åˆ«ï¼Œè¿™æ„å‘³ç€YOLO9000åªèƒ½çœ‹åˆ°å¤§å¤šæ•°æµ‹è¯•å›¾åƒçš„åˆ†ç±»æ•°æ®ï¼Œè€Œä¸æ˜¯æ£€æµ‹æ•°æ®ã€‚YOLO9000åœ¨ä»æœªè§è¿‡ä»»ä½•æ ‡è®°çš„æ£€æµ‹æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ•´ä½“ä¸Šè·å¾—äº†19.7 mAPï¼Œåœ¨ä¸ç›¸äº¤çš„156ä¸ªç›®æ ‡ç±»åˆ«ä¸­è·å¾—äº†16.0 mAPã€‚è¿™ä¸ªmAPé«˜äºDPMç®—æ³•çš„ç»“æœï¼Œä½†æ˜¯YOLO9000æ˜¯åœ¨åªæœ‰éƒ¨åˆ†ç›‘ç£çš„ä¸åŒçš„æ•°æ®é›†ä¸Šè®­ç»ƒçš„ã€‚å®ƒä¹ŸåŒæ—¶å®æ—¶æ£€æµ‹9000ä¸ªå…¶ä»–ç±»åˆ«ã€‚<br />
å½“æˆ‘ä»¬åˆ†æYOLO9000åœ¨ImageNetä¸Šçš„è¡¨ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°å®ƒå¾ˆå¥½çš„å­¦ä¹ æ–°çš„åŠ¨ç‰©ç§ç±»ï¼Œä½†æ˜¯å­¦ä¹ å¦‚è¡£æœã€è£…å¤‡è¿™ç§ç±»åˆ«çš„æ—¶å€™æ¯”è¾ƒå›°éš¾ã€‚æ–°åŠ¨ç‰©å®¹æ˜“å­¦ä¹ æ˜¯å› ä¸ºç›®æ ‡æ£€æµ‹å¯ä»¥ä»COCOçš„åŠ¨ç‰©ç±»ä¸­å¾—åˆ°å¾ˆå¥½çš„æ³›åŒ–ã€‚ç›¸åçš„ï¼ŒCOCOä¸­æ²¡æœ‰ä»»ä½•è¡£æœçš„è¾¹æ¡†æ ‡ç­¾ï¼Œåªæœ‰äººçš„ã€‚æ‰€ä»¥YOLO9000å¾ˆéš¾å¯¹â€œå¢¨é•œâ€ã€â€œæ³³è£¤â€ç­‰ç±»å»ºæ¨¡ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/YOLO9000-translate-13.png" alt="è¡¨ 7 åœ¨ImageNetä¸ŠYOLO9000é¢„æµ‹æœ€å¥½å’Œæœ€å·®çš„ç±»ã€‚156ä¸ªå¼±ç›‘ç£ç±»ä¸­APå€¼æœ€é«˜å’Œæœ€ä½çš„ç±»ã€‚YOLO9000å­¦ä¹ å„ç§åŠ¨ç‰©æ¨¡å‹çš„æ•ˆæœå¾ˆå¥½ï¼Œä½†åœ¨æœè£…æˆ–è£…å¤‡ç­‰æ–°å‘ç±»ä¸Šå­¦ä¹ å´å¾ˆåƒåŠ›ã€‚" /></p>
<h1 id="ç»“è®º"><a class="markdownIt-Anchor" href="#ç»“è®º"></a> ç»“è®º</h1>
<p>æˆ‘ä»¬ä»‹ç»äº†YOLOv2å’ŒYOLO9000ï¼Œä¸¤ä¸ªå®æ—¶ç³»ç»Ÿã€‚YOLOv2æ˜¯å„ç§æ£€æµ‹æ•°æ®é›†ä¸Šæœ€å…ˆè¿›çš„ï¼Œæ¯”å…¶ä»–æ£€æµ‹ç³»ç»Ÿå¿«ã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥è¿è¡Œåœ¨å„ç§å›¾åƒå¤§å°ï¼Œæä¾›é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´çš„å¹³æ»‘æŠ˜è¡·ã€‚<br />
YOLO9000æ˜¯ä¸€ä¸ªé€šè¿‡è”åˆä¼˜åŒ–æ£€æµ‹ã€åˆ†ç±»æ•°æ®é›†æ£€æµ‹è¶…è¿‡9000ä¸ªç±»çš„å®æ—¶æ£€æµ‹æ¡†æ¶ã€‚æˆ‘ä»¬ä½¿ç”¨WordTreeå°†å„ç§æ¥æºçš„æ•°æ®å’Œæˆ‘ä»¬è”åˆä¼˜åŒ–æŠ€æœ¯ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶åŒæ—¶åœ¨ImageNetå’ŒCOCOä¸Šè®­ç»ƒã€‚YOLO9000æ˜¯ç¼©å°æ£€æµ‹æ•°æ®é›†å’Œåˆ†ç±»æ•°æ®é›†ä¹‹é—´å¤§å°å·®è·çš„é‡è¦ä¸€æ­¥ã€‚<br />
æˆ‘ä»¬çš„è®¸å¤šæŠ€æœ¯éƒ½å¯ä»¥æ³›åŒ–åˆ°ç›®æ ‡æ£€æµ‹ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨ImageNetä¸Šçš„WordTreeä¸ºå›¾åƒåˆ†ç±»æä¾›äº†æ›´ä¸°å¯Œï¼Œè¯¦ç»†çš„è¾“å‡ºç©ºé—´ã€‚ä½¿ç”¨åˆ†å±‚åˆ†ç±»çš„æ•°æ®é›†ç»„åˆåœ¨åˆ†ç±»å’Œåˆ†å‰²é¢†åŸŸå¾ˆæœ‰ç”¨ã€‚åƒå¤šå°ºåº¦è®­ç»ƒè¿™æ ·çš„è®­ç»ƒæŠ€æœ¯å¯ä»¥ä¸ºå„ç§è§†è§‰ä»»åŠ¡æä¾›ç›Šå¤„ã€‚<br />
å¯¹äºæœªæ¥çš„å·¥ä½œï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ç±»ä¼¼çš„æŠ€æœ¯æ¥è¿›è¡Œå¼±ç›‘ç£çš„å›¾åƒåˆ†å‰²ã€‚æˆ‘ä»¬è¿˜è®¡åˆ’åœ¨è®­ç»ƒæœŸé—´ä½¿ç”¨æ›´å¼ºå¤§çš„åŒ¹é…ç­–ç•¥ä¸ºåˆ†ç±»æ•°æ®åˆ†é…å¼±æ ‡ç­¾ï¼Œä»¥æ”¹å–„æ£€æµ‹ç»“æœã€‚è®¡ç®—æœºè§†è§‰å—åˆ°å¤§é‡æ ‡è®°æ•°æ®ã€‚æˆ‘ä»¬å°†ç»§ç»­å¯»æ‰¾æ–¹æ³•ï¼Œå°†ä¸åŒæ¥æºå’Œä¸åŒç»“æ„çš„æ•°æ®æ•´åˆèµ·æ¥ï¼Œå½¢æˆæ›´å¼ºå¤§çš„è§†è§‰ä¸–ç•Œæ¨¡å‹ã€‚</p>
<h1 id="å¼•ç”¨"><a class="markdownIt-Anchor" href="#å¼•ç”¨"></a> å¼•ç”¨</h1>
<p>[1] S. Bell, C. L. Zitnick, K. Bala, and R. Girshick. Insideoutside net: Detecting objects in context with skip pooling and recurrent neural networks. arXiv preprint arXiv:1512.04143, 2015. 6<br />
[2] J. Deng, W. Dong, R. Socher, L.-J. Li, K. Li, and L. Fei-Fei. Imagenet: A large-scale hierarchical image database. In Computer Vision and Pattern Recognition, 2009. CVPR 2009. IEEE Conference on, pages 248â€“255. IEEE, 2009. 1<br />
[3] M. Everingham, L. Van Gool, C. K. Williams, J. Winn, and A. Zisserman. The pascal visual object classes (voc) challenge. International journal of computer vision, 88(2):303â€“338, 2010. 1<br />
[4] P. F. Felzenszwalb, R. B. Girshick, and D. McAllester. Discriminatively trained deformable part models, release 4. <a href="http://people.cs.uchicago.edu/pff/latent-release4/">http://people.cs.uchicago.edu/pff/latent-release4/</a>. 8<br />
[5] R. B. Girshick. Fast R-CNN. CoRR, abs/1504.08083, 2015.4, 5, 6<br />
[6] K. He, X. Zhang, S. Ren, and J. Sun. Deep residual learning for image recognition. arXiv preprint arXiv:1512.03385, 2015. 2, 4, 5<br />
[7] S. Ioffe and C. Szegedy. Batch normalization: Accelerating deep network training by reducing internal covariate shift. arXiv preprint arXiv:1502.03167,2015. 2, 5<br />
[8] A. Krizhevsky, I. Sutskever, and G. E. Hinton. Imagenet classification with deep convolutional neural networks. In Advances in neural information processing systems, pages 1097â€“1105, 2012. 2<br />
[9] M. Lin, Q. Chen, and S. Yan. Network in network. arXiv preprint arXiv:1312.4400, 2013. 5<br />
[10] T.-Y. Lin, M. Maire, S. Belongie, J. Hays, P. Perona, D. Ramanan, P. DollÂ´ar, and C. L. Zitnick. Microsoft coco: Common objects in context. In European Conference on Computer Vision, pages 740â€“755. Springer, 2014. 1, 6<br />
[11] W. Liu, D. Anguelov, D. Erhan, C. Szegedy, and S. E. Reed. SSD: single shot multibox detector. CoRR, abs/1512.02325, 2015. 4, 5, 6<br />
[12] G. A. Miller, R. Beckwith, C. Fellbaum, D. Gross, and K. J. Miller. Introduction to wordnet: An on-line lexical database. International journal of lexicography, 3(4):235â€“244, 1990.6<br />
[13] J. Redmon. Darknet: Open source neural networks in c. <a href="http://pjreddie.com/darknet/">http://pjreddie.com/darknet/</a>, 2013â€“2016. 5<br />
[14] J. Redmon, S. Divvala, R. Girshick, and A. Farhadi. You only look once: Unified, real-time object detection. arXiv preprint arXiv:1506.02640, 2015. 4, 5<br />
[15] S. Ren, K. He, R. Girshick, and J. Sun. Faster r-cnn: Towards real-time object detection with region proposal networks. arXiv preprint arXiv:1506.01497,2015. 2, 3, 4, 5, 6<br />
[16] O. Russakovsky, J. Deng, H. Su, J. Krause, S. Satheesh, S. Ma, Z. Huang, A. Karpathy, A. Khosla, M. Bernstein, A. C. Berg, and L. Fei-Fei. ImageNet Large Scale Visual Recognition Challenge. International Journal of Computer Vision (IJCV), 2015. 2<br />
[17] K. Simonyan and A. Zisserman. Very deep convolutional networks for large-scale image recognition. arXiv preprint arXiv:1409.1556, 2014. 2, 5<br />
[18] C. Szegedy, S. Ioffe, and V. Vanhoucke. Inception-v4, inception-resnet and the impact of residual connections on learning. CoRR, abs/1602.07261, 2016. 2<br />
[19] C. Szegedy, W. Liu, Y. Jia, P. Sermanet, S. Reed, D. Anguelov, D. Erhan, V. Vanhoucke, and A. Rabinovich. Going deeper with convolutions. CoRR, abs/1409.4842,2014. 5<br />
[20] B. Thomee, D. A. Shamma, G. Friedland, B. Elizalde, K. Ni, D. Poland, D. Borth, and L.-J. Li. Yfcc100m: The new data in multimedia research. Communications of the ACM, 59(2):64â€“73, 2016. 1</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆå…­ï¼‰åŸºäºæ·±åº¦å­¦ä¹ ç®—æ³•YOLOçš„è¡Œäººè½¦è¾†æ£€æµ‹â€”â€”è®ºæ–‡</title>
    <url>/2021/07/02/YOLO-paper/</url>
    <content><![CDATA[<p>ç‰¹åˆ«ç‰¹åˆ«æ°´çš„è®ºæ–‡ï¼Œæ•°æ®é›†å’Œæƒé‡æ™šç‚¹æ”¾åˆ°ä»“åº“é‡Œé¢</p>
<span id="more"></span>
<style>
article p{
    text-indent:2em
}
</style>
<h1 id="æ‘˜è¦"><a class="markdownIt-Anchor" href="#æ‘˜è¦"></a> æ‘˜è¦</h1>
<p>è¡Œäººã€è½¦è¾†æ£€æµ‹æ˜¯è‡ªåŠ¨é©¾é©¶ä¸­çš„ä¸€é¡¹é‡è¦æŠ€æœ¯ï¼Œå¯¹äºè¡Œäººã€è½¦è¾†æ£€æµ‹å¾€å¾€éœ€è¦è¾ƒé«˜çš„ç²¾ç¡®åº¦å’Œå®æ—¶æ€§ã€‚YOLOv5æ˜¯ä¸€ç§é€šç”¨çš„ç›®æ ‡æ£€æµ‹ç®—æ³•,ä½†å°†å…¶ä½¿ç”¨åˆ°è¡Œäººã€è½¦è¾†çš„ç›®æ ‡æ£€æµ‹æ—¶ï¼Œç”±äºè¡Œäººã€è½¦è¾†æ•°æ®é›†å­˜åœ¨ç€æ ·æœ¬ä¸å‡è¡¡å’Œå°ç›®æ ‡è¿‡å¤šçš„é—®é¢˜ï¼ŒYOLOv5ç®—æ³•å¾€å¾€éš¾ä»¥è¾¾åˆ°é¢„è®¡æ•ˆæœã€‚</p>
<p>æœ¬æ–‡æå‡ºäº†ä¸€ç§åŸºäºYOLOv5çš„æ”¹è¿›æ¨¡å‹ã€‚æœ¬æ–‡çš„ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼š</p>
<p>(1) é’ˆå¯¹æ•°æ®é›†æ ·æœ¬ä¸å‡è¡¡é—®é¢˜é‡‡ç”¨æ•°æ®å¢å¼ºå¯¹è¾“å…¥çš„å›¾åƒè¿›è¡Œé¢„å¤„ç†ã€‚</p>
<p>(2) é’ˆå¯¹YOLOv5å¯¹å¤§ç›®æ ‡åˆ†ç±»æ•ˆæœä¸ç†æƒ³é—®é¢˜ï¼Œå¯¹YOLOv5çš„ç½‘ç»œéª¨æ¶è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>(3) é’ˆå¯¹æ•°æ®é›†ä¸­å°ç›®æ ‡è¾ƒå¤šçš„é—®é¢˜ï¼Œå¯¹YOLOv5çš„ç‰¹å¾èåˆéƒ¨åˆ†è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>ç ”ç©¶ç»“æœè¡¨æ˜ï¼Œæ”¹è¿›åçš„æ¨¡å‹ä¿æŒå®æ—¶æ€§(150 FPS)çš„æƒ…å†µä¸‹ï¼Œå‡å€¼å¹³å‡ç²¾ç¡®åº¦ç›¸æ¯”åŸå§‹YOLOv5æ¨¡å‹ä»åŸæ¥çš„62%æå‡åˆ°äº†64.5%ï¼Œç²¾ç¡®ç‡ä»74.4%ä¸Šå‡åˆ°äº†75.8%ï¼Œå¬å›ç‡ä»55.4%ä¸Šå‡åˆ°56.6%ã€‚</p>
<p>ç›¸è¾ƒäºåŸå…ˆçš„æ¨¡å‹ï¼Œæ”¹è¿›åçš„YOLOv5æ¨¡å‹åœ¨å°ç›®æ ‡æ£€æµ‹ä¸Šä¼˜åŠ¿æ˜æ˜¾ï¼Œèƒ½åœ¨ä¿æŒYOLOv5æ£€æµ‹å®æ—¶æ€§çš„åŒæ—¶ï¼Œæé«˜å…¶å°å‹è¡Œäººè½¦è¾†çš„æ£€æµ‹å’Œåˆ†è¾¨æ•ˆæœã€‚</p>
<p><strong>å…³é”®è¯ï¼š</strong> YOLOv5ï¼›ç›®æ ‡æ£€æµ‹ï¼›è¡Œäººè½¦è¾†æ£€æµ‹</p>
<h1 id="abstract"><a class="markdownIt-Anchor" href="#abstract"></a> Abstract</h1>
<p>Pedestrian and vehicle detection is an important technology in automatic driving, which often requires high precision and real-time performance. YOLOV5 is a general object detection algorithm, but when it is applied to pedestrian and vehicle target detection, it is often difficult to achieve the expected results due to the problems of unbalanced samples and too many small targets in pedestrian and vehicle datasets.</p>
<p>This paper proposes an improved model based on YOLOV5. Followings are the main work in this paper:</p>
<p>(1) Data augmentation is used to preprocess the input image for the problem of unbalanced dataset samples.</p>
<p>(2) To solve the problem that YOLOV5â€™s classification effect on large targets is not ideal, the network skeleton of YOLOV5 is adjusted.</p>
<p>(3) Adjust the feature fusion part of YOLOV5 for the problem that there are many small targets in the data set.</p>
<p>The results show that when the improved model maintains real time (150 FPS), the mean average precision is improved from 62% to 64.5% compared with the original YOLOV5 model, the precision rate is increased from 74.4% to 75.8%, and the recall rate is increased from 55.4% to 56.6%.</p>
<p>Compared with the original model, the improved YOLOV5 model has obvious advantages in small target detection, which can improve the detection and resolution effect of small pedestrians and vehicles while maintaining the real-time detection of YOLOV5.</p>
<p><strong>Key words:</strong> yolov5; object detection; Pedestrian and vehicle detection</p>
<h1 id="ç»ªè®º"><a class="markdownIt-Anchor" href="#ç»ªè®º"></a> ç»ªè®º</h1>
<p>è¿‘å¹´æ¥ï¼Œå›½å†…å¤–å¤§é‡å‚å•†å®£å¸ƒè¦åˆ¶é€ è‡ªåŠ¨é©¾é©¶æ±½è½¦ï¼Œè€Œè‡ªåŠ¨é©¾é©¶ä¸­ä¸€é¡¹å…³ä¹ç”Ÿå‘½å®‰å…¨çš„é‡è¦æŠ€æœ¯å°±æ˜¯è¡Œäººå’Œè½¦è¾†æ£€æµ‹ã€‚æœ¬ç« å°†é¦–å…ˆä»‹ç»è¡Œäººã€è½¦è¾†æ£€æµ‹çš„ç ”ç©¶èƒŒæ™¯å’Œæ„ä¹‰ï¼Œéšåä»‹ç»ç›®æ ‡æ£€æµ‹çš„å›½å†…å¤–å‘å±•ç°çŠ¶ï¼Œæœ¬ç« æœ€åéƒ¨åˆ†å°†ä¼šè®²è¿°å…¨æ–‡ç»“æ„ã€‚</p>
<h2 id="ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰"><a class="markdownIt-Anchor" href="#ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰"></a> ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰</h2>
<p>ç›®æ ‡æ£€æµ‹(Object Detection)æ˜¯è®¡ç®—æœºè§†è§‰å’Œå›¾åƒå¤„ç†çš„ä¸€é¡¹åˆ†æ”¯æŠ€æœ¯ï¼Œå…¶ä¸»è¦ä»»åŠ¡æ˜¯åœ¨ä¸€å¹…æ•°å­—å›¾åƒä¸­æ­£ç¡®è¯†åˆ«å‡ºç›®æ ‡ç‰©ä½“çš„ä½ç½®å¹¶åˆ¤æ–­ç±»åˆ«ã€‚å¦‚å›¾1.1æ‰€ç¤ºï¼Œç›®æ ‡æ£€æµ‹ç®—æ³•éœ€è¦æ¡†é€‰å‡ºå›¾ç‰‡ä¸­çš„ç‰©ä½“ï¼Œå¹¶åˆ¤æ–­å‡ºæ¡†é€‰å‡ºçš„ç‰©ä½“æ˜¯äººè¿˜æ˜¯æ£’çƒæ£’ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image1.jpg" alt="å›¾ 1.1 ç›®æ ‡æ£€æµ‹ç®—æ³•å®ä¾‹" /></p>
<p>éšç€æˆ‘å›½äººæ°‘ç”Ÿæ´»æ°´å¹³çš„æ—¥æ¸æé«˜ï¼Œè¶Šæ¥è¶Šå¤šçš„å®¶åº­æ‹¥æœ‰æœºåŠ¨è½¦ï¼Œéšä¹‹è€Œæ¥çš„ä¾¿æ˜¯åŸå¸‚å†…çš„äº¤é€šç¯å¢ƒè¶Šæ¥è¶Šå¤æ‚ã€‚å°½ç®¡ç°åœ¨çš„è½¦è¾†é…å¤‡äº†æ—¥æ¸å®Œå–„çš„å®‰å…¨è®¾å¤‡å’Œé˜²æ’æŠ€æœ¯ï¼Œè¿‘ä¸¤å¹´çš„äº¤é€šäº‹æ•…çš„æ­»äº¡äººæ•°ä¾ç„¶å¾ˆé«˜<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup><sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>ã€‚æ­¤å¤–ï¼Œå›½å†…å¤–ä¸å°‘å…¬å¸ä¹Ÿå¼€å§‹é™†ç»­æ¨å‡ºè‡ªåŠ¨é©¾é©¶æ±½è½¦ï¼Œå¦‚æœè‡ªåŠ¨é©¾é©¶æŠ€æœ¯å¹¿æ³›è¿ç”¨è½¦è¾†ç³»ç»Ÿä¸Šï¼Œå°†ä¼šé¿å…è®¸å¤šæœ¬å¯ä»¥é¿å…çš„äº¤é€šäº‹æ•…ã€‚</p>
<p>åœ¨è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿä¸­å¯¹è¡Œäººå’Œè½¦è¾†çš„æ£€æµ‹æä¸ºå…³é”®ï¼Œå¦‚æœæ£€æµ‹é€Ÿåº¦æ…¢æˆ–è€…æ£€æµ‹æ•ˆæœå·®å°±å®¹æ˜“å¯¼è‡´äººèº«å®‰å…¨äº‹æ•…ã€‚è¡Œäººè½¦è¾†æ£€æµ‹éš¾ç‚¹åœ¨äºè¡Œäººåœ¨å›¾åƒä¸­åƒç´ è¾ƒå°ï¼Œéš¾ä»¥ä¿æŒé«˜å‡†ç¡®ç‡ï¼ŒåŒæ—¶è¿˜éš¾ä»¥å¿«é€Ÿå¯¹å…¶è¿›è¡Œæ£€æµ‹<sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup>ã€‚ä¼ ç»Ÿçš„å¯¹è¡Œäººè½¦è¾†æ£€æµ‹æ–¹æ³•å¾€å¾€æ˜¯ä½¿ç”¨äººå·¥æå–ç‰¹å¾çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œè¿™ç§æ–¹æ³•å¾€å¾€è®¡ç®—é‡è¾ƒå¤§ä¸”ç²¾åº¦è¾ƒä½ï¼Œæ— æ³•è¿ç”¨åœ¨éœ€è¦é«˜ç²¾åº¦å’Œé«˜å®æ—¶æ€§è¦æ±‚çš„è‡ªåŠ¨é©¾é©¶é¢†åŸŸã€‚å¾—ç›Šäºè¿‘å¹´æ¥GPUåŠ é€ŸæŠ€æœ¯å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„å‘å±•ï¼Œä½¿å¾—å¦‚ä»ŠåŸºäºæ·±åº¦å­¦ä¹ çš„è¡Œäººè½¦è¾†æ£€æµ‹èƒ½å¤Ÿè¾¾åˆ°é«˜ç²¾åº¦å’Œè¾ƒå¥½çš„å®æ—¶æ€§ï¼Œæœ‰æ•ˆçš„æ”¹å–„ä¼ ç»Ÿæ–¹æ³•çš„æ•ˆç‡ä½ä¸‹é—®é¢˜ï¼Œèƒ½å¤Ÿæ›´å¥½çš„é¿å…äº¤é€šäº‹æ•…çš„å‘ç”Ÿã€‚</p>
<h2 id="å›½å†…å¤–ç ”ç©¶ç°çŠ¶"><a class="markdownIt-Anchor" href="#å›½å†…å¤–ç ”ç©¶ç°çŠ¶"></a> å›½å†…å¤–ç ”ç©¶ç°çŠ¶</h2>
<p>åœ¨è¿‡å»20å¤šå¹´é‡Œï¼Œç›®æ ‡æ£€æµ‹ç»å†äº†ä¸¤ä¸ªæ—¶æœŸï¼Œä¸€ä¸ªæ˜¯2014å¹´å‰çš„ä¼ ç»Ÿç›®æ ‡æ£€æµ‹æ¢ç´¢æ—¶æœŸï¼Œè€Œå¦ä¸€ä¸ªæ˜¯2014å¹´åçš„åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹æ—¶æœŸ<sup class="footnote-ref"><a href="#fn3" id="fnref3:1">[3:1]</a></sup>ã€‚</p>
<h3 id="ä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•"><a class="markdownIt-Anchor" href="#ä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•"></a> ä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•</h3>
<p>åœ¨2014å¹´å‰ï¼Œç›®æ ‡æ£€æµ‹ç®—æ³•ä½¿ç”¨çš„éƒ½æ˜¯ä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚ä¼ ç»Ÿçš„ç›®æ ‡æ£€æµ‹ç®—æ³•å¤§å¤šå¯ä»¥åˆ†ä¸ºä»¥ä¸‹3æ­¥ã€‚é¦–å…ˆé€šè¿‡æ»‘åŠ¨çª—å£ç­‰æ–¹æ³•ç©·ä¸¾å¯èƒ½å«æœ‰ç›®æ ‡ç‰©ä½“çš„å›¾åƒåŒºåŸŸï¼›ç„¶åä½¿ç”¨æ–¹å‘æ¢¯åº¦ç›´æ–¹å›¾(Histograms of Oriented Gradientsï¼ŒHOG)<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>å’Œå°ºåº¦ä¸å˜ç‰¹å¾å˜æ¢(Scale-invariant feature transformï¼ŒSIFT)<sup class="footnote-ref"><a href="#fn5" id="fnref5">[5]</a></sup>ç­‰ç‰¹å¾æå–ç®—æ³•å¯¹å›¾åƒåŒºåŸŸè¿›è¡Œç‰¹å¾æå–è¿ç®—ï¼Œå¾—åˆ°ç›®æ ‡çš„ç‰¹å¾ï¼›æœ€åå°†æå–åˆ°çš„ç‰¹å¾é€å…¥æ”¯æŒå‘é‡æœº(Support Vector Machineï¼ŒSVM)<sup class="footnote-ref"><a href="#fn6" id="fnref6">[6]</a></sup>ã€adaboost<sup class="footnote-ref"><a href="#fn7" id="fnref7">[7]</a></sup>ç­‰åˆ†ç±»ç®—æ³•ä¸­è®¡ç®—å¾—åˆ°åˆ†ç±»ç»“æœ<sup class="footnote-ref"><a href="#fn3" id="fnref3:2">[3:2]</a></sup>ã€‚</p>
<p>è¿™äº›ä¼ ç»Ÿç›®æ ‡æ£€æµ‹æ–¹æ³•é€šå¸¸éƒ½æ˜¯éœ€è¦æ‰‹å·¥è®¾è®¡ç‰¹å¾æå–ï¼Œè€Œä¸”è¦æ±‚è°ƒè¯•è€…æœ‰ç†Ÿç»ƒçš„è°ƒè¯•ç»éªŒï¼Œç›¸æ¯”äºåé¢å‡ºç°çš„åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œä¼ ç»Ÿç®—æ³•ç‰¹å¾æå–ç›¸å¯¹å¤æ‚ï¼Œä¸”æ£€æµ‹çš„å‡†ç¡®ç‡ä¸å¦‚åè€…ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¼ ç»Ÿç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­çš„æ»‘åŠ¨çª—å£ã€å›°éš¾æ ·æœ¬æŒ–æ˜å’Œè¾¹ç•Œæ¡†å›å½’ç­‰æ€æƒ³ä¾ç„¶å½±å“äº†åç»­çš„ç›®æ ‡æ£€æµ‹ç®—æ³•<sup class="footnote-ref"><a href="#fn3" id="fnref3:3">[3:3]</a></sup>ã€‚</p>
<h3 id="åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ç®—æ³•"><a class="markdownIt-Anchor" href="#åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ç®—æ³•"></a> åŸºäºæ·±åº¦å­¦ä¹ çš„ç›®æ ‡æ£€æµ‹ç®—æ³•</h3>
<p>åœ¨2012å¹´çš„ImageNetç«èµ›ä¸Šï¼ŒHintonç­‰äººä½¿ç”¨åŸºäºå·ç§¯ç¥ç»ç½‘ç»œ(convolutional neural networkï¼ŒCNN)ç»“æ„çš„AlexNet<sup class="footnote-ref"><a href="#fn8" id="fnref8">[8]</a></sup>è·å¾—äº†å† å†›ï¼Œå…¶é”™è¯¯ç‡æ¯”ç¬¬äºŒåä½äº†10.8%ï¼Œåˆ†ç±»æ•ˆæœè¿œè¶…ç¬¬äºŒåã€‚è¿™ä½¿å¾—å­¦è€…ä»¬é‡æ–°å¯¹å·ç§¯ç¥ç»ç½‘ç»œäº§ç”Ÿäº†å…´è¶£ï¼Œå¹¶è€ƒè™‘å°†å·ç§¯ç¥ç»ç½‘ç»œçš„åˆ†ç±»ç»“æœè¿ç”¨åˆ°ç›®æ ‡æ£€æµ‹ä¸Šé¢ã€‚</p>
<p>åœ¨2014å¹´Ross Girshick æå‡ºçš„R-CNN(Regions with CNN features)<sup class="footnote-ref"><a href="#fn9" id="fnref9">[9]</a></sup>æ˜¯ç¬¬ä¸€ä¸ªåŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„ç›®æ ‡æ£€æµ‹ç®—æ³•ã€‚å…¶å°†ä¼ ç»Ÿç®—æ³•ä¸­çš„äººå·¥æå–ç‰¹å¾éƒ¨åˆ†æ¢æˆäº†ä½¿ç”¨CNNæå–ï¼Œæé«˜äº†æ£€æµ‹ç²¾åº¦ã€‚ç”±äºR-CNNä¸­ä¼ ç»Ÿå€™é€‰æ¡†æœç´¢ç®—æ³•ç©·ä¸¾å€™é€‰åŒºåŸŸè¾ƒæ…¢ï¼ŒGirshickç­‰äººéšåä¾¿æå‡ºäº†Fast R-CNN<sup class="footnote-ref"><a href="#fn10" id="fnref10">[10]</a></sup>å’ŒFaster R-CNN<sup class="footnote-ref"><a href="#fn11" id="fnref11">[11]</a></sup>ã€‚åœ¨Faster R-CNN<sup class="footnote-ref"><a href="#fn11" id="fnref11:1">[11:1]</a></sup>ä¸­ä½¿ç”¨å€™é€‰åŒºåŸŸç”Ÿæˆç½‘ç»œ(Region Proposal Networkï¼ŒRPN)æ›¿ä»£äº†åŸå…ˆçš„é€‰æ‹©æ€§æœç´¢ç®—æ³•ï¼Œå†ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œå¯¹ç”Ÿæˆçš„å€™é€‰æ¡†ä¸­çš„ç‰©ä½“è¿›è¡Œåˆ†ç±»è¯†åˆ«ã€‚</p>
<p>è¿™ç±»ç®—æ³•å› ä¸ºå°†ç›®æ ‡æ£€æµ‹åˆ†ä¸ºå€™é€‰æ¡†æå–å’Œç›®æ ‡åˆ†ç±»ä¸¤ä¸ªæ¨¡å—ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºtwo-stageç®—æ³•ï¼Œå…¶ä»£è¡¨çš„ç½‘ç»œæœ‰R-CNNç³»åˆ—ã€SPP Netå’ŒPyramid Networkç­‰ã€‚two-stageæ–¹æ³•è™½ç„¶ç²¾åº¦è¾ƒé«˜ï¼Œä½†æ˜¯æ£€æµ‹é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚ä»¥Faster R-CNNä¸ºä¾‹ï¼Œè™½ç„¶å…¶èƒ½å¤Ÿåœ¨PASCAL VOC 2012ä¸Šå–å¾—70.4%çš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦ï¼Œä½†æ˜¯å…¶åœ¨GPUä¸Šæ¨ç†é€Ÿåº¦ä¸º5 FPS<sup class="footnote-ref"><a href="#fn11" id="fnref11:2">[11:2]</a></sup>ã€‚é™¤äº†two-stageç®—æ³•ï¼Œè¿˜æœ‰ä¸€äº›ç®—æ³•å°†å€™é€‰æ¡†åæ ‡å›å½’å’Œåˆ†ç±»å’Œä¸ºä¸€æ­¥é¢„æµ‹ï¼Œè¿™ç§ç®—æ³•ä¹Ÿè¢«ç§°ä¸ºone-stageç®—æ³•ã€‚</p>
<p>åœ¨2016å¹´ï¼ŒRedmonæå‡ºçš„YOLO(You Only Look Once)<sup class="footnote-ref"><a href="#fn12" id="fnref12">[12]</a></sup>ç®—æ³•æ˜¯ç¬¬ä¸€ç§one-stageç®—æ³•ã€‚å…¶ç‰¹ç‚¹æ˜¯å°†åªæ˜¯ç”¨ä¸€ä¸ªç½‘ç»œå®Œæˆç›®æ ‡æ£€æµ‹ï¼Œåœ¨ä¿è¯æ£€æµ‹ç²¾åº¦çš„åŒæ—¶è¿ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œåœ¨PASCAL VOC 2012æ£€æµ‹ä»»åŠ¡ä¸ŠYOLOçš„FPSè¾¾åˆ°45 FPSï¼Œè€Œä¸”å‡å€¼å¹³å‡ç²¾ç¡®åº¦è¾¾åˆ°63.4%ï¼Œç²¾åº¦ç•¥å¾®ä½äºFaster R-CNN<sup class="footnote-ref"><a href="#fn12" id="fnref12:1">[12:1]</a></sup>ã€‚å…¶ä¸»è¦æ€æƒ³æ˜¯å°†å›¾åƒåˆ†ä¸ºå¤šä¸ªç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼é¢„æµ‹å«æœ‰è¾¹ç•Œæ¡†åæ ‡ä¿¡æ¯ã€ç½®ä¿¡åº¦å’Œæ¯ä¸ªç±»åˆ«çš„æ¡ä»¶æ¦‚ç‡çš„å‘é‡ï¼Œå°†ç›®æ ‡æ£€æµ‹é—®é¢˜è½¬æ¢ä¸ºå›å½’é—®é¢˜ã€‚åœ¨2017å¹´ï¼ŒRedmonæå‡ºäº†YOLOv2<sup class="footnote-ref"><a href="#fn13" id="fnref13">[13]</a></sup>ç½‘ç»œï¼Œå°†Faster R-CNNä¸­çš„å…ˆéªŒé”šæ¡†æœºåˆ¶å’Œç½‘ä¸­ç½‘(Network in Networkï¼ŒNIN)<sup class="footnote-ref"><a href="#fn14" id="fnref14">[14]</a></sup>ä¸­çš„å…¨å±€å¹³å±€æ± åŒ–ç­‰ç»“æ„åŠ å…¥YOLOv1ç½‘ç»œã€‚ä½¿å…¶ä¸å†ç›´æ¥é¢„æµ‹ç›®æ ‡åæ ‡è€Œæ˜¯é¢„æµ‹ç›®æ ‡ä¸é”šæ¡†ä¹‹é—´çš„åå·®ï¼Œé™ä½äº†è®­ç»ƒéš¾åº¦ï¼Œæé«˜äº†ç½‘ç»œçš„å¬å›ç‡ã€‚åœ¨2018å¹´æå‡ºçš„YOLOv3<sup class="footnote-ref"><a href="#fn15" id="fnref15">[15]</a></sup>ä¸­åŠ å…¥äº†ç‰¹å¾é‡‘å­—å¡”å’Œæ®‹å·®å—ç»“æ„ï¼Œå¢åŠ äº†å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœã€‚åœ¨YOLOv3å‘å¸ƒåï¼ŒYOLOç³»åˆ—ä¸€ä»£åˆ°ä¸‰ä»£çš„åŸä½œè€…Redmonå®£å¸ƒå› ä¸ºæ— æ³•å¿½è§†è‡ªå·±ç ”ç©¶å¸¦æ¥çš„è´Ÿé¢å½±å“ï¼Œå†³å®šé€€å‡ºè®¡ç®—æœºè§†è§‰é¢†åŸŸã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨2020å¹´YOLOç¤¾åŒºçš„å‚ä¸è€…Alexey Bochkovskiyæ¥æ‰‹äº†YOLOé¡¹ç›®å¹¶å‘è¡¨äº†YOLOv4<sup class="footnote-ref"><a href="#fn16" id="fnref16">[16]</a></sup>ã€‚åœ¨YOLOv4ä¸­ä½œè€…å¼•å…¥äº†å¤§é‡è®­ç»ƒæŠ€å·§å’Œç»“æ„æ”¹è¿›ï¼Œå¦‚CSPç»“æ„ã€CIoU lossã€Mishæ¿€æ´»å‡½æ•°ç­‰ç­‰ï¼Œæå¤§çš„æå‡äº†ç½‘ç»œçš„æ€§èƒ½ã€‚YOLOv4è¯ç”Ÿåä¸ä¹…ï¼ŒUltralyticså…¬å¸å‘å¸ƒäº†è‡ªå·±çš„YOLOç‰ˆæœ¬å¹¶å‘½åä¸ºYOLOv5ã€‚è¯¥ç‰ˆæœ¬åœ¨ç¤¾åŒºä¸­æœ‰ä¸€å®šçš„äº‰è®®ï¼Œåœ¨æœ¬æ–‡ä¸­ä¸ä¼šå¯¹æ­¤è¿›è¡Œè®¨è®ºã€‚YOLOv5ç›¸è¾ƒYOLOv4è€Œè¨€è¿˜æ˜¯æœ‰å°‘è®¸æ”¹è¿›ï¼Œå…¶æ–°å¢äº†é©¬èµ›å…‹æ•°æ®å¢åŠ ã€Focusæ¨¡å—ã€è‡ªåŠ¨é”šæ¡†è®¡ç®—ç­‰ã€‚YOLOv5ä¿è¯äº†æ¨¡å‹ç²¾åº¦çš„åŒæ—¶ï¼Œè¿ç®—é€Ÿåº¦æ›´å¿«ï¼Œæ¨¡å‹æƒé‡çš„å¤§å°ç›¸å¯¹äºYOLOv4è€Œè¨€æ›´å°ã€‚</p>
<h3 id="ç ”ç©¶ç°çŠ¶å°ç»“"><a class="markdownIt-Anchor" href="#ç ”ç©¶ç°çŠ¶å°ç»“"></a> ç ”ç©¶ç°çŠ¶å°ç»“</h3>
<p>æ ¹æ®ä¸Šè¿°ç›®æ ‡æ£€æµ‹ç®—æ³•çš„åˆ†æï¼Œå¯ä»¥æ ¹æ®ä½¿ç”¨çš„æ–¹æ³•å°†ç›®æ ‡æ£€æµ‹ç®—æ³•å¤§è‡´åˆ’åˆ†ä¸º3ç±»ï¼Œç»“æœå¦‚å›¾1.2æ‰€ç¤ºã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image2.png" alt="å›¾ 1.2 ç›®æ ‡æ£€æµ‹ç®—æ³•æ€»ç»“" /></p>
<h2 id="æœ¬æ–‡ç ”ç©¶å†…å®¹å’Œç»„ç»‡ç»“æ„"><a class="markdownIt-Anchor" href="#æœ¬æ–‡ç ”ç©¶å†…å®¹å’Œç»„ç»‡ç»“æ„"></a> æœ¬æ–‡ç ”ç©¶å†…å®¹å’Œç»„ç»‡ç»“æ„</h2>
<p>å¦‚å‰æ–‡æ‰€è¿°ï¼Œä¼ ç»Ÿæ–¹æ³•çš„ç²¾åº¦è¾ƒå·®ï¼Œè€ŒR-CNNç³»åˆ—ç®—æ³•è™½ç„¶æœ‰è¾ƒé«˜ç²¾åº¦ï¼Œä½†æ˜¯é€Ÿåº¦æ— æ³•æ»¡è¶³è¦æ±‚ã€‚å› æ­¤æœ¬æ–‡å°†ä½¿ç”¨YOLOv5ç®—æ³•å¯¹è¡Œäººå’Œè½¦è¾†æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°è¡Œäººè½¦è¾†æ£€æµ‹æ¨¡å‹ã€‚è¯¥æ¨¡å‹å¯ä»¥å¯¹è¡Œäºº(person)ã€è‡ªè¡Œè½¦(bike)ã€æœºåŠ¨è½¦(car)ã€æ‘©æ‰˜è½¦(motor)ã€å…¬äº¤è½¦(bus)å’Œå¡è½¦(truck)å…±å…­ä¸ªç±»åˆ«è¿›è¡Œæ£€æµ‹ã€‚</p>
<p>åŒæ—¶é’ˆå¯¹æ•°æ®é›†å’Œæ¨¡å‹åˆ†æï¼Œå¯¹YOLOv5çš„æ¨¡å‹æå‡ºäº†æ”¹è¿›æ€è·¯ï¼Œå¹¶å¯¹æ”¹è¿›æ€è·¯è¿›è¡Œå®éªŒï¼Œä»¥å‡å€¼å¹³å‡ç²¾ç¡®åº¦ä¸ºæŒ‡æ ‡è¯„ä»·ç½‘ç»œçš„æ”¹è¿›ç»“æœã€‚å…·ä½“æ”¹è¿›å†…å®¹å¦‚ä¸‹ï¼š</p>
<p>(1)ã€åŸºäºå¯¹YOLOv5ç½‘ç»œçš„ç†è§£å’Œå®é™…ç»“æœï¼Œå¯¹YOLOv5çš„éª¨æ¶æå‡ºæ”¹è¿›æ€è·¯</p>
<p>(2)ã€åŸºäºä¸Šè¿°å¯¹YOLOv5çš„ç†è§£ï¼Œå¯¹YOLOv5çš„é¢ˆéƒ¨éƒ¨åˆ†çš„è·¯å¾„èšåˆç½‘ç»œæå‡ºäº†æ”¹è¿›æ€è·¯ã€‚</p>
<p>æœ¬æ–‡å„ç« èŠ‚å…·ä½“å†…å®¹å®‰æ’å¦‚ä¸‹ï¼š</p>
<p>ç¬¬ä¸€ç«  ç»ªè®ºã€‚ä»‹ç»äº†è¡Œäººè½¦è¾†æ£€æµ‹çš„ç ”ç©¶èƒŒæ™¯å’Œé‡è¦æ€§ï¼Œå¼•å‡ºäº†ç›®æ ‡æ£€æµ‹çš„å‘å±•ã€‚ç®€è¦çš„ä»‹ç»äº†ä¼ ç»Ÿæ–¹æ³•å’ŒåŸºäºæ·±åº¦å­¦ä¹ çš„æ–¹æ³•ã€‚</p>
<p>ç¬¬äºŒç«  YOLOç®—æ³•åŸç†ç®€ä»‹ã€‚ä¸»è¦ä»‹ç»äº†å·ç§¯ç¥ç»ç½‘ç»œçš„ç›¸å…³åŸºç¡€çŸ¥è¯†ã€YOLOv5ç½‘ç»œçš„ç»“æ„å’Œç®—æ³•æµç¨‹ä»¥åŠå¯¹ç®—æ³•çš„è¯„åˆ¤æŒ‡æ ‡ã€‚</p>
<p>ç¬¬ä¸‰ç«  YOLOç®—æ³•åˆ†æåŠæ”¹è¿›ã€‚å¯¹è¡Œäººè½¦è¾†æ£€æµ‹æ•°æ®é›†å’ŒYOLOv5æ¨¡å‹çš„åˆ†æã€‚å¹¶é’ˆå¯¹æ•°æ®é›†çš„ç‰¹ç‚¹å’ŒYOLOv5åœ¨è¯¥æ•°æ®é›†ä¸Šçš„ç¼ºé™·æå‡ºæ”¹è¿›æªæ–½ã€‚</p>
<p>ç¬¬å››ç«  å®éªŒåˆ†æã€‚è¿™ä¸€éƒ¨åˆ†ä¸»è¦è®²è¿°äº†æœ¬æ¬¡å®éªŒçš„è¿è¡Œç»“æœä»¥åŠé’ˆå¯¹è¡Œäººè½¦è¾†æ•°æ®é›†çš„æ”¹è¿›æ–¹æ¡ˆå’ŒåŸæœ¬YOLOv5ä¹‹é—´çš„æ£€æµ‹æ•ˆæœå¯¹æ¯”ã€‚</p>
<p>ç¬¬äº”ç«  æ€»ç»“ä¸å±•æœ›ã€‚æ€»ç»“äº†YOLOv5æ”¹è¿›æ¨¡å‹çš„ä¼˜ç¼ºç‚¹ï¼Œé˜è¿°æœªæ¥çš„æ”¹è¿›æ–¹å‘ã€‚</p>
<h1 id="yoloç®—æ³•åŸç†"><a class="markdownIt-Anchor" href="#yoloç®—æ³•åŸç†"></a> YOLOç®—æ³•åŸç†</h1>
<p>YOLOæ˜¯ä¸€ç§å·ç§¯ç¥ç»ç½‘ç»œï¼Œç›¸è¾ƒäºä¼ ç»Ÿç¥ç»ç½‘ç»œï¼Œå·ç§¯ç¥ç»ç½‘ç»œèƒ½å¤Ÿæ›´å¥½çš„æå–ç‰¹å¾ï¼ŒåŒæ—¶è¿˜èƒ½å‡å°‘æ¨¡å‹å‚æ•°ã€‚æœ¬ç« é¦–å…ˆä»‹ç»äº†å·ç§¯ç¥ç»ç½‘ç»œçš„ç»„æˆéƒ¨åˆ†å’ŒåŸç†ã€‚ç„¶åå¯¹YOLOv5ç½‘ç»œç»“æ„è¿›è¡Œåˆ†æï¼Œå¹¶ä»‹ç»äº†å…¶æ£€æµ‹æµç¨‹ã€‚æœ€åä»‹ç»äº†æ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡ã€‚</p>
<h2 id="å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°"><a class="markdownIt-Anchor" href="#å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°"></a> å·ç§¯ç¥ç»ç½‘ç»œæ¦‚è¿°</h2>
<p>ä¼ ç»Ÿå…¨è¿æ¥ç¥ç»ç½‘ç»œè™½ç„¶åœ¨ä¸€äº›ä»»åŠ¡ä¸Šæœ‰å¾ˆå¥½çš„è¡¨ç°ï¼Œä½†æ˜¯å…¶ä½¿ç”¨çš„å…¨è¿æ¥å±‚ä¼šå¯¼è‡´å‚æ•°è¿‡å¤§ï¼Œåœ¨å›¾åƒå¤„ç†ä¸Šè¿™é¡¹ç¼ºç‚¹æä¸ºæ˜æ˜¾ã€‚ä»¥æœ¬æ–‡åç»­ä½¿ç”¨çš„æ¨¡å‹ä¸ºä¾‹ï¼Œè¾“å…¥çš„å›¾åƒå°ºå¯¸ä¼šç¼©æ”¾åˆ°640Ã—640Ã—3ï¼Œå¦‚æœå°†å…¶ä½œä¸ºå…¨è¿æ¥ç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼Œä»…ä»…è¾“å…¥å±‚ä¸­çš„ä¸€ä¸ªç¥ç»å…ƒçš„æƒé‡å°±æœ‰640Ã—640Ã—3=1228800ä¸ªï¼Œä»¥floatå½¢å¼ä¿å­˜å°±æœ‰çº¦4.9 MBçš„å¤§å°ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸€é¡¹å·¨å¤§çš„å¼€é”€ã€‚ä»¥VGGç½‘ç»œçš„è¾“å…¥3é€šé“è¾“å‡º96é€šé“ï¼Œå·ç§¯æ ¸å¤§å°ä¸º3Ã—3çš„å·ç§¯å±‚ä¸ºä¾‹ï¼Œå…¶æƒé‡ä¸ªæ•°ä¸º3Ã—3Ã—3Ã—96=2592ä¸ªï¼Œæ˜æ˜¾å°‘äºå…¨è¿æ¥ç½‘ç»œã€‚å¾—ç›Šäºå·ç§¯è®¡ç®—çš„æƒé‡å…±äº«å’Œå±€éƒ¨æ„Ÿå—é‡çš„ç‰¹ç‚¹ï¼Œå·ç§¯ç¥ç»ç½‘ç»œå‚æ•°çš„æ•°é‡è¿œå°‘äºä¼ ç»Ÿå…¨è¿æ¥ç½‘ç»œã€‚</p>
<p>1962å¹´ç”Ÿç‰©å­¦å®¶HuBelå’ŒWieselåŸºäºå¯¹çŒ«çš„è§†è§‰çš®å±‚ç¥ç»å…ƒçš„ç ”ç©¶æå‡ºäº†æ„Ÿå—é‡çš„æ¦‚å¿µ<sup class="footnote-ref"><a href="#fn17" id="fnref17">[17]</a></sup>ã€‚1980å¹´æ—¥æœ¬å­¦è€…FukushimaåŸºäºHuBelçš„ç ”ç©¶æå‡ºäº†å·ç§¯å±‚ã€æ± åŒ–å±‚ç»“æ„<sup class="footnote-ref"><a href="#fn18" id="fnref18">[18]</a></sup>ã€‚éšååœ¨1998å¹´LeCunåŸºäºå‰äººçš„ç ”ç©¶è®¾è®¡äº†ç¬¬ä¸€ä¸ªå·ç§¯ç¥ç»ç½‘ç»œLeNet-5å¹¶è¿ç”¨åœ¨äº†è¯†åˆ«æ”¯ç¥¨ä¸Šçš„æ‰‹å†™æ•°å­—<sup class="footnote-ref"><a href="#fn19" id="fnref19">[19]</a></sup>ã€‚ä½†æ˜¯å—é™äºå½“å¹´æœ‰é™çš„è®¡ç®—æœºèµ„æºå’ŒSVMç®—æ³•çš„å…´èµ·ï¼Œå·ç§¯ç¥ç»ç½‘ç»œæ…¢æ…¢æ·¡å‡ºäº†äººä»¬çš„è§†é‡ã€‚ç›´åˆ°2012å¹´çš„ImageNetæ¯”èµ›ä¸ŠAlexNet<sup class="footnote-ref"><a href="#fn8" id="fnref8:1">[8:1]</a></sup>çš„ä»¥æå¤§çš„ä¼˜åŠ¿å‡»è´¥äº†å…¶ä»–ä¼ ç»Ÿç®—æ³•ï¼Œå·ç§¯ç¥ç»ç½‘ç»œæ‰é‡æ–°æ´»è·ƒåœ¨äººä»¬çš„çœ¼å‰ã€‚</p>
<p>å·ç§¯ç¥ç»ç½‘ç»œé€šå¸¸ç”±è¾“å…¥å±‚ã€å·ç§¯å±‚ã€æ¿€æ´»å‡½æ•°ã€æ± åŒ–å±‚ã€å…¨è¿æ¥å±‚å’Œè¾“å‡ºå±‚æ„æˆ<sup class="footnote-ref"><a href="#fn20" id="fnref20">[20]</a></sup>ã€‚è¿™å‡ ä¸ªéƒ¨åˆ†ä¼šåœ¨åç»­å°èŠ‚ä¸­è¿›è¡Œè®²è§£ã€‚</p>
<h3 id="å·ç§¯å±‚"><a class="markdownIt-Anchor" href="#å·ç§¯å±‚"></a> å·ç§¯å±‚</h3>
<p>å·ç§¯å±‚çš„åå­—æ¥æºäºæ•°å­—ä¿¡å·å¤„ç†ä¸­çš„å·ç§¯æ“ä½œï¼ŒäºŒç»´å·ç§¯çš„å…¬å¼å¦‚å¼2.1æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>âˆ—</mo><mi>h</mi><mo stretchy="false">(</mo><mi>m</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>âˆ‘</mo><mi>i</mi><mi mathvariant="normal">âˆ</mi></munderover><munderover><mo>âˆ‘</mo><mi>j</mi><mi mathvariant="normal">âˆ</mi></munderover><mi>x</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">)</mo><mi>h</mi><mo stretchy="false">(</mo><mi>m</mi><mo>âˆ’</mo><mi>i</mi><mo separator="true">,</mo><mi>n</mi><mo>âˆ’</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">y(m,n)=x(m,n)*h(m,n)=\sum_{i}^{\infty}\sum_{j}^{\infty}x(i,j)h(m-i,n-j) \tag{2.1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000007em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:3.0651740000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å·ç§¯å±‚æ˜¯å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„åŸºç¡€æ¨¡å—ï¼Œä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å¯¹è¾“å…¥è¿›è¡Œç‰¹å¾æå–ã€‚å·ç§¯å±‚æ˜¯ç”±å¤šä¸ªç‰¹å¾å›¾ç»„æˆçš„ï¼Œä¸å…¨è¿æ¥ä¸åŒçš„æ˜¯ï¼Œç‰¹å¾å›¾ä¸­çš„æ¯ä¸€ä¸ªç¥ç»å…ƒé€šè¿‡å·ç§¯æ ¸ä¸Šä¸€å±‚æ˜¯å±€éƒ¨è¿æ¥çš„ã€‚å·ç§¯æ ¸å°±æ˜¯ä¸€ä¸ªå¤§å°ä¸º<em>N</em>çš„æƒå€¼æ–¹é˜µï¼Œå…¶æƒå€¼åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è‡ªè¡Œå­¦ä¹ ï¼Œä¸ºäº†ç¡®ä¿å·ç§¯æ ¸æœ‰ä¸€ä¸ªä¸­å¿ƒç‚¹ï¼ŒåŒæ—¶æ–¹ä¾¿å¯¹ç‰¹å¾å›¾è¿›è¡Œå¡«å……ï¼Œ<em>N</em>é€šå¸¸å–å¥‡æ•°ã€‚å·ç§¯æ“ä½œå°±æ˜¯ä½¿ç”¨ä¸€ä¸ªæ»‘åŠ¨çª—å£ä»¥ä¸€å®šæ­¥é•¿åœ¨å›¾åƒä¸Šæ»‘åŠ¨ï¼Œå¹¶å¯¹çª—å£å†…çš„ç‰¹å¾è¿›è¡ŒåŠ æƒæ±‚å’Œæ“ä½œï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ–°çš„è¾“å‡ºã€‚ä¸€èˆ¬è®¤ä¸ºCNNç»“æ„ä¸­è¶Šæ¥è¿‘è¾“å‡ºçš„å·ç§¯å±‚è¾“å‡ºçš„æ˜¯ä¸€äº›æ›´ä¸ºæŠ½è±¡çš„é«˜çº§ç‰¹å¾ï¼Œå› æ­¤èƒ½æ¯”äººä¸ºè®¾è®¡çš„æ»¤æ³¢å™¨æœ‰æ›´å¥½çš„æå–ç‰¹å¾èƒ½åŠ›ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image3.png" alt="å›¾ 2.1 å·ç§¯çš„æ“ä½œè¿‡ç¨‹" /></p>
<p>å›¾2.1ä¸ºå·ç§¯æ ¸çš„è¿ç®—è¿‡ç¨‹ï¼Œ<em>Input</em>è¡¨ç¤ºè¾“å…¥çš„ç‰¹å¾å›¾ï¼Œæ•°å­—ä¸ºåƒç´ ç‚¹çš„å€¼ï¼Œå…¶ä¸­é»„è‰²çš„éƒ¨åˆ†è¡¨ç¤ºå·ç§¯æ ¸çš„å…³æ³¨åŒºåŸŸã€‚å›¾ä¸­çš„<em>kernel</em>è¡¨ç¤ºäº†ä¸€ä¸ªå°ºå¯¸ä¸º3Ã—3çš„å·ç§¯æ ¸ï¼Œå…¶ä¸­ç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºå·ç§¯æ ¸çš„æƒé‡ã€‚å›¾ä¸­å³ä¾§çš„<em>output</em>è¡¨ç¤ºç»è¿‡å·ç§¯è¿ç®—åçš„è¾“å‡ºï¼Œå…¶é»„è‰²åŒºåŸŸè¡¨ç¤ºçš„å°±æ˜¯å·ç§¯çš„è¿ç®—ç»“æ„ã€‚å›¾2.1ä¸­çš„å·ç§¯çš„è¾“å‡ºå¦‚å¼2.2æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>o</mi><mi>u</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>t</mi><mo>=</mo><mn>2</mn><mo>âˆ—</mo><mo>âˆ’</mo><mn>1</mn><mo>+</mo><mn>1</mn><mo>âˆ—</mo><mn>0</mn><mo>+</mo><mn>0</mn><mo>âˆ—</mo><mn>1</mn><mo>+</mo><mn>9</mn><mo>âˆ—</mo><mo>âˆ’</mo><mn>1</mn><mo>+</mo><mn>5</mn><mo>âˆ—</mo><mn>0</mn><mo>+</mo><mn>4</mn><mo>âˆ—</mo><mn>1</mn><mo>+</mo><mn>2</mn><mo>âˆ—</mo><mo>âˆ’</mo><mn>1</mn><mo>+</mo><mn>3</mn><mo>âˆ—</mo><mn>0</mn><mo>+</mo><mn>4</mn><mo>âˆ—</mo><mn>1</mn><mo>=</mo><mo>âˆ’</mo><mn>5</mn></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.2)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">output = 2*-1+1*0+0*1+9*-1+5*0+4*1+2*-1+3*0+4*1=-5 \tag{2.2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">p</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">âˆ’</span><span class="mord">5</span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>ç‰¹å¾å›¾åœ¨é€šè¿‡å·ç§¯æ“ä½œåï¼Œè¾“å‡ºçš„å°ºå¯¸ä¸è¾“å…¥ä¸åŒ¹é…ï¼Œå¦‚æœéœ€è¦ä¸¤è€…åŒ¹é…ï¼Œåˆ™éœ€è¦å¯¹è¾“å…¥ç‰¹å¾å›¾çš„å‘¨å›´å¡«å……é›¶ã€‚ç»è¿‡å·ç§¯æ“ä½œåçš„è¾“å…¥å’Œè¾“å‡ºçš„é•¿å®½å…³ç³»å¦‚å¼2.3æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><msup><mi>w</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mfrac><mrow><mi>w</mi><mo>âˆ’</mo><mi>n</mi><mo>+</mo><mn>2</mn><mi>p</mi></mrow><mi>s</mi></mfrac><mo>+</mo><mn>1</mn></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.3)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">w&#x27;=\frac{w-n+2p}{s}+1 \tag{2.3}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathdefault">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span><span class="tag"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>w</mi><mo mathvariant="normal">â€²</mo></msup></mrow><annotation encoding="application/x-tex">w&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.751892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span></span></span></span>ä¸ºè¾“å‡ºç‰¹å¾å›¾çš„å®½åº¦ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>ä¸ºè¾“å…¥ç‰¹å¾å›¾çš„å®½åº¦ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>ä¸ºå·ç§¯æ ¸çš„å°ºå¯¸ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span>ä¸ºå¡«å……<em>padding</em>å³å¯¹è¾“å…¥è¿›è¡Œé›¶å¡«å……çš„å¤§å°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">s</span></span></span></span>ä¸ºå·ç§¯çª—å£æ»‘åŠ¨çš„æ­¥é•¿ã€‚</p>
<p>ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨äº†å·ç§¯å±‚çš„ä¼˜ç‚¹å¦‚ä¸‹</p>
<p>(1)ã€å‡å°‘ç½‘ç»œå‚æ•°ã€‚å·ç§¯æ ¸åœ¨å¯¹ä¸€ä¸ªè¾“å…¥çš„ä¸åŒåŒºåŸŸè¿›è¡Œå·ç§¯è¿ç®—çš„æ—¶å€™ï¼Œå·ç§¯æ ¸å†…å‚æ•°æ˜¯å›ºå®šçš„ã€‚å› æ­¤å¯ä»¥çœ‹ä½œæ˜¯å…±äº«äº†æƒé‡å’Œåç½®ï¼Œä»è€Œå‡å°‘äº†ç½‘ç»œçš„å‚æ•°é‡ã€‚</p>
<p>(2)ã€æ›´å¼ºçš„æŠ½è±¡èƒ½åŠ›ã€‚ç›¸è¾ƒäºäººå·¥è®¾è®¡çš„å·ç§¯æ»¤æ³¢å™¨ï¼ŒåŸºäºæ·±åº¦å­¦ä¹ çš„å·ç§¯æ»¤æ³¢å™¨å¯ä»¥åœ¨è®­ç»ƒä¸­è‡ªå·±å­¦ä¹ æƒé‡ï¼Œèƒ½å¤Ÿæå–åˆ°æ›´æŠ½è±¡çš„ç‰¹å¾ã€‚</p>
<h3 id="æ¿€æ´»å‡½æ•°"><a class="markdownIt-Anchor" href="#æ¿€æ´»å‡½æ•°"></a> æ¿€æ´»å‡½æ•°</h3>
<p>å·ç§¯å±‚ï¼Œæ± åŒ–å±‚å’Œå…¨è¿æ¥å±‚éƒ½å¯ä»¥çœ‹ä½œæ˜¯å¯¹è¾“å…¥çš„çº¿æ€§åŠ æƒæ±‚å’Œã€‚å½“å¤šä¸ªå·ç§¯å±‚ã€æ± åŒ–å±‚ã€å…¨è¿æ¥å±‚è¿æ¥æ—¶ï¼Œéƒ½å¯ä»¥å°†å…¶è§†ä¸ºå¯¹è¾“å…¥çš„çº¿æ€§ç»„åˆï¼Œè¿™æ ·æ— è®ºç½‘ç»œæœ‰å¤šæ·±ï¼Œéƒ½ä¸å•å±‚çº¿æ€§ç»„åˆæ²¡æœ‰åŒºåˆ«ã€‚å› æ­¤ç½‘ç»œä¸­éœ€è¦åŠ å…¥éçº¿æ€§çš„æ¿€æ´»å‡½æ•°ï¼Œé¿å…ç½‘ç»œåªæ˜¯å•çº¯çš„çº¿æ€§ç»„åˆã€‚ç›®å‰å¸¸è§çš„æ¿€æ´»å‡½æ•°æœ‰sigmoidã€ReLUã€Mishç­‰ï¼Œä¸‹æ–‡å°†å¯¹è¿™å‡ ç§æ¿€æ´»å‡½æ•°è¿›è¡Œä»‹ç»<sup class="footnote-ref"><a href="#fn20" id="fnref20:1">[20:1]</a></sup>ã€‚</p>
<p>(1)ã€sigmoidï¼Œå…¶å…¬å¼å¦‚å¼2.4æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.4)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">f(x)=\frac{1}{1+e^{-x}} \tag{2.4}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">4</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>sigmoidçš„ä¼˜ç‚¹æ˜¯å¯ä»¥å°†è¾“å‡ºè½¬æ¢ä¸º0åˆ°1ä¹‹é—´çš„å®æ•°ï¼Œç¼ºç‚¹æ˜¯è¾“å‡ºçš„å‡å€¼ä¸ä¸º0ï¼Œä½¿å¾—ç½‘ç»œæ”¶æ•›é€Ÿåº¦æ…¢ï¼Œç‰¹å®šæƒ…å†µä¸‹è¿˜ä¼šæœ‰æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ã€‚</p>
<p>(2)ã€tanhï¼Œå…¶å…¬å¼å¦‚å¼2.5æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msup><mi>e</mi><mi>x</mi></msup><mo>âˆ’</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow><mrow><msup><mi>e</mi><mi>x</mi></msup><mo>+</mo><msup><mi>e</mi><mrow><mo>âˆ’</mo><mi>x</mi></mrow></msup></mrow></mfrac></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.5)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">f(x)=\frac{e^x-e^{-x}}{e^x+e^{-x}} \tag{2.5}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.217661em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.448331em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.590392em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.697331em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.771331em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height:2.217661em;vertical-align:-0.7693300000000001em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">5</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>tanhçš„ä¼˜ç‚¹æ˜¯è§£å†³äº†sigmoidçš„è¾“å‡ºå‡å€¼åç§»çš„é—®é¢˜ï¼Œç„¶è€Œå­˜åœ¨æ¢¯åº¦æ¶ˆå¤±é—®é¢˜<sup class="footnote-ref"><a href="#fn21" id="fnref21">[21]</a></sup>ã€‚</p>
<p>(3)ã€ReLUï¼Œå…¶å…¬å¼å¦‚å¼2.6æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.6)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">f(x)=max(0,x) \tag{2.6}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">6</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>ReLUçš„ä¼˜ç‚¹æ˜¯æ­£åŒºé—´å†…è§£å†³äº†æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚ä½†æ˜¯è¾“å‡ºçš„å‡å€¼ä¾ç„¶ä¸ä¸º0ã€‚æ­¤å¤–ReLUæ¿€æ´»å‡½æ•°è¿˜å­˜åœ¨æ­»åŒºï¼Œå³å½“è¾“å…¥åœ¨è´ŸåŒºé—´æ—¶ï¼Œç¥ç»å…ƒè¾“å‡ºä¸º0ï¼Œå¯¼è‡´åå‘ä¼ æ’­æ—¶ä¸Šä¸€å±‚çš„ç¥ç»å…ƒæƒé‡å‚æ•°æ— æ³•æ›´æ–°<sup class="footnote-ref"><a href="#fn21" id="fnref21:1">[21:1]</a></sup>ã€‚</p>
<p>(4)ã€Leaky ReLUï¼Œå…¶å…¬å¼å¦‚å¼2.7æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mi>a</mi><mi>x</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.7)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">f(x)=max(ax,x) \tag{2.7}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">7</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å¼ä¸­aå¯ä»¥æ ¹æ®å®é™…æ•°æ®è°ƒæ•´ï¼Œé€šå¸¸æƒ…å†µä¸‹aå–0.01ã€‚Leaky ReLUçš„ä¼˜ç‚¹æ˜¯è´ŸåŒºé—´å†…ä»ç„¶æœ‰å°‘é‡çš„è¾“å‡ºï¼Œä½¿å¾—è¾“å…¥åœ¨è´ŸåŒºé—´å†…æ—¶ï¼Œä¸Šä¸€å±‚çš„ç¥ç»å…ƒæƒé‡ä¾ç„¶å¯ä»¥æ›´æ–°ã€‚</p>
<p>(5)ã€Mishï¼šå…¶å…¬å¼å¦‚å¼2.8æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mo>âˆ—</mo><mi>t</mi><mi>a</mi><mi>n</mi><mi>h</mi><mo stretchy="false">(</mo><mi>l</mi><mi>n</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msup><mi>e</mi><mi>x</mi></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.8)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">f(x)=x*tanh(ln(1+e^x)) \tag{2.8}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">h</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7143919999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">8</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>Mishæ˜¯æ–°æå‡ºçš„æ¿€æ´»å‡½æ•°ï¼ŒMishä¼˜ç‚¹æ˜¯æ¯”è¾ƒå¹³æ»‘æœ‰è¾ƒå¥½çš„æ³›åŒ–èƒ½åŠ›å’Œæ€»ç»“èƒ½åŠ›ï¼Œç¼ºç‚¹æ˜¯è®¡ç®—ç›¸å¯¹ReLUè¾ƒä¸ºå¤æ‚ã€‚</p>
<h3 id="æ± åŒ–å±‚"><a class="markdownIt-Anchor" href="#æ± åŒ–å±‚"></a> æ± åŒ–å±‚</h3>
<p>æ± åŒ–å±‚ä¹Ÿè¢«ç§°ä¸ºä¸‹é‡‡æ ·å±‚ï¼Œé€šå¸¸è·Ÿåœ¨å·ç§¯å±‚åé¢ï¼Œä¸»è¦åŠŸèƒ½æ˜¯é™ç»´ã€‚å·ç§¯è¾“å‡ºçš„ç‰¹å¾å›¾ä¸­ç›¸é‚»åƒç´ æ˜¯å‡ ä¹ä¸€æ ·çš„ï¼Œåªæœ‰åœ¨ç›®æ ‡çš„è¾¹ç¼˜éƒ¨åˆ†åƒç´ å˜åŒ–æ˜æ˜¾ï¼Œå¦‚æœå¯ä»¥å»é™¤è¿™äº›å†—ä½™éƒ¨åˆ†ï¼Œå°±å¯ä»¥æ˜æ˜¾çš„å‡å°‘ç½‘ç»œå‚æ•°é‡ã€‚æ± åŒ–å±‚çš„ä½œç”¨å°±æ˜¯é™ä½è¾“å‡ºç‰¹å¾å›¾çš„ç»´åº¦ä»è€Œè¾¾åˆ°å‡å°‘ç½‘ç»œå‚æ•°ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿä¿ç•™ç‰¹å¾å›¾ä¸­æœ€é‡è¦çš„ä¿¡æ¯ã€‚æ± åŒ–æŒ‰ç…§è®¡ç®—æ–¹å¼å¤§è‡´å¯ä»¥åˆ†ä¸ºæœ€å¤§æ± åŒ–å’Œå‡å€¼æ± åŒ–ã€‚æ± åŒ–çš„è®¡ç®—æ–¹æ³•ä¸å·ç§¯çš„è®¡ç®—æ–¹æ³•æ¯”è¾ƒç›¸ä¼¼ã€‚ä»¥æœ€å¤§æ± åŒ–ä¸ºä¾‹ï¼Œæ± åŒ–å±‚ä¼šä½¿ç”¨ä¸€ä¸ªæ»‘åŠ¨çª—å£ä»¥ä¸€å®šæ­¥é•¿åœ¨ç‰¹å¾å›¾ä¸Šæ»‘åŠ¨ï¼Œå¹¶å¯¹æ¯ä¸ªçª—å£ä¸­çš„åƒç´ æ±‚æœ€å¤§å€¼ä½œä¸ºè¾“å‡ºã€‚ä¸å·ç§¯ä¸åŒçš„æ˜¯ï¼Œæ± åŒ–å±‚ä¸åŒ…å«ä»»ä½•å‚æ•°ï¼Œå› æ­¤ä¸ä¼šå½±å“æ¨¡å‹å¤§å°ã€‚</p>
<p>å›¾2.2è¡¨ç¤ºäº†ä¸€ä¸ªæœ€å¤§æ± åŒ–çš„æ“ä½œè¿‡ç¨‹ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªçª—å£å¤§å°ä¸º2Ã—2ï¼Œæ­¥é•¿ä¸º2çš„æœ€å¤§æ± åŒ–å±‚ï¼ŒåŒæ—¶åœ¨å·¦ä¾§å®šä¹‰æœ€å¤§æ± åŒ–å±‚çš„è¾“å…¥ï¼Œé»„è‰²ã€è“è‰²ã€çº¢è‰²å’Œç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯æ± åŒ–çª—å£è¦†ç›–çš„åŒºåŸŸï¼Œå³ä¾§ä¸ºæœ€å¤§æ± åŒ–å±‚çš„è¾“å‡ºï¼Œä¸åŒé¢œè‰²åŒºåŸŸä»£è¡¨ä¸åŒçª—å£çš„è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æœ€å¤§æ± åŒ–å±‚é€‰æ‹©äº†ä¸åŒçª—å£çš„æœ€å¤§åƒç´ å€¼ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image4.png" alt="å›¾ 2.2 æœ€å¤§æ± åŒ–å±‚çš„æ“ä½œè¿‡ç¨‹" /></p>
<p>ç¥ç»ç½‘ç»œä¸­ä½¿ç”¨æ± åŒ–å±‚çš„ä¼˜ç‚¹æœ‰ï¼š</p>
<p>(1)ã€å»é™¤ç‰¹å¾å›¾ä¸­çš„å†—ä½™ä¿¡æ¯ï¼Œä¿ç•™å…¶ä¸­å…³é”®ä¿¡æ¯ï¼Œå‡å°‘ç½‘ç»œçš„å‚æ•°å’Œè®¡ç®—é‡ã€‚</p>
<p>(2)ã€å¢åŠ ç½‘ç»œçš„é²æ£’æ€§ï¼Œå½“ç›¸é‚»åƒç´ å‘ç”Ÿå¾®å°çš„æ”¹å˜çš„æ—¶å€™å¹¶ä¸å½±å“ç½‘ç»œçš„æœ€ç»ˆè¾“å‡ºã€‚</p>
<h3 id="å…¨è¿æ¥å±‚"><a class="markdownIt-Anchor" href="#å…¨è¿æ¥å±‚"></a> å…¨è¿æ¥å±‚</h3>
<p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œç»“æ„çš„æœ€åéƒ¨åˆ†ï¼Œé€šå¸¸è¿æ¥ç€ä¸€ä¸ªæˆ–è€…å¤šä¸ªå…¨è¿æ¥å±‚ä»¥è¾¾åˆ°ä¸€ä¸ª&quot;åˆ†ç±»å™¨&quot;çš„æ•ˆæœã€‚å…¨è¿æ¥å±‚çš„ç»“æ„ä¸ä¼ ç»Ÿçš„å¤šå±‚æ„ŸçŸ¥å™¨ç±»ä¼¼ï¼Œæ¯ä¸€ä¸ªç¥ç»å…ƒéƒ½ä¸ä¸Šä¸€å±‚çš„æ‰€æœ‰ç¥ç»å…ƒè¿æ¥ï¼Œå› æ­¤ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯å¯¹å·ç§¯å±‚æå–åˆ°çš„å±€éƒ¨ä¿¡æ¯è¿›è¡Œæ•´åˆã€‚ä¸ºäº†å¢å¼ºå…¨è¿æ¥å±‚çš„æ‹Ÿåˆèƒ½åŠ›ï¼Œé€šå¸¸ä¼šåœ¨æ¯ä¸ªç¥ç»å…ƒåé¢éƒ½ä¼šæ·»åŠ ä¸€ä¸ªéçº¿æ€§çš„æ¿€æ´»å‡½æ•°ï¼Œé¿å…ç½‘ç»œåªæ˜¯å•çº¯çš„çº¿æ€§æ‹Ÿåˆ<sup class="footnote-ref"><a href="#fn20" id="fnref20:2">[20:2]</a></sup>ã€‚</p>
<p>è™½ç„¶å…¨è¿æ¥å±‚æœ‰ç€å¾ˆå¥½çš„æ‹Ÿåˆæ•ˆæœï¼Œä½†æ˜¯åœ¨ç¥ç»ç½‘ç»œè®­ç»ƒæ—¶æœŸï¼Œå…¨è¿æ¥å±‚å®¹æ˜“äº§ç”Ÿè¿‡æ‹Ÿåˆé—®é¢˜ï¼Œå³è®­ç»ƒå®Œæˆçš„æ¨¡å‹æ— æ³•åœ¨å…¶ä»–çš„åœºåˆä¸‹æ³›ç”¨åŒ–ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜é€šå¸¸éœ€è¦åœ¨è®­ç»ƒæ—¶æœŸåŠ ä¸Šdropoutå±‚ï¼Œä½¿å…¶åœ¨è®­ç»ƒæ—¶éšæœºéšè—ä¸€äº›ç¥ç»å…ƒèŠ‚ç‚¹ï¼Œä»è€Œè¾¾åˆ°é˜²æ­¢è¿‡æ‹Ÿåˆçš„æ•ˆæœã€‚æ­¤å¤–å…¨è¿æ¥å±‚å› ä¸ºæ¯ä¸ªç¥ç»å…ƒéƒ½è¦ä¸å‰åä¸¤å±‚çš„ç¥ç»å…ƒå®Œå…¨è¿æ¥ï¼Œå› æ­¤éœ€è¦çš„å‚æ•°è¾ƒå¤šï¼Œä¹Ÿæ˜¯å¯¼è‡´æ¨¡å‹å¤§çš„åŸå› ä¹‹ä¸€ã€‚åœ¨NINä¸­ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæå‡ºäº†å…¨å±€å¹³å‡æ± åŒ–å±‚æ¥æ›¿ä»£å…¨è¿æ¥å±‚ï¼Œå³å¯¹æœ€åä¸€ä¸ªå·ç§¯å±‚è¾“å‡ºçš„æ¯ä¸€ä¸ªç‰¹å¾å›¾æ±‚å¹³å‡å€¼ï¼Œå¾—åˆ°çš„å‘é‡å°±æ˜¯è¾“å‡ºï¼Œå› ä¸ºæ± åŒ–å±‚æ²¡æœ‰å‚æ•°éœ€è¦ä¼˜åŒ–ï¼Œæ‰€ä»¥å¤§å¤§çš„å‡å°‘äº†ç½‘ç»œçš„å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†å…¨è¿æ¥å±‚å®¹æ˜“å‡ºç°æ¨¡å‹è¿‡æ‹Ÿåˆçš„é—®é¢˜<sup class="footnote-ref"><a href="#fn14" id="fnref14:1">[14:1]</a></sup>ã€‚</p>
<h2 id="yoloç½‘ç»œæ¦‚è¿°"><a class="markdownIt-Anchor" href="#yoloç½‘ç»œæ¦‚è¿°"></a> YOLOç½‘ç»œæ¦‚è¿°</h2>
<p>ä»¥R-CNNç³»åˆ—ç®—æ³•ä¸ºä»£è¡¨çš„two-stageç®—æ³•å°†ç›®æ ‡æ£€æµ‹åˆ†å¤šä¸ªæ­¥éª¤æ¥å®ç°ï¼Œå…ˆæ˜¯å¯»æ‰¾å‡ºå¯èƒ½å«æœ‰ç‰©ä½“çš„å€™é€‰æ¡†ï¼Œç„¶åå†å¯¹å€™é€‰æ¡†è¿›è¡Œåæ ‡å›å½’å’Œç›®æ ‡åˆ†ç±»ã€‚two-stageç®—æ³•çš„æ¯ä¸ªæ­¥éª¤ä¸­æ‰€ä½¿ç”¨çš„æ¨¡å—éƒ½éœ€è¦å•ç‹¬è®­ç»ƒï¼Œè€Œä¸”å¯»æ‰¾å¯èƒ½å«æœ‰ç‰©ä½“çš„å€™é€‰æ¡†ä¸€æ­¥å› ä¸ºéœ€è¦å¤§é‡å¯»æ‰¾è€Œè€—è´¹äº†å¤§é‡æ—¶é—´ã€‚å› æ­¤ï¼Œè™½ç„¶R-CNNç³»åˆ—ç®—æ³•çš„ç²¾åº¦å¾ˆé«˜ï¼Œä½†æ˜¯å…¶æ£€æµ‹é€Ÿåº¦å¾ˆæ…¢ã€‚YOLOç³»åˆ—ç®—æ³•åˆ™æ˜¯é‡‡å–äº†ç«¯åˆ°ç«¯çš„æ€è·¯ï¼Œç›´æ¥å°†å€™é€‰æ¡†é¢„æµ‹å’Œåˆ†ç±»åˆåœ¨ä¸€æ­¥å®Œæˆï¼Œå°†ç›®æ ‡æ£€æµ‹é—®é¢˜è½¬åŒ–æˆäº†å›å½’é—®é¢˜ï¼Œè¿™æ ·åšè™½ç„¶ä½¿å¾—æ£€æµ‹ç»“æœçš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦ç•¥å¾®æœ‰æ‰€ä¸‹é™ï¼Œä½†æ˜¯æ£€æµ‹é€Ÿåº¦æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<h3 id="yolov5ç½‘ç»œç»“æ„"><a class="markdownIt-Anchor" href="#yolov5ç½‘ç»œç»“æ„"></a> YOLOv5ç½‘ç»œç»“æ„</h3>
<p>å›¾2.3ä¸ºYOLOv5sæ¨¡å‹çš„ç½‘ç»œç»“æ„ï¼Œå›¾ä¸­å·¦ä¸Šè§’çš„çº¢ç»¿è“ä¸‰è‰²æ–¹å—ä»£è¡¨å›¾åƒè¾“å…¥ï¼Œåœ¨YOLOv5ä¸­å›¾åƒçš„è¾“å…¥å¤§å°ä¸ºå›ºå®šçš„640Ã—640Ã—3ã€‚å·¦ä¾§ç¬¬ä¸€åˆ—ä¸ºYOLOv5ç½‘ç»œçš„éª¨æ¶ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯å¯¹å›¾åƒè¿›è¡Œç‰¹å¾æå–ï¼Œæœ€å³ä¾§çš„ä¸‰ä¸ªçº¢è‰²æ¨¡å—ä¸ºYOLOçš„è¾“å‡ºéƒ¨åˆ†ï¼Œä¹Ÿè¢«ç§°ä¸ºYOLOç®—æ³•çš„å¤´ï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯è®¡ç®—ç½‘ç»œçš„è¾“å‡ºã€‚ä¸­é—´çš„ä¸¤åˆ—æ˜¯è¿‘å‡ å¹´æ¥ç›®æ ‡æ£€æµ‹ç®—æ³•æ·»åŠ åœ¨ç½‘ç»œéª¨æ¶å’Œå¤´ä¹‹é—´çš„é¢ˆéƒ¨éƒ¨åˆ†ï¼Œå…¶ä½œç”¨æ˜¯å°†ä¸åŒå°ºåº¦çš„ç‰¹å¾è¿›è¡Œèåˆï¼Œé€šå¸¸ç”±ç‰¹å¾é‡‘å­—å¡”æˆ–è€…è·¯å¾„èšåˆç½‘ç»œ(Path Aggregation Networkï¼ŒPAN)ç»„æˆï¼Œåœ¨YOLOv5ä¸­ä½¿ç”¨çš„æ˜¯è·¯å¾„èšåˆç½‘ç»œï¼Œå³åœ¨åŸæœ¬è‡ªä¸‹å‘ä¸Šçš„ç‰¹å¾é‡‘å­—å¡”ä¸Šå†åŠ ä¸Šä¸€å±‚è‡ªä¸Šå‘ä¸‹çš„ç‰¹å¾èåˆè·¯å¾„<sup class="footnote-ref"><a href="#fn22" id="fnref22">[22]</a></sup>ã€‚åœ¨å›¾ä¸­ï¼Œ640Ã—640Ã—3è¡¨ç¤ºè¾“å…¥å›¾ç‰‡é•¿å®½ä¸º640Ã—640çš„RGBå½©å›¾ã€‚å››ä¸ªå‚æ•°çš„æ¨¡å—å¦‚Focusã€CBLã€YOLOä¸­ï¼Œå„ä¸ªå‚æ•°åˆ†åˆ«ä»£äº†è¾“å…¥é€šé“æ•°ã€è¾“å‡ºé€šé“æ•°ã€å†…æ ¸å¤§å°å’Œæ­¥é•¿ã€‚å«æœ‰åŒå‚æ•°çš„æ¨¡å—å¦‚C3ï¼Œå„ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨äº†è¾“å…¥é€šé“æ•°å’Œè¾“å‡ºé€šé“æ•°ã€‚å•ä¸ªå‚æ•°çš„æ¨¡å—å¦‚SPPã€Concatã€Upsampleç­‰ï¼Œå…¶å‚æ•°åˆ™ä»£è¡¨äº†è¾“å‡ºçš„é€šé“æ•°ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image5.png" alt="å›¾ 2.3 YOLOv5sæ¨¡å‹ç»“æ„" /></p>
<p>å›¾2.3ä¸­çš„ç²‰è‰²æ¨¡å—ä¸ºYOLOv5ä¸­çš„å·ç§¯å±‚åŸºæœ¬å•å…ƒCBLï¼Œå…¶ç»“æ„å¦‚å›¾2.4æ‰€ç¤ºã€‚CæŒ‡ä»£çš„æ˜¯å·ç§¯å±‚ï¼Œå…¶è®¡ç®—å¦‚ä¸Šä¸€èŠ‚æ‰€è¿°ã€‚Bä»£è¡¨æ‰¹æ¬¡å½’ä¸€åŒ–(Batch Normalizationï¼ŒBN)ï¼Œå…¶ä½œç”¨æ˜¯å°†ä¸€ä¸ªæ‰¹æ¬¡å†…çš„å·ç§¯å±‚çš„è¾“å‡ºå½’ä¸€åŒ–åˆ°å‡å€¼ä¸ºé›¶ï¼Œæ–¹å·®ä¸ºä¸€çš„èŒƒå›´å†…ï¼Œå°†ç½‘ç»œæ­£åˆ™åŒ–ï¼Œè¿™ä½¿å¾—ç½‘ç»œèƒ½å¤Ÿé¿å…è¿‡æ‹Ÿåˆï¼ŒåŒæ—¶è¿˜èƒ½å¸®åŠ©ç½‘ç»œæ›´å¿«çš„è¾¾åˆ°æ•ˆæœæœ€å¥½çš„ç‚¹ï¼Œå‡å°‘ç½‘ç»œè®­ç»ƒæ—¶é—´ã€‚Lä»£è¡¨Leaky ReLUæ¿€æ´»å‡½æ•°ï¼Œä½œç”¨æ˜¯å¼•å…¥éçº¿æ€§å‡½æ•°ï¼Œä»¥å¢å¼ºç½‘ç»œçš„è¡¨å¾èƒ½åŠ›ã€‚åœ¨YOLOv5ç½‘ç»œä¸­å•ç‹¬ä½¿ç”¨CBLæ¨¡å—ä¸»è¦æ˜¯ä¸ºäº†å®Œæˆå¯¹ç½‘ç»œçš„ä¸‹é‡‡æ ·æ“ä½œã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image6.png" alt="å›¾ 2.4 CBLæ¨¡å—ç»“æ„" /></p>
<p>å›¾2.3ä¸­çš„æµ…ç»¿è‰²çš„æ¨¡å—ä¸ºFocusæ¨¡å—ï¼Œå…¶ç»“æ„å¦‚å›¾2.5æ‰€ç¤ºã€‚Focuså±‚çš„åšæ³•æ˜¯å°†è¾“å…¥çš„å›¾ç‰‡æ¯éš”ä¸€ä¸ªåƒç´ å–ä¸€ä¸ªå€¼ï¼Œåšåˆ°å°†è¾“å…¥å›¾ç‰‡åˆ‡ç‰‡æˆå››ä»½ï¼Œç„¶ååœ¨é€šé“ç»´åº¦ä¸Šå°†å››å¼ å›¾æ‹¼æ¥èµ·æ¥ã€‚è¿™ç­‰ä»·äºåœ¨æ²¡æœ‰ä»»ä½•ä¿¡æ¯æŸå¤±çš„æƒ…å†µä¸‹å¯¹å›¾åƒä¸‹é‡‡æ ·å¤„ç†ï¼ŒåŒæ—¶å‡å°‘äº†ç½‘ç»œçš„å‚æ•°é‡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image7.png" alt="å›¾ 2.5 Focusæ¨¡å—ç»“æ„" /></p>
<p>å›¾2.3ä¸­æ·¡è“è‰²æ¨¡å—ä¸ºC3æ¨¡å—ï¼Œå…¶ç»“æ„å¦‚å›¾2.6æ‰€ç¤ºã€‚å…¶ä¸­çº¢è‰²çš„æ®‹å·®å•å…ƒ(Res Unit)ç»“æ„å¦‚å›¾2.7æ‰€ç¤ºã€‚æ®‹å·®å—ç»“æ„æ˜¯åœ¨æ®‹å·®ç½‘ç»œä¸­æå‡ºçš„ï¼Œå…¶ç»“æ„å°±æ˜¯å°†ç½‘ç»œçš„è¾“å…¥æ·»åŠ åˆ°ç½‘ç»œçš„è¾“å‡ºéƒ¨åˆ†ï¼Œè§£å†³äº†ä¼ ç»Ÿå·ç§¯ç¥ç»ç½‘ç»œéšç€ç½‘ç»œæ·±åº¦çš„å¢åŠ ç½‘ç»œèƒ½åŠ›é€€åŒ–çš„é—®é¢˜ï¼Œæ­¤å¤–ä½¿ç”¨æ®‹å·®ç»“æ„ä¹Ÿæœ‰åŠ©äºè§£å†³æ·±å±‚ç¥ç»ç½‘ç»œä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸ç­‰é—®é¢˜ã€‚åœ¨å›¾2.3ä¸­ï¼ŒC3ä¸­çš„å‚æ•°(128ï¼Œ128)Ã—3ï¼Œå…¶è¡¨ç¤ºçš„æ„æ€æ˜¯C3ç»“æ„çš„è¾“å…¥é€šé“æ•°ä¸º128ï¼Œè¾“å‡ºé€šé“æ•°ä¸º128ï¼ŒC3æ¨¡å—ä¸­å«æœ‰3ä¸ªæ®‹å·®å•å…ƒï¼Œè€Œ(64ï¼Œ64)ä»£è¡¨è¾“å…¥å’Œè¾“å‡ºæ¨¡å—çš„é€šé“çš„ä¸ªæ•°éƒ½ä¸º64ï¼ŒC3æ¨¡å—ä¸­åªæœ‰1ä¸ªæ®‹å·®å•å…ƒã€‚C3æ¨¡å—æ˜¯YOLOv5å¯¹äºè·¨é˜¶çº§å±€éƒ¨è¿æ¥(Cross-stage partial connectionsï¼ŒCSP)ç»“æ„çš„ä¸€ç§æ”¹è¿›ï¼ŒCSPæ¨¡å—å°†è¾“å…¥çš„ç‰¹å¾å›¾åˆ†ä¸ºä¸¤éƒ¨åˆ†è®¡ç®—ï¼Œä½¿å¾—æ¢¯åº¦èƒ½å¤Ÿé€šè¿‡ä¸åŒçš„è·¯å¾„ä¼ æ’­ï¼Œä»è€Œè·å¾—æ›´å¤šçš„æ¢¯åº¦ç»„åˆã€‚æ­¤å¤–ï¼Œå› ä¸ºCSPç»“æ„ä¸­åªæœ‰ä¸€åŠçš„ç‰¹å¾å›¾è¿›å…¥äº†æ®‹å·®å•å…ƒè¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥ç½‘ç»œçš„è®¡ç®—é‡æ˜æ˜¾å‡å°‘ã€‚C3æ¨¡å—æ¯”YOLOv4ä¸­çš„CSPæ¨¡å—å°‘äº†ä¸€ä¸ªå·ç§¯å±‚ï¼Œä½¿å…¶è®¡ç®—é‡æ›´å°ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image8.png" alt="å›¾ 2.6 C3æ¨¡å—ç»“æ„" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image9.png" alt="å›¾ 2.7 æ®‹å·®å—ç»“æ„" /></p>
<p>å›¾2.3ä¸­çš„æ·±ç»¿è‰²æ¨¡å—ä¸ºç©ºé—´é‡‘å­—å¡”æ± åŒ–å±‚(Spatial Pyramid Poolingï¼ŒSPP)ã€‚å…¶ç»“æ„å¦‚å›¾2.8æ‰€ç¤ºï¼Œå…¶ä¸­ç»¿è‰²çš„ä¸ºæœ€å¤§æ± åŒ–å±‚ã€‚SPPå±‚ä½¿ç”¨ä¸åŒå°ºå¯¸å’Œæ­¥é•¿æœ€å¤§æ± åŒ–çš„å±‚ï¼Œå°†å›¾åƒè¿›è¡Œå‹ç¼©ï¼Œå¹¶æ‹¼æ¥é€šé“æ•°ï¼Œæé«˜äº†ç½‘ç»œçš„æ„Ÿå—é‡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image10.png" alt="å›¾ 2.8 SPPç»“æ„" /></p>
<p>å›¾2.3ä¸­æ·±è“è‰²æ¨¡å—ä¸ºupsampleå±‚ï¼Œä¸Šé‡‡æ ·ä½¿å¾—ç‰¹å¾å›¾çš„ç»´åº¦å¾—ä»¥å¢åŠ ã€‚åœ¨YOLOv5ä¸­ä¸Šé‡‡æ ·ä½¿ç”¨ç›¸é‚»å€¼å¡«å……çš„æ–¹æ³•ä½¿ç‰¹å¾å›¾çš„ç»´åº¦æ”¾å¤§ä¸€å€ï¼Œä½¿å…¶èƒ½å¤Ÿä¸éœ€è¦æ‹¼æ¥çš„ç‰¹å¾å›¾åœ¨ç»´åº¦ä¸ŠåŒ¹é…ã€‚å›¾2.3ä¸­çš„æ©™è‰²æ¨¡å—ä¸ºconcatå±‚ï¼Œåœ¨YOLOv5å…¶ä½œç”¨æ˜¯å°†ç‰¹å¾å›¾æŒ‰ç…§é€šé“æ•°æ‹¼æ¥èµ·æ¥ï¼Œå› æ­¤éœ€è¦å…¶è¾“å…¥çš„ç‰¹å¾å›¾çš„ç»´åº¦è¦ä¸€è‡´ã€‚å›¾2.3ä¸­çš„çº¢è‰²æ¨¡å—ä¸ºYOLOå±‚ï¼Œå…¶ä½œç”¨æ˜¯è´Ÿè´£å¯¹è¾“å…¥çš„ç‰¹å¾å›¾è¿›è¡Œé¢„æµ‹ã€‚åœ¨YOLOv5ä¸­ä¸€å…±ç”±ä¸‰å¼ ç‰¹å¾å›¾è´Ÿè´£è¾“å‡ºé¢„æµ‹ç»“æœï¼Œå…¶ä¸­å¤§å°ºåº¦ç‰¹å¾å›¾çš„å°ºå¯¸ä¸º80Ã—80ï¼Œä¸»è¦ç”¨äºé¢„æµ‹å°ç›®æ ‡ã€‚ä¸­ç­‰å°ºåº¦çš„ç‰¹å¾å›¾å°ºå¯¸ä¸º40Ã—40ï¼Œä¸»è¦ç”¨äºé¢„æµ‹ä¸­ç­‰ç›®æ ‡ã€‚å°å°ºåº¦ç‰¹å¾å›¾å°ºå¯¸20Ã—20ï¼Œä¸»è¦ç”¨äºé¢„æµ‹å¤§ç›®æ ‡ã€‚</p>
<h3 id="yoloæ£€æµ‹æµç¨‹"><a class="markdownIt-Anchor" href="#yoloæ£€æµ‹æµç¨‹"></a> YOLOæ£€æµ‹æµç¨‹</h3>
<p>YOLOç®—æ³•åœ¨äº‹å…ˆå°±å¯¹æ•°æ®é›†æ ‡ç­¾ä¸­çš„æ‰€æœ‰è¾¹ç•Œæ¡†è¿›è¡Œk-meansèšç±»è¿ç®—ï¼Œè·å–èšç±»çš„è´¨å¿ƒä½œä¸ºé”šæ¡†(anchor)ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯å°†å›¾åƒåˆ’åˆ†æˆSÃ—Sä¸ªç½‘æ ¼ï¼Œåæ˜ åˆ°å®é™…ä¸­å°±æ˜¯è¾“å‡ºç‰¹å¾å›¾çš„å¤§å°ã€‚æ¯ä¸ªç½‘æ ¼è´Ÿè´£é¢„æµ‹ä¸­å¿ƒè½åœ¨å…¶ä¸­çš„ç‰©ä½“ã€‚æ¯ä¸ªç½‘æ ¼é¢„æµ‹Bä¸ªè¾¹ç•Œæ¡†ï¼Œæ¯ä¸ªè¾¹ç•Œæ¡†åŒ…å«äº†ç›®æ ‡ç›¸å¯¹äºç½‘æ ¼ä¸­å¿ƒåæ ‡çš„åå·®ä»¥åŠè¾¹ç•Œæ¡†å’Œé”šæ¡†é•¿å®½ä¹‹é—´çš„åå·®å’Œè¾¹ç•Œæ¡†çš„ç½®ä¿¡åº¦ã€‚ç½®ä¿¡åº¦çš„è®¡ç®—å…¬å¼å¦‚å¼2.8æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>f</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>=</mo><msub><mi>P</mi><mi>r</mi></msub><mo stretchy="false">(</mo><mi>O</mi><mi>b</mi><mi>j</mi><mi>e</mi><mi>c</mi><mi>t</mi><mo stretchy="false">)</mo><mo>âˆ—</mo><mi>I</mi><mi>o</mi><msubsup><mi>U</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow><mrow><mi>t</mi><mi>r</mi><mi>u</mi><mi>t</mi><mi>h</mi></mrow></msubsup></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.8)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">confidence=P_r(Object)*IoU_{pred}^{truth} \tag{2.8}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">c</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault">b</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.282216em;vertical-align:-0.383108em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.899108em;"><span style="top:-2.4530000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">d</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">u</span><span class="mord mathdefault mtight">t</span><span class="mord mathdefault mtight">h</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:1.282216em;vertical-align:-0.383108em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">8</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å…¶ååº”äº†è¾¹ç•Œæ¡†å«æœ‰ç‰©ä½“çš„æ¦‚ç‡ä»¥åŠå…¶å’ŒçœŸå®å€¼ä¹‹é—´çš„é‡åˆç¨‹åº¦ã€‚æ­¤å¤–æ¯ä¸ªè¾¹ç•Œæ¡†è¿˜é™„å¸¦äº†ä»¥one-hotå½¢å¼ç¼–ç çš„è¯¥ç‰©ä½“å±äºCä¸ªç±»åˆ«çš„æ¡ä»¶æ¦‚ç‡ã€‚å› æ­¤YOLOæœ€åè¾“å‡ºçš„å¼ é‡å½¢çŠ¶å¦‚å¼2.9æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>f</mi><mi>i</mi><mi>l</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mo>=</mo><mi>S</mi><mo>Ã—</mo><mi>S</mi><mo>Ã—</mo><mo stretchy="false">(</mo><mi>B</mi><mo>âˆ—</mo><mn>5</mn><mo>+</mo><mi>C</mi><mo stretchy="false">)</mo></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.9)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">filters=S\times S\times (B*5+C) \tag{2.9}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">t</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">9</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>ä»¥MS COCOæ•°æ®é›†çš„80ä¸ªç±»ç›®æ ‡æ£€æµ‹ä¸ºä¾‹ï¼Œå›¾2.3ä¸­YOLOå±‚è¾“å‡ºé€šé“æ•°ä¸º255è¡¨ç¤ºï¼šåœ¨YOLOv5ä¸­Bä¸º3ä¸ªè¾¹ç•Œæ¡†ï¼ŒCä¸º80ä¸ªç±»åˆ«ã€‚å› æ­¤ä»£å…¥å¼2.9å¯ä»¥å¾—åˆ°255=3Ã—(5+80)ã€‚</p>
<p>åœ¨YOLOv5æ¨¡å‹ä¸­ä¸ºäº†è§£å†³å…¶å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ€§èƒ½ä¸ä½³ï¼Œä¾¿å€Ÿé‰´äº†ç‰¹å¾é‡‘å­—å¡”ç»“æ„å’Œè·¯å¾„èšåˆç½‘ç»œç»“æ„ï¼Œå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾è¿›è¡Œèåˆã€‚ç›¸è¾ƒäºYOLOçš„ä»¥å¾€ç‰ˆæœ¬åªä½¿ç”¨ä¸€ä¸ªç‰¹å¾å›¾è¿›è¡Œé¢„æµ‹ï¼ŒYOLOv5ä¸­ä½¿ç”¨äº†å¤§ä¸­å°ä¸‰ä¸ªç‰¹å¾å›¾åˆ†è¾¨é¢„æµ‹å°ä¸­å¤§å°ºåº¦çš„ç›®æ ‡ï¼Œæå¤§çš„æå‡äº†å°ç›®æ ‡æ£€æµ‹æ€§èƒ½ã€‚</p>
<p>ç”±äºYOLOv5è¾“å‡ºçš„åæ ‡éƒ¨åˆ†æ˜¯å…³äºé”šæ¡†çš„åç§»é‡ï¼Œå› æ­¤éœ€è¦å¯¹è¿™éƒ¨åˆ†æ•°æ®è¿›è¡Œè§£ç ã€‚è®¡ç®—è¿‡ç¨‹å¦‚å›¾2.9æ‰€ç¤ºã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">c_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>c</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">c_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.716668em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>æŒ‡ç½‘æ ¼çš„ä¸­å¿ƒåæ ‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">p_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>p</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">p_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>åˆ†åˆ«æŒ‡é”šæ¡†çš„é•¿å®½ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">t_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">t_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>è¡¨ç¤ºé¢„æµ‹ç›¸å¯¹ç½‘æ ¼ä¸­å¿ƒçš„åå·®ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">t_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">t_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>åˆ†åˆ«è¡¨ç¤ºé¢„æµ‹ç›¸å¯¹äºé”šæ¡†çš„åå·®ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span></span></span></span>æŒ‡<em>sigmoid</em>å‡½æ•°ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">b_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">b_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>w</mi></msub></mrow><annotation encoding="application/x-tex">b_w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>b</mi><mi>h</mi></msub></mrow><annotation encoding="application/x-tex">b_h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">h</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯æŒ‡å®é™…é¢„æµ‹æ¡†çš„ä¸­å¿ƒåæ ‡å’Œé•¿å®½ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image11.png" alt="å›¾ 2.9 é”šæ¡†è§£ç " /></p>
<p>YOLOç®—æ³•çš„é¢„æµ‹ç»“æœä¼šæœ‰å¤šä¸ªå†—ä½™çš„æ£€æµ‹æ¡†ï¼Œä¸ºæ­¤YOLOv5ä½¿ç”¨éæå¤§å€¼æŠ‘åˆ¶(Non-Maximum Suppressionï¼ŒNMS)é€‰æ‹©ä¸å®é™…ç›®æ ‡æœ€æ¥è¿‘çš„è¾¹æ¥æ¡†å¹¶å»é™¤ä¸å…¶å†—ä½™çš„æ¡†ã€‚å…¶è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹</p>
<p>(1)ã€æ ¹æ®ç½®ä¿¡åº¦å¯¹è¾¹ç•Œæ¡†è¿›è¡Œæ’åºï¼Œå¹¶è®¾ç½®ä¸€ä¸ªIoUé˜ˆå€¼å’ŒNMSé˜ˆå€¼ã€‚</p>
<p>(2)ã€åˆ é™¤æ‰€æœ‰ç½®ä¿¡åº¦å°äºNMSé˜ˆå€¼çš„æ¡†ï¼Œç½®ä¿¡åº¦è¶Šä½ä»£è¡¨æ£€æµ‹é”™è¯¯çš„å¯èƒ½æ€§è¶Šå¤§ã€‚</p>
<p>(3)ã€å–ç½®ä¿¡åº¦æœ€é«˜çš„é¢„æµ‹æ¡†ï¼Œå¹¶åˆ é™¤ä¸è¯¥é¢„æµ‹æ¡†çš„IoUå¤§äºé˜ˆå€¼çš„é¢„æµ‹æ¡†ã€‚IoUè¶Šå¤§å°±è¡¨æ˜é‡å éƒ¨åˆ†è¶Šå¤šï¼Œåœ¨å›¾åƒä¸­å°±é‡å åº¦è¾ƒé«˜çš„é¢„æµ‹æ¡†å¯èƒ½é¢„æµ‹çš„æ˜¯åŒä¸€ä¸ªç‰©ä½“ï¼Œæ‰€ä»¥è¦åˆ å»å¤šä½™çš„æ¡†ã€‚</p>
<p>(4)ã€å¯¹å‰©ä¸‹æœªå¤„ç†çš„æ¡†é‡å¤ä¸Šè¿°æ“ä½œï¼Œç›´åˆ°æ‰€æœ‰æ¡†éƒ½è¢«å¤„ç†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image12.png" alt="å›¾ 2.10 YOLOç®—æ³•çš„æ£€æµ‹æµç¨‹" /></p>
<p>YOLOç®—æ³•çš„æ•´ä½“æ£€æµ‹æµç¨‹å¦‚å›¾2.10æ‰€ç¤ºã€‚å›¾ç‰‡è¾“å…¥åå…ˆé¢„æµ‹å‡ºåå·®ï¼Œå†å¯¹é”šæ¡†è¿›è¡Œè§£ç ï¼Œæœ€åè¿›è¡ŒNMSå¤„ç†ã€‚å…¶ç»“æœå°±æ˜¯æœ€åçš„æ£€æµ‹ç»“æœã€‚</p>
<h2 id="è¯„åˆ¤æŒ‡æ ‡æ¦‚è¿°"><a class="markdownIt-Anchor" href="#è¯„åˆ¤æŒ‡æ ‡æ¦‚è¿°"></a> è¯„åˆ¤æŒ‡æ ‡æ¦‚è¿°</h2>
<p>è¯„ä»·ä¸€ä¸ªæ¨¡å‹æ£€æµ‹æ•ˆæœçš„å¥½åå¾€å¾€éœ€è¦ä½¿ç”¨åŒä¸€ç§è¯„ä»·æŒ‡æ ‡ã€‚åœ¨ç›®æ ‡æ£€æµ‹ç®—æ³•ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ä»¥ä¸‹æŒ‡æ ‡ï¼š</p>
<p>äº¤å¹¶é›†(Intersection over Unionï¼ŒIoU)ã€‚å…¶è®¡ç®—ç»“æœå¦‚å›¾2.11æ‰€ç¤ºï¼Œå³é¢„æµ‹è¾¹ç•Œæ¡†å’Œå®é™…è¾¹ç•Œæ¡†ä¹‹é—´çš„äº¤é›†é¢ç§¯å’Œå¹¶é›†é¢ç§¯ä¹‹æ¯”ã€‚æ˜¯ä¸€ç§è¡¡é‡é¢„æµ‹æ¡†å’Œæ ‡ç­¾æ¡†é‡åˆç¨‹åº¦çš„æŒ‡æ ‡ï¼Œè¶Šæ¥è¿‘1ä»£è¡¨é¢„æµ‹ç»“æœè¶Šå¥½ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image13.png" alt="å›¾ 2.11 IoUè®¡ç®—è¿‡ç¨‹" /></p>
<p>æ··æ·†çŸ©é˜µã€‚è®¡ç®—å¦‚è¡¨2.1æ‰€ç¤ºã€‚å…¶ä¸ºè¯„ä¼°æ¨¡å‹æ€§èƒ½çš„ä¸€é¡¹é‡è¦æŒ‡æ ‡ï¼Œä¹Ÿæ˜¯åç»­å¤šé¡¹è¡ç”ŸæŒ‡æ ‡çš„åŸºç¡€ã€‚</p>
<table style="text-align: center;">
    <caption>è¡¨2.1ç¥ç»ç½‘ç»œæ··æ·†çŸ©é˜µ</caption>
    <tr>
        <td colspan="2" rowspan="2"></td>
        <td colspan="2">é¢„æµ‹å€¼</td>
    </tr>
    <tr>
        <td>Positive</td>
        <td>Negative</td>
    </tr>
    <tr>
        <td rowspan="2">çœŸå®</td>
        <td>Positive</td>
        <td>TP(True Positive)</td>
        <td>FN(False Negative)</td>  
    </tr>
    <tr>
        <td>Negative</td>
        <td>FP(False Positive)</td>
        <td>TN(True Negative)</td>
    </tr>
</table>
<p>ç²¾ç¡®ç‡(Precision)ã€‚å…¶è®¡ç®—å…¬å¼å¦‚å¼2.10æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi></mrow></mfrac></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.10)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Precision=\frac{TP}{TP+FP} \tag{2.10}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">i</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1296600000000003em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height:2.1296600000000003em;vertical-align:-0.7693300000000001em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span><span class="mord">0</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å¯¹äºç›®æ ‡æ£€æµ‹ç®—æ³•æ¥è¯´ï¼Œé€šå¸¸ä½¿ç”¨ä¸€ä¸ªç½®ä¿¡åº¦é˜ˆå€¼æ¥åˆ¤æ–­TPå’ŒFPã€‚å¦‚æœç½®ä¿¡åº¦å¤§äºé˜ˆå€¼å°±æ˜¯TPå¦åˆ™å°±æ˜¯FPã€‚å…¶è¡¨ç¤ºåœ¨æ‰€æœ‰æ­£æ ·æœ¬ä¸­è¢«é¢„æµ‹æ­£ç¡®çš„æ¯”ä¾‹ã€‚</p>
<p>å¬å›ç‡(Recall)ã€‚å…¶è®¡ç®—å…¬å¼å¦‚å¼2.11æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mo>=</mo><mfrac><mrow><mi>T</mi><mi>P</mi></mrow><mrow><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi></mrow></mfrac></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.11)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">Recall=\frac{TP}{TP+FN}  \tag{2.11}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">c</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.1296600000000003em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height:2.1296600000000003em;vertical-align:-0.7693300000000001em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å¯¹äºç›®æ ‡æ£€æµ‹ç®—æ³•æ¥è¯´ï¼ŒFNå°±æ˜¯æ¨¡å‹æ²¡æœ‰æ£€æµ‹åˆ°çš„æ ‡ç­¾ã€‚å…¶è¡¨ç¤ºåœ¨æ‰€æœ‰åˆ†ç±»æ­£ç¡®çš„æ ·æœ¬ä¸­æ­£æ ·æœ¬çš„æ¯”ä¾‹ã€‚</p>
<p>å¹³å‡ç²¾ç¡®åº¦(Average Precisionï¼ŒAP)ã€‚é€šå¸¸æ¥è¯´æˆ‘ä»¬å¸Œæœ›æ£€æµ‹ç»“æœçš„ç²¾ç¡®ç‡å’Œå¬å›ç‡éƒ½è¶Šé«˜è¶Šå¥½ï¼Œç„¶è€Œä¸¤è€…å¾€å¾€æ˜¯ä»¥ç›¸åæ–¹å‘å˜åŒ–çš„ã€‚ä¸ºäº†æ›´å¥½çš„æè¿°ç®—æ³•æ£€æµ‹æ•ˆæœï¼ŒPASCAL VOCæ¯”èµ›æ–¹æå‡ºäº†ä¸€ä¸ªæ–°çš„æŒ‡æ ‡AP<sup class="footnote-ref"><a href="#fn3" id="fnref3:4">[3:4]</a></sup>ã€‚APçš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼Œé€šè¿‡è®¾ç½®ä¸åŒçš„ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸åŒçš„ç²¾ç¡®åº¦å’Œå¬å›ç‡ï¼Œæœ€åå¯ä»¥ç»˜åˆ¶æˆä¸€æ¡æ¨ªåæ ‡ä¸ºå¬å›ç‡ï¼Œçºµåæ ‡ä¸ºç²¾ç¡®ç‡çš„P-Ræ›²çº¿ã€‚æ›²çº¿ä¸åæ ‡è½´ä¹‹é—´çš„é¢ç§¯å°±æ˜¯APã€‚APçš„è®¡ç®—å…¬å¼å¦‚å¼2.12æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>A</mi><mi>P</mi><mo>=</mo><msubsup><mo>âˆ«</mo><mn>0</mn><mn>1</mn></msubsup><mi>p</mi><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mi>d</mi><mi>r</mi></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.12)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">AP=\int_{0}^{1}p(r)dr \tag{2.12}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4759580000000003em;vertical-align:-0.9119499999999999em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5640080000000003em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span><span style="top:-3.8129000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9119499999999999em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose">)</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span></span><span class="tag"><span class="strut" style="height:2.4759580000000003em;vertical-align:-0.9119499999999999em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>p</mi><mrow><mo fence="true">(</mo><mi>r</mi><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">p\left( r \right)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span>ä¸ºå¬å›ç‡ræ‰€å¯¹åº”çš„ç²¾ç¡®åº¦ã€‚ç”±äºAPèƒ½å¤Ÿå¾ˆå¥½çš„æè¿°æ£€æµ‹æ•ˆæœï¼Œå› æ­¤åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚</p>
<p>å‡å€¼å¹³å‡ç²¾ç¡®åº¦(mean Average Precisionï¼ŒmAP)ã€‚APæ˜¯é’ˆå¯¹æŸä¸€ä¸ªç‰¹å®šçš„ç±»åˆ«æ‰€è®¡ç®—çš„ï¼ŒmAPå°±æ˜¯å°†æ¯ä¸ªç±»åˆ«çš„APæ±‚å’Œåå–ä¸€æ³¢å¹³å‡å€¼ã€‚mAPçš„è®¡ç®—å…¬å¼å¦‚2.13æ‰€ç¤ºï¼š</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mi>m</mi><mi>A</mi><mi>P</mi><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>âˆ‘</mo><mi>i</mi><mi>N</mi></munderover><mi>A</mi><msub><mi>P</mi><mi>i</mi></msub></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2.13)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">mAP=\frac{1}{N}\sum_{i}^{N}AP_i \tag{2.13}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="strut" style="height:3.106005em;vertical-align:-1.277669em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span><span class="mord">.</span><span class="mord">1</span><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p>å¼ä¸­<em>N</em>ä¸ºæ£€æµ‹ç±»åˆ«çš„ä¸ªæ•°ã€‚mAPè¿˜å¯ä»¥æ ¹æ®å•ç‹¬çš„IoUæ¥è®¡ç®—ï¼Œé€šå¸¸æƒ…å†µä¸‹é€‰æ‹©IoUä¸º50%æˆ–è€…75%ï¼Œè®°ä½œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>75</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{75}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ã€‚<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯æŒ‡åªè€ƒè™‘IoUåˆ†æ•°å¤§äº0.5çš„æ ·æœ¬çš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦ã€‚</p>
<h2 id="æœ¬ç« å°ç»“"><a class="markdownIt-Anchor" href="#æœ¬ç« å°ç»“"></a> æœ¬ç« å°ç»“</h2>
<p>æœ¬ç« é¦–å…ˆä¸»è¦è®²è¿°äº†å·ç§¯ç¥ç»ç½‘ç»œçš„ä¸»è¦ç»„æˆéƒ¨åˆ†çš„åŸç†å’Œä¼˜ç‚¹ã€‚ä»‹ç»å‡ ç§å¸¸è§çš„æ¿€æ´»å‡½æ•°çš„ä¼˜ç‚¹ä»¥åŠå„è‡ªæ‰€å­˜åœ¨çš„é—®é¢˜ï¼Œè¿˜ä»‹ç»äº†å…¨è¿æ¥ç½‘ç»œçš„ä¼˜ç¼ºç‚¹ä»¥åŠå¸¸è§çš„æ”¹è¿›æªæ–½ã€‚æœ¬ç« éšåè¿˜é‡ç‚¹ä»‹ç»äº†YOLOv5ç½‘ç»œçš„ç»“æ„ä¸æ£€æµ‹æµç¨‹ï¼Œå¹¶å¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªæ¨¡å—éƒ½è¿›è¡Œäº†è¯¦ç»†è®²è§£ã€‚æœ¬ç« æœ€åä»‹ç»äº†ç›®æ ‡æ£€æµ‹ç®—æ³•çš„ç›¸å…³è¯„ä»·æŒ‡æ ‡ï¼Œä½œä¸ºåæ–‡YOLOv5æ”¹è¿›å‰åæ¨¡å‹çš„å¯¹æ¯”æŒ‡æ ‡ã€‚</p>
<h1 id="yoloç®—æ³•åˆ†æåŠæ”¹è¿›"><a class="markdownIt-Anchor" href="#yoloç®—æ³•åˆ†æåŠæ”¹è¿›"></a> YOLOç®—æ³•åˆ†æåŠæ”¹è¿›</h1>
<p>è™½ç„¶YOLOæ˜¯ä¸€ç§æ£€æµ‹æ•ˆæœè¾ƒå¥½çš„é€šç”¨ç®—æ³•ï¼Œä½†æ˜¯å…¶å¯¹äºç‰¹å®šæ•°æ®é›†éœ€è¦åšä¸€å®šçš„è°ƒæ•´ã€‚æœ¬ç« é¦–å…ˆå¯¹æ•°æ®é›†å’ŒYOLOv5æ¨¡å‹è¿›è¡Œåˆ†æï¼Œéšåé’ˆå¯¹å…¶ä¸­çš„é—®é¢˜æå‡ºå‡ é¡¹æ”¹è¿›æªæ–½ã€‚</p>
<h2 id="æ•°æ®é›†åˆ†æ"><a class="markdownIt-Anchor" href="#æ•°æ®é›†åˆ†æ"></a> æ•°æ®é›†åˆ†æ</h2>
<p>åœ¨æ­£å¼å¼€å§‹ç¥ç»ç½‘ç»œè®­ç»ƒä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œæ¢ç´¢æ€§åˆ†æï¼Œè§‚å¯Ÿæ•°æ®é›†ä¸­æ•°æ®çš„ç‰¹ç‚¹ã€‚å¯¹æ•°æ®é›†æœ‰å……åˆ†çš„è®¤è¯†ä¹‹åï¼Œæ‰èƒ½ç¡®å®šåç»­å¯¹æ¨¡å‹çš„æ”¹è¿›æ–¹å‘ã€‚</p>
<p>æœ¬æ¬¡è¡Œäººè½¦è¾†æ£€æµ‹æ•°æ®é›†ç”±MS COCOå¤§å‹ç›®æ ‡æ£€æµ‹æ•°æ®é›†å’ŒBDD100Kè‡ªåŠ¨é©¾é©¶æ•°æ®é›†ä¸­å„è‡ªæå–çš„ä¸€éƒ¨åˆ†åŒ…å«è¡Œäººå’Œè½¦è¾†çš„æ•°æ®é›†åˆå¹¶è€Œæˆã€‚COCOå’ŒBDD100Kæ•°æ®é›†çš„æ ‡ç­¾æ ¼å¼å¦‚å›¾3.1å’Œå›¾3.2æ‰€ç¤ºã€‚COCOæ ‡ç­¾é›†è¾¹ç•Œæ¡†ä¸ºå·¦ä¸Šè§’åæ ‡å’Œé•¿å®½ï¼ŒBDD100Kåˆ™ä¸ºè¾¹æ¡†çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡ã€‚å› æ­¤éœ€è¦è®­ç»ƒä¹‹å‰éœ€è¦å°†å…¶è½¬åŒ–ä¸ºYOLOçš„ä¸­å¿ƒåæ ‡ã€é•¿å®½çš„æ ¼å¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image14.png" alt="å›¾ 3.1 COCOæ ‡ç­¾æ ¼å¼" /></p>
<p>åˆå¹¶åæ•°æ®é›†ä¸€å…±æœ‰17524å¼ å›¾ç‰‡ç”¨äºè®­ç»ƒï¼Œ2262å¼ å›¾ç‰‡ç”¨äºéªŒè¯ã€‚å…¶ä¸­æ£€æµ‹çš„ç±»åˆ«å«æœ‰è¡Œäººã€æœºåŠ¨è½¦ã€è‡ªè¡Œè½¦ã€æ‘©æ‰˜è½¦ã€å…¬äº¤è½¦å’Œå¡è½¦å…­ç±»ã€‚æ¯ä¸ªç±»åˆ«çš„å®ä¾‹æ•°é‡å¦‚å›¾3.3æ‰€ç¤ºã€‚å…¶ä¸­è¡Œäººç±»å…±æœ‰51651ä¸ªï¼Œè‡ªè¡Œè½¦ç±»å…±æœ‰5835ä¸ªï¼Œæ™®é€šæœºåŠ¨è½¦90234ä¸ªï¼Œæ‘©æ‰˜ç±»6108ä¸ªï¼Œå…¬äº¤è½¦ç±»4957ä¸ªï¼Œå¡è½¦ç±»7999ä¸ªã€‚å¯ä»¥æ˜æ˜¾å‘ç°æœºåŠ¨è½¦å’Œè¡Œäººä¸¤ç±»å®ä¾‹è¾ƒå¤šï¼Œè€Œå…¶ä»–ç±»å‹çš„è½¦å®ä¾‹è¾ƒå°‘ï¼Œæ˜æ˜¾å­˜åœ¨æ£€æµ‹æ ·æœ¬ä¸å‡è¡¡çš„é—®é¢˜ï¼Œå¯¹æ­¤æœ‰ä¸€ç§æ”¹è¿›æ–¹æ³•å°±æ˜¯åœ¨è®­ç»ƒä¹‹å‰å¯¹å…¶åšæ•°æ®å¢å¼ºå¤„ç†ã€‚æ­¤å¤–ç»è¿‡ç»Ÿè®¡ï¼Œæ•°æ®é›†ä¸­ä¸€å…±æœ‰166784ä¸ªæ£€æµ‹å®ä¾‹ï¼Œå¦‚æœå°†è¾“å…¥å›¾åƒç¼©æ”¾åˆ°640Ã—640çš„å¤§å°è®¡ç®—ï¼Œæ ‡ç­¾åƒç´ é•¿å®½å°äº8çš„16560ä¸ªï¼Œè€Œæ ‡ç­¾åƒç´ é•¿å®½å°äº4çš„æœ‰1200ä¸ªï¼Œå°ç›®æ ‡å æ¯”çº¦ä¸º9.92%ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image15.png" alt="å›¾ 3.2 BDD100kæ ‡ç­¾æ ¼å¼" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image16.png" alt="å›¾ 3.3 æ•°æ®é›†å®ä¾‹åˆ†å¸ƒ" /></p>
<h2 id="å¯¹yolov5æ¨¡å‹çš„åˆ†æ"><a class="markdownIt-Anchor" href="#å¯¹yolov5æ¨¡å‹çš„åˆ†æ"></a> å¯¹YOLOv5æ¨¡å‹çš„åˆ†æ</h2>
<p>YOLOv5ä½¿ç”¨è·¯å¾„èšåˆç½‘ç»œå’Œæ”¹è¿›çš„ç½‘ç»œéª¨æ¶åï¼Œç›¸è¾ƒäºä»¥å¾€ç‰ˆæœ¬å¯¹äºå°ç‰©ä½“çš„æ£€æµ‹æ•ˆæœæœ‰äº†è¾ƒå¤§çš„æå‡ï¼Œä½†æ˜¯YOLOv5å¯¹äºå¤§å°ºå¯¸çš„ç‰©ä½“æ£€æµ‹æ€§èƒ½å¹¶ä¸ç†æƒ³ï¼Œç®—æ³•éš¾ä»¥åŒºåˆ†å¡è½¦å’Œå…¬äº¤è½¦ä¸¤ç±»ï¼Œè¿™å¯èƒ½æ˜¯å› ä¸ºç®—æ³•æå–çš„ç‰¹å¾ä¸å¤Ÿï¼Œéš¾ä»¥æ ¹æ®ç°æœ‰ç‰¹å¾æ¥åŒºåˆ†å¡è½¦å’Œå…¬äº¤è½¦ã€‚</p>
<p>YOLOv5æ¨¡å‹åœ¨æ£€æµ‹ä¸€äº›å¯†é›†å°ç‰©ä½“æ—¶ï¼Œå­˜åœ¨å®šä½ä¸ç²¾ç¡®çš„é—®é¢˜ï¼Œå³å‡ºç°ä¸€äº›å®šä½ä¸Šçš„å¤±è¯¯ï¼Œè¿˜ä¼šå‡ºç°å°†èƒŒæ™¯é”™è¯¯çš„åˆ¤åˆ«ä¸ºç‰©ä½“æˆ–è€…å¤šä¸ªç‰©ä½“è¢«åˆ¤åˆ«æˆä¸€ä¸ªç‰©ä½“çš„é—®é¢˜ã€‚</p>
<h2 id="å¯¹yolov5æ¨¡å‹çš„æ”¹è¿›æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#å¯¹yolov5æ¨¡å‹çš„æ”¹è¿›æ–¹æ¡ˆ"></a> å¯¹YOLOv5æ¨¡å‹çš„æ”¹è¿›æ–¹æ¡ˆ</h2>
<h3 id="æ•°æ®å¢å¼º"><a class="markdownIt-Anchor" href="#æ•°æ®å¢å¼º"></a> æ•°æ®å¢å¼º</h3>
<p>é’ˆå¯¹å›¾3.1ä¸­çš„æ•°æ®ä¸å‡è¡¡é—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªç§æ”¹è¿›æ–¹æ³•ï¼Œä¸€æ˜¯åœ¨è®­ç»ƒçš„æŸå¤±å‡½æ•°ä¸­åŠ å…¥ä¸€äº›é«˜çº§æŸå¤±å‡½æ•°å¦‚Focal lossï¼Œå¦å¤–ä¸€ç§æ˜¯åœ¨è®­ç»ƒæ—¶æœŸå¯¹è®­ç»ƒæ•°æ®ä½¿ç”¨æ•°æ®å¢å¼ºã€‚å› ä¸ºä¿®æ”¹æŸå¤±å‡½æ•°è¾ƒä¸ºå¤æ‚ï¼Œå› æ­¤æœ¬æ–‡é€‰ç”¨ä½¿ç”¨æ•°æ®å¢å¼ºçš„æ–¹æ³•ã€‚æ•°æ®å¢å¼ºæ˜¯æŒ‡åœ¨å›¾ç‰‡é€å…¥ç½‘ç»œå‰çš„é¢„å¤„ç†é˜¶æ®µï¼Œé€šè¿‡å¯¹è¾“å…¥å›¾ç‰‡è¿›è¡Œä¸€äº›å¾®å°çš„æ”¹å˜æ“ä½œå¦‚éšæœºæ“¦é™¤ã€è°ƒæ•´é¥±å’Œåº¦ç­‰ï¼Œä½¿å¾—ç¥ç»ç½‘ç»œè®¤ä¸ºè¿™æ˜¯ä¸€å¼ å…¨æ–°çš„å›¾ç‰‡è¾¾åˆ°å¢åŠ æ•°æ®é‡çš„æ•ˆæœã€‚åœ¨æœ¬æ¬¡å®éªŒä¸­å°†ä½¿ç”¨é©¬èµ›å…‹æ•°æ®å¢å¼ºï¼Œå…¶åŸç†æ˜¯å°†å››å¼ å›¾ç‰‡éšæœºç¼©æ”¾ã€ç¿»è½¬ã€è°ƒæ•´è‰²åŸŸã€éšæœºåˆ†å¸ƒç„¶åæ‹¼æ¥èµ·æ¥ã€‚è¿™æ ·åšä¸ä»…å¯ä»¥å¢å¤§ç›®æ ‡æ£€æµ‹çš„æ•°æ®é‡ï¼Œè¿˜èƒ½å¤Ÿä¸°å¯Œæ•°æ®é›†ä¸­æ£€æµ‹ç›®æ ‡çš„èƒŒæ™¯ï¼Œå‡å°‘èƒŒæ™¯è¢«è¯¯åˆ¤ä¸ºæ£€æµ‹ç›®æ ‡çš„æ¦‚ç‡ã€‚</p>
<h3 id="é’ˆå¯¹ç½‘ç»œç»“æ„æ”¹è¿›"><a class="markdownIt-Anchor" href="#é’ˆå¯¹ç½‘ç»œç»“æ„æ”¹è¿›"></a> é’ˆå¯¹ç½‘ç»œç»“æ„æ”¹è¿›</h3>
<p>YOLOv5å¯¹äºç‰©ä½“åˆ†ç±»ä»¥åŠå¯¹å¤§å°ºå¯¸ç‰©ä½“æ£€æµ‹æ€§èƒ½ä¸ç†æƒ³ï¼Œå¯èƒ½æ˜¯å› ä¸ºYOLOv5å¯¹äºç›®æ ‡çš„ç‰¹å¾æå–çš„ä¸å¤Ÿã€‚å¯¹æ­¤æœ‰ä¸€æ¡æ”¹è¿›æ€è·¯ï¼Œå°±æ˜¯å¯¹YOLOv5çš„éª¨æ¶è¿›è¡Œæ”¹è¿›ï¼Œå†ç”¨ä¸€å±‚å·ç§¯è¿›è¡Œä¸‹é‡‡æ ·ï¼Œè®©å·ç§¯å±‚èƒ½å¤Ÿæå–åˆ°æ›´å¤šçš„ç‰¹å¾ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ç½‘ç»œçš„å‚æ•°å˜å¤šï¼Œç½‘ç»œçš„è¿ç®—é€Ÿåº¦ä¼šæœ‰æ‰€ä¸‹é™ã€‚ä½†æ˜¯è¿ç®—é€Ÿåº¦å¹¶ä¸æ˜¯è¶Šå¿«è¶Šå¥½ï¼Œæ›´é‡è¦çš„æ˜¯è¾ƒå¿«çš„é€Ÿåº¦å’Œè¾ƒé«˜ç²¾ç¡®åº¦çš„æƒè¡¡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image17.png" alt="å›¾ 3.4 æ”¹è¿›åçš„YOLOv5æ¨¡å‹ç»“æ„" /></p>
<p>YOLOv5æ¨¡å‹å¯¹8å€ä¸‹é‡‡æ ·è¾“å‡ºçš„ç‰¹å¾å›¾è´Ÿè´£å¯¹å°ç›®æ ‡è¿›è¡Œæ£€æµ‹ï¼Œè¿™æ„å‘³ç€å¦‚æœå®ä¾‹çš„åƒç´ å¤§å°å°äº8Ã—8å°†ä¼šå¾ˆéš¾è¢«æ£€æµ‹åˆ°<sup class="footnote-ref"><a href="#fn23" id="fnref23">[23]</a></sup>ã€‚è€Œæ•°æ®é›†ä¸­å°äº8Ã—8çš„å®ä¾‹ä¸€å…±æœ‰16560ä¸ªï¼Œè€Œåƒç´ å°ºå¯¸å°äº4Ã—4çš„å®ä¾‹åªæœ‰1200ä¸ªï¼Œæ˜¾ç„¶é‡‡ç”¨4å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾è´Ÿè´£å°ç›®æ ‡çš„æ£€æµ‹èƒ½å¤ŸåŒ…å«å‡ ä¹æ•´ä¸ªæ•°æ®é›†ã€‚æ­¤å¤–YOLOv5å¯¹äºå¯†é›†çš„å°ç›®æ ‡ç‰©ä½“çš„å®šä½æ€§èƒ½ä¸æ˜¯å¾ˆç†æƒ³ã€‚å¯¹æ­¤æå‡ºä¸€ç§é’ˆå¯¹ç‰¹å¾èåˆæ”¹è¿›æ–¹æ¡ˆï¼Œè°ƒæ•´YOLOv5ä¸­çš„è·¯å¾„èšåˆç½‘ç»œï¼Œå–å…¶ä¸­4ã€8ã€16ã€32ã€64å€ä¸‹é‡‡æ ·çš„äº”å¼ ç‰¹å¾å›¾ï¼Œç»è¿‡ç‰¹å¾èåˆäººååˆ†åˆ«è´Ÿè´£æ£€æµ‹å·¨å¤§ç‰©ä½“ã€å¤§ç‰©ä½“ã€ä¸­ç­‰å¤§å°ç‰©ä½“ã€å°ç‰©ä½“å’Œç‰¹åˆ«å°çš„ç‰©ä½“ã€‚è¿™ç§æ”¹è¿›åŒæ ·æ˜¯ä»¥ç‰ºç‰²é€Ÿåº¦æ¥æ¢å–ä¸€å®šçš„ç²¾åº¦ã€‚</p>
<p>æ€»ä½“çš„æ”¹è¿›æ–¹æ³•å¦‚å›¾3.4æ‰€ç¤ºï¼Œå…¶ä¸­çº¢è‰²æ¡†æ¡†èµ·æ¥çš„éƒ¨åˆ†å°±æ˜¯æœ¬æ–‡æ–°å¢æ”¹è¿›çš„ç»“æ„ã€‚ä¸‹æ–¹çš„çº¢è‰²æ¡†ä¸ºæ–°å¢çš„ä¸‹é‡‡æ ·éƒ¨åˆ†ï¼Œè¾“å‡ºé€šé“æ•°å–256å’Œ512çš„ä¸­å€¼ã€‚å¹¶åœ¨ç‰¹å¾èåˆè¿‡ç¨‹ä¸­æ–°å¢äº†ä¸€å¼ ç‰¹å¾å›¾è´Ÿè´£è¾ƒå¤§ç‰©ä½“çš„æ£€æµ‹ã€‚ä¸Šæ–¹çš„çº¢è‰²æ¡†ä¸ºå¯¹ç‰¹å¾èåˆéƒ¨åˆ†çš„æ”¹è¿›ï¼Œå¯¹åŸå…ˆçš„8å€ä¸‹é‡‡æ ·è¾“å‡ºç‰¹å¾å›¾å†åŠ ä¸€å±‚ä¸Šé‡‡æ ·ï¼Œä¸4å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾è¿›è¡Œèåˆï¼Œä»¥æé«˜å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœã€‚åŸºäºè¿™äº›æ”¹è¿›ï¼Œè´Ÿè´£é¢„æµ‹è¾“å‡ºçš„ç‰¹å¾å›¾ä»åŸå…ˆçš„ä¸‰å¼ æ‰©å±•åˆ°äº†äº”å¼ ã€‚</p>
<h2 id="æœ¬ç« å°ç»“-2"><a class="markdownIt-Anchor" href="#æœ¬ç« å°ç»“-2"></a> æœ¬ç« å°ç»“</h2>
<p>åœ¨æœ¬ç« é¦–å…ˆåˆ†æäº†è¡Œäººè½¦è¾†æ•°æ®é›†ï¼Œè®²è¿°äº†æ•°æ®é›†çš„æ¥æºå’Œéœ€è¦æ£€æµ‹çš„ç±»åˆ«ã€‚ä»‹ç»äº†å…¶ä¸­æ ·æœ¬ä¸å‡è¡¡çš„å’Œå…¶ä¸­å«æœ‰ä¸€éƒ¨åˆ†å°å‹ç›®æ ‡çš„é—®é¢˜ï¼Œè¿˜ä»‹ç»äº†YOLOv5æ¨¡å‹åœ¨å½“å‰æ•°æ®ä¸Šçš„ç¼ºé™·ã€‚æœ¬ç« åç»­é’ˆå¯¹æœ¬ç« å‰é¢æåˆ°çš„é—®é¢˜ï¼Œæå‡ºäº†æ•°æ®é¢„å¤„ç†å’Œç½‘ç»œç»“æ„ä¸¤æ–¹é¢çš„æ”¹è¿›ã€‚ç¬¬å››ç« å°†ä¼šåŸºäºè¿™äº›æ”¹è¿›å¯¹å…¶è¿›è¡Œå®éªŒã€‚</p>
<h1 id="å®éªŒä¸åˆ†æ"><a class="markdownIt-Anchor" href="#å®éªŒä¸åˆ†æ"></a> å®éªŒä¸åˆ†æ</h1>
<p>Pytorchæ˜¯ä¸€ä¸ªfacebookç ”å‘çš„å¼€æºAIæ¡†æ¶ï¼Œå…¶ä¼˜ç‚¹æœ‰(1)ã€ä¸pythonç¼–ç¨‹ç±»ä¼¼ï¼Œä¸Šæ‰‹å®¹æ˜“ï¼Œå¯è¯»æ€§é«˜(2)ã€ä½¿ç”¨åŠ¨æ€è®¡ç®—å›¾ï¼Œæ›´æ–¹ä¾¿ç¼–å†™å’Œè°ƒè¯•ï¼Œ(3)ã€å®¹æ˜“ä½¿ç”¨GPUè¿›è¡ŒåŠ é€Ÿè¿ç®—ã€‚æœ¬æ–‡å°†ä½¿ç”¨pytorchæ¡†æ¶æ¥å®ç°YOLOv5æ”¹è¿›åçš„æ¨¡å‹ã€‚</p>
<p>æœ¬ç« å°†ä»‹ç»æœ¬æ¬¡å®éªŒçš„ç¡¬ä»¶å¹³å°ï¼Œéšåå¯¹æ”¹è¿›å‰åæ¨¡å‹çš„æ€§èƒ½å’Œå®é™…å›¾ç‰‡æ•ˆæœè¿›è¡Œå¯¹æ¯”åˆ†æã€‚</p>
<h2 id="å®éªŒç¡¬ä»¶å¹³å°"><a class="markdownIt-Anchor" href="#å®éªŒç¡¬ä»¶å¹³å°"></a> å®éªŒç¡¬ä»¶å¹³å°</h2>
<p>æœ¬æ¬¡å®éªŒä¸­çš„æ‰€æœ‰æ•°æ®çš†åœ¨ä»¥ä¸‹ç¡¬ä»¶å¹³å°ä¸Šè¿è¡Œæ‰€å¾—ã€‚</p>
<p>(1)ã€CPUï¼šIntel Â® Xeon Â® Platinum 8163 CPU @ 2.50GHz</p>
<p>(2)ã€å†…å­˜ï¼š64GB</p>
<p>(3)ã€GPUï¼šNVIDIA Tesla P100ï¼Œ16GBæ˜¾å­˜ï¼Œæµ®ç‚¹è®¡ç®—é€Ÿåº¦ä¸º5.18 TFLOPS</p>
<p>(4)ã€æ“ä½œç³»ç»Ÿï¼šUbuntu 18.04 LTS</p>
<h2 id="å®éªŒç»“æœåˆ†æ"><a class="markdownIt-Anchor" href="#å®éªŒç»“æœåˆ†æ"></a> å®éªŒç»“æœåˆ†æ</h2>
<p>æœ¬æ¬¡å®éªŒåŸºäºä¸ŠèŠ‚æåˆ°çš„å®éªŒç¡¬ä»¶è®¾å¤‡å¯¹æ”¹è¿›å‰åæ¨¡å‹è®­ç»ƒ150è½®ï¼Œä½¿ç”¨ç²¾ç¡®ç‡ã€å¬å›ç‡å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä½œä¸ºæ¨¡å‹çš„è¯„ä»·æŒ‡æ ‡ï¼Œç›¸å…³è¯„ä»·æŒ‡æ ‡çš„è®¡ç®—è¿‡ç¨‹å¯è§æœ¬æ–‡ç¬¬äºŒç« ä¸­çš„è¯„ä»·æŒ‡æ ‡ä»‹ç»ã€‚</p>
<h3 id="è®­ç»ƒæ—¶æœŸæ•ˆæœå¯¹æ¯”"><a class="markdownIt-Anchor" href="#è®­ç»ƒæ—¶æœŸæ•ˆæœå¯¹æ¯”"></a> è®­ç»ƒæ—¶æœŸæ•ˆæœå¯¹æ¯”</h3>
<p>å›¾4.1ä¸ºè®­ç»ƒæ—¶æœŸIoUé˜ˆå€¼ä¸º50%çš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦å˜åŒ–å›¾ï¼Œçºµåæ ‡ä¸ºåªè€ƒè™‘IoUå¤§äº50%è¾¹ç•Œæ¡†é¢„æµ‹å€¼çš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦ï¼Œæ¨ªåæ ‡ä¸ºè®­ç»ƒçš„è½®æ•°epochï¼Œä¸€ä¸ªepochæŒ‡å®Œæˆä¸€æ¬¡æ•°æ®é›†é‡Œé¢çš„å…¨éƒ¨æ•°æ®çš„è®­ç»ƒã€‚è“è‰²çš„æ›²çº¿ä¸ºæ”¹è¿›å‰æ¨¡å‹åœ¨è®­ç»ƒæ—¶æœŸçš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„å˜åŒ–æ›²çº¿ï¼Œçº¢è‰²çš„æ›²çº¿ä¸ºæ”¹è¿›åæ¨¡å‹åœ¨è®­ç»ƒæ—¶æœŸçš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„å˜åŒ–æ›²çº¿ã€‚ä»å›¾ä¸­å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºæ”¹è¿›åçš„æ¨¡å‹çš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>åœ¨è®­ç»ƒæœŸé—´ä¸€ç›´æ¯”æ”¹è¿›å‰æ¨¡å‹é«˜ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image18.png" alt="å›¾ 4.1 æ”¹è¿›å‰åæ¨¡å‹åœ¨è®­ç»ƒæ—¶æœŸçš„mAP50å˜åŒ–æ›²çº¿" /></p>
<p>å›¾4.2ã€å›¾4.3å’Œå›¾4.4ä¸ºè®­ç»ƒæ—¶æœŸæ”¹è¿›å‰æ¨¡å‹å’Œæ”¹è¿›åæ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„losså¯¹æ¯”å›¾ï¼Œæ¨ªåæ ‡éƒ½ä¸ºè®­ç»ƒæ—¶çš„è½®æ¬¡ï¼Œçºµåæ ‡ä¸ºlossçš„å¤§å°ã€‚è“è‰²çš„æ›²çº¿ä¸ºæ”¹è¿›å‰çš„æ¨¡å‹ï¼Œçº¢è‰²çš„æ›²çº¿ä¸ºæ”¹è¿›åçš„æ¨¡å‹ã€‚å›¾4.2ä¸ºéªŒè¯é›†cls_losså˜åŒ–å›¾ï¼Œè¡¨ç¤ºçš„æ˜¯æ¨¡å‹åˆ†è¾¨ç±»åˆ«çš„è¯¯å·®ï¼Œè¶Šä½è¡¨ç¤ºæ¨¡å‹åˆ†ç±»è¶Šç²¾å‡†ï¼Œåœ¨YOLOv5ä¸­ä½¿ç”¨äºŒå…ƒäº¤å‰ç†µæ¥è®¡ç®—åˆ†ç±»æŸå¤±ã€‚å¯ä»¥çœ‹åˆ°è®­ç»ƒåæœŸæ”¹è¿›åæ¨¡å‹çš„cls_lossè¦æ¯”æ”¹è¿›å‰çš„ä½ï¼Œå› æ­¤æ”¹è¿›åæ¨¡å‹çš„åˆ†ç±»æ•ˆæœè¦æ›´å¥½ã€‚å›¾4.3ä¸ºbox_losså˜åŒ–å›¾ï¼Œè¡¨ç¤ºçš„æ˜¯æ¨¡å‹çš„è¾¹ç•Œæ¡†åæ ‡å®šä½æ–¹é¢çš„è¯¯å·®ï¼Œè¶Šä½è¡¨ç¤ºæ¨¡å‹çš„è¾¹ç•Œæ¡†å®šä½è¶Šå‡†ã€‚åœ¨YOLOv5ä¸­ä½¿ç”¨äº†C-IoU lossæ¥è®¡ç®—box_lossï¼ŒC-IoU lossæ¯”åŸæœ¬çš„æŸå¤±å‡½æ•°å¤šè€ƒè™‘äº†è¾¹ç•Œæ¡†çš„ä¸­å¿ƒç‚¹è·ç¦»å’Œé•¿å®½æ¯”ï¼Œèƒ½æ›´å¥½çš„ååº”é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„æ¥è¿‘ç¨‹åº¦ï¼Œå¯ä»¥çœ‹åˆ°è®­ç»ƒæ—¶æœŸæ”¹è¿›åæ¨¡å‹æ¯”æ”¹è¿›å‰çš„box_lossä½ï¼Œè¿™è¡¨æ˜æ”¹è¿›åçš„æ¨¡å‹åœ¨å®šä½æ–¹é¢æ›´ç²¾ç¡®ã€‚å›¾4.4ä¸ºobj_losså˜åŒ–å›¾ï¼Œè¡¨ç¤ºçš„æ˜¯è¾¹ç•Œæ¡†æ˜¯ç‰©ä½“çš„ç½®ä¿¡åº¦æ–¹é¢è¯¯å·®ï¼Œè¶Šä½è¡¨ç¤ºæ¨¡å‹å¯¹è¾¹ç•Œæ¡†å†…æ˜¯å¦å­˜åœ¨ç‰©ä½“çš„åˆ¤åˆ«èƒ½åŠ›è¶Šå¼ºã€‚æ”¹è¿›åæ¨¡å‹çš„obj_lossä¸€ç›´æ¯”æ”¹è¿›å‰ä½ï¼Œè¿™è¡¨æ˜æ”¹è¿›åæ¨¡å‹åˆ¤åˆ«æ˜¯å¦å­˜åœ¨ç‰©ä½“çš„èƒ½åŠ›æ›´å¼ºï¼Œèƒ½å¤Ÿå‡å°‘é£æ™¯è¢«è¯¯åˆ¤æ¦‚ç‡ã€‚è¿˜å¯ä»¥å‘ç°éšç€è®­ç»ƒæ‰¹æ¬¡çš„ä¸Šå‡ï¼ŒéªŒè¯é›†çš„losså‡ºç°äº†å…ˆä¸‹é™åä¸Šå‡çš„è¶‹åŠ¿ï¼Œè¿™æ˜¯å› ä¸ºå‡ºç°äº†è¿‡æ‹Ÿåˆçš„ç°è±¡ã€‚ä¸ºäº†é€‰å–æ³›åŒ–èƒ½åŠ›æœ€å¼ºçš„æ¨¡å‹æƒé‡ï¼Œåº”è¯¥é€‰æ‹©lossæ›²çº¿ä¸­æœ€ä½çš„ç‚¹æ‰€å¯¹åº”çš„æ¨¡å‹æƒé‡ä½œä¸ºæœ€ä½³çš„æ¨¡å‹æƒé‡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image19.png" alt="å›¾ 4.2 æ”¹è¿›å‰åæ¨¡å‹çš„éªŒè¯é›†åˆ†ç±»è¯¯å·®åœ¨è®­ç»ƒæ—¶æœŸçš„å˜åŒ–æ›²çº¿" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image20.png" alt="å›¾ 4.3 æ”¹è¿›å‰åæ¨¡å‹çš„éªŒè¯é›†è¾¹ç•Œæ¡†è¯¯å·®åœ¨è®­ç»ƒæ—¶æœŸçš„å˜åŒ–æ›²çº¿" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image21.png" alt="å›¾ 4.4 æ”¹è¿›å‰åæ¨¡å‹çš„éªŒè¯é›†ç‰©ä½“æ€§è¯¯å·®åœ¨è®­ç»ƒæ—¶æœŸçš„å˜åŒ–æ›²çº¿" /></p>
<h3 id="è®­ç»ƒå®Œæˆæ•ˆæœå¯¹æ¯”"><a class="markdownIt-Anchor" href="#è®­ç»ƒå®Œæˆæ•ˆæœå¯¹æ¯”"></a> è®­ç»ƒå®Œæˆæ•ˆæœå¯¹æ¯”</h3>
<p>å›¾4.5ä¸ºYOLOv5æ¨¡å‹æ”¹è¿›å‰åçš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mi>A</mi><msub><mi>P</mi><mn>50</mn></msub></mrow><annotation encoding="application/x-tex">mAP_{50}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">A</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„æ•ˆæœå¯¹æ¯”ï¼Œå›¾ä¸­è“è‰²ä»£è¡¨çš„æ˜¯æ”¹è¿›å‰çš„æ¨¡å‹è¡¨ç°æ•ˆæœï¼Œçº¢è‰²çš„æ˜¯æ”¹è¿›åçš„æ¨¡å‹è¡¨ç°æ•ˆæœã€‚æ¨ªåæ ‡è¡¨ç¤ºå„ä¸ªç±»åˆ«ï¼Œä¸€å…±æœ‰è¡Œäººã€è‡ªè¡Œè½¦ã€æ‘©æ‰˜è½¦ã€å…¬äº¤è½¦å’Œå¡è½¦å…±å…­ç±»ï¼Œæ­¤å¤–å›¾ä¸­è¿˜æœ‰ä¸€ä¸ªæ‰€æœ‰ç±»çš„æ±‡æ€»ã€‚çºµåæ ‡è¡¨ç¤ºçš„æ˜¯åªè€ƒè™‘IoUå¤§äº50%çš„è¾¹ç•Œæ¡†çš„å‡å€¼å¹³å‡ç²¾ç¡®ç‡ï¼Œä»¥ç™¾åˆ†æ¯”çš„å½¢å¼è¡¨ç¤ºã€‚è¡¨æ ¼ç¬¬ä¸€åˆ—ä¸ºå…¨éƒ¨ç±»åˆ«çš„å‡å€¼å¹³å‡ç²¾ç¡®ç‡ï¼Œæ”¹è¿›ä¹‹å‰ä¸º62%ï¼Œæ”¹è¿›ä¹‹åä¸º64.5%ï¼Œæ€»ä½“æå‡äº†2.5%çš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦ã€‚è¡Œäººç±»ä»66.2%æå‡åˆ°äº†68.3%ï¼Œè‡ªè¡Œè½¦ç±»ä»47.3%ä¸Šå‡åˆ°äº†50%ï¼ŒæœºåŠ¨è½¦ç±»ä»71%ä¸Šå‡åˆ°äº†75.1%ï¼Œæ‘©æ‰˜è½¦ç±»ä»65.7%ä¸Šå‡åˆ°68.6%ï¼Œå…¬äº¤è½¦ç±»ä»69.3%ä¸Šå‡åˆ°äº†70.4ï¼Œå¡è½¦ç±»ä»52.3%ä¸Šå‡åˆ°äº†54.2%ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image22.png" alt="å›¾ 4.5 æ”¹è¿›å‰åæ¨¡å‹çš„mAP50å¯¹æ¯”" /></p>
<p>å›¾4.6æ˜¯YOLOv5æ¨¡å‹æ”¹è¿›å‰å’Œæ”¹è¿›åçš„ç²¾ç¡®åº¦å¯¹æ¯”ã€‚è“è‰²æŸ±å½¢å›¾è¡¨ç¤ºçš„æ˜¯æ”¹è¿›å‰æ¨¡å‹çš„è¡¨ç°ï¼Œçº¢è‰²çš„æ˜¯æ”¹è¿›åçš„æ¨¡å‹è¡¨ç°ã€‚æ¨ªåæ ‡ä»£è¡¨æ£€æµ‹çš„ç±»åˆ«ï¼Œçºµåæ ‡ä»£è¡¨äº†å„ä¸ªç±»åˆ«çš„ç²¾ç¡®åº¦ã€‚å¯ä»¥çœ‹åˆ°å…¨éƒ¨ç±»çš„ç²¾ç¡®åº¦åœ¨æ”¹è¿›ä¹‹å‰æ˜¯74.4%ï¼Œåœ¨æ”¹è¿›ä¹‹åä¸º75.8%ï¼Œæ•´ä½“æé«˜äº†1.4%ã€‚è¡Œäººç±»æå‡äº†2.3%ï¼Œè‡ªè¡Œè½¦ç±»æå‡äº†2%ï¼ŒæœºåŠ¨è½¦ç±»æå‡äº†1.5%ï¼Œæ‘©æ‰˜è½¦ç±»ä¸‹é™äº†2.9%ï¼Œè¾ƒéš¾åˆ†ç±»çš„å…¬äº¤è½¦ç±»å’Œå¡è½¦ç±»åˆ†åˆ«æå‡äº†2.8%å’Œ1.8%ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image23.png" alt="å›¾ 4.6 æ”¹è¿›å‰åæ¨¡å‹çš„ç²¾ç¡®åº¦å¯¹æ¯”" /></p>
<p>å›¾4.7ä¸ºYOLOv5æ¨¡å‹æ”¹è¿›å‰åçš„å¬å›ç‡å¯¹æ¯”ï¼Œæ¨ªåæ ‡æ˜¯åˆ†ç±»çš„å„ä¸ªç±»åˆ«ï¼Œçºµåæ ‡ä¸ºæ¨¡å‹çš„å¬å›ç‡ï¼Œä»¥ç™¾åˆ†æ¯”çš„å½¢å¼æ˜¾ç¤ºï¼Œè“è‰²æŸ±å½¢å›¾è¡¨ç¤ºçš„æ˜¯æ”¹è¿›å‰çš„æ¨¡å‹å¬å›ç‡ï¼Œçº¢è‰²æŸ±å½¢å›¾è¡¨ç¤ºçš„æ˜¯æ”¹è¿›åçš„æ¨¡å‹å¬å›ç‡ã€‚å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç±»åˆ«çš„å¬å›ç‡ä»åŸæ¥çš„55.4%ä¸Šå‡åˆ°äº†56.6%ï¼Œä½†æ˜¯è¡Œäººç±»ä»58.6%ä¸‹é™åˆ°äº†57.4%ï¼Œè‡ªè¡Œè½¦ç±»ä»44.9%ä¸Šå‡åˆ°äº†45.4ï¼ŒæœºåŠ¨è½¦ç±»ä»63%ä¸Šå‡åˆ°äº†64.9%ï¼Œæ‘©æ‰˜è½¦ç±»ä»58.8%ä¸Šå‡åˆ°äº†60.8%ï¼Œå…¬äº¤è½¦ç±»ä»61.8%ä¸Šå‡åˆ°äº†63.7%ï¼Œå¡è½¦ç±»ä»45.4%ä¸Šå‡åˆ°äº†47.5%ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image24.png" alt="å›¾ 4.7 æ”¹è¿›å‰åæ¨¡å‹çš„å¬å›ç‡å¯¹æ¯”" /></p>
<p>å›¾4.8å’Œå›¾4.9ä¸ºæ¨¡å‹æ”¹è¿›å‰åå¯¹ä¸€è¾†é»„è‰²å¡è½¦çš„æ£€æµ‹æ•ˆæœå¯¹æ¯”å›¾ï¼Œå›¾4.8ä¸ºæ”¹è¿›å‰çš„å¡è½¦æ£€æµ‹æ•ˆæœå›¾ï¼Œå›¾ä¸­æ£•è‰²æ¡†è¡¨ç¤ºçš„æ˜¯å¡è½¦ç±»ï¼Œ0.49è¡¨ç¤ºæ¨¡å‹è®¤ä¸ºè¯¥æ£•è‰²æ¡†æœ‰49%çš„å¯èƒ½æ€§ä¸ºå¡è½¦ï¼Œç´«è‰²æ¡†è¡¨ç¤ºçš„æ˜¯å…¬äº¤è½¦ç±»ï¼Œ0.45è¡¨ç¤ºæ¨¡å‹è®¤ä¸ºè¯¥æ¡†æœ‰45%çš„å¯èƒ½æ€§ä¸ºå…¬äº¤è½¦ã€‚å›¾4.9ä¸ºæ”¹è¿›åçš„æ¨¡å‹å¯¹åŒä¸€å¼ å›¾ç‰‡çš„æ£€æµ‹æ•ˆæœå›¾ï¼Œå›¾ä¸­æ£•è‰²æ¡†è¡¨ç¤ºå¡è½¦ç±»ï¼Œ0.91è¡¨ç¤ºæ”¹è¿›åçš„æ¨¡å‹æœ‰é«˜è¾¾91%çš„ç½®ä¿¡åº¦è®¤ä¸ºè¯¥æ¡†ä¸ºä¸€è¾†å¡è½¦ã€‚æ¯”è¾ƒæ”¹è¿›å‰åçš„æ£€æµ‹æ•ˆæœå›¾å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºæ”¹è¿›åçš„æ¨¡å‹ç›¸è¾ƒäºæ”¹è¿›å‰æ¨¡å‹åœ¨å¡è½¦çš„åˆ†ç±»ä¸Šæœ‰äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image25.jpeg" alt="å›¾ 4.8 æ”¹è¿›å‰æ¨¡å‹å¯¹å¡è½¦çš„é¢„æµ‹ç»“æœ" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image26.jpeg" alt="å›¾ 4.9 æ”¹è¿›åæ¨¡å‹å¯¹å¡è½¦çš„é¢„æµ‹ç»“æœ" /></p>
<p>å›¾4.10ä¸ºå«æœ‰å°ç›®æ ‡å¸¦æœ‰æ ‡ç­¾çš„åŸå§‹å›¾ç‰‡å›¾ï¼Œç»¿è‰²æ¡†ä»£è¡¨çš„è½¦è¾†ç±»ï¼Œé€šè¿‡è®¡æ•°å¯ä»¥å‘ç°å›¾ç‰‡ä¸­ä¸€å…±æœ‰8ä¸ªè½¦è¾†æ¡†ã€‚å›¾4.11ä¸ºæ”¹è¿›å‰çš„æ¨¡å‹å¯¹è¯¥å›¾ç‰‡çš„æ£€æµ‹æ•ˆæœï¼Œç»¿è‰²æ¡†ä»£è¡¨è½¦è¾†ï¼Œæ•°å­—ä»£è¡¨ç€ç½®ä¿¡åº¦çš„å¤§å°ï¼Œæ•°å­—è¶Šé«˜ä»£è¡¨è¶Šå¯ä¿¡ï¼Œä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°ä¸€å…±é¢„æµ‹äº†9ä¸ªè½¦è¾†æ¡†ï¼Œåœ¨ä¸­é—´åå·¦ä¸€ç‚¹çš„ä½ç½®å¤šä»¥è¾ƒé«˜çš„æ¦‚ç‡å¤šé¢„æµ‹äº†ä¸€ä¸ªæ¡†ã€‚å›¾4.12ä¸ºæ”¹è¿›åçš„æ¨¡å‹å¯¹äºå°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœï¼Œä»”ç»†è§‚å¯Ÿå¯ä»¥å‘ç°æ”¹è¿›åçš„æ¨¡å‹å¯¹å›¾ç‰‡é¢„æµ‹äº†8ä¸ªè½¦è¾†æ¡†ï¼Œè™½ç„¶å›¾ä¸­æ”¹è¿›åçš„æ¨¡å‹çš„ç½®ä¿¡åº¦ç›¸å¯¹äºæ”¹è¿›å‰æ¨¡å‹ä¸‹é™äº†1%ï¼Œä½†æ˜¯æ”¹è¿›åçš„æ¨¡å‹å¯¹äºç›®æ ‡çš„å®šä½æ›´ä¸ºç²¾å‡†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image27.jpeg" alt="å›¾ 4.10 å°ç›®æ ‡æ£€æµ‹æµ‹è¯•å›¾ç‰‡" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image28.jpg" alt="å›¾ 4.11 æ”¹è¿›å‰æ¨¡å‹å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœ" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image29.jpg" alt="å›¾ 4.12 æ”¹è¿›åæ¨¡å‹å¯¹å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœ" /></p>
<p>å›¾4.13ä¸ºæ”¹è¿›åæ¨¡å‹çš„å„ä¸ªæ¨¡å—çš„è®¡ç®—é€Ÿåº¦å›¾ï¼Œæ¨ªåæ ‡ä¸ºå„ä¸ªæ¨¡å—ï¼Œçºµåæ ‡ä¸ºæ¶ˆè€—çš„æ—¶é—´ã€‚å¯ä»¥çœ‹åˆ°æ”¹è¿›åçš„æ¨¡å‹åœ¨æ¨ç†éƒ¨åˆ†è€—æ—¶ä¸º1.8<br />
msï¼Œè€Œå¯¹æ¨ç†ç»“æœåšéæå¤§å€¼æŠ‘åˆ¶è€—æ—¶4.5 msï¼Œæ€»ä½“è€—æ—¶6.3<br />
msã€‚å¯ä»¥ä¼°ç®—å¾—åˆ°æ”¹è¿›åæ¨¡å‹çš„é€Ÿåº¦çº¦ä¸º159 FPSï¼Œå¯ä»¥æ»¡è¶³å®æ—¶æ€§çš„è¦æ±‚ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.3/paper-image30.png" alt="å›¾ 4.13æ”¹è¿›åæ¨¡å‹çš„è®¡ç®—é€Ÿåº¦" /></p>
<h2 id="æœ¬ç« å°ç»“-3"><a class="markdownIt-Anchor" href="#æœ¬ç« å°ç»“-3"></a> æœ¬ç« å°ç»“</h2>
<p>æœ¬ç« é’ˆå¯¹YOLOv5æ”¹è¿›å‰åçš„æ¨¡å‹è¿›è¡Œäº†å®éªŒå¯¹æ¯”ï¼Œå¯¹æ¯”äº†è®­ç»ƒæ—¶æœŸçš„losså˜åŒ–å’Œå®Œæˆè®­ç»ƒåçš„ç²¾ç¡®åº¦ã€å¬å›ç‡å’Œå‡å€¼å¹³å‡ç²¾ç¡®åº¦ç­‰ã€‚æ­¤å¤–è¿˜å¯¹æ¯”äº†ä¸¤ä¸ªæ¨¡å‹å¯¹äºå®é™…å›¾ç‰‡çš„æ£€æµ‹æ•ˆæœã€‚</p>
<h1 id="æ€»ç»“ä¸å±•æœ›"><a class="markdownIt-Anchor" href="#æ€»ç»“ä¸å±•æœ›"></a> æ€»ç»“ä¸å±•æœ›</h1>
<h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h2>
<p>æœ¬æ–‡é¦–å…ˆè®²è¿°äº†è½¦è¾†è¡Œäººæ£€æµ‹çš„ç ”ç©¶èƒŒæ™¯åŠå…¶æ„ä¹‰ï¼Œç®€è¦çš„é˜è¿°äº†ç›®æ ‡æ£€æµ‹ç®—æ³•çš„ç ”ç©¶ç°çŠ¶ã€‚éšååœ¨ç¬¬äºŒç« ä¸­ä»‹ç»äº†å·ç§¯ç¥ç»ç½‘ç»œçš„å·ç§¯çš„åŸç†å’Œç»“æ„ï¼Œåˆ†æäº†å…¶ä¸­çš„ä¼˜ç¼ºç‚¹ã€‚é‡ç‚¹è®²è¿°äº†YOLOv5çš„æ¨¡å‹ç»“æ„å’Œå…¶ä¸­å„ä¸ªæ¨¡å—çš„ä½œç”¨å’ŒYOLOv5çš„æ£€æµ‹æµç¨‹ã€‚</p>
<p>å¯¹äºè¡Œäººè½¦è¾†æ£€æµ‹ä¼˜åŒ–æ–¹é¢ï¼Œæœ¬æ–‡åˆ†æäº†è¡Œäººè½¦è¾†æ•°æ®é›†ä¸­æ•°æ®ä¸å‡è¡¡å’Œå°ç›®æ ‡è¾ƒå¤šçš„é—®é¢˜ï¼Œæ­¤å¤–è¿˜åˆ†æäº†YOLOv5æ¨¡å‹åœ¨å½“å‰æ•°æ®é›†ä¸Šå­˜åœ¨çš„ä¸€äº›å°é—®é¢˜ã€‚é’ˆå¯¹è¿™äº›é—®é¢˜æœ¬æ–‡ä¸‰ç‚¹æ”¹è¿›æ–¹æ¡ˆï¼š</p>
<p>(1)ã€æå‡ºäº†ä½¿ç”¨é©¬èµ›å…‹æ•°æ®å¢å¼ºæ¥è§£å†³æ•°æ®é›†ä¸­å„ä¸ªç±»åˆ«æ ·æœ¬åˆ†å¸ƒä¸å‡è¡¡çš„é—®é¢˜ã€‚</p>
<p>(2)ã€é’ˆå¯¹YOLOv5å¯¹å¤§å‹è½¦è¾†çš„æ£€æµ‹æ•ˆæœä¸ç†æƒ³çš„é—®é¢˜ï¼Œæœ¬æ–‡æå‡ºäº†æ–°å¢ä¸€å±‚ä¸‹é‡‡æ ·å±‚ä»¥è·å–æ›´å¤šçš„ç‰¹å¾ã€‚</p>
<p>(3)ã€é’ˆå¯¹æ•°æ®é›†ä¸­å°ç›®æ ‡è¾ƒå¤šçš„é—®é¢˜å’Œå°ç›®æ ‡å®šä½ä¸ç†æƒ³çš„é—®é¢˜ï¼Œæœ¬æ–‡æå‡ºäº†å¯¹YOLOv5æ¨¡å‹çš„ç‰¹å¾èåˆéƒ¨åˆ†è¿›è¡Œè°ƒæ•´ã€‚ä½¿ç”¨4å€ä¸‹é‡‡æ ·çš„ç‰¹å¾å›¾æ£€æµ‹å°ç›®æ ‡ã€‚</p>
<p>æœ¬æ–‡æœ€åå¯¹æ”¹è¿›æ–¹æ¡ˆè¿›è¡Œäº†å®éªŒéªŒè¯ï¼Œç»“æœè¡¨æ˜ç›¸è¾ƒäºåŸæœ¬çš„YOLOv5æ¨¡å‹ï¼Œæ”¹è¿›åçš„æ¨¡å‹åœ¨å¡è½¦å’Œå…¬äº¤è½¦ç­‰å¤§ç‰©ä½“åˆ†è¾¨çš„æ•ˆæœä¸Šæœ‰äº†å¾ˆå¤§çš„æå‡ã€‚æ­¤å¤–æ”¹è¿›åæ¨¡å‹å¯¹å°ç‰©ä½“çš„å®šä½æ•ˆæœä¹Ÿæ¯”åŸæ¥çš„æ›´å¥½äº†ã€‚è™½ç„¶æ¨¡å‹ä»ç„¶ä¿æŒç€å®æ—¶æ£€æµ‹çš„æ•ˆæœï¼Œä½†æ˜¯æ¨¡å‹çš„å¤§å°æœ‰å˜å¤§äº†ã€‚</p>
<h2 id="å±•æœ›"><a class="markdownIt-Anchor" href="#å±•æœ›"></a> å±•æœ›</h2>
<p>ç»è¿‡æ”¹è¿›åçš„YOLOv5æ¨¡å‹è¿˜å¯ä»¥åšå‡ºæ›´å¤šçš„æ”¹å–„ï¼Œé¦–å…ˆæ”¹è¿›åçš„YOLOv5æ¨¡å‹è™½ç„¶åœ¨å‡å€¼å¹³å‡ç²¾ç¡®ç‡ã€ç²¾ç¡®ç‡å’Œå¬å›ç‡ç­‰æŒ‡æ ‡ä¸Šæœ‰æ‰€æå‡ï¼Œä½†æ˜¯å› ä¸ºå…¶æ–°å¢åŠ äº†ä¸€ä¸ªä¸‹é‡‡æ ·å±‚ï¼ŒåŒæ—¶è¿˜ä¸å¤§å°ºå¯¸çš„ç‰¹å¾å›¾è¿›è¡Œç‰¹å¾èåˆï¼Œæ¨¡å‹çš„å‚æ•°é‡ä¹Ÿå› æ­¤å¢å¤§ï¼Œä¸åˆ©äºåµŒå…¥å¼ç­‰èµ„æºç´§ç¼ºçš„è®¾å¤‡éƒ¨ç½²ã€‚å› æ­¤å¸Œæœ›èƒ½å¤Ÿåœ¨ä¿æŒç°æœ‰ç²¾åº¦çš„æƒ…å†µä¸‹é™ä½æ¨¡å‹çš„å¤§å°ã€‚å…¶æ¬¡æ”¹è¿›åçš„YOLOv5æ¨¡å‹å¯¹äºå¤§é‡ç‰©ä½“å’Œè¿œå¤„çš„å°ç›®æ ‡è¯†åˆ«æ•ˆæœä¾ç„¶ä¸ä½³ã€‚</p>
<p>åç»­çš„å·¥ä½œæœ‰ä¸‰ä¸ªæ–¹å‘ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¯¹è¡Œäººè½¦è¾†æ•°æ®é›†åšå¤„ç†ï¼Œå¯¹å…¶ä¸­æ¯”è¾ƒå°‘çš„å®ä¾‹ç±»åšä¸Šé‡‡æ ·å¤„ç†æˆ–è€…æ˜¯äººä¸ºçš„å¢åŠ è¿™éƒ¨åˆ†æ•°æ®ï¼Œä½¿å¾—ç±»åˆ«çš„åˆ†å¸ƒæ¯”è¾ƒå‡è¡¡ã€‚ç¬¬äºŒä¸ªæ˜¯å¯ä»¥å‚è€ƒMobileNetä¸­çš„æ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼Œå°è¯•å°†æ·±åº¦å¯åˆ†ç¦»å·ç§¯è¿ç”¨åˆ°æ”¹è¿›åYOLOv5çš„ç½‘ç»œç»“æ„ä¸­ï¼Œå°†ç½‘ç»œæ¨¡å‹è½»é‡åŒ–ã€‚ç¬¬ä¸‰ä¸ªæ˜¯å°è¯•å°†æœ€è¿‘æ¯”è¾ƒç«çš„è§†è§‰Transformeråº”ç”¨åˆ°YOLOv5ç½‘ç»œç»“æ„ä¸­æ”¹å–„ç½‘ç»œçš„æ£€æµ‹æ•ˆæœã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<hr class="footnotes-sep" />
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>ä¸­å›½ç»Ÿè®¡å¹´é‰´[Z]. ä¸­å›½ç»Ÿè®¡å‡ºç‰ˆç¤¾. 2019. <a href="#fnref1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn2" class="footnote-item"><p>ä¸­å›½ç»Ÿè®¡å¹´é‰´[Z]. ä¸­å›½ç»Ÿè®¡å‡ºç‰ˆç¤¾. 2020. <a href="#fnref2" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn3" class="footnote-item"><p>Zou Z, Shi Z, Guo Y, et al. Object detection in 20 years: A survey[J]. arXiv preprint arXiv:1905.05055, 2019. <a href="#fnref3" class="footnote-backref">â†©ï¸</a> <a href="#fnref3:1" class="footnote-backref">â†©ï¸</a> <a href="#fnref3:2" class="footnote-backref">â†©ï¸</a> <a href="#fnref3:3" class="footnote-backref">â†©ï¸</a> <a href="#fnref3:4" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn4" class="footnote-item"><p>Dalal N, Triggs B. Histograms of oriented gradients for human detection[C]//2005 IEEE computer society conference on computer vision and pattern recognition (CVPRâ€™05). Ieee, 2005, 1: 886-893. <a href="#fnref4" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn5" class="footnote-item"><p>Lowe D G. Object recognition from local scale-invariant features[C]//Proceedings of the seventh IEEE international conference on computer vision. Ieee, 1999, 2: 1150-1157. <a href="#fnref5" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn6" class="footnote-item"><p>Cortes C, Vapnik V. Support-vector networks[J]. Machine learning, 1995, 20(3): 273-297. <a href="#fnref6" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn7" class="footnote-item"><p>Freund Y, Schapire R E. A decision-theoretic generalization of on-line learning and an application to boosting[J]. Journal of computer and system sciences, 1997, 55(1): 119-139. <a href="#fnref7" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn8" class="footnote-item"><p>Krizhevsky A, Sutskever I, Hinton G E. Imagenet classification with deep convolutional neural networks[J]. Advances in neural information processing systems, 2012, 25: 1097-1105. <a href="#fnref8" class="footnote-backref">â†©ï¸</a> <a href="#fnref8:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn9" class="footnote-item"><p>Girshick R, Donahue J, Darrell T, et al. Rich feature hierarchies for accurate object detection and semantic segmentation[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2014: 580-587. <a href="#fnref9" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn10" class="footnote-item"><p>Girshick R. Fast r-cnn[C]//Proceedings of the IEEE international conference on computer vision. 2015: 1440-1448. <a href="#fnref10" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn11" class="footnote-item"><p>Ren S, He K, Girshick R, et al. Faster r-cnn: Towards real-time object detection with region proposal networks[J]. arXiv preprint arXiv:1506.01497, 2015. <a href="#fnref11" class="footnote-backref">â†©ï¸</a> <a href="#fnref11:1" class="footnote-backref">â†©ï¸</a> <a href="#fnref11:2" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn12" class="footnote-item"><p>Redmon J, Divvala S, Girshick R, et al. You only look once: Unified, real-time object detection[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2016: 779-788. <a href="#fnref12" class="footnote-backref">â†©ï¸</a> <a href="#fnref12:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn13" class="footnote-item"><p>Redmon J, Farhadi A. YOLO9000: better, faster, stronger[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2017: 7263-7271. <a href="#fnref13" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn14" class="footnote-item"><p>Lin M, Chen Q, Yan S. Network in network[J]. arXiv preprint arXiv:1312.4400, 2013. <a href="#fnref14" class="footnote-backref">â†©ï¸</a> <a href="#fnref14:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn15" class="footnote-item"><p>Redmon J, Farhadi A. Yolov3: An incremental improvement[J]. arXiv preprint arXiv:1804.02767, 2018. <a href="#fnref15" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn16" class="footnote-item"><p>Bochkovskiy A, Wang C Y, Liao H Y M. Yolov4: Optimal speed and accuracy of object detection[J]. arXiv preprint arXiv:2004.10934, 2020. <a href="#fnref16" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn17" class="footnote-item"><p>Hubel D H, Wiesel T N. Receptive fields of single neurones in the catâ€™s striate cortex[J]. The Journal of physiology, 1959, 148(3): 574-591. <a href="#fnref17" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn18" class="footnote-item"><p>Fukushima K, Miyake S. Neocognitron: A self-organizing neural network model for a mechanism of visual pattern recognition[M]//Competition and cooperation in neural nets. Springer, Berlin, Heidelberg, 1982: 267-285. <a href="#fnref18" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn19" class="footnote-item"><p>LeCun Y, Bottou L, Bengio Y, et al. Gradient-based learning applied to document recognition[J]. Proceedings of the IEEE, 1998, 86(11): 2278-2324. <a href="#fnref19" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn20" class="footnote-item"><p>å‘¨é£ç‡•,é‡‘æ—é¹,è‘£å†›.å·ç§¯ç¥ç»ç½‘ç»œç ”ç©¶ç»¼è¿°[J].è®¡ç®—æœºå­¦æŠ¥,2017,40(06):1229-1251. <a href="#fnref20" class="footnote-backref">â†©ï¸</a> <a href="#fnref20:1" class="footnote-backref">â†©ï¸</a> <a href="#fnref20:2" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn21" class="footnote-item"><p>è’‹æ˜‚æ³¢,ç‹ç»´ç»´.ReLUæ¿€æ´»å‡½æ•°ä¼˜åŒ–ç ”ç©¶[J].ä¼ æ„Ÿå™¨ä¸å¾®ç³»ç»Ÿ,2018,37(02):50-52. <a href="#fnref21" class="footnote-backref">â†©ï¸</a> <a href="#fnref21:1" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn22" class="footnote-item"><p>Liu S, Qi L, Qin H, et al. Path aggregation network for instance segmentation[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2018: 8759-8768. <a href="#fnref22" class="footnote-backref">â†©ï¸</a></p>
</li>
<li id="fn23" class="footnote-item"><p>é é»˜ç„¶,ç½—æµ·æ³¢,ç‹ä»²åš,ä½•æ·¼,å¸¸é“®,æƒ æ–Œ.æ”¹è¿›çš„YOLO V3ç®—æ³•åŠå…¶åœ¨å°ç›®æ ‡æ£€æµ‹ä¸­çš„åº”ç”¨[J].å…‰å­¦å­¦æŠ¥,2019,39(07):253-260. <a href="#fnref23" class="footnote-backref">â†©ï¸</a></p>
</li>
</ol>
</section>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¯•ä¸šè®¾è®¡ï¼ˆä¸ƒï¼‰åŸºäºæ·±åº¦å­¦ä¹ ç®—æ³•YOLOçš„è¡Œäººè½¦è¾†æ£€æµ‹â€”â€”ç­”è¾©è®°å½•</title>
    <url>/2021/07/03/YOLO-oral-defense/</url>
    <content><![CDATA[<p>å¾ˆä¸å¹¸çš„æ˜¯è¢«æŠ½åˆ°äº†å…¬å¼€ç­”è¾©ï¼Œç„¶è€Œå¹¸è¿çš„æ˜¯æˆ‘æ˜¯ç¬¬ä¸€ä¸ªç­”è¾©ï¼Œç³»é‡Œé¢çš„è€å¸ˆä¹Ÿæ²¡æœ‰å…¨æ¥ï¼Œå¤§æ¦‚åˆ°åœºçš„ä¹Ÿå°±8åˆ°9ä¸ªã€‚</p>
<span id="more"></span>
<h1 id="å†™åœ¨å‰é¢"><a class="markdownIt-Anchor" href="#å†™åœ¨å‰é¢"></a> å†™åœ¨å‰é¢</h1>
<p>æˆ‘ä¼°è®¡è€å¸ˆåœ¨ç­”è¾©çš„æ—¶å€™æ„Ÿè§‰å‡ºæ¥æˆ‘åšçš„æ¯”è¾ƒæ°´ï¼Œåªæ˜¯å› ä¸ºæœ‰ç£å¯¼åœ¨å‰é¢å°±ç»™æˆ‘ç‚¹é¢å­ï¼Œæœ€åæ°´äº†ä¸ªä¼˜ç§€æ¯•ä¸šè®ºæ–‡ã€‚æ ¡ä¼˜ç§€å°±ä¸ç”³è¯·äº†ï¼Œå«Œéº»çƒ¦ï¼Œè€Œä¸”ä¼°è®¡æ›´å¤šè€å¸ˆçœ‹æ˜ç™½æ˜¯ä¸ªæ°´æ–‡ã€‚</p>
<blockquote>
<p>ç­”è¾©PPT: <a href="https://pan.baidu.com/s/1V_GZbogIoj9Q_tkY7HfqQw">ç™¾åº¦ç›˜</a> æå–ç : p7yv</p>
</blockquote>
<h1 id="ç­”è¾©è®°å½•"><a class="markdownIt-Anchor" href="#ç­”è¾©è®°å½•"></a> ç­”è¾©è®°å½•</h1>
<ul>
<li>Q1ï¼š å‡ ç±»ç›®æ ‡ï¼Ÿ<br />
6ç±»ï¼Œåˆ†åˆ«ä¸ºè¡Œäººï¼ˆPersonï¼‰ã€è‡ªè¡Œè½¦ï¼ˆbikeï¼‰ã€æœºåŠ¨è½¦ï¼ˆcarï¼‰ã€æ‘©æ‰˜è½¦ï¼ˆmotorï¼‰ã€å…¬äº¤è½¦ï¼ˆbusï¼‰å’Œå¡è½¦ï¼ˆtruckï¼‰</li>
<li>Q2ï¼šå®æµ‹æ¡†æ¶ï¼Ÿ<br />
æœ¬æ¬¡ç³»ç»Ÿä½¿ç”¨pytorchæ¡†æ¶å®ç°</li>
<li>Q3ï¼šä¸å¹³è¡¡æ€ä¹ˆå»ç¡®å®š<br />
æ ¹æ®æ•°æ®é›†ä¸­å„ä¸ªç±»çš„æ•°é‡æ¯”å¯¹ï¼Œ è¡Œäººç±»å’ŒæœºåŠ¨è½¦ç±»æ˜æ˜¾æ¯”å…¶ä»–ç±»åˆ«è¦å¤š</li>
<li>Q4ï¼šæ•°æ®é›†å¦‚ä½•è‡ªå»ºï¼Ÿæ”¶é›†ï¼Ÿ<br />
æœ¬æ¬¡æ•°æ®é›†ä»å¤§å‹æ£€æµ‹æ•°æ®é›†COCOã€è‡ªåŠ¨é©¾é©¶æ•°æ®é›†BDD100Kä¸­æå–çš„å«æœ‰è¡Œäººè½¦è¾†å›¾ç‰‡å’Œç½‘ç»œçˆ¬å–çš„å›¾ç‰‡ç»„æˆã€‚</li>
<li>Q5ï¼šæŸå¤±å‡½æ•°çš„é€‰æ‹©ç†ç”±ï¼Ÿ<br />
æŸå¤±å‡½æ•°ç”±box lossã€obj lossã€cls lossä¸‰éƒ¨åˆ†ç»„æˆã€‚å…¶ä¸­box lossä¸ºè¾¹ç•Œæ¡†å®šä½éƒ¨åˆ†ï¼Œç”±c-iou lossç»„æˆï¼Œå…¶ååº”äº†é¢„æµ‹æ¡†å’ŒçœŸå®æ¡†çš„é‡å ç¨‹åº¦ã€ä¸­å¿ƒç‚¹è·ç¦»å’Œé•¿å®½æ¯”ï¼Œä¼˜åŒ–è¾¹ç•Œæ¡†çš„å®šä½é—®é¢˜ã€‚å¯¹äºåˆ†ç±»éƒ¨åˆ†é‡‡å–é€»è¾‘å›å½’å‡½æ•°èƒ½å¤Ÿæ›´å¥½çš„ååº”é¢„æµ‹ç‰©ä½“æ€§å’Œé¢„æµ‹ç±»åˆ«ä¸çœŸå®å€¼çš„å·®åˆ«ã€‚obj lossé‡‡ç”¨BCE Logitså‡½æ•°ï¼Œå¯¹è¾¹ç•Œæ¡†ä¸­å«æœ‰ç‰©ä½“çš„ç½®ä¿¡åº¦è¿›è¡Œä¼˜åŒ–ã€‚cls lossé‡‡ç”¨BCEå‡½æ•°ï¼Œå¯¹è¾¹ç•Œæ¡†çš„åˆ†ç±»è¿›è¡Œä¼˜åŒ–ã€‚</li>
<li>Q6ï¼šä¸ºä»€ä¹ˆä¸é‡‡ç”¨å…¬å¼€æ•°æ®é›†ï¼Ÿ70%è®­ç»ƒï¼Œ30%æµ‹è¯•ï¼Œç†ç”±ï¼Ÿ<br />
ç”±äºæœªèƒ½æ‰¾åˆ°ç¬¦åˆæˆ‘éœ€æ±‚çš„å…¬å¼€æ•°æ®é›†ï¼Œå› æ­¤ä»å„ä¸ªå…¬å¼€æ•°æ®é›†ä¸­æå–éœ€è¦çš„ç±»åˆ«æ£€æµ‹ã€‚<br />
æœ¬æ¬¡è®­ç»ƒå’ŒéªŒè¯ä¸€å…±ä½¿ç”¨çº¦2ä¸‡å¼ å›¾ç‰‡ï¼Œå±äºå°æ•°æ®é›†ã€‚å› æ­¤é‡‡ç”¨æœºå™¨å­¦ä¹ ä¸­ä¼ ç»Ÿçš„åˆ’åˆ†æ–¹æ³•ï¼Œå³å°†70%çš„æ•°æ®ç”¨äºè®­ç»ƒï¼Œ20%æ•°æ®ç”¨äºéªŒè¯ã€‚<br />
(å…¶å®å› ä¸ºæ²¡é’±ã€‚å…è´¹colabå«–åˆ°æ²¡æ¬¡æ•°äº†ï¼Œç§Ÿçš„GPUåˆè´µï¼Œç½‘ç›˜åŠŸèƒ½å…è´¹åªç»™5Gï¼Œåªèƒ½æå°ä¸€ç‚¹æ•°æ®é›†)</li>
<li>Q7ï¼šæ”¹è¿›ç»“æœçªå‡ºå“ªäº›ç±»ï¼Ÿ<br />
æ‰€æœ‰ç±»çš„å‡å€¼å¹³å‡ç²¾ç¡®åº¦éƒ½æœ‰ä¸€å®šçš„æå‡ï¼Œæ•ˆæœæœ€å¤§çš„ä¸ºæœºåŠ¨è½¦ç±»ï¼Œçº¦æœ‰4.1%çš„æå‡æ•ˆæœã€‚</li>
<li>Q8ï¼šä¸ºä»€ä¹ˆcarç±»æå‡æ•ˆæœæœ€é«˜ï¼Ÿ<br />
è°ƒæ•´ç‰¹å¾èåˆéƒ¨åˆ†ä¸»è¦æ˜¯é’ˆå¯¹é•¿å®½å°äº8åƒç´ çš„å°ç›®æ ‡æ”¹è¿›ï¼Œè€Œåœ¨è¿™äº›å°ç›®æ ‡ä¸­carç±»çš„å®ä¾‹æ•°é‡çº¦å ä¸€åŠï¼Œå› æ­¤carç±»å—åˆ°çš„æå‡æ•ˆæœæœ€é«˜ã€‚<br />
(å› ä¸ºå½“æ—¶PPTæ‰“é”™äº†ï¼Œè€å¸ˆåŸæœ¬é—®çš„æ˜¯motor)</li>
</ul>
<h1 id="å†™åœ¨æœ€å"><a class="markdownIt-Anchor" href="#å†™åœ¨æœ€å"></a> å†™åœ¨æœ€å</h1>
<p>å› ä¸ºå½“æ—¶ç­”è¾©çš„PPTæŠŠmotorç±»çš„æ•°å€¼å†™é”™äº†ï¼Œä»¥è‡³äºè€å¸ˆä»¥ä¸ºæˆ‘çš„æå‡æ•ˆæœæœ‰10%ï¼Œå®é™…åªæœ‰2%å·¦å³å§ã€‚æå¾—æˆ‘ç­”è¾©æ—¶å€™å¾ˆæ‡µé€¼ï¼Œæ€»å…±æå‡æ•ˆæœä¸€èˆ¬èˆ¬ï¼Œè€Œè€å¸ˆä»¥ä¸ºå¾ˆå¤§ã€‚</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>æ¯•ä¸šè®¾è®¡</tag>
        <tag>yolo</tag>
      </tags>
  </entry>
  <entry>
    <title>ResNetè®ºæ–‡ç¬”è®°</title>
    <url>/2021/07/11/ResNet-Note/</url>
    <content><![CDATA[<p>ResNetæ˜¯è§£å†³äº†æ·±åº¦å­¦ä¹ ç½‘ç»œä¸­éšç€ç½‘ç»œæ·±åŒ–ï¼Œç½‘ç»œèƒ½åŠ›åè€Œé€€åŒ–çš„é—®é¢˜ã€‚<br />
å°é¢ã€Šæ‹Ã—ã‚·ãƒ³ã‚¢ã‚¤å½¼å¥³ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å·ç§¯ç¥ç»ç½‘ç»œä¸­ç½‘ç»œçš„æ·±åº¦æ˜¯éå¸¸å…³é”®çš„ï¼Œè®¸å¤šéå‡¡çš„è§†è§‰è¯†åˆ«ä»»åŠ¡éƒ½æ”¶ç›Šäºéå¸¸æ·±çš„æ¨¡å‹ã€‚å› æ­¤ä¾¿æœ‰ä¸€ä¸ªé—®é¢˜â€œå­¦ä¹ æ›´å¥½çš„ç½‘ç»œæ˜¯å¦å°±åƒå †å æ›´å¤šçš„å±‚ä¸€æ ·ç®€å•ï¼Ÿâ€å›ç­”è¿™ä¸ªé—®é¢˜çš„å…¶ä¸­ä¸€ä¸ªè‡­åæ˜­è‘—çš„éšœç¢å°±æ˜¯â€œæ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸â€ï¼Œå…¶é˜»ç¢äº†ç½‘ç»œæ”¶æ•›ã€‚ç„¶è€Œè¿™ä¸ªé—®é¢˜è¢«é€šè¿‡åˆå§‹å½’ä¸€åŒ–å’Œä¸­é—´å±‚å½’ä¸€åŒ–è§£å†³äº†ã€‚<br />
å½“æ›´æ·±çš„ç½‘ç»œèƒ½å¤Ÿæ”¶æ•›çš„æ—¶å€™ï¼Œç½‘ç»œé€€åŒ–çš„é—®é¢˜å‡ºç°äº†ã€‚éšç€ç½‘ç»œæ·±åº¦çš„å¢åŠ ï¼Œå‡†ç¡®ç‡è¾¾åˆ°é¥±å’Œç„¶åè¿…é€Ÿä¸‹é™ã€‚è®©äººæ„å¤–çš„æ˜¯è¿™ç§é€€åŒ–å¹¶ä¸æ˜¯ç”±è¿‡æ‹Ÿåˆå¯¼è‡´çš„ï¼Œéšç€å±‚æ•°çš„ä¸æ–­å¢åŠ ï¼Œæ¨¡å‹åè€Œæœ‰äº†æ›´é«˜çš„è®­ç»ƒè¯¯å·®ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/fig1.png" alt="" /></p>
<h1 id="æ­£æ–‡"><a class="markdownIt-Anchor" href="#æ­£æ–‡"></a> æ­£æ–‡</h1>
<p>ä¸ºäº†è§£å†³é€€åŒ–é—®é¢˜ï¼Œä½•å‡¯æ˜å›¢é˜Ÿæå‡ºäº†ä¸€ç§æ–°å‹ç½‘ç»œç»“æ„â€”â€”æ®‹å·®ç»“æ„ã€‚å…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ–°å¢åŠ çš„å±‚ä¸ºæ’ç­‰æ˜ å°„å±‚ï¼Œå¦ä¸€ä¸ªä¸ºä»æµ…å±‚å­¦ä¹ ç»“æœçš„å¤åˆ¶ã€‚åŸæœ¬åº•å±‚çš„è¾“å‡ºå˜æˆäº†<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span>ï¼Œå¢åŠ çš„éçº¿æ€§è¿æ¥å»æ‹Ÿåˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>:</mo><mo>=</mo><mi>H</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">F(x):=H(x)-x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>ï¼ŒåŸå§‹çš„æ˜ å°„é‡æ„æˆäº†<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">F(x)+x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>ã€‚ä½•å‡¯æ˜å›¢é˜Ÿå‡å®šæ®‹å·®éƒ¨åˆ†æ¯”åŸæœ¬æ˜ å°„æ›´å®¹æ˜“ä¼˜åŒ–ã€‚å¦‚æœæ’ç­‰æ˜ å°„æ˜¯æœ€ä¼˜çš„ï¼Œé‚£ä¹ˆåªéœ€è¦è®²æ®‹å·®éƒ¨åˆ†ç½®0å³å¯ï¼Œè¿™æ¯”æ‹Ÿåˆéçº¿æ€§å±‚æ›´å®¹æ˜“ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/res_block.png" alt="" /><br />
<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">F(x)+x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>å¯ä»¥é€šè¿‡å‰å‘ç¥ç»ç½‘ç»œåŠ ä¸Šâ€œçŸ­è·¯â€œï¼ˆshortcutï¼‰æ¥å®ç°ï¼Œæ— éœ€é¢å¤–å‚æ•°å’Œè®¡ç®—å¤æ‚åº¦ï¼Œä¾ç„¶å¯ä»¥ç”¨SGDæ¥ä¼˜åŒ–ã€‚</p>
<h1 id="ç½‘ç»œç»“æ„"><a class="markdownIt-Anchor" href="#ç½‘ç»œç»“æ„"></a> ç½‘ç»œç»“æ„</h1>
<h2 id="plain-network"><a class="markdownIt-Anchor" href="#plain-network"></a> plain network</h2>
<p>å—åˆ°VGGå¯å‘ï¼Œä½•å‡¯æ˜å›¢é˜ŸåŸºäºä»¥ä¸‹åŸåˆ™è®¾è®¡äº†ä¸€ç§æ–°çš„ç»“æ„plain-networkä½œä¸ºæµ‹è¯•çš„åŸºå‡†çº¿</p>
<ul>
<li>è¾“å‡ºå¤§å°ä¸€æ ·çš„å±‚æ‹¥æœ‰ä¸€æ ·çš„å·ç§¯æ ¸æ•°</li>
<li>ç‰¹å¾å›¾å˜æˆåŸæ¥ä¸€åŠçš„æ—¶å€™è¾“å‡ºçš„å·ç§¯æ ¸ç¿»å€<br />
åŒæ—¶ä½¿ç”¨æ­¥é•¿ä¸º2çš„å·ç§¯æ›¿ä»£ä¸‹é‡‡æ ·ï¼Œä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–å’Œå¸¦æœ‰softmaxçš„1000è¾“å‡ºå…¨è¿æ¥ä½œä¸ºè¾“å‡ºã€‚è¯¥ç»“æ„æ¯”VGGèŠ±è´¹æ›´å°‘çš„å·ç§¯æ ¸ï¼Œå¤æ‚åº¦æ›´ä½ã€‚è®¡ç®—é‡ä¸º3.6 BFLOPsï¼ˆä¹˜åŠ ï¼‰ï¼Œåªæœ‰åŸæœ¬VGGçš„18%ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/architectures.png" alt="" /></li>
</ul>
<h2 id="residual-network"><a class="markdownIt-Anchor" href="#residual-network"></a> residual network</h2>
<p>plain networkçš„æ®‹å·®ç‰ˆï¼Œå¯¹äºè¾“å…¥è¾“å‡ºç»´åº¦ç›¸ç­‰æ—¶ç›´æ¥â€çŸ­è·¯â€œå³å¯ï¼Œå³ä¸Šå›¾ä¸­çš„å®çº¿ã€‚å¯¹äºç»´åº¦ä¸Šå‡çš„ï¼Œå›¾ä¸­è™šçº¿éƒ¨åˆ†ï¼Œåˆ™æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ol>
<li>çŸ­è·¯éƒ¨åˆ†ä¾ç„¶ä½¿ç”¨æ’ç­‰æ˜ å°„ï¼Œç»´åº¦å¢åŠ çš„éƒ¨åˆ†è¡¥0å¡«å……ï¼Œè¿™æ ·ä¸ä¼šå¼•å…¥æ–°çš„å‚æ•°</li>
<li>ä½¿ç”¨å…¬å¼<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><msub><mi>W</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>+</mo><msub><mi>W</mi><mi>s</mi></msub><mi>x</mi></mrow><annotation encoding="application/x-tex">y=F(x,{W_i})+W_sx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">s</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault">x</span></span></span></span>åŒ¹é…ç»´åº¦ï¼Œä½¿ç”¨1Ã—1å·ç§¯å®ç°ã€‚<br />
å¯¹äºä¸¤ç§å®ç°æ–¹æ¡ˆï¼Œè¿æ¥ä¸åŒå¤§å°çš„ç‰¹å¾å›¾æ—¶ï¼Œéƒ½éœ€è¦æ­¥é•¿ä¸º2ã€‚</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/table1.png" alt="" /><br />
è¡¨ä¸€ä¸ºå…¶ç»“æ„çš„å„ç§å˜ç§ã€‚</p>
<h1 id="å®éªŒ"><a class="markdownIt-Anchor" href="#å®éªŒ"></a> å®éªŒ</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/fig4.png" alt="" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/top1-error.png" alt="top1-error" /></p>
<h1 id="æ›´æ·±çš„ç“¶é¢ˆç»“æ„"><a class="markdownIt-Anchor" href="#æ›´æ·±çš„ç“¶é¢ˆç»“æ„"></a> æ›´æ·±çš„ç“¶é¢ˆç»“æ„</h1>
<p>ä¸ºäº†å‡å°‘æ·±å±‚ç½‘ç»œçš„è®­ç»ƒæ—¶é—´ï¼Œä½œè€…é‡æ–°è®¾è®¡äº†ä¸€ç§ç“¶é¢ˆç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä½¿ç”¨1Ã—1ï¼Œ3Ã—3ï¼Œ1Ã—1å·ç§¯æ›¿æ¢åŸæ¥çš„2å±‚å·ç§¯ã€‚å…¶ä¸­1Ã—1çš„å·ç§¯ç”¨äºå‡é™ç»´ï¼Œä½¿å¾—3Ã—3å·ç§¯çš„è¾“å…¥ç»´åº¦å’Œè¾“å‡ºç»´åº¦å‡å°ï¼Œè¿™é™ä½äº†ç½‘ç»œå¤æ‚åº¦å’Œè®¡ç®—é‡ã€‚ï¼ˆåœ¨åç»­ä¸€äº›ç½‘ç»œå¦‚YOLOä¸­éƒ½èƒ½çœ‹åˆ°bottleneckç»“æ„ï¼‰<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.2/bottleneck.png" alt="" /></p>
<h1 id="å°ç»“"><a class="markdownIt-Anchor" href="#å°ç»“"></a> å°ç»“</h1>
<p>ResNetä¸­çš„æ®‹å·®ç»“æ„è§£å†³äº†ç½‘ç»œé€€åŒ–é—®é¢˜ï¼Œä¸”ç»“æ„ç®€å•ï¼Œç°å®æ–¹ä¾¿ä¹Ÿæ²¡æœ‰å¢åŠ å¤ªå¤šçš„è®¡ç®—é‡ã€‚åœ¨åç»­çš„ç½‘ç»œä¸­å‡ ä¹å…¨éƒ½æœ‰æ®‹å·®ç»“æ„ï¼Œè€Œä¸”ç½‘ç»œæ·±åº¦ä¹Ÿå¼€å§‹åˆ°äº†ä¸Šç™¾å±‚,è®­ç»ƒæ—¶ä¹Ÿæ›´å®¹æ˜“OOMäº†ï¼ˆå“­ï¼‰ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p>[1] He K, Zhang X, Ren S, et al. Deep residual learning for image recognition[C]//Proceedings of the IEEE conference on computer vision and pattern recognition. 2016: 770-778.</p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>åŠæ¬¡å…ƒçˆ¬è™«</title>
    <url>/2021/07/27/bcy-spider/</url>
    <content><![CDATA[<p>çœ‹ç€åŠæ¬¡å…ƒçš„å›¾ä¸é”™ï¼Œæ‰“ç®—çˆ¬ä¸€çˆ¬<br />
å°é¢ã€Šchaos;childã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºå¶ç„¶çš„æœºä¼šå¾—çŸ¥äº†åŠæ¬¡å…ƒçš„å­˜åœ¨ï¼Œåç»­åˆè§‰å¾—åŠæ¬¡å…ƒçš„COSå›¾ã€JKå›¾è¿˜æœ‰ä¸€äº›ç»˜å›¾ä¸é”™ï¼Œå› æ­¤æ‰“ç®—çˆ¬ä¸€äº›å¥½çœ‹çš„å›¾ç‰‡ã€‚</p>
<h1 id="åˆ†æç½‘é¡µ"><a class="markdownIt-Anchor" href="#åˆ†æç½‘é¡µ"></a> åˆ†æç½‘é¡µ</h1>
<h2 id="åˆ†æhtml"><a class="markdownIt-Anchor" href="#åˆ†æhtml"></a> åˆ†æhtml</h2>
<p>åˆ†æè¢«çˆ¬çš„ç½‘é¡µè‚¯å®šæ˜¯è¦æ‰“å¼€æ§åˆ¶å°äº†ï¼ŒæŒ‰ä¸‹F12å…ˆè§‚å¯Ÿhtmlå¯ä»¥å‘ç°åœ¨ç¬¬ä¸€ä¸ª<code>&lt;script&gt;</code>æ ‡ç­¾ä¸­å­˜åœ¨ä¸€ä¸ªjsonæ–‡ä»¶ã€‚è¿™ä¸ªjsonåŒ…å«äº†ä½ çš„ç”¨æˆ·ä¿¡æ¯ã€åœˆå­ä¿¡æ¯å’Œå›¾ç‰‡ä¿¡æ¯ç­‰ã€‚å› ä¸ºæ•´ä¸ªjsonæ–‡ä»¶è§£æåè¡Œæœ‰ç‚¹ç‚¹å¤šï¼Œå› æ­¤è¿™é‡Œå°±æ”¾å‡ºéƒ¨åˆ†å†…å®¹ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.1/F12-1.png" alt="F12åˆ†æhtml" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.1/html-json.png" alt="htmlä¸­çš„json" /></p>
<h2 id="åˆ†æapi"><a class="markdownIt-Anchor" href="#åˆ†æapi"></a> åˆ†æapi</h2>
<p>ç»§ç»­åˆ†æç½‘ç»œä¿¡æ¯ï¼Œå¯ä»¥å‘ç°åœ¨å‘ä¸‹æ»šåŠ¨åå¯ä»¥å‘ç°æœ‰ä¸€ä¸ªapiè¿”å›äº†åŒ…å«å›¾ç‰‡ä¿¡æ¯çš„æ¥å£ï¼Œå…¶å‚æ•°ç»“æ„å¦‚ä¸‹<br />
<code>https://www.bcy.net/apiv3/common/circleFeed?circle_id=399&amp;since=rec:2&amp;sort_type=1&amp;grid_type=10</code><br />
ç»è¿‡å¤šæ¬¡è°ƒç”¨å¯ä»¥å‘ç°circle_idè¡¨ç¤ºè¿™ä¸ªåœˆå­çš„idï¼Œå¦‚JKã€COSæœ‰å„è‡ªçš„circle_idã€‚è€Œæ»šåŠ¨æ—¶å˜åŒ–çš„åªæœ‰sinceçš„å‚æ•°ï¼Œè¡¨ç¤ºçš„æ˜¯è°ƒç”¨ç¬¬å‡ æ³¢ã€‚å› æ­¤è¯·æ±‚çš„æ—¶å€™åªéœ€è¦ä¿®æ”¹circle_idå’Œsinceçš„å†…å®¹å³å¯<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.1/F12-2.png" alt="F12åˆ†æapiï¼ˆè¿‡æ»¤äº†æ— å…³å†…å®¹ï¼‰" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.1/api-json.png" alt="apiè¿”å›çš„json" /></p>
<h2 id="å›¾ç‰‡æ ¼å¼"><a class="markdownIt-Anchor" href="#å›¾ç‰‡æ ¼å¼"></a> å›¾ç‰‡æ ¼å¼</h2>
<p>ä»¥ä¸Šå›¾çš„ç½‘å€ä¸ºä¾‹å­ï¼ŒåŠæ¬¡å…ƒçš„å›¾ç‰‡æœ‰å¤šç§è¯·æ±‚æ ¼å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤å¤–çœ‹åˆ°jsoné‡Œé¢çš„<code>format</code>å­—æ®µåˆ™æ˜¯è¡¨ç¤ºäº†å›¾ç‰‡çš„æ ¼å¼ï¼ˆæœ‰gifçš„ï¼‰ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># è¿”å›å®½åº¦ä¸º650çš„å›¾</span><br><span class="line">https://p3-bcy.byteimg.com/img/banciyuan/756021456bf744f2a04ac989a2e106a6~tplv-banciyuan-w650.image</span><br><span class="line"># ä¸­ç­‰å¤§å°çš„å›¾</span><br><span class="line">https://p3-bcy.byteimg.com/img/banciyuan/756021456bf744f2a04ac989a2e106a6~tplv-banciyuan-sq360.image</span><br><span class="line"># ç¨å¾®å¤§ä¸€ç‚¹å¤§å›¾</span><br><span class="line">https://p3-bcy.byteimg.com/img/banciyuan/756021456bf744f2a04ac989a2e106a6~tplv-banciyuan-tl640.image</span><br><span class="line"># å°æ–¹å›¾</span><br><span class="line">https://p3-bcy.byteimg.com/img/banciyuan/756021456bf744f2a04ac989a2e106a6~tplv-banciyuan-2x2.image</span><br><span class="line"># ä¼¼ä¹æ˜¯åŸå›¾</span><br><span class="line">https://p3-bcy.byteimg.com/img/banciyuan/756021456bf744f2a04ac989a2e106a6~noop.image</span><br></pre></td></tr></table></figure>
<h1 id="çˆ¬å–å›¾ç‰‡"><a class="markdownIt-Anchor" href="#çˆ¬å–å›¾ç‰‡"></a> çˆ¬å–å›¾ç‰‡</h1>
<p>ç”±äº<code>request</code>åº“ä¸æ”¯æŒå¼‚æ­¥ï¼Œä¸‹è½½å›¾ç‰‡ä¼šæ¯”è¾ƒè€—æ—¶ï¼ŒåŒæ—¶ä¸ºäº†åç»­æ–¹ä¾¿åŠ å…¥<code>nonebot</code>æœºå™¨äººæ¡†æ¶ä¸­ï¼Œå› æ­¤ä½¿ç”¨<code>httpx</code>ä½œä¸ºæœ¬æ¬¡çš„è¯·æ±‚åº“ã€‚<code>httpx</code>å¦ä¸€ä¸ªå¥½å¤„æ˜¯å…¼å®¹<code>request</code>æ¥å£<br />
å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦ä½¿ç”¨<code>httpx.AsyncClient()</code>æˆ–æ˜¯<code>request.session()</code>è¿™ç§ä¿å­˜cookieï¼Œå¦‚æœæ²¡æœ‰cookieï¼Œæ¯æ¬¡è¯·æ±‚åŠæ¬¡å…ƒapiä¼šè¿”å›ä¸€æ ·çš„jsonæ–‡ä»¶<br />
ä¸ºäº†åŠ å¿«ä¸€å®šé€Ÿåº¦ï¼Œæœ¬æ¬¡åŠ äº†åœˆåè½¬åœˆidçš„ç¼“å­˜ï¼Œå¦‚æœåœ¨<code>nonebot</code>æ¡†æ¶é‡Œé¢å¯ä»¥ä½¿ç”¨æ•°æ®åº“æ›´å¥½ã€‚</p>
<h2 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_cookies</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    cookieè¯»å–ï¼ŒåŸŸæ•æ„Ÿå› æ­¤ä¹‹é—´è½¬dictå­˜ä¸è¡Œ</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&quot;cookies.pk&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    cookies = httpx.Cookies()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;cookies.pk&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        jar_cookies = pickle.load(f)</span><br><span class="line">    <span class="keyword">for</span> domain, pc <span class="keyword">in</span> jar_cookies.items():</span><br><span class="line">        <span class="keyword">for</span> path, c <span class="keyword">in</span> pc.items():</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> c.items():</span><br><span class="line">                cookies.<span class="built_in">set</span>(k, v.value, domain=domain, path=path)</span><br><span class="line">    <span class="keyword">return</span> cookies</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ²¡æœ‰cookieä¼šå¯¼è‡´æ¯æ¬¡è·å¾—çš„jsonæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœæ˜¯å…¨å¤©å€™å®šæ—¶æ‰§è¡Œå¯ä»¥å»é™¤cookieè¯»å–å’Œä¿å­˜</span></span><br><span class="line">client = httpx.AsyncClient(cookies=load_cookies())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_header</span>(<span class="params">image: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    è·å–request headeréƒ¨åˆ†</span></span><br><span class="line"><span class="string">    image: è¯·æ±‚çš„æ˜¯å¦ä¸ºå›¾ç‰‡</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;referer&#x27;</span>: <span class="string">&#x27;https://www.bcy.net/&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#x27;</span></span><br><span class="line">               &#125;</span><br><span class="line">    <span class="keyword">if</span> image == <span class="literal">True</span>:</span><br><span class="line">        headers[<span class="string">&#x27;accept&#x27;</span>] = <span class="string">&#x27;image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> headers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">id2name</span>(<span class="params"><span class="built_in">id</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å°†idè½¬name</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    url = <span class="string">&quot;https://www.bcy.net/tag/&#123;id&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">id</span>=<span class="built_in">id</span>)</span><br><span class="line">    r = <span class="keyword">await</span> client.get(url, headers=get_header())</span><br><span class="line">    soup = BeautifulSoup(r.text, features=<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    name = soup.find(<span class="string">&#x27;meta&#x27;</span>, &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;keywords&#x27;</span>&#125;)[<span class="string">&#x27;content&#x27;</span>].split(<span class="string">&quot; - &quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># print(name)</span></span><br><span class="line">    <span class="keyword">return</span> name</span><br><span class="line">    <span class="comment"># print(r.text)</span></span><br><span class="line">    <span class="comment"># with open(&#x27;index.html&#x27;,&#x27;w&#x27;,encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class="line">    <span class="comment">#    f.write(r.text)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">load_name2id_cache</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    è·å–name2idçš„ç¼“å­˜</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(<span class="string">&#x27;cache.json&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;cache.json&#x27;</span>,<span class="string">&#x27;r&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">save_name2id_cache</span>(<span class="params">cache</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ä¿å­˜ç¼“å­˜</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;cache.json&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># ä¸­æ–‡</span></span><br><span class="line">        json.dump(cache,f,ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">name2id</span>(<span class="params">name: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å°†nameè½¬id</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># è¯»å–name2idçš„ç¼“å­˜</span></span><br><span class="line">    cache = <span class="keyword">await</span> load_name2id_cache()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cache == <span class="literal">None</span> <span class="keyword">and</span> name <span class="keyword">in</span> cache:</span><br><span class="line">        <span class="keyword">return</span> cache[name]</span><br><span class="line">    <span class="keyword">if</span> cache == <span class="literal">None</span>:</span><br><span class="line">        cache = &#123;&#125;    </span><br><span class="line">    <span class="comment"># ç¼“å­˜åˆ™çˆ¬å–</span></span><br><span class="line">    url = <span class="string">&quot;https://www.bcy.net/search/home?k=&#123;name&#125;&quot;</span>.<span class="built_in">format</span>(name=name)</span><br><span class="line">    r = <span class="keyword">await</span> client.get(url, headers=get_header())</span><br><span class="line">    raw = re.findall(<span class="string">&#x27;JSON.parse\(&quot;.*&quot;\);&#x27;</span>, r.text)[<span class="number">0</span>].replace(<span class="string">&#x27;JSON.parse(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;);&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\\\\u002F&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    data = json.loads(raw) <span class="comment">#è¿™é‡Œå±…ç„¶è¿”å›çš„æ˜¯str</span></span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    circles = data[<span class="string">&#x27;all&#x27;</span>][<span class="string">&#x27;circle&#x27;</span>][<span class="string">&#x27;circle_list&#x27;</span>]</span><br><span class="line">    cid = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> circle <span class="keyword">in</span> circles:</span><br><span class="line">        cache[circle[<span class="string">&#x27;circle_name&#x27;</span>]] = circle[<span class="string">&#x27;circle_id&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> circle[<span class="string">&#x27;circle_name&#x27;</span>] == name:</span><br><span class="line">            cid = circle[<span class="string">&#x27;circle_id&#x27;</span>]</span><br><span class="line">    <span class="comment">#print(cid)</span></span><br><span class="line">    <span class="keyword">await</span> save_name2id_cache(cache)</span><br><span class="line">    <span class="keyword">return</span> cid</span><br><span class="line">    <span class="comment">#with open(&#x27;index.html&#x27;,&#x27;w&#x27;,encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class="line">    <span class="comment">#    f.write(r.text)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_image</span>(<span class="params">url: <span class="built_in">str</span>, save_path: <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span>, <span class="built_in">format</span>: <span class="built_in">str</span> = <span class="string">&#x27;jpeg&#x27;</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    é€šè¿‡urlä¸‹è½½å›¾ç‰‡</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    filename = url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]+<span class="string">&#x27;.&#x27;</span>+<span class="built_in">format</span></span><br><span class="line">    filename = os.path.join(save_path, filename)</span><br><span class="line">    <span class="comment"># æ‹¼æ¥å®é™…åœ°å€</span></span><br><span class="line">    url = url + <span class="string">&quot;~noop.image&quot;</span></span><br><span class="line">    r = <span class="keyword">await</span> client.get(url, headers=get_header())</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(r.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_more_from_tag</span>(<span class="params">circle_id: <span class="built_in">int</span>, since: <span class="built_in">int</span> = <span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    è°ƒç”¨circleFeedæ¥å£ï¼Œè·å–åœˆå­å†…çš„å›¾</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    headers = get_header()</span><br><span class="line">    url = <span class="string">&quot;https://www.bcy.net/apiv3/common/circleFeed?circle_id=&#123;cid&#125;&amp;since=rec:&#123;since&#125;&amp;sort_type=1&amp;grid_type=10&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">        cid=circle_id, since=since)</span><br><span class="line">    <span class="comment"># print(url)</span></span><br><span class="line">    r = <span class="keyword">await</span> client.get(url, headers=headers)</span><br><span class="line">    <span class="comment"># with open(&#x27;&#123;&#125;.json&#x27;.format(since),&#x27;w&#x27;,encoding=&#x27;utf-8&#x27;) as f:</span></span><br><span class="line">    <span class="comment">#   json.dump(r.json(),f,ensure_ascii=False)</span></span><br><span class="line">    <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_image_from_tag</span>(<span class="params">circle_id: <span class="built_in">int</span>, circle_name: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    é€šè¿‡åœˆå­idä¸‹è½½å›¾ç‰‡</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># å»ºæ–‡ä»¶å¤¹åˆ†ç±»</span></span><br><span class="line">    <span class="keyword">if</span> circle_name == <span class="literal">None</span> <span class="keyword">or</span> circle_name.strip() == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        circle_name = <span class="built_in">str</span>(circle_id)</span><br><span class="line">    save_path = circle_name</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(save_path):</span><br><span class="line">        os.mkdir(save_path)</span><br><span class="line">    content = <span class="keyword">await</span> get_more_from_tag(circle_id, since=<span class="number">0</span>)</span><br><span class="line">    items = content[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;items&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        image_list = item[<span class="string">&#x27;item_detail&#x27;</span>][<span class="string">&#x27;image_list&#x27;</span>]</span><br><span class="line">        <span class="keyword">for</span> image <span class="keyword">in</span> image_list:</span><br><span class="line">            <span class="keyword">await</span> download_image(image[<span class="string">&#x27;path&#x27;</span>], save_path=save_path, <span class="built_in">format</span>=image[<span class="string">&#x27;format&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_image_from_name</span>(<span class="params">circle_name:<span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    é€šè¿‡åœˆåä¸‹è½½å›¾ç‰‡</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    cid = <span class="keyword">await</span> name2id(circle_name)</span><br><span class="line">    <span class="keyword">if</span> cid != <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">await</span> download_image_from_tag(cid,circle_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">close_client</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å…³é—­clientï¼Œä¿å­˜cookie</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;cookies.pk&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        pickle.dump(client.cookies.jar._cookies, f)</span><br><span class="line">    <span class="keyword">await</span> client.aclose()</span><br><span class="line"></span><br><span class="line"><span class="comment"># asyncio.run(download_image(</span></span><br><span class="line"><span class="comment">#    &quot;https://p3-bcy.byteimg.com/img/banciyuan/2eb5f6a5330f47ccaab29eff30a42a15&quot;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># asyncio.run(get_more_from_tag(492))</span></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(download_image_from_name(<span class="string">&quot;COSæ­£ç‰‡&quot;</span>))</span><br><span class="line"><span class="comment">#loop.run_until_complete(name2id(&quot;JK&quot;))</span></span><br><span class="line">loop.run_until_complete(close_client())</span><br><span class="line">loop.close()</span><br></pre></td></tr></table></figure>
<h1 id="åç»­å·¥ä½œ"><a class="markdownIt-Anchor" href="#åç»­å·¥ä½œ"></a> åç»­å·¥ä½œ</h1>
<p>åç»­å·¥ä½œåœ¨äºä½¿ç”¨<code>Aspscheduler</code>æ¡†æ¶å®šæ—¶çˆ¬å–ã€‚æœ‰ç©ºçš„è¯æ•´åˆåˆ°<code>nonebot</code>é‡Œé¢ï¼Œå¹¶ä½¿ç”¨æ•°æ®åº“ä¿å­˜æ›´å¤šä¿¡æ¯ã€‚<br />
æ­¤å¤–ç”±äºåŠæ¬¡å…ƒæ›´åƒæ˜¯å¾®åšä¸€æ ·çš„ä¸ªäººåœˆå­ï¼Œåœˆå†…å‘å¸ƒçš„å†…å®¹ä¸­å«æœ‰ä¸€å®šçš„æ‚å›¾ï¼Œå› æ­¤çˆ¬å–æ—¶ä¼šæœ‰æ‚å›¾åœ¨å†…ï¼Œåç»­éœ€è¦åŠ å…¥çƒ­æ¦œçˆ¬è™«ã€‚</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title>DCGANç”Ÿæˆæ‰‹å†™æ•°å­—</title>
    <url>/2021/08/05/DCGAN/</url>
    <content><![CDATA[<p>æƒ³è¯•è¯•ç”¨GANç”ŸæˆåŠ¨æ¼«å¤´åƒï¼Œäºæ˜¯å…ˆç”¨ç®€å•GANè¯•ä¸€è¯•ã€‚ä¸è¿‡æœ‰ä¸€è¯´ä¸€ï¼ŒGANçœŸçš„éš¾è®­ç»ƒã€‚<br />
å°é¢ã€ŠButterfly Seekerã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>DCGAN(Deep Convolutional Generative Adversarial Networks)æ˜¯GANçš„ä¸€ç§å˜ä½“ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åœ¨åŸæœ¬çš„GANä¸­å¼•å…¥äº†å·ç§¯ç¥ç»ç½‘ç»œã€‚æœ¬æ¬¡ä½¿ç”¨DCGANæ¥ç”Ÿæˆæ‰‹å†™æ•°å­—ã€‚</p>
<h1 id="step-1-å¯¼å…¥åŒ…"><a class="markdownIt-Anchor" href="#step-1-å¯¼å…¥åŒ…"></a> Step 1 å¯¼å…¥åŒ…</h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> tensorflow.keras.layers <span class="keyword">as</span> layers</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="built_in">print</span>(tf.__version__)</span><br><span class="line"><span class="built_in">print</span>(tf.config.list_physical_devices())</span><br></pre></td></tr></table></figure>
<pre><code>2.4.0
[PhysicalDevice(name='/physical_device:CPU:0', device_type='CPU'), PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')]
</code></pre>
<h1 id="step-2-æ£€æŸ¥æ•°æ®é›†"><a class="markdownIt-Anchor" href="#step-2-æ£€æŸ¥æ•°æ®é›†"></a> step 2 æ£€æŸ¥æ•°æ®é›†</h1>
<p>æœ¬æ¬¡ä½¿ç”¨mnistä½œä¸ºæ‰‹å†™æ•°å­—è¯†åˆ«</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;svg&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_dataset</span>(<span class="params">batch_size=<span class="number">128</span></span>):</span><br><span class="line">    mnist = tf.keras.datasets.mnist</span><br><span class="line">    <span class="comment"># load dataset</span></span><br><span class="line">    (x_train, _), _ = mnist.load_data()</span><br><span class="line">    <span class="comment"># [0,255] -&gt; [-1,1]</span></span><br><span class="line">    x_train = x_train/<span class="number">127.5</span> - <span class="number">1</span></span><br><span class="line">    <span class="comment"># (batch_size,w,h) -&gt; (batch,w,h,channel)</span></span><br><span class="line">    x_train = np.expand_dims(x_train, axis=<span class="number">3</span>)</span><br><span class="line">    dataset = tf.data.Dataset.from_tensor_slices(x_train).shuffle(<span class="number">60000</span>).batch(batch_size)</span><br><span class="line">    <span class="keyword">return</span> dataset</span><br><span class="line"><span class="comment">#æŸ¥çœ‹è®­ç»ƒæ ·æœ¬</span></span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt </span><br><span class="line"></span><br><span class="line">dataset = load_dataset()</span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">8</span>))  <span class="comment">#8*8 inch</span></span><br><span class="line"><span class="keyword">for</span> i,(img) <span class="keyword">in</span> <span class="built_in">enumerate</span>(dataset.unbatch().take(<span class="number">9</span>)):  </span><br><span class="line">    ax = plt.subplot(<span class="number">3</span>, <span class="number">3</span>, i+<span class="number">1</span>)</span><br><span class="line">    ax.imshow(img[:,:,<span class="number">0</span>])</span><br><span class="line">    <span class="comment">#ax.set_title(&quot;label = %d&quot; % label)</span></span><br><span class="line">    ax.set_xticks([])</span><br><span class="line">    ax.set_yticks([])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.0/output_4_0.svg" alt="svg" /></p>
<h1 id="step-3-æ„å»ºæ¨¡å‹"><a class="markdownIt-Anchor" href="#step-3-æ„å»ºæ¨¡å‹"></a> step 3 æ„å»ºæ¨¡å‹</h1>
<h2 id="æƒé‡åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#æƒé‡åˆå§‹åŒ–"></a> æƒé‡åˆå§‹åŒ–</h2>
<p>æƒé‡åˆå§‹åŒ–ï¼Œæ ¹æ®DCGANçš„è®ºæ–‡ï¼Œæ‰€æœ‰æƒé‡åˆå§‹åŒ–ä¸ºå‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º0.02ã€‚åŒæ—¶å‚è€ƒå…¶ä»–äººçš„å®ç°æ–¹æ³•å°†BNå±‚çš„åˆå§‹åŒ–æ”¹äº†ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_weight</span>(<span class="params">model:tf.keras.models.Model</span>):</span><br><span class="line">    <span class="keyword">for</span> layer <span class="keyword">in</span> model.layers:</span><br><span class="line">        rule_weights = tf.keras.initializers.RandomNormal(mean=<span class="number">0</span>,stddev=<span class="number">0.02</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(layer,layers.Conv2D):</span><br><span class="line">            layer.weights[<span class="number">0</span>] = rule_weights <span class="comment"># 0:weight 1:bias</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(layer,layers.Conv2DTranspose):</span><br><span class="line">            layer.weights[<span class="number">0</span>] = rule_weights</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(layer,layers.Dense):</span><br><span class="line">            layer.weights[<span class="number">0</span>] = rule_weights</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(layer,layers.BatchNormalization):</span><br><span class="line">            layer.weights[<span class="number">0</span>] = tf.keras.initializers.RandomNormal(mean=<span class="number">1.0</span>,stddev=<span class="number">0.02</span>)</span><br><span class="line">            layer.weights[<span class="number">1</span>] = tf.keras.initializers.Zeros()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="ç”Ÿæˆå™¨æ¨¡å‹"><a class="markdownIt-Anchor" href="#ç”Ÿæˆå™¨æ¨¡å‹"></a> ç”Ÿæˆå™¨æ¨¡å‹</h2>
<p>ç”Ÿæˆå™¨çš„æ¨¡å‹æˆ‘çœ‹åˆ°æœ‰å¤šç§å®ç°æ–¹æ³•ï¼Œè®ºæ–‡ä¸­çš„project and reshapeæœ‰å…¨è¿æ¥å’Œå·ç§¯ä¸¤ç§æ–¹æ³•ï¼Œæ­¤å¤„ä½¿ç”¨å…¨è¿æ¥æ¥å®ç°ã€‚åå·ç§¯æœ‰<code>Conv2DTranspose</code>å’Œ<code>Upsample2D+Conv2D</code>ä¸¤ç§æ–¹æ³•ï¼Œæ­¤å¤„æŒ‰ç…§è®ºæ–‡ä½¿ç”¨å‰è€…ã€‚æŒ‰ç…§è®ºæ–‡åº”è¯¥ä½¿ç”¨ReLUå‡½æ•°ï¼Œæ­¤å¤„æ›¿æ¢ä¸ºLeaky ReLUï¼ŒalphaæŒ‰ç…§è®ºæ–‡è®¾ç½®ä¸º0.2ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_generator</span>() -&gt; tf.keras.Model:</span><br><span class="line">    model = tf.keras.models.Sequential()</span><br><span class="line">    <span class="comment"># z lantent_dim = 100</span></span><br><span class="line">    model.add(layers.InputLayer(input_shape=<span class="number">100</span>))</span><br><span class="line">    <span class="comment"># project and reshape</span></span><br><span class="line">    model.add(layers.Dense(<span class="number">7</span>*<span class="number">7</span>*<span class="number">256</span>))</span><br><span class="line">    model.add(layers.Reshape((<span class="number">7</span>, <span class="number">7</span>, <span class="number">256</span>)))</span><br><span class="line">    model.add(layers.BatchNormalization())</span><br><span class="line">    model.add(layers.LeakyReLU(alpha=<span class="number">0.2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 7*7*256 -&gt; 7*7*128</span></span><br><span class="line">    model.add(layers.Conv2DTranspose(<span class="number">128</span>,kernel_size=<span class="number">5</span>,strides=<span class="number">1</span>,padding=<span class="string">&#x27;same&#x27;</span>,use_bias=<span class="literal">False</span>))</span><br><span class="line">    model.add(layers.BatchNormalization())</span><br><span class="line">    model.add(layers.LeakyReLU(alpha=<span class="number">0.2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 7*7*128 -&gt; 14*14*64</span></span><br><span class="line">    model.add(layers.Conv2DTranspose(<span class="number">64</span>,kernel_size=<span class="number">5</span>,strides=<span class="number">2</span>,padding=<span class="string">&#x27;same&#x27;</span>,use_bias=<span class="literal">False</span>))</span><br><span class="line">    model.add(layers.BatchNormalization())</span><br><span class="line">    model.add(layers.LeakyReLU(alpha=<span class="number">0.2</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 14*14*64 -&gt; 28*28*32</span></span><br><span class="line">    model.add(layers.Conv2DTranspose(<span class="number">32</span>,kernel_size=<span class="number">5</span>,strides=<span class="number">2</span>,padding=<span class="string">&#x27;same&#x27;</span>,use_bias=<span class="literal">False</span>))</span><br><span class="line">    model.add(layers.BatchNormalization())</span><br><span class="line">    model.add(layers.LeakyReLU(alpha=<span class="number">0.2</span>))</span><br><span class="line"></span><br><span class="line">    model.add(layers.Conv2D(<span class="number">1</span>,kernel_size=<span class="number">5</span>,strides=<span class="number">1</span>,padding=<span class="string">&#x27;same&#x27;</span>,use_bias=<span class="literal">False</span>))</span><br><span class="line">    model.add(layers.Activation(<span class="string">&quot;tanh&quot;</span>))</span><br><span class="line"></span><br><span class="line">    model.summary()</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line">generator = build_generator()</span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&#x27;generator.index&#x27;</span>):</span><br><span class="line">    generator.load_weights(<span class="string">&#x27;generator&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:   </span><br><span class="line">    init_weight(generator)</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, 12544)             1266944   
_________________________________________________________________
reshape (Reshape)            (None, 7, 7, 256)         0         
_________________________________________________________________
batch_normalization (BatchNo (None, 7, 7, 256)         1024      
_________________________________________________________________
leaky_re_lu (LeakyReLU)      (None, 7, 7, 256)         0         
_________________________________________________________________
conv2d_transpose (Conv2DTran (None, 7, 7, 128)         819200    
_________________________________________________________________
batch_normalization_1 (Batch (None, 7, 7, 128)         512       
_________________________________________________________________
leaky_re_lu_1 (LeakyReLU)    (None, 7, 7, 128)         0         
_________________________________________________________________
conv2d_transpose_1 (Conv2DTr (None, 14, 14, 64)        204800    
_________________________________________________________________
batch_normalization_2 (Batch (None, 14, 14, 64)        256       
_________________________________________________________________
leaky_re_lu_2 (LeakyReLU)    (None, 14, 14, 64)        0         
_________________________________________________________________
conv2d_transpose_2 (Conv2DTr (None, 28, 28, 32)        51200     
_________________________________________________________________
batch_normalization_3 (Batch (None, 28, 28, 32)        128       
_________________________________________________________________
leaky_re_lu_3 (LeakyReLU)    (None, 28, 28, 32)        0         
_________________________________________________________________
conv2d (Conv2D)              (None, 28, 28, 1)         800       
_________________________________________________________________
activation (Activation)      (None, 28, 28, 1)         0         
=================================================================
Total params: 2,344,864
Trainable params: 2,343,904
Non-trainable params: 960
_________________________________________________________________
</code></pre>
<h2 id="æ„é€ åˆ¤å†³å™¨"><a class="markdownIt-Anchor" href="#æ„é€ åˆ¤å†³å™¨"></a> æ„é€ åˆ¤å†³å™¨</h2>
<p>æ­¤å¤„æœ€åä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°ï¼ŒåŒæ—¶å‚è€ƒå…¶ä»–äººä»£ç åŠ å…¥äº†Dropoutï¼Œä¸ç„¶åé¢è®­ç»ƒçš„æ—¶å€™éƒ½æ²¡æœ‰å¯¹æŠ—ï¼Œä¸¤ä¸ªæ¨¡å‹ç›´æ¥æ‘†çƒ‚ï¼ˆå“­ï¼‰ã€‚è¿˜éœ€è¦æ³¨æ„çš„æ˜¯Dä¸èƒ½å¤ªå¼ºï¼Œä¸ç„¶Gè®­ç»ƒä¸èµ·æ¥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_discriminator</span>() -&gt; tf.keras.Model:</span><br><span class="line">    model = tf.keras.models.Sequential()</span><br><span class="line">    model.add(layers.InputLayer(input_shape=(<span class="number">28</span>,<span class="number">28</span>,<span class="number">1</span>)))</span><br><span class="line">    <span class="comment"># 28*28*1 -&gt; 14*14*64</span></span><br><span class="line">    model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">5</span>, <span class="number">5</span>), strides=(<span class="number">2</span>, <span class="number">2</span>), padding=<span class="string">&#x27;same&#x27;</span>,use_bias=<span class="literal">False</span>))</span><br><span class="line">    model.add(layers.LeakyReLU(alpha=<span class="number">0.2</span>))</span><br><span class="line">    model.add(layers.Dropout(<span class="number">0.3</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 14*14*64 -&gt; 7*7*128</span></span><br><span class="line">    model.add(layers.Conv2D(<span class="number">128</span>, (<span class="number">5</span>, <span class="number">5</span>), strides=(<span class="number">2</span>, <span class="number">2</span>), padding=<span class="string">&#x27;same&#x27;</span>,use_bias=<span class="literal">False</span>))</span><br><span class="line">    model.add(layers.LeakyReLU(alpha=<span class="number">0.2</span>))</span><br><span class="line">    model.add(layers.Dropout(<span class="number">0.3</span>))</span><br><span class="line"></span><br><span class="line">    model.add(layers.Flatten())</span><br><span class="line">    model.add(layers.Dense(<span class="number">1</span>,activation=<span class="string">&#x27;sigmoid&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    model.summary()</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line">discriminator = build_discriminator()</span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&#x27;discriminator.index&#x27;</span>):</span><br><span class="line">    discriminator.load_weights(<span class="string">&#x27;discriminator&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    init_weight(discriminator)</span><br></pre></td></tr></table></figure>
<pre><code>Model: &quot;sequential_1&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d_1 (Conv2D)            (None, 14, 14, 64)        1600      
_________________________________________________________________
leaky_re_lu_4 (LeakyReLU)    (None, 14, 14, 64)        0         
_________________________________________________________________
dropout (Dropout)            (None, 14, 14, 64)        0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 7, 7, 128)         204800    
_________________________________________________________________
leaky_re_lu_5 (LeakyReLU)    (None, 7, 7, 128)         0         
_________________________________________________________________
dropout_1 (Dropout)          (None, 7, 7, 128)         0         
_________________________________________________________________
flatten (Flatten)            (None, 6272)              0         
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 6273      
=================================================================
Total params: 212,673
Trainable params: 212,673
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<h2 id="ç”Ÿæˆè”åˆæ¨¡å‹"><a class="markdownIt-Anchor" href="#ç”Ÿæˆè”åˆæ¨¡å‹"></a> ç”Ÿæˆè”åˆæ¨¡å‹</h2>
<p>æ ¹æ®Gå’ŒDç”Ÿæˆè”åˆæ¨¡å‹ï¼Œé‡‡ç”¨BCE LOSSã€‚ä¼˜åŒ–å™¨æ ¹æ®è®ºæ–‡Adamä¼˜åŒ–å™¨ï¼Œå­¦ä¹ ç‡æŒ‰ç…§è®ºæ–‡é€‰æ‹©0.0002ï¼Œbeta_1é€‰æ‹©0.5ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œè®¾ç½®äº†Dçš„trainableä¸ºFalseã€‚è€ŒDç¼–è¯‘åå°±ç®—è®¾ç½®äº†trainableä¸ºFalseä¹Ÿå¯ä»¥è®­ç»ƒï¼Œè€Œè”åˆæ¨¡å‹ç¼–è¯‘æ—¶Dè®¾ç½®äº†ä¸èƒ½è®­ç»ƒï¼Œå› æ­¤è”åˆæ¨¡å‹åªä¼šè®­ç»ƒGã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">build_DCGAN</span>(<span class="params">discriminator: tf.keras.Model, generator: tf.keras.Model</span>) -&gt; tf.keras.Model:</span><br><span class="line">    discriminator.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">                          optimizer=tf.keras.optimizers.Adam(learning_rate=<span class="number">0.0002</span>,beta_1=<span class="number">0.5</span>),</span><br><span class="line">                          metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line">    discriminator.trainable = <span class="literal">False</span></span><br><span class="line">    noise = layers.Input(shape=<span class="number">100</span>)</span><br><span class="line">    img = generator(noise)</span><br><span class="line">    valid = discriminator(img)</span><br><span class="line">    model = tf.keras.Model(noise,valid)</span><br><span class="line">    model.summary()</span><br><span class="line">    model.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">                          optimizer=tf.keras.optimizers.Adam(learning_rate=<span class="number">0.0002</span>,beta_1=<span class="number">0.5</span>))</span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line">dcgan = build_DCGAN(discriminator,generator)</span><br></pre></td></tr></table></figure>
<pre><code>Model: &quot;model&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_3 (InputLayer)         [(None, 100)]             0         
_________________________________________________________________
sequential (Sequential)      (None, 28, 28, 1)         2344864   
_________________________________________________________________
sequential_1 (Sequential)    (None, 1)                 212673    
=================================================================
Total params: 2,557,537
Trainable params: 2,343,904
Non-trainable params: 213,633
_________________________________________________________________
</code></pre>
<h2 id="ä¿å­˜å’Œæ˜¾ç¤ºå›¾ç‰‡"><a class="markdownIt-Anchor" href="#ä¿å­˜å’Œæ˜¾ç¤ºå›¾ç‰‡"></a> ä¿å­˜å’Œæ˜¾ç¤ºå›¾ç‰‡</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./images&#x27;</span>):</span><br><span class="line">    os.mkdir(<span class="string">&#x27;./images&#x27;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">plot_images</span>(<span class="params">save2file=<span class="literal">False</span>, samples=<span class="number">16</span>, step=<span class="number">0</span></span>):</span><br><span class="line">    filename = <span class="string">&quot;./images/mnist_%d.png&quot;</span> % step</span><br><span class="line">    noise = np.random.normal(<span class="number">0</span>, <span class="number">1</span>, (samples, <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line">    images = generator.predict(noise)</span><br><span class="line"></span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(images.shape[<span class="number">0</span>]):</span><br><span class="line">        plt.subplot(<span class="number">4</span>, <span class="number">4</span>, i+<span class="number">1</span>)</span><br><span class="line">        image = images[i, :, :, :]</span><br><span class="line">        plt.imshow(image[:,:,<span class="number">0</span>])</span><br><span class="line">        plt.axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">    plt.tight_layout()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> save2file:</span><br><span class="line">        plt.savefig(filename)</span><br><span class="line">        plt.close(<span class="string">&#x27;all&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        plt.show()</span><br></pre></td></tr></table></figure>
<h1 id="step-3-è®­ç»ƒæ¨¡å‹"><a class="markdownIt-Anchor" href="#step-3-è®­ç»ƒæ¨¡å‹"></a> step 3 è®­ç»ƒæ¨¡å‹</h1>
<p>æ ¹æ®è®ºæ–‡è®¾ç½®batch_sizeä¸º128ï¼Œè¾“å…¥èŒƒå›´è½¬æ¢ä¸º[-1,1]</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d_loss_list = []</span><br><span class="line">g_loss_list = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">batch_size=<span class="number">128</span>, epochs=<span class="number">50</span>, save_interval=<span class="number">10</span></span>):</span><br><span class="line">    </span><br><span class="line">    dataset = load_dataset(batch_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line"></span><br><span class="line">        pbar = tqdm(<span class="built_in">enumerate</span>(dataset))</span><br><span class="line">        <span class="keyword">for</span> step, real_img <span class="keyword">in</span> pbar:</span><br><span class="line">            bs = <span class="built_in">len</span>(real_img)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># label</span></span><br><span class="line">            real = np.ones((bs, <span class="number">1</span>))</span><br><span class="line">            fake = np.zeros((bs, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># generate noise</span></span><br><span class="line">            noise = np.random.normal(<span class="number">0</span>, <span class="number">1</span>, (bs, <span class="number">100</span>))</span><br><span class="line">            fake_img = generator.predict(noise)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># train d</span></span><br><span class="line">            d_loss_real = discriminator.train_on_batch(real_img, real)</span><br><span class="line">            d_loss_fake = discriminator.train_on_batch(fake_img, fake)</span><br><span class="line">            d_loss, accuracy = <span class="number">0.5</span>*np.add(d_loss_real, d_loss_fake)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># train g</span></span><br><span class="line">            noise = np.random.normal(<span class="number">0</span>, <span class="number">1</span>, (bs, <span class="number">100</span>))</span><br><span class="line">            fake_img = generator.predict(noise)</span><br><span class="line">            g_loss = dcgan.train_on_batch(noise, real)</span><br><span class="line"></span><br><span class="line">            pbar.set_postfix(&#123;<span class="string">&#x27;step&#x27;</span>: step, <span class="string">&#x27;d_loss&#x27;</span>: <span class="string">&#x27;&#123;:.4f&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                d_loss), <span class="string">&#x27;acc&#x27;</span>: <span class="string">&#x27;&#123;:.4f&#125;&#x27;</span>.<span class="built_in">format</span>(accuracy), <span class="string">&#x27;g_loss&#x27;</span>: <span class="string">&#x27;&#123;:.4f&#125;&#x27;</span>.<span class="built_in">format</span>(g_loss)&#125;)</span><br><span class="line"></span><br><span class="line">        d_loss_list.append(d_loss)</span><br><span class="line">        g_loss_list.append(g_loss)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> epoch % save_interval == <span class="number">0</span> <span class="keyword">or</span> epoch == (epochs-<span class="number">1</span>):</span><br><span class="line">            plot_images(save2file=<span class="literal">True</span>, step=epoch)</span><br><span class="line">            generator.save_weights(<span class="string">&#x27;generator&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line">            discriminator.save_weights(<span class="string">&#x27;discriminator&#x27;</span>, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">train(epochs=<span class="number">50</span>,save_interval=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<pre><code>469it [01:57,  4.01it/s, step=468, d_loss=0.4450, acc=0.9115, g_loss=0.1112]
469it [01:53,  4.12it/s, step=468, d_loss=0.5188, acc=0.8750, g_loss=0.8756]
469it [01:53,  4.13it/s, step=468, d_loss=0.6582, acc=0.6354, g_loss=1.1004]
469it [01:53,  4.12it/s, step=468, d_loss=0.6392, acc=0.6667, g_loss=1.0247]
469it [01:53,  4.15it/s, step=468, d_loss=0.6302, acc=0.6510, g_loss=0.9042]
469it [01:53,  4.14it/s, step=468, d_loss=0.4286, acc=0.8490, g_loss=1.3098]
469it [01:53,  4.13it/s, step=468, d_loss=0.5711, acc=0.7552, g_loss=1.0918]
469it [01:54,  4.11it/s, step=468, d_loss=0.1656, acc=0.9531, g_loss=0.0233]
469it [01:53,  4.13it/s, step=468, d_loss=0.4908, acc=0.8177, g_loss=1.5465]
469it [01:53,  4.13it/s, step=468, d_loss=0.4977, acc=0.7656, g_loss=1.1850]
469it [01:54,  4.11it/s, step=468, d_loss=0.4030, acc=0.8646, g_loss=1.3088]
469it [01:53,  4.12it/s, step=468, d_loss=0.4622, acc=0.8177, g_loss=0.6755]
469it [01:53,  4.13it/s, step=468, d_loss=0.2610, acc=0.9323, g_loss=0.5214]
469it [01:53,  4.14it/s, step=468, d_loss=0.3714, acc=0.8646, g_loss=1.7093]
469it [01:52,  4.17it/s, step=468, d_loss=0.6514, acc=0.6458, g_loss=1.2826]
469it [01:52,  4.17it/s, step=468, d_loss=0.5218, acc=0.7448, g_loss=1.6180]
469it [01:52,  4.16it/s, step=468, d_loss=0.3786, acc=0.8594, g_loss=1.4780]
469it [01:52,  4.16it/s, step=468, d_loss=0.2106, acc=0.9427, g_loss=2.5880]
469it [01:52,  4.15it/s, step=468, d_loss=0.6040, acc=0.7240, g_loss=1.7180]
469it [01:52,  4.16it/s, step=468, d_loss=0.3441, acc=0.8490, g_loss=1.5291]
469it [01:52,  4.16it/s, step=468, d_loss=0.3020, acc=0.8958, g_loss=2.0768]
469it [01:52,  4.15it/s, step=468, d_loss=0.4162, acc=0.8333, g_loss=1.6850]
469it [01:52,  4.17it/s, step=468, d_loss=0.3279, acc=0.8698, g_loss=1.3302]
469it [01:53,  4.14it/s, step=468, d_loss=0.2163, acc=0.9271, g_loss=2.9825]
469it [01:53,  4.13it/s, step=468, d_loss=0.2229, acc=0.9167, g_loss=2.2349]
469it [01:52,  4.15it/s, step=468, d_loss=0.2062, acc=0.9375, g_loss=1.6529]
469it [01:53,  4.14it/s, step=468, d_loss=0.1285, acc=0.9635, g_loss=2.8505]
469it [01:53,  4.14it/s, step=468, d_loss=0.3163, acc=0.8750, g_loss=2.8405]
469it [01:53,  4.15it/s, step=468, d_loss=0.3621, acc=0.8698, g_loss=2.1161]
469it [01:53,  4.12it/s, step=468, d_loss=0.2909, acc=0.9062, g_loss=2.6993]
469it [01:53,  4.15it/s, step=468, d_loss=0.2011, acc=0.9271, g_loss=2.5064]
469it [01:53,  4.12it/s, step=468, d_loss=0.2564, acc=0.8854, g_loss=2.4029]
469it [01:53,  4.15it/s, step=468, d_loss=0.1781, acc=0.9479, g_loss=1.5723]
469it [01:53,  4.13it/s, step=468, d_loss=0.1547, acc=0.9583, g_loss=1.3841]
469it [01:53,  4.14it/s, step=468, d_loss=0.1384, acc=0.9583, g_loss=1.9002]
469it [01:53,  4.15it/s, step=468, d_loss=0.4499, acc=0.7865, g_loss=2.3525]
469it [01:54,  4.08it/s, step=468, d_loss=0.0773, acc=0.9844, g_loss=0.5579]
469it [01:54,  4.11it/s, step=468, d_loss=0.2629, acc=0.8958, g_loss=0.5309]
469it [02:00,  3.88it/s, step=468, d_loss=0.2257, acc=0.9167, g_loss=2.6041]
469it [01:59,  3.91it/s, step=468, d_loss=0.2283, acc=0.9271, g_loss=1.5944]
469it [02:08,  3.65it/s, step=468, d_loss=0.2495, acc=0.9115, g_loss=2.7131]
469it [02:07,  3.67it/s, step=468, d_loss=0.1437, acc=0.9479, g_loss=0.9581]
469it [02:08,  3.64it/s, step=468, d_loss=0.5403, acc=0.7865, g_loss=2.7837]
469it [02:08,  3.66it/s, step=468, d_loss=0.1985, acc=0.9323, g_loss=2.7737]
469it [02:09,  3.62it/s, step=468, d_loss=0.1488, acc=0.9427, g_loss=0.7168]
469it [02:07,  3.68it/s, step=468, d_loss=0.1167, acc=0.9583, g_loss=0.8895]
469it [02:09,  3.63it/s, step=468, d_loss=0.1243, acc=0.9323, g_loss=2.8780]
469it [02:10,  3.59it/s, step=468, d_loss=0.2008, acc=0.9115, g_loss=2.6001]
469it [02:10,  3.59it/s, step=468, d_loss=0.1474, acc=0.9479, g_loss=1.5862]
469it [02:08,  3.64it/s, step=468, d_loss=0.2088, acc=0.9062, g_loss=3.0232]
</code></pre>
<h1 id="step-4-æŸ¥çœ‹ç»“æœ"><a class="markdownIt-Anchor" href="#step-4-æŸ¥çœ‹ç»“æœ"></a> step 4 æŸ¥çœ‹ç»“æœ</h1>
<p>æŸ¥çœ‹d_lossã€g_lossã€‚å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªlosséƒ½åœ¨éœ‡è¡ï¼Œæ„Ÿè§‰æ˜¯è¿˜æ²¡è®­ç»ƒå®Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%config InlineBackend.figure_format = <span class="string">&#x27;svg&#x27;</span></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">5</span>))</span><br><span class="line">plt.title(<span class="string">&quot;Generator and Discriminator Loss During Training&quot;</span>)</span><br><span class="line">plt.plot(g_loss_list,label=<span class="string">&quot;G&quot;</span>)</span><br><span class="line">plt.plot(d_loss_list,label=<span class="string">&quot;D&quot;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&quot;iterations&quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;Loss&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.0/output_20_0.svg" alt="svg" /></p>
<h2 id="ç”ŸæˆåŠ¨å›¾"><a class="markdownIt-Anchor" href="#ç”ŸæˆåŠ¨å›¾"></a> ç”ŸæˆåŠ¨å›¾</h2>
<p>å°†è®­ç»ƒå›¾ä¸­å„ä¸ªé˜¶æ®µçš„å›¾ç‰‡ç»„åˆèµ·æ¥ç”Ÿæˆgifå›¾ç‰‡ã€‚è™½ç„¶æ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼Œä½†ä»ç„¶å¯ä»¥çœ‹åˆ°æ•°å­—çš„å½¢çŠ¶ï¼Œæ²¡æœ‰æ™¶ä½“å›¾</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">anim_file = <span class="string">&#x27;dcgan.gif&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">filenames = glob.glob(<span class="string">&#x27;./images/mnist_*.png&#x27;</span>)</span><br><span class="line">filenames = <span class="built_in">sorted</span>(filenames)</span><br><span class="line">frames = []</span><br><span class="line"><span class="keyword">for</span> i,filename <span class="keyword">in</span> <span class="built_in">enumerate</span>(filenames):</span><br><span class="line">    image = imageio.imread(filename)</span><br><span class="line">    frames.append(image)</span><br><span class="line"></span><br><span class="line">kargs = &#123; <span class="string">&#x27;duration&#x27;</span>: <span class="number">0.5</span> &#125;</span><br><span class="line">imageio.mimsave(anim_file, frames, <span class="string">&#x27;GIF&#x27;</span>, **kargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> IPython <span class="keyword">import</span> display</span><br><span class="line">display.Image(filename=anim_file)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.2.0/dcgan.gif" alt="" /></p>
<h2 id="ä¿å­˜æ¨¡å‹æƒé‡"><a class="markdownIt-Anchor" href="#ä¿å­˜æ¨¡å‹æƒé‡"></a> ä¿å­˜æ¨¡å‹æƒé‡</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">generator.save_weights(<span class="string">&#x27;generator&#x27;</span>,<span class="literal">True</span>)</span><br><span class="line">discriminator.save_weights(<span class="string">&#x27;discriminator&#x27;</span>,<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/1406.2661">Generative Adversarial Nets</a></p>
<p><a href="https://arxiv.org/abs/1511.06434">Unsupervised Representation Learning with Deep Convolutional Generative Adversarial Networks</a></p>
<p><a href="https://github.com/eriklindernoren/Keras-GAN">Keras-GAN</a></p>
<p><a href="https://towardsdatascience.com/dcgans-deep-convolutional-generative-adversarial-networks-c7f392c2c8f8">DCGANs (Deep Convolutional Generative Adversarial Networks)</a></p>
<p><a href="https://github.com/eriklindernoren/PyTorch-GAN">PyTorch-GAN</a></p>
<p><a href="https://github.com/soumith/ganhacks">How to Train a GAN? Tips and tricks to make GANs work</a></p>
<p><a href="https://www.tensorflow.org/tutorials/generative/dcgan?hl=zh-cn">DCGAN</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>GAN</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨è½¯ä»¶é•œåƒæº</title>
    <url>/2021/08/11/source-mirror/</url>
    <content><![CDATA[<p>ä¸ºäº†åˆ¶ä½œé­”é•œï¼Œé‡è£…äº†æ ‘è“æ´¾ç³»ç»Ÿã€‚å› ä¸ºè¦å°†å„ç§è½¯ä»¶æºè®¾ç½®é•œåƒæºï¼Œå› æ­¤å†™è¿™æ ·ä¸€æ¡åšå®¢æ–¹ä¾¿è‡ªå·±æŸ¥è¯¢ã€‚<br />
å°é¢ã€Š9-nine-NewEpisodeã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å…¶å®å„ä¸ªé•œåƒæºç«™éƒ½å†™æœ‰å„è‡ªçš„è®¾ç½®çš„æ–¹å¼ï¼Œæœ¬æ–‡åŸºæœ¬ä¸Šåªæ˜¯æ¬è¿å’Œæ•´åˆï¼Œé™„ä¸Šè‡ªå·±çš„ä¸€ç‚¹ç‚¹æ„Ÿå—ã€‚æ­¤å¤„åˆ—å‡ºæˆ‘å¸¸ç”¨çš„é•œåƒç«™</p>
<ul>
<li><a href="https://developer.aliyun.com/mirror/">é˜¿é‡Œäº‘é•œåƒç«™</a>:ä¸ªäººè§‰å¾—æœ€å¥½ç”¨çš„é•œåƒç«™ï¼Œé€Ÿåº¦å¿«ä¸”ç¨³å®šï¼Œä¹‹å‰ç»´æŠ¤æ—¶é—´å¾ˆé•¿æˆ‘è¿˜ä»¥ä¸ºé˜¿é‡Œä¸æäº†ï¼Œæœ€è¿‘æ¢å¤äº†</li>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/">æ¸…åé•œåƒç«™</a>:å°è±¡é‡Œanacondaä¹‹å‰å› ä¸ºç‰ˆæƒé—®é¢˜ï¼Œé•œåƒæºå…¨éƒ¨ä¸‹æ¶ã€‚åæ¥å¥½åƒæ¸…åæºç»è¿‡äº¤æ¶‰é‡æ–°æ„å»ºäº†é•œåƒæºã€‚å› æ­¤ç°åœ¨condaé•œåƒç”¨æ¸…åï¼Œä¸è¿‡æœ‰æ—¶å€™ä¸‹è½½è¿˜æ˜¯ä¸å¥½ç”¨</li>
<li><a href="http://mirrors.zju.edu.cn/">æµ™å¤§é•œåƒç«™</a>:è¿™ä¸ªæ²¡ç”¨è¿‡ï¼Œæ„Ÿè§‰ä¸æ˜¯å¾ˆå¥½ï¼Œä¹‹ååœ¨æµ™å¤§æ ¡å›­å†…å†è¯•ä¸€è¯•</li>
</ul>
<h1 id="æ ‘è“æ´¾é•œåƒ"><a class="markdownIt-Anchor" href="#æ ‘è“æ´¾é•œåƒ"></a> æ ‘è“æ´¾é•œåƒ</h1>
<p>æ‰“å¼€<code>/etc/apt/sources.list</code>ï¼Œä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ã€‚éœ€è¦æ³¨æ„ä¸åŒç‰ˆæœ¬æœ‰æ‰€ä¸åŒ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb https://mirrors.aliyun.com/raspbian/raspbian/ buster main non-free contrib</span><br><span class="line">deb-src https://mirrors.aliyun.com/raspbian/raspbian/ buster main non-free contrib</span><br></pre></td></tr></table></figure>
<h1 id="ubuntué•œåƒ"><a class="markdownIt-Anchor" href="#ubuntué•œåƒ"></a> Ubuntué•œåƒ</h1>
<p>åŒæ ·æ˜¯æ‰“å¼€<code>/etc/apt/sources.list</code>ï¼Œå°†<code>https://archive.ubuntu.com/</code>æ›¿æ¢ä¸º<code>mirrors.aliyun.com</code>ï¼Œç”±äºè¦æ”¹çš„åœ°æ–¹è¾ƒå¤šï¼Œå»ºè®®å…ˆå¤‡ä»½ä¸€ä¸‹ã€‚<br />
ä»¥ubuntu20.04ä¸ºä¾‹å­å¤§è‡´å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>
<h1 id="githubé•œåƒ"><a class="markdownIt-Anchor" href="#githubé•œåƒ"></a> githubé•œåƒ</h1>
<p>githubåœ¨å›½å†…çš„è®¿é—®æ—¶å¥½æ—¶åï¼Œç”¨VPNçš„æ—¶å€™ä¼šå¥½ä¸€ç‚¹ï¼Œä½†æ˜¯æ²¡VPNçš„æ—¶å€™å°±å¾ˆéš¾å—ã€‚æœ‰ä¿®æ”¹DNSçš„æ–¹æ³•ï¼Œä»¥å‰è§‰å¾—è¿˜è¡Œï¼Œä¸è¿‡å¥½åƒæœ€è¿‘ä½¿ç”¨çš„æ—¶å€™ä¸å¤ªå¥½ç”¨</p>
<h2 id="é•œåƒç«™"><a class="markdownIt-Anchor" href="#é•œåƒç«™"></a> é•œåƒç«™</h2>
<p>æ­¤å¤„æ¨èä¸€ä¸ªæœ¬äººè§‰å¾—ä¸é”™çš„é•œåƒç«™<br />
<a href="https://github.com.cnpmjs.org/">https://github.com.cnpmjs.org/</a>:ä¸‹è½½æ—¶åªéœ€è¦å°†<code>github.com</code>æ›¿æ¢ä¸º<code>github.com.cnpmjs.org</code>å³å¯ã€‚<br />
ä¾‹å­å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæœ¬</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/qxdn/live2d-widget.git</span><br><span class="line"><span class="comment"># é•œåƒæº</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com.cnpmjs.org/qxdn/live2d-widget.git</span><br></pre></td></tr></table></figure>
<h2 id="cdn"><a class="markdownIt-Anchor" href="#cdn"></a> cdn</h2>
<p>æ­¤å¤„æ¨èä¸€ä¸ªæœ¬äººå¸¸ç”¨çš„cdnã€‚<br />
<a href="https://www.jsdelivr.com/">jsdelivr</a>:é™¤äº†githubä»¥å¤–è¿˜å¯ä»¥åŠ é€Ÿnpmã€‚ç”¨æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨å®˜ç½‘æœ‰è¯´ã€‚<br />
ç®€å•ä¾‹å­å¦‚ä¸‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæœ¬</span></span><br><span class="line">https://raw.githubusercontent.com/qxdn/live2d-widget/master/autoload.js</span><br><span class="line"><span class="comment"># é•œåƒæº</span></span><br><span class="line">https://cdn.jsdelivr.net/gh/qxdn/live2d-widget@latest/autoload.js</span><br></pre></td></tr></table></figure>
<h1 id="java"><a class="markdownIt-Anchor" href="#java"></a> java</h1>
<p>javaä¸­ä¸¾ä¸€ä¸‹<code>maven</code>çš„ä¾‹å­ï¼Œå› ä¸ºæœ¬äººåŸºæœ¬ä¸Šéƒ½ç”¨çš„æ˜¯<code>maven</code>ï¼Œæ²¡æ€ä¹ˆä½¿ç”¨<code>gradle</code>å°±ä¸æ<code>gradle</code>ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´<code>maven</code>çš„é…ç½®æ–‡ä»¶åœ¨<code>conf/settings.xml</code>é‡Œé¢ï¼Œæ‰¾åˆ°<code>&lt;mirrors&gt;&lt;/mirrors&gt;</code>æ·»åŠ å¦‚ä¸‹ä»£ç </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>é˜¿é‡Œäº‘å…¬å…±ä»“åº“<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="python"><a class="markdownIt-Anchor" href="#python"></a> python</h1>
<h2 id="pip"><a class="markdownIt-Anchor" href="#pip"></a> pip</h2>
<h3 id="å•æ¬¡ä½¿ç”¨"><a class="markdownIt-Anchor" href="#å•æ¬¡ä½¿ç”¨"></a> å•æ¬¡ä½¿ç”¨</h3>
<p>ä»¥å®‰è£…<code>httpx</code>ä¸ºä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæœ¬å®‰è£…</span></span><br><span class="line">pip install httpx</span><br><span class="line"><span class="comment"># é•œåƒæº</span></span><br><span class="line">pip install -i https://mirrors.aliyun.com/pypi/simple/ httpx</span><br></pre></td></tr></table></figure>
<h3 id="é•¿æœŸä½¿ç”¨"><a class="markdownIt-Anchor" href="#é•¿æœŸä½¿ç”¨"></a> é•¿æœŸä½¿ç”¨</h3>
<p>Linuxä¸‹æ‰¾åˆ°<code>~/.pip/pip.conf</code>,Windowsä¸‹æ–°å»º<code>C:\Users\&#123;Your User Name&#125;\pip\pip.ini</code>æ–‡ä»¶ã€‚ä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">index-url</span> = https://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line"><span class="section">[install]</span></span><br><span class="line"><span class="attr">trusted-host</span>=mirrors.aliyun.com</span><br></pre></td></tr></table></figure>
<h2 id="conda"><a class="markdownIt-Anchor" href="#conda"></a> conda</h2>
<p>ä¿®æ”¹ç”¨æˆ·ç›®å½•ä¸‹çš„<code>.condarc</code>æ–‡ä»¶ï¼Œå¯¹äºwindowsç”¨æˆ·å¯èƒ½è¦å…ˆæ‰§è¡Œä¸€é<code>conda config --set show_channel_urls yes</code>æ‰è¡Œã€‚ä¿®æ”¹å®Œåå¯èƒ½è¿˜éœ€è¦æ‰§è¡Œ<code>conda clean -i</code>æ¥æ¸…ç†ç¼“å­˜ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">channels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">defaults</span></span><br><span class="line"><span class="attr">show_channel_urls:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">default_channels:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2</span></span><br><span class="line"><span class="attr">custom_channels:</span></span><br><span class="line">  <span class="attr">conda-forge:</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span></span><br><span class="line">  <span class="attr">msys2:</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span></span><br><span class="line">  <span class="attr">bioconda:</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span></span><br><span class="line">  <span class="attr">menpo:</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span></span><br><span class="line">  <span class="attr">pytorch:</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span></span><br><span class="line">  <span class="attr">simpleitk:</span> <span class="string">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span></span><br></pre></td></tr></table></figure>
<h1 id="javascript"><a class="markdownIt-Anchor" href="#javascript"></a> javascript</h1>
<p>npmé•œåƒä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨çš„æ·˜å®é•œåƒï¼Œæ­¤å¤–è¿˜æœ‰ä¸€ä¸ªcnpmå·¥å…·ä¸“é—¨ç”¨äºä»£ç†æ·˜å®çš„npm<br />
<a href="http://npm.taobao.org/">æ·˜å®npmé•œåƒ</a>:æœ¬æ–‡æ’°å†™æœŸé—´åœ¨ç»´æŠ¤å‡çº§ï¼Œè¿˜ä¸æ¸…æ¥šèƒ½ä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚ä¸è¿‡ä¹‹å‰é˜¿é‡Œäº‘é•œåƒç»´æŠ¤æœŸé—´ä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ï¼Œåº”è¯¥åªæ˜¯webé¡µé¢å‡çº§ä¸å½±å“ä½¿ç”¨ã€‚<br />
<a href="https://cnpmjs.org/">cnpm</a>:ç”¨äºä»£ç†æ·˜å®é•œåƒçš„npmå·¥å…·ï¼Œå›½å†…å¾ˆå¥½ç”¨</p>
<h2 id="ä¸´æ—¶ä½¿ç”¨"><a class="markdownIt-Anchor" href="#ä¸´æ—¶ä½¿ç”¨"></a> ä¸´æ—¶ä½¿ç”¨</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm --registry https://registry.npm.taobao.org install hexo</span><br></pre></td></tr></table></figure>
<h2 id="é•¿æœŸä½¿ç”¨-2"><a class="markdownIt-Anchor" href="#é•¿æœŸä½¿ç”¨-2"></a> é•¿æœŸä½¿ç”¨</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"><span class="comment"># éªŒè¯æ˜¯å¦æˆåŠŸæ–¹æ³•</span></span><br><span class="line">npm config <span class="built_in">ls</span></span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨cnpm"><a class="markdownIt-Anchor" href="#ä½¿ç”¨cnpm"></a> ä½¿ç”¨cnpm</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">cnpm install hexo</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>æœ¬æ–‡ä¸ºå¸¸ç”¨è½¯ä»¶é•œåƒæºçš„å½’æ¡£ï¼Œæ–¹ä¾¿æœ¬äººåœ¨åç»­ä½¿ç”¨æ—¶ç¿»é˜…ï¼Œå¦‚æœé‡åˆ°äº†é—®é¢˜è¿˜è¯·å»é•œåƒç«™çœ‹ä¸‹ä½¿ç”¨æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>python</tag>
        <tag>Linux</tag>
        <tag>javascript</tag>
        <tag>æ ‘è“æ´¾</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–‡ä»¶å“ˆå¸Œå€¼</title>
    <url>/2021/08/13/file-hash/</url>
    <content><![CDATA[<p>æœ€è¿‘ä¸Šä¼ ç™¾åº¦äº‘çš„æ—¶å€™å‘ç°æœ‰æé€Ÿç§’ä¼ ï¼Œä»è€Œäº†è§£åˆ°äº†æ–‡ä»¶å“ˆå¸Œå€¼ã€‚ç‰¹æ­¤è®°å½•ã€‚<br />
å°é¢ã€Šé‡‘è‰²ãƒ©ãƒ–ãƒªãƒƒãƒã‚§ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æœ€è¿‘ä¸Šä¼ ç™¾åº¦äº‘çš„æ—¶å€™å‘ç°æœ‰ä¸ªæ–‡ä»¶ç›´æ¥æé€Ÿç§’ä¼ äº†ï¼Œåƒæˆ‘è¿™ç§ä¸€èˆ¬ä¸ç»™ç™¾åº¦äº‘é€é’±çš„äººæ˜¯ä¸å¤ªå¯èƒ½äº«ç”¨VIPåŠŸèƒ½çš„ï¼Œå› æ­¤æŸ¥äº†æŸ¥æé€Ÿç§’ä¼ çš„åŸç†ã€‚</p>
<h1 id="æ–‡ä»¶å“ˆå¸Œ"><a class="markdownIt-Anchor" href="#æ–‡ä»¶å“ˆå¸Œ"></a> æ–‡ä»¶å“ˆå¸Œ</h1>
<p>å…¶å®åŸç†å¾ˆç®€å•ï¼Œæé€Ÿç§’ä¼ åªæ˜¯å› ä¸ºä½ ä¸Šä¼ çš„æ–‡ä»¶åœ¨ç™¾åº¦äº‘é‡Œé¢æœ‰åˆ«äººä¸Šä¼ çš„ä¸€æ¨¡ä¸€æ ·çš„æ–‡ä»¶ï¼Œå› æ­¤åªéœ€è¦å°†åˆ«äººä¸Šä¼ ç»™ä½ çš„è½¬å­˜ä¸€ä»½å³å¯ã€‚é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ä¸€æ ·å‘¢ï¼Œè¿™å°±ä¸»è¦é æ–‡ä»¶å“ˆå¸Œå€¼æ¥åˆ¤æ–­ã€‚</p>
<p>å“ˆå¸Œæ˜¯ä¸€ç§ä»æ–‡ä»¶è®¡ç®—å›ºå®šå¤§å°çš„ä½ä¸²å€¼çš„ç®—æ³•ã€‚æ–‡ä»¶åŸºæœ¬ä¸ŠåŒ…å«æ•°æ®å—ã€‚å“ˆå¸Œå°†æ­¤æ•°æ®è½¬æ¢ä¸ºæ›´çŸ­çš„å›ºå®šé•¿åº¦å€¼æˆ–è¡¨ç¤ºåŸå§‹å­—ç¬¦ä¸²çš„é”®å€¼ã€‚å“ˆå¸Œå€¼å¯ä»¥è¢«è®¤ä¸ºæ˜¯è¯¥æ–‡ä»¶ä¸­æ‰€æœ‰å†…å®¹çš„æç‚¼æ‘˜è¦ã€‚</p>
<p>ä¸€ä¸ªå¥½çš„å“ˆå¸Œç®—æ³•ä¼šè¡¨ç°å‡ºä¸€ç§ç§°ä¸ºé›ªå´©æ•ˆåº”çš„ç‰¹æ€§ï¼Œå³æ–‡ä»¶ä¸­çš„å•ä¸ªä½æˆ–ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ‰€äº§ç”Ÿçš„å“ˆå¸Œè¾“å‡ºä¹Ÿä¼šæ˜¾è‘—æ”¹å˜ã€‚æ²¡æœ‰è¿™æ ·æ•ˆæœçš„å“ˆå¸Œå‡½æ•°è¢«è®¤ä¸ºå…·æœ‰è¾ƒå·®çš„éšæœºæ€§ï¼Œå¾ˆå®¹æ˜“è¢«é»‘å®¢ç ´è§£ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬æ¥é <code>powershell</code>é‡Œé¢çš„<code>Get-FileHash</code>å‡½æ•°æ¥åšä¸ªå®éªŒå§ï¼Œ<code>Get-FileHash</code>çš„æ–‡æ¡£åœ¨<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-filehash?view=powershell-7.1">æ­¤</a></p>
<p>å…ˆæ–°å»ºä¸¤ä¸ªtxtæ–‡ä»¶ï¼Œå¹¶å†™å…¥å†…å®¹ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ª<code>h</code>åŒºåˆ†å¤§å°å†™</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;hash&quot;</span> &gt; test.txt</span><br><span class="line"><span class="comment"># h å˜ H</span></span><br><span class="line"><span class="string">&quot;Hash&quot;</span> &gt; test1.txt</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨<code>Get-FileHash</code>æ¥è®¡ç®—ä¸¤ä¸ªæ–‡ä»¶çš„<code>SHA256</code>å€¼</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Get-FileHash é»˜è®¤ä½¿ç”¨ SHA256</span></span><br><span class="line"><span class="built_in">Get-FileHash</span> test.txt | <span class="built_in">Format-List</span></span><br><span class="line"><span class="built_in">Get-FileHash</span> test1.txt | <span class="built_in">Format-List</span></span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å³ä½¿ä¸¤ä¸ªæ–‡ä»¶åªæœ‰ä¸€ä¸ªå­—æ¯ä¸ä¸€æ ·ï¼Œ<code>SHA256</code>çš„å€¼å·®çš„å´éå¸¸çš„å¤šã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.8/sha256.png" alt="" /><br />
é™¤äº†<code>SHA256</code>ä»¥å¤–ï¼Œ<code>Get-FileHash</code>è¿˜æ”¯æŒ<code>MD5</code>ã€<code>SHA1</code>ã€<code>SHA384</code>ã€<code>SHA512</code>ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-FileHash</span> test1.txt <span class="literal">-Algorithm</span> MD5 | <span class="built_in">Format-List</span></span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>ç”±äºæ–‡ä»¶å“ˆå¸Œçš„ç‰¹æ€§ï¼Œæ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶æ˜¯å¦ä¸€æ ·å¾€å¾€ä¸éœ€è¦å®Œå…¨æ¯”è¾ƒæ–‡ä»¶å†…çš„æ‰€æœ‰å†…å®¹ï¼Œåªéœ€è¦æ¯”è¾ƒå“ˆå¸Œå€¼å³å¯ã€‚æ¯”å¦‚åœ¨<a href="https://msdn.itellyou.cn/">MSDN</a>ä¸­ä¸‹è½½æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨è¯¦ç»†ä¿¡æ¯é¡µé¢é‡Œè¿˜ä¼šé™„ä¸Šæ”¹æ–‡ä»¶çš„<code>SHA1</code>å€¼ï¼Œåªéœ€è¦å¯¹æ¯”å°±å¯ä»¥çŸ¥é“ä½ ä¸‹è½½çš„æ˜¯å¦ä¸ºåŒä¸€æ–‡ä»¶ï¼Œè€Œä¸æ˜¯è¢«åˆ«äººæš—ä¸­ä¿®æ”¹çš„æ–‡ä»¶ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://www.jianshu.com/p/938c5dd2caa5">è®¡ç®—æ–‡ä»¶å“ˆå¸Œå€¼</a></p>
<p><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-filehash?view=powershell-7.1">Get-FileHash</a></p>
<p><a href="https://www.2brightsparks.com/resources/articles/introduction-to-hashing-and-its-uses.html">Introduction to Hashing and its uses</a></p>
]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>hash</tag>
        <tag>ç™¾åº¦äº‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¾åŒ–ç»ˆç«¯</title>
    <url>/2021/08/17/beautify-terminal/</url>
    <content><![CDATA[<p>ä¸å°å¿ƒå°†oh-my-poshä»V2å‡çº§åˆ°äº†V3ï¼Œè®¸å¤šä¸œè¥¿æœ‰äº†è¾ƒå¤§å˜åŒ–ã€‚æ­¤ç¯‡åšå®¢è®°å½•ä¸€ä¸‹ä¸»é¢˜çš„ä¿®æ”¹è®°å½•ã€‚<br />
å°é¢ã€Šæœˆã«å¯„ã‚Šãã†ä¹™å¥³ã®ä½œæ³•ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p><a href="https://github.com/JanDeDobbeleer/oh-my-posh">oh-my-posh</a>æ˜¯ä¸€ä¸ªå¯è‡ªå®šä¹‰çš„shellæç¤ºå¼•æ“ã€‚oh-my-posh v3ç›¸è¾ƒäºoh-my-posh v2ï¼Œå®Œå…¨ä½¿ç”¨äº†GOç¼–å†™ï¼Œä½¿å…¶å¯ä»¥è·¨å¹³å°è¿è¡Œï¼ŒåŒæ—¶å¯¹ä¸»é¢˜çš„ä¿®æ”¹æ›´å®¹æ˜“ã€‚</p>
<p>Oh-My-Posh V3çš„æ–‡æ¡£åœ¨<a href="https://ohmyposh.dev/docs/">æ­¤</a></p>
<h1 id="å®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…"></a> å®‰è£…</h1>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -Scope CurrentUserå¯ä»¥ä¸éœ€è¦ï¼Œå› ä¸ºé»˜è®¤å°±æ˜¯CurrentUser</span></span><br><span class="line"><span class="comment"># å¯èƒ½éœ€è¦VPNä¸‹è½½</span></span><br><span class="line"><span class="built_in">Install-Module</span> <span class="built_in">oh</span><span class="literal">-my-posh</span> <span class="literal">-Scope</span> CurrentUser</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»V2å‡çº§åˆ°V3</span></span><br><span class="line"><span class="comment"># ä¼¼ä¹æœ‰ç‚¹ç‚¹é—®é¢˜ï¼Œæˆ‘æ˜¯å¸è½½é‡è£…äº†</span></span><br><span class="line"><span class="built_in">Update-Module</span> <span class="literal">-Name</span> <span class="built_in">oh</span><span class="literal">-my-posh</span> <span class="literal">-Scope</span> CurrentUser</span><br></pre></td></tr></table></figure>
<h1 id="ä¸»é¢˜é…ç½®"><a class="markdownIt-Anchor" href="#ä¸»é¢˜é…ç½®"></a> ä¸»é¢˜é…ç½®</h1>
<h2 id="å±•ç¤ºæ‰€æœ‰æœ¬åœ°ä¸»é¢˜"><a class="markdownIt-Anchor" href="#å±•ç¤ºæ‰€æœ‰æœ¬åœ°ä¸»é¢˜"></a> å±•ç¤ºæ‰€æœ‰æœ¬åœ°ä¸»é¢˜</h2>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-PoshThemes</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.7/list-themes.png" alt="å±•ç¤ºä¸»é¢˜" /></p>
<h2 id="è®¾ç½®ä¸»é¢˜"><a class="markdownIt-Anchor" href="#è®¾ç½®ä¸»é¢˜"></a> è®¾ç½®ä¸»é¢˜</h2>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­¤å¤„ä»¥æœ¬äººæ¯”è¾ƒå–œæ¬¢çš„paradoxä¸ºä¾‹</span></span><br><span class="line"><span class="comment"># è®¾ç½®ä¸»é¢˜</span></span><br><span class="line"><span class="built_in">Set-PoshPrompt</span> <span class="literal">-Theme</span> paradox</span><br><span class="line"><span class="comment"># å¯¼å‡ºå½“å‰ä¸»é¢˜ä»¥ä¾¿ä¿®æ”¹</span></span><br><span class="line"><span class="built_in">Export-PoshTheme</span> <span class="literal">-FilePath</span> ~/.oh<span class="literal">-my-posh</span>.omp.json</span><br><span class="line"><span class="comment"># è®¾ç½®è‡ªå®šä¹‰çš„ä¸»é¢˜</span></span><br><span class="line"><span class="built_in">Set-PoshPrompt</span> <span class="literal">-Theme</span>  ~/.oh<span class="literal">-my-posh</span>.omp.json</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ç°åœ¨è®¾ç½®çš„ä¸»é¢˜ä¸ºæš‚æ—¶çš„ï¼Œå½“ä½ æ‰“å¼€æ–°çš„powershellä»¥åå°±æ²¡äº†ï¼Œå› æ­¤è¿˜éœ€è¦ç¼–è¾‘<code>$PROFILE</code>æ¥æŒä¹…åŒ–</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¬”è®°æœ¬ç¼–è¾‘</span></span><br><span class="line">notepad <span class="variable">$PROFILE</span></span><br><span class="line"><span class="comment"># æˆ–è€…ä»£ç ç¼–è¾‘å™¨ç¼–è¾‘</span></span><br><span class="line">code <span class="variable">$PROFILE</span></span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ä¸‹é¢ä¸€è¡Œ</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-PoshPrompt</span> <span class="literal">-Theme</span>  ~/.oh<span class="literal">-my-posh</span>.omp.json</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé‡åˆ°äº†æ•°å­—ç­¾åé—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ<a href="https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_signing?view=powershell-7.1">è¿™</a>é‡Œé¢çš„RemoteSignedçš„æ–¹æ³•ï¼Œæ‰“å¼€profileæ–‡ä»¶å±æ€§è®¾ç½®ä¸ºä¸é˜»æ‹¦ã€‚</p>
<h2 id="å­—ä½“ä¸‹è½½"><a class="markdownIt-Anchor" href="#å­—ä½“ä¸‹è½½"></a> å­—ä½“ä¸‹è½½</h2>
<p>oh-my-posh V3è®¾è®¡ä½¿ç”¨<a href="https://www.nerdfonts.com/">Nerd Fonts</a>ï¼Œå®˜æ–¹æ¨è<a href="https://github.com/ryanoasis/nerd-fonts/releases/download/v2.1.0/Meslo.zip">Meslo LGM NF</a>ã€‚æœ¬æ–‡é…ç½®ä½¿ç”¨çš„æ˜¯<code>MesloLGM NF</code>å­—ä½“ã€‚éœ€è¦ä¸‹è½½å®Œå­—ä½“åè®¾ç½®ç»ˆç«¯çš„å­—ä½“ï¼Œå¦åˆ™ä¸€äº›ç‰¹æ®Šç¬¦å·æ— æ³•æ­£å¸¸æ˜¾ç¤º</p>
<h1 id="ä¸»é¢˜å®šåˆ¶"><a class="markdownIt-Anchor" href="#ä¸»é¢˜å®šåˆ¶"></a> ä¸»é¢˜å®šåˆ¶</h1>
<p>è€ƒè™‘åˆ°è‡ªå¸¦çš„ä¸»é¢˜æ— æ³•å®Œç¾çš„ç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œå› æ­¤éœ€è¦å¯¹ä¸»é¢˜æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œä¸»è¦è°ƒæ•´condaçš„å…¨å±€æ˜¾ç¤ºã€gitå’Œæ—¶é—´çš„æ˜¾ç¤ºã€‚ä¹Ÿå¯ä»¥å‚è€ƒå…¶ä»–ä¸»é¢˜æ–°å¢ä¸€ç‚¹åŠŸèƒ½ï¼Œæ‰€æœ‰å®˜æ–¹ä¸»é¢˜æ–‡ä»¶åœ¨<a href="https://github.com/JanDeDobbeleer/oh-my-posh/tree/main/themes">æ­¤</a></p>
<h2 id="conda"><a class="markdownIt-Anchor" href="#conda"></a> conda</h2>
<p>oh-my-poshé»˜è®¤çš„pythoné…ç½®åªæœ‰åœ¨å«æœ‰pythonæ–‡ä»¶çš„ç›®å½•ä¸‹æ‰ä¼šå¯åŠ¨ï¼Œå› æ­¤æ— æ³•çœ‹åˆ°condaçš„é»˜è®¤ç¯å¢ƒã€‚ä¿®æ”¹èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé‡‡ç”¨ç¯å¢ƒå˜é‡çš„å½¢å¼å³å¯ã€‚é€šè¿‡<code>dir env:</code>æ‰¾åˆ°<code>CONDA_DEFAULT_ENV</code>ç¯å¢ƒå˜é‡ï¼Œè®¾ç½®oh-my-poshä¸­çš„èƒŒæ™¯è‰²ä¸ºçº¢è‰²ï¼Œè®¾ç½®pythonçš„å›¾æ ‡ï¼Œä¿æŒå­—ä½“é¢œè‰²ä¸€è‡´ã€‚ä¸ºäº†å¥½çœ‹å’Œæ–¹ä¾¿ï¼Œæ·»åŠ åˆ°<code>session</code>å—ä¹‹å<code>path</code>å—ä¹‹å‰ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FF6E6E&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#100e23&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\uE0B0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\uE235&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;var_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CONDA_DEFAULT_ENV&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;envvar&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="git"><a class="markdownIt-Anchor" href="#git"></a> git</h2>
<p>oh-my-poshåœ¨é«˜ç‰ˆæœ¬ä¸­çš„gitä¸æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä¸»é¢˜è§£å†³ã€‚é…ç½®å¦‚ä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>posh-git</code>ç›´æ¥é…ç½®ã€‚ç»è¿‡å°è¯•<code>posh-git</code>æ— æ³•è¾¾åˆ°æˆ‘éœ€è¦çš„æ•ˆæœã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\uE0B0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#193549&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#95ffa4&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;display_status&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;display_stash_count&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;display_upstream_icon&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="time"><a class="markdownIt-Anchor" href="#time"></a> time</h2>
<p>å‚è€ƒå…¶ä»–ä¸»é¢˜ï¼Œåœ¨æ¯è¡Œçš„å³è¾¹æ–°å¢ä¸€ä¸ªæ˜¾ç¤ºå½“å‰æ—¶é—´çš„å›¾æ ‡ã€‚</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;alignment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prompt&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;segments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;time&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;plain&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;time_format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[15:04:05]&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="å®Œæ•´é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#å®Œæ•´é…ç½®æ–‡ä»¶"></a> å®Œæ•´é…ç½®æ–‡ä»¶</h2>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://raw.githubusercontent.com/JanDeDobbeleer/oh-my-posh/main/themes/schema.json&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;blocks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;alignment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;left&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;segments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffe9aa&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#100e23&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;î‚°&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#100e23&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;î‚°&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;session&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;display_host&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#FF6E6E&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#100e23&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;î‚°&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot; îˆµ &quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;var_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CONDA_DEFAULT_ENV&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;envvar&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#91ddff&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#100e23&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;î‚°&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;folder_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ï„•&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;folder_separator_icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot; î‚± &quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;full&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;path&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;git&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\uE0B0&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#193549&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#95ffa4&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;display_status&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;display_stash_count&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;display_upstream_icon&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;background&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ff8080&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;powerline_symbol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;î‚°&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot; îˆ&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;powerline&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;exit&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prompt&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;alignment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prompt&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;segments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;time&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;plain&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#ffffff&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;time_format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;[15:04:05]&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;alignment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;left&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;newline&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;segments&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;foreground&quot;</span><span class="punctuation">:</span> <span class="string">&quot;#007ACC&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;prefix&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;â¯&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="string">&quot;plain&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prompt&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;final_space&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ•ˆæœå›¾"><a class="markdownIt-Anchor" href="#æ•ˆæœå›¾"></a> æ•ˆæœå›¾</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.7/theme.png" alt="æœ€ç»ˆæ•ˆæœ" /></p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æ€»ä½“æ¥è¯´oh-my-posh v3æ¯”v2æ›´å…·æœ‰ç§»æ¤æ€§ï¼ŒåŒé…ç½®èµ·æ¥æ›´æ–¹ä¾¿ï¼Œé»˜è®¤ä¸»é¢˜ä¹Ÿå¤šï¼Œç›¸å¯¹ä¹Ÿæ›´å¥½çœ‹ã€‚ä¸ªäººä¸»è§‚æ„Ÿè§‰å¯åŠ¨é€Ÿåº¦ä¹Ÿå¿«äº†ä¸å°‘ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://ohmyposh.dev/docs/">oh-my-posh doc</a><br />
<a href="https://docs.microsoft.com/zh-cn/powershell/module/microsoft.powershell.core/about/about_signing?view=powershell-7.1">æ•°å­—ç­¾å</a></p>
]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Terminal</tag>
      </tags>
  </entry>
  <entry>
    <title>powershellè®¾ç½®ä»£ç†</title>
    <url>/2021/08/18/powershell-proxy/</url>
    <content><![CDATA[<p>æœ¬æ–‡ä¸»è¦æ˜¯ä¸ºpowershellã€cmdç­‰windowsç»ˆç«¯è®¾ç½®ä»£ç†<br />
å°é¢ã€ŠLAMUNATIONï¼ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>åœ¨powershellä¸­ä½¿ç”¨ä¸€äº›å·¥å…·ä¸‹è½½å¤–ç½‘èµ„æºçš„æ—¶å€™ç»å¸¸ä¼šç¢°åˆ°ä¸€äº›ç½‘ç»œé—®é¢˜ã€‚è¿™äº›æ—¶å€™å¾€å¾€è®¾ç½®ä¸€ä¸‹VPNçš„ä»£ç†æ¨¡å¼ä¸ºå…¨å±€ä»£ç†å³å¯ã€‚ä½†å¾€å¾€æœ‰äº›æ—¶å€™è®¾ç½®å…¨å±€ä»£ç†ä¹Ÿæ²¡ç”¨ï¼Œäº¦æˆ–è€…ä¸€æ—¶æ²¡æ³•åˆ‡æ¢ä»£ç†æ¨¡å¼ï¼ˆæ¯”å¦‚Chromeä¸‹è½½ä¸€äº›èµ„æºçš„æ—¶å€™ï¼‰ï¼Œè¿™äº›æ—¶å€™å°±éœ€è¦è®¾ç½®powershellçš„ä»£ç†äº†ã€‚</p>
<h1 id="powershellè®¾ç½®ä»£ç†"><a class="markdownIt-Anchor" href="#powershellè®¾ç½®ä»£ç†"></a> powershellè®¾ç½®ä»£ç†</h1>
<h2 id="æŸ¥çœ‹ä»£ç†"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹ä»£ç†"></a> æŸ¥çœ‹ä»£ç†</h2>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">netsh winhttp show proxy</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.6/show-proxy.png" alt="" /></p>
<p>å¯ä»¥è™½ç„¶æˆ‘è®¾ç½®äº†VPNï¼ˆéå…¨å±€æ¨¡å¼ï¼‰ï¼Œä½†æ˜¯å…¶ä¾ç„¶æ˜¾ç¤ºç›´æ¥è¿æ¥</p>
<h2 id="è®¾ç½®ä»£ç†"><a class="markdownIt-Anchor" href="#è®¾ç½®ä»£ç†"></a> è®¾ç½®ä»£ç†</h2>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># éœ€è¦ç®¡ç†å‘˜æƒé™</span></span><br><span class="line"><span class="comment"># å¦åˆ™ Error writing proxy settings. (5) Access is denied.</span></span><br><span class="line">netsh winhttp <span class="built_in">set</span> proxy <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">41091</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">netsh winhttp import proxy source=ie</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.6/set-proxy.png" alt="" /></p>
<p>ä¸‹é¢è¿™ä¸ªä¸ç”¨ç®¡ç†å‘˜æƒé™ä¹Ÿå¯ï¼Œä¸è¿‡æ— æ³•ç›´æ¥æŸ¥çœ‹ã€‚ç¬¬ä¸€æ¬¡é‡è§æ˜¯åœ¨vcpkgä¸­ä½¿ç”¨</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$env:HTTP_PROXY</span>=<span class="string">&quot;http://127.0.0.1:41091&quot;</span></span><br><span class="line"><span class="variable">$env:HTTPS_PROXY</span>=<span class="string">&quot;https://127.0.0.1:41091&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="å–æ¶ˆä»£ç†"><a class="markdownIt-Anchor" href="#å–æ¶ˆä»£ç†"></a> å–æ¶ˆä»£ç†</h2>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">netsh winhttp reset proxy</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.6/reset-proxy.png" alt="" /></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="http://woshub.com/using-powershell-behind-a-proxy/">Using PowerShell Behind a Proxy Server</a></p>
<p><a href="https://www.jianshu.com/p/7d08b3c2be95">Windowsä¸ºcmd/powershellè®¾ç½®ä»£ç†</a></p>
]]></content>
      <categories>
        <category>æ‚é¡¹</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>Terminal</tag>
        <tag>powershell</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸ºpowershellæ·»åŠ sudo</title>
    <url>/2021/08/23/powershell-sudo/</url>
    <content><![CDATA[<p>win10æœ¬ç”Ÿæ²¡æœ‰sudoï¼Œæ¯æ¬¡éœ€è¦ç®¡ç†å‘˜æ“ä½œçš„æ—¶å€™éƒ½éœ€è¦åœ¨å¼€å§‹å¤„å³é”®ç‚¹å‡»ä½¿ç”¨ç®¡ç†å‘˜æ¨¡å¼è¿è¡Œï¼Œå› æ­¤æƒ³ä¸ºwin10å¢åŠ ä¸€ä¸ªunix-likeçš„sudoã€‚<br />
å°é¢ã€ŠRiddle Jokerã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p><code>sudo</code>æ˜¯unix-likeçš„ä¸€ç§ææƒæ“ä½œï¼Œä½¿å¾—æ™®é€šç”¨æˆ·å¯ä»¥ä»¥rootç”¨æˆ·çš„æƒé™åšä¸€äº›æ“ä½œã€‚æ”¾åœ¨windowsé‡Œé¢å°±æ˜¯ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œã€‚ä½†æ˜¯win10é‡Œé¢æ²¡æœ‰è¿™ç§å‘½ä»¤ï¼Œéœ€è¦æ‰“å¼€powershellçš„æ—¶å€™å°±ä»¥ç®¡ç†å‘˜æ¨¡å¼æ‰“å¼€ï¼Œè¿™æ ·å¾€å¾€ä¼šå¾ˆéº»çƒ¦ï¼Œè€Œä¸”é‡æ–°æ‰“å¼€åä¼šæ²¡æœ‰ä¹‹å‰çš„è®°å½•ã€‚å¦‚æœæœ‰ä¸ªsudoå‘½ä»¤ä¼šå‡å°‘å¾ˆå¤šæ“ä½œã€‚</p>
<h1 id="æ–¹æ³•ä¸€-powershellå‡½æ•°ä¸æ¨è"><a class="markdownIt-Anchor" href="#æ–¹æ³•ä¸€-powershellå‡½æ•°ä¸æ¨è"></a> æ–¹æ³•ä¸€ powershellå‡½æ•°ï¼ˆä¸æ¨èï¼‰</h1>
<p>å‚è€ƒstack overflowçš„æ–¹æ³•ï¼Œæç¤ºä½¿ç”¨<a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-process?view=powershell-7.1">Start-Process</a>å‡½æ•°</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">notepad <span class="variable">$PROFILE</span></span><br></pre></td></tr></table></figure>
<p>ç¼–è¾‘<code>$PROFILE</code>æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä¼šæç¤ºåˆ›å»ºã€‚å¾€é‡Œé¢æ–°å¢ä¸€ä¸‹è¯­å¥</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sudo</span></span> &#123;</span><br><span class="line">    <span class="built_in">Start-Process</span> @args <span class="literal">-verb</span> runas</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#ç¼ºç‚¹"></a> ç¼ºç‚¹</h2>
<p>ç”¨æ­¤æ–¹æ³•å­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹</p>
<ul>
<li>æ¯æ¬¡éƒ½éœ€è¦è¿›è¡ŒUACéªŒè¯ï¼Œæ²¡æœ‰åƒLinuxçš„ç¼“å­˜åªéœ€è¦è¾“ç¬¬ä¸€éå¯†ç ï¼Œç”¨æ­¤æ–¹æ³•æ¯æ¬¡éƒ½éœ€è¦éªŒè¯</li>
<li>æ¯æ¬¡éƒ½ä¼šæ–°å»ºçª—å£ï¼Œæ¯æ¬¡éƒ½ä¼šæ–°å»ºä¸€ä¸ªçª—å£æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä¸åˆ©äºDEBUGã€‚ï¼ˆå¯ä»¥è¯•ä¸€è¯•<code>npm install</code>ï¼Œæˆ‘æ‰‹é€Ÿæ…¢æ²¡æˆªåˆ°ï¼‰</li>
<li>åªæ”¯æŒpowershellä¸æ”¯æŒcmd</li>
</ul>
<h1 id="æ–¹æ³•äºŒ-ä½¿ç”¨gsudoæ¨è"><a class="markdownIt-Anchor" href="#æ–¹æ³•äºŒ-ä½¿ç”¨gsudoæ¨è"></a> æ–¹æ³•äºŒ ä½¿ç”¨gsudoï¼ˆæ¨èï¼‰</h1>
<p>åœ¨æœç´¢æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘å‘ç°è®¸å¤šäººæ¨è<a href="https://github.com/gerardog/gsudo">gsudo</a>ï¼Œä½¿ç”¨åå‘ç°<code>gsudo</code>æ¯”è¾ƒç¬¦åˆæˆ‘çš„è¦æ±‚ã€‚<br />
åœ¨æ­¤æˆ‘ä½¿ç”¨<code>winget</code>å®‰è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å»<a href="https://github.com/gerardog/gsudo/releases">release</a>ä¸‹è½½å®‰è£…æ–‡ä»¶</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">winget install gsudo</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.5/install.png" alt="" /><br />
ä½¿ç”¨<code>gsudo</code>æ— éœ€æ–°å»ºçª—å£ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡é…ç½®æ¥å®ç°æƒé™ç¼“å­˜ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">gsudo config CacheMode auto</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.5/test1.png" alt="" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.5/test2.png" alt="" /></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://stackoverflow.com/questions/55314557/how-to-sudo-on-powershell-on-windows">How to sudo on powershell on Windows</a></p>
<p><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-process?view=powershell-7.1">Start-Process</a></p>
<p><a href="https://github.com/gerardog/gsudo">gsudo</a></p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>powershell</tag>
      </tags>
  </entry>
  <entry>
    <title>cs231n-2021ä½œä¸š</title>
    <url>/2021/09/05/cs231n-assignment/</url>
    <content><![CDATA[<p>ä¹˜ç€å‡æœŸçš„æœ€åå‡ å¤©åˆ·äº†ä¸€ä¸‹cs231nï¼Œå› æ­¤è®°å½•ä¸€ä¸‹</p>
<span id="more"></span>
<h1 id="cs231n"><a class="markdownIt-Anchor" href="#cs231n"></a> cs231n</h1>
<p>cs231nå…¨ç§°Convolutional Neural Networks for Visual Recognitionï¼Œæ˜¯æ–¯å¦ç¦å¤§å­¦å¼€è®¾çš„ä¸€é—¨è®¡ç®—æœºè§†è§‰å’Œæœºå™¨å­¦ä¹ çš„ç»å…¸è¯¾ç¨‹ã€‚ä¸€ç›´ä»¥æ¥å¤‡å—æ¨èã€‚</p>
<p>å­¦ä¹ æ–¹å¼å¦‚ä¸‹</p>
<ul>
<li>è¯¾ç¨‹è§†é¢‘ï¼šæ²¡æ‰¾åˆ°2021çš„è§†é¢‘ï¼Œåªæ‰¾åˆ°äº†2017çš„è§†é¢‘ã€‚<a href="https://www.youtube.com/watch?v=vT1JzLTH4G4&amp;list=PLC1qU-LWwrF64f4QKQT-Vg5Wr4qEE1Zxk">Youtube</a>ï¼Œå¦‚æœç½‘é€Ÿä¸è¡Œå¯ä»¥çœ‹<a href="https://www.bilibili.com/video/BV1Dx411n7UE">bilibili</a>çš„æ¬è¿ï¼Œæœ‰ccå­—å¹•ï¼Œä¸è¿‡ç¿»è¯‘ä¸å¤ªè¡Œï¼Œå»ºè®®çœ‹è‹±æ–‡ï¼Œä¸­æ–‡åªè¾…åŠ©ç†è§£</li>
<li>è¯¾ç¨‹ç¬”è®°ï¼š<a href="https://cs231n.github.io/">ç¬”è®°</a>ï¼Œé™¤äº†è¯¾ç¨‹ä»¥å¤–è¿˜éœ€è¦è¯¾ç¨‹ç¬”è®°è¾…åŠ©ï¼Œé‡Œé¢æœ‰ä¸€äº›è§†é¢‘é‡Œä¹Ÿæ²¡è®²çš„å†…å®¹</li>
<li>ä½œä¸šï¼š<a href="https://cs231n.github.io/">assignment</a>ï¼Œå®Œæˆä½œä¸šæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼ï¼Œä½œä¸šçš„éš¾åº¦æœ‰ä¸€ç‚¹ç‚¹ï¼ŒåŒ…å«æ¨å¯¼å¯¼æ•°ï¼Œæ ¹æ®è®ºæ–‡å®ç°éƒ¨åˆ†ç½‘ç»œç­‰ã€‚å¦‚æœå®åœ¨æ— æ³•å®Œæˆå¯ä»¥å‚è€ƒgithubä¸Šå…¶ä»–äººçš„å®ç°ã€‚å°½é‡åœ¨linuxæˆ–è€…colabä¸Šè·‘ï¼Œwinä¸Šç¼–è¯‘cythonåçš„å¤„ç†æœ‰ç‚¹éº»çƒ¦ï¼Œæœ‰æ—¶è¿˜æœ‰ä¸€ç‚¹ç‚¹bugã€‚</li>
</ul>
<p>æœ€åæ”¾ä¸€ä¸‹æˆ‘è‡ªå·±å®Œæˆçš„ä½œä¸š<a href="https://github.com/qxdn/cs231n-assignment">assignment</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨å‘½ä»¤--grep sed awk</title>
    <url>/2021/09/10/common-command/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨Linuxçš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šçœ‹åˆ°ä¸€äº›å‘½ä»¤ä½¿ç”¨grepã€sedå’Œawkï¼Œç°åœ¨æ¥ç®€å•çš„ä»‹ç»ä¸€ä¸‹è¿™ä¸‰ä¸ªå¸¸ç”¨çš„å‘½ä»¤ã€‚<br />
å°é¢ã€ŠãƒãƒŸãƒ€ã‚·ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>åœ¨ä»¥å‰æŸ¥è¯¢å„ç§å’ŒLinuxæœ‰å…³ç³»çš„ä»»åŠ¡èµ„æ–™çš„æ—¶å€™ç»å¸¸å¯ä»¥çœ‹åˆ°<code>grep</code>ã€<code>sed</code>ã€<code>awk</code>ç­‰å‘½ä»¤ï¼Œä½†æ˜¯å¯¹äºä»–ä»¬çš„ä½œç”¨æˆ‘æ²¡æœ‰æ·±å…¥äº†è§£è¿‡ï¼Œå› æ­¤æœ¬æ–‡å°†å¯¹è¿™å‡ æ¡å‘½ä»¤åšç®€å•ä»‹ç»</p>
<h1 id="ç®¡é“å‘½ä»¤"><a class="markdownIt-Anchor" href="#ç®¡é“å‘½ä»¤"></a> ç®¡é“å‘½ä»¤</h1>
<p>å¦‚æœéœ€è¦å°†bashå‘½ä»¤è¾“å‡ºè¿›è¡Œå¤šé‡å¤„ç†çš„æ—¶å€™å°±éœ€è¦ç”¨åˆ°ç®¡é“å‘½ä»¤ï¼Œç®¡é“å‘½ä»¤ä½¿ç”¨<code>|</code>ç•Œå®šç¬¦ã€‚ä¸è¿ç»­å‘½ä»¤ä¸åŒçš„æ˜¯ï¼Œè¿ç»­å‘½ä»¤åªæ˜¯é¡ºåºæ‰§è¡Œï¼Œå„ä¸ªå‘½ä»¤ä¸å­˜åœ¨ç›¸å…³æ€§ï¼Œè€Œç®¡é“å‘½ä»¤ä¼šå°†ä¸Šä¸€ä¸ªå‘½ä»¤çš„æ­£ç¡®è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ã€‚ç®¡é“å‘½ä»¤éœ€è¦æ³¨æ„çš„æœ‰ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li>ç®¡é“å‘½ä»¤ä»…ä¼šå¤„ç†æ ‡å‡†è¾“å‡ºï¼Œå¿½ç•¥æ ‡å‡†é”™è¯¯(å¯ä»¥é€šè¿‡æ•°æ®æµé‡å®šå‘æ¥è§£å†³ï¼Œå³<code>2&gt;&amp;1</code>)</li>
<li>ç®¡é“å‘½ä»¤å¿…é¡»è¦èƒ½å¤Ÿæ¥å—æ¥è‡ªå‰ä¸€ä¸ªå‘½ä»¤çš„æ•°æ®ä½œä¸ºæ ‡å‡†è¾“å…¥å¤„ç†</li>
</ul>
<h2 id="ä¾‹å­"><a class="markdownIt-Anchor" href="#ä¾‹å­"></a> ä¾‹å­</h2>
<p>å¯»æ‰¾å½“å‰ç›®å½•ä¸‹å«æœ‰bashçš„æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -a | grep bash</span><br></pre></td></tr></table></figure>
<h1 id="grep"><a class="markdownIt-Anchor" href="#grep"></a> grep</h1>
<p><code>grep</code>(globally search a regular expression and print)æ˜¯ç®¡é“å‘½ä»¤çš„ä¸€ç§ã€‚<code>grep</code>æ˜¯åˆ†æä¸€è¡Œä¿¡æ¯ï¼Œè‹¥å…¶ä¸­æœ‰æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯ï¼Œå°±å°†è¯¥è¡Œæ‹¿å‡ºæ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•</span></span><br><span class="line">grep [-acinv] [--color=auto] <span class="string">&#x27;æŸ¥æ‰¾å­—ç¬¦&#x27;</span> filename</span><br><span class="line"><span class="comment"># é€‰é¡¹</span></span><br><span class="line">-a:å°† binary æ–‡ä»¶ä»¥ text æ–‡ä»¶æ–¹å¼æŸ¥æ‰¾æ•°æ®</span><br><span class="line">-c:è®¡ç®—â€˜æŸ¥æ‰¾å­—ç¬¦ä¸²â€™æ¬¡æ•°</span><br><span class="line">-i:å¿½ç•¥å¤§å°å†™</span><br><span class="line">-n:è¾“å‡ºè¡Œå·</span><br><span class="line">-v:åå‘é€‰æ‹©</span><br><span class="line">--color=auto: å…³é”®å­—éƒ¨åˆ†æ·»åŠ é¢œè‰²</span><br></pre></td></tr></table></figure>
<h2 id="ä¾‹å­-2"><a class="markdownIt-Anchor" href="#ä¾‹å­-2"></a> ä¾‹å­</h2>
<p>ä»¥æˆ‘ä¹‹å‰å¸¸ç”¨çš„å¯»æ‰¾javaè¿›ç¨‹ä¸ºä¾‹ï¼Œä½¿ç”¨<code>ps</code>å‘½ä»¤æ‰¾åˆ°æ‰€æœ‰è¿›ç¨‹ï¼Œåœ¨ä½¿ç”¨<code>grep</code>è¿›è¡Œè¿‡æ»¤ï¼Œè¿™æ ·å°±èƒ½æ‰¾åˆ°java webçš„è¿›ç¨‹äº†ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep java</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.4/grep.png" alt="" /><br />
<code>grep</code>é™¤äº†æ™®é€šçš„å­—ç¬¦ä¸²ä»¥å¤–è¿˜æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å‘½ä»¤</p>
<h1 id="sed"><a class="markdownIt-Anchor" href="#sed"></a> sed</h1>
<p><code>sed</code>ä¹Ÿæ˜¯ä¸€ä¸ªç®¡é“å‘½ä»¤ï¼Œå¯ä»¥åˆ†ææ ‡å‡†è¾“å…¥ï¼Œå¯ä»¥å°†æ•°æ®è¿›è¡Œæ›¿æ¢ã€åˆ é™¤ã€æ–°å¢ã€é€‰å–ç‰¹å®šè¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¯­æ³•</span></span><br><span class="line">sed [-nefr] [æ“ä½œ]</span><br><span class="line"><span class="comment"># é€‰é¡¹</span></span><br><span class="line">-n: å®‰é™æ¨¡å¼ï¼Œåªä¼šå°†ç‰¹æ®Šå¤„ç†çš„é‚£ä¸€è¡Œåˆ—å‡ºæ¥</span><br><span class="line">-e: ç›´æ¥åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸Šè¿›è¡Œsedæ“ä½œç¼–è¾‘</span><br><span class="line">-f: ç›´æ¥å°†sedçš„æ“ä½œå†™åˆ°ä¸€ä¸ªè¾“å‡ºé‡Œ</span><br><span class="line">-r: sedçš„æ“ä½œä½¿ç”¨çš„æ˜¯æ‹“å±•å‹æ­£åˆ™è¯­æ³•ï¼ˆé»˜è®¤åŸºç¡€å‹æ­£åˆ™ï¼‰</span><br><span class="line">-i: ç›´æ¥ä¿®æ”¹è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯å±å¹•è¾“å‡º</span><br><span class="line"><span class="comment"># æ“ä½œè¯´æ˜ [n1[,n2]] function</span></span><br><span class="line">a: æ–°å¢ï¼Œåœ¨ç›®å‰çš„ä¸‹ä¸€è¡Œæ–°å¢å­—ç¬¦</span><br><span class="line">c: æ›¿æ¢ï¼Œåé¢å¯ä»¥å€Ÿå­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦æ›¿æ¢n1,n2ä¹‹é—´çš„è¡Œ</span><br><span class="line">d: åˆ é™¤</span><br><span class="line">i: æ’å…¥,æ’å…¥ç›®å‰çš„ä¸Šä¸€è¡Œ</span><br><span class="line">p: æ‰“å°ï¼Œå°†é€‰æ‹©çš„æ•°æ®æ‰“å°å‡ºæ¥</span><br><span class="line">s: æ›¿æ¢ï¼Œå¯ä»¥ç›´æ¥æ›¿æ¢çš„å·¥ä½œï¼Œs/old/new/g</span><br></pre></td></tr></table></figure>
<h2 id="ä¾‹å­-3"><a class="markdownIt-Anchor" href="#ä¾‹å­-3"></a> ä¾‹å­</h2>
<p>æ–°å»º<code>test.txt</code>å†™å…¥å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">line 1</span><br><span class="line">line line 2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">this is line 7</span><br></pre></td></tr></table></figure>
<p>sedä¾‹å­</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤2-5è¡Œ</span></span><br><span class="line"><span class="built_in">nl</span> test.txt | sed <span class="string">&#x27;2,5d&#x27;</span></span><br><span class="line"><span class="comment"># ç¬¬ä¸‰è¡Œçš„ä¸‹ä¸€è¡Œï¼ˆç¬¬å››è¡Œï¼‰åŠ ä¸Š this is new line</span></span><br><span class="line"><span class="comment"># å¦‚æœè¦åŠ åœ¨å‰é¢åˆ™åªéœ€è¦å°†aæ¢æˆi</span></span><br><span class="line"><span class="built_in">nl</span> test.txt | sed <span class="string">&#x27;3a this is new line&#x27;</span></span><br><span class="line"><span class="comment"># 2-5è¡Œæ›¿æ¢ä¸º new line</span></span><br><span class="line"><span class="built_in">nl</span> test.txt | sed <span class="string">&#x27;2,5c new line&#x27;</span></span><br><span class="line"><span class="comment"># sçš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># æ‰€æœ‰lineæ¢æˆnew</span></span><br><span class="line"><span class="built_in">nl</span> test.txt | sed <span class="string">&#x27;s/line/new/g&#x27;</span></span><br><span class="line"><span class="comment"># æ¯è¡Œçš„ç¬¬ä¸€ä¸ªlineæ¢æˆnew</span></span><br><span class="line"><span class="built_in">nl</span> test.txt | sed <span class="string">&#x27;s/line/new/1&#x27;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.4/sed.png" alt="" /></p>
<h1 id="awk"><a class="markdownIt-Anchor" href="#awk"></a> awk</h1>
<p>ç›¸è¾ƒäºsedå¸¸å¸¸å¤„ç†ä¸€è¡Œæ•°æ®ï¼Œawkå€¾å‘äºä»¥åˆ—æ¥å¤„ç†æ•°æ®</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">awk <span class="string">&#x27;æ¡ä»¶ç±»å‹1&#123;æ“ä½œ1&#125;æ¡ä»¶ç±»å‹2&#123;æ“ä½œ2&#125;...&#x27;</span> filename</span><br></pre></td></tr></table></figure>
<h2 id="ä¾‹å­-4"><a class="markdownIt-Anchor" href="#ä¾‹å­-4"></a> ä¾‹å­</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨test.txtå†™ä¸‹å¦‚ä¸‹å†…å®¹</span></span><br><span class="line">2 this is a <span class="built_in">test</span></span><br><span class="line">3 Are you like awk</span><br><span class="line">This<span class="string">&#x27;s a test</span></span><br><span class="line"><span class="string">10 There are orange,apple,mongo</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¯è¡ŒæŒ‰ç©ºæ ¼æˆ–TABåˆ†å‰²ï¼Œè¾“å‡ºæ–‡æœ¬ä¸­çš„1ã€4é¡¹</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1,$4&#125;&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># ç”¨,åˆ†å‰²</span></span><br><span class="line">awk -F, <span class="string">&#x27;&#123;print $1,$2&#125;&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># æ³¨æ„beginï¼Œå¦åˆ™ç¬¬ä¸€è¡Œé»˜è®¤ç©ºæ ¼ tab</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125;&#123;print $1,$2&#125;&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># ç»Ÿè®¡æ•°æ®</span></span><br><span class="line"><span class="comment"># NF æ¯è¡Œ($0)æ‹¥æœ‰çš„å­—æ®µæ€»æ•°ï¼Œ$0è¡¨ç¤ºä¸€æ•´åˆ—æ•°æ®</span></span><br><span class="line"><span class="comment"># NR è¡¨ç¤ºå½“å‰ä¸ºç¬¬å‡ è¡Œ</span></span><br><span class="line">awk <span class="string">&#x27;&#123;print $1,&quot;\t lines:&quot; NR &quot;\t columns:&quot;NF&#125;&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># æ¡ä»¶è¿‡æ»¤</span></span><br><span class="line"><span class="comment"># é€‰å‡ºç¬¬ä¸€åˆ—å¤§äº2çš„</span></span><br><span class="line">awk <span class="string">&#x27;$1&gt;2&#x27;</span> test.txt</span><br><span class="line"><span class="comment"># é€‰å‡ºç¬¬ä¸€åˆ—ç­‰äº2ï¼Œç¬¬äºŒåˆ—ä¸ºare</span></span><br><span class="line">awk <span class="string">&#x27;$1&gt;2 &amp;&amp; $2==&quot;Are&quot; &#123;print $1,$2,$3&#125;&#x27;</span> test.txt </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.4/awk.png" alt="" /></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://wiki.jikexueyuan.com/project/learn-linux-step-by-step/pipe-command.html">ç®¡é“å‘½ä»¤</a><br />
<a href="">é¸Ÿå“¥çš„Linuxç§æˆ¿èœ</a><br />
<a href="https://www.runoob.com/linux/linux-comm-awk.html">Linux awk å‘½ä»¤</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>junit5æµ‹è¯•</title>
    <url>/2021/09/18/junit5/</url>
    <content><![CDATA[<p>åˆ·äº†å¤šé“leetcodeåå‘è§‰æ¯æ¬¡å†™mainæµ‹è¯•å¾ˆéº»çƒ¦ï¼Œå› æ­¤ç¨å¾®å¯¹é¡¹ç›®è¿›è¡Œäº†è°ƒæ•´ï¼Œè½¬ä¸ºä½¿ç”¨junitè¿›è¡Œæµ‹è¯•ã€‚<br />
å°é¢ã€ŠãƒãƒŸãƒ€ã‚·ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>åœ¨leetcodeä¸Šè¿›è¡ŒDEBUGéœ€è¦å……å€¼VIPï¼Œå› æ­¤æˆ‘ä¸€èˆ¬éƒ½æ˜¯åœ¨çº¿ä¸‹è¿›è¡ŒDEBUGï¼Œç„¶è€Œå¦‚æœä¸ºæ¯é“é¢˜éƒ½DEBUGåˆ™éœ€è¦ç¼–å†™ä¸åŒçš„mainå‡½æ•°ï¼Œä¸”åˆ‡æ¢æ•°æ®çš„æ—¶å€™æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤ä½¿ç”¨junitæ¥è¿›è¡Œæµ‹è¯•ï¼Œæ–¹ä¾¿æ¯æ¬¡debugã€‚</p>
<h1 id="junit5ä»‹ç»"><a class="markdownIt-Anchor" href="#junit5ä»‹ç»"></a> JUnit5ä»‹ç»</h1>
<p>JUnitæ˜¯åŸºäºJavaçš„ä¸€ä¸ªå•å…ƒæµ‹è¯•æ¡†æ¶ï¼ŒJUnit5ä¸€å…±ç”±ä»¥ä¸‹å‡ ä¸ªä¸‰éƒ¨åˆ†ç»„æˆ</p>
<ul>
<li>JUnit Platform: è¿è¡Œåœ¨JVMä¸Šçš„ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œå®šä¹‰äº†æµ‹è¯•çš„APIï¼Œå¯ä»¥æ¥å…¥å…¶ä»–æµ‹è¯•å¼•æ“</li>
<li>JUnit Jupiter: å…¨æ–°çš„ç¼–ç¨‹å’Œæ‹“å±•çš„æµ‹è¯•æ¨¡å‹çš„ç»„åˆï¼Œå¹¶ä¸ºJUnit Platformæä¾›æµ‹è¯•å¼•æ“</li>
<li>JUnit Vintage: æä¾›äº†JUnit3ã€JUnit4çš„æµ‹è¯•å¼•æ“</li>
</ul>
<h1 id="mavenä¸­å¯¼å…¥"><a class="markdownIt-Anchor" href="#mavenä¸­å¯¼å…¥"></a> Mavenä¸­å¯¼å…¥</h1>
<p>å‚è€ƒå®˜æ–¹ç»™å‡ºçš„<a href="https://github.com/junit-team/junit5-samples/blob/r5.8.0/junit5-jupiter-starter-maven/pom.xml">JUnit5é¡¹ç›®</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="æ³¨è§£"><a class="markdownIt-Anchor" href="#æ³¨è§£"></a> æ³¨è§£</h1>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æµ‹è¯•æ³¨è§£ï¼Œæ›´å¤šçš„æµ‹è¯•æ³¨è§£ä»¥åŠå…¶ä½¿ç”¨æ–¹æ³•è¯·ç¿»é˜…<a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">æ–‡æ¡£</a></p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Test</td>
<td>æè¿°ä¸€ä¸ªæ–¹æ³•æ˜¯æµ‹è¯•æ–¹æ³•ï¼Œä¸JUnit4ä¸åŒçš„æ˜¯æ­¤æ–¹æ³•ä¸ç”³æ˜ä»»ä½•å±æ€§</td>
</tr>
<tr>
<td>@ParameterizedTest</td>
<td>è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºå‚æ•°åŒ–æµ‹è¯•</td>
</tr>
<tr>
<td>@RepeatedTest</td>
<td>è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºé‡å¤æµ‹è¯•</td>
</tr>
<tr>
<td>@TestFactory</td>
<td>è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºåŠ¨æ€æµ‹è¯•</td>
</tr>
<tr>
<td>@TestTemplate</td>
<td>è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ºæµ‹è¯•æ¨¡æ¿</td>
</tr>
<tr>
<td>@TestClassOrder</td>
<td>è¡¨ç¤º@Nestedæ ‡æ³¨çš„æµ‹è¯•ç±»çš„æ‰§è¡Œé¡ºåº</td>
</tr>
<tr>
<td>@TestMethodOrder</td>
<td>è¡¨ç¤ºæµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œé¡ºåº</td>
</tr>
<tr>
<td>@TestInstance</td>
<td>é…ç½®æµ‹è¯•å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸ</td>
</tr>
<tr>
<td>@DisplayName</td>
<td>è‡ªå®šä¹‰æµ‹è¯•çš„åç§°</td>
</tr>
<tr>
<td>@DisplayNameGeneration</td>
<td>è‡ªå®šä¹‰æµ‹è¯•åçš„ç”Ÿæˆæ–¹æ³•</td>
</tr>
<tr>
<td>@BeforeEach</td>
<td>åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æµ‹è¯•å‰æ‰§è¡Œ</td>
</tr>
<tr>
<td>@AfterEach</td>
<td>åœ¨æ¯ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œ</td>
</tr>
<tr>
<td>@BeforeAll</td>
<td>åœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•æµ‹è¯•å‰æ‰§è¡Œï¼Œæ³¨è§£çš„æ–¹æ³•å¿…é¡»æ˜¯static</td>
</tr>
<tr>
<td>@AfterAll</td>
<td>åœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•æµ‹è¯•åæ‰§è¡Œï¼Œæ³¨è§£çš„æ–¹æ³•å¿…é¡»æ˜¯static</td>
</tr>
<tr>
<td>@Nested</td>
<td>æè¿°ä¸€ä¸ªéé™æ€çš„åµŒå¥—æµ‹è¯•ç±»</td>
</tr>
<tr>
<td>@Tag</td>
<td>ä½¿ç”¨å®šä¹‰çš„æ ‡ç­¾å»è¿‡æ»¤ä¸€äº›æµ‹è¯•</td>
</tr>
<tr>
<td>@Disabled</td>
<td>å¿½ç•¥ä¸€äº›æµ‹è¯•æ–¹æ³•</td>
</tr>
<tr>
<td>@Timeout</td>
<td>è¿è¡Œè¶…è¿‡äº†æ—¶é—´ä¼šæŠ¥é”™</td>
</tr>
<tr>
<td>@ExtendWith</td>
<td>å£°æ˜çš„æ–¹å¼æ‹“å±•æµ‹è¯•ç±»</td>
</tr>
<tr>
<td>@RegisterExtension</td>
<td>ç¼–ç¨‹çš„æ–¹å¼æ‹“å±•æµ‹è¯•ç±»</td>
</tr>
<tr>
<td>@TempDir</td>
<td>ä½¿ç”¨ä¸´æ—¶ç›®å½•è¿›è¡Œæµ‹è¯•</td>
</tr>
</tbody>
</table>
<h1 id="ç”Ÿå‘½å‘¨æœŸ"><a class="markdownIt-Anchor" href="#ç”Ÿå‘½å‘¨æœŸ"></a> ç”Ÿå‘½å‘¨æœŸ</h1>
<p>ä¸€ä¸ªæ ‡å‡†çš„æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.fail;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assumptions.assumeTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterAll;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.AfterEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeAll;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.BeforeEach;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Disabled;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StandardTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initAll</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">succeedingTest</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">failingTest</span><span class="params">()</span> &#123;</span><br><span class="line">        fail(<span class="string">&quot;a failing test&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Disabled(&quot;for demonstration purposes&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">skippedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// not executed</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">abortedTest</span><span class="params">()</span> &#123;</span><br><span class="line">        assumeTrue(<span class="string">&quot;abc&quot;</span>.contains(<span class="string">&quot;Z&quot;</span>));</span><br><span class="line">        fail(<span class="string">&quot;test should have been aborted&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterAll</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">tearDownAll</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å‚æ•°åŒ–æµ‹è¯•"><a class="markdownIt-Anchor" href="#å‚æ•°åŒ–æµ‹è¯•"></a> å‚æ•°åŒ–æµ‹è¯•</h1>
<p>ä»¥ç›®å‰çš„éœ€æ±‚æ¥è¯´ï¼Œåˆ·leetcodeæœ€éœ€è¦æ˜¯å‚æ•°åŒ–æµ‹è¯•ï¼Œå› æ­¤æœ¬æ¬¡é‡ç‚¹å°±æ˜¯å‡ ç§å¸¸ç”¨çš„å‚æ•°åŒ–æµ‹è¯•</p>
<h2 id="valuesource"><a class="markdownIt-Anchor" href="#valuesource"></a> @ValueSource</h2>
<p><code>@ValueSource</code>æ˜¯æœ€ç®€å•çš„æ•°æ®æ¥æºä¹‹ä¸€ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„æ•°ç»„æ¥æä¾›æµ‹è¯•æ•°æ®ã€‚æ”¯æŒçš„ç±»å‹æœ‰<code>short</code>,<code>byte</code>,<code>int</code>,<code>long</code>,<code>float</code>,<code>double</code>,<code>char</code>,<code>boolean</code>,<code>java.lang.String</code>,<code>java.lang.Class</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ValueSourceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ValueSource(ints = &#123; 1, 2, 3, 4 &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLargerThanZero</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        assertTrue(num &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºNULLæˆ–è€…ç©ºæ•°æ®åˆ™å¯ä»¥ä½¿ç”¨<code>@NullSource</code>ã€<code>@EmptySource</code>ã€<code>@NullAndEmptySource</code></p>
<h2 id="enumsource"><a class="markdownIt-Anchor" href="#enumsource"></a> @EnumSource</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnumSourceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@EnumSource(names = &#123; &quot;DAYS&quot;, &quot;HOURS&quot; &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(ChronoUnit unit)</span> &#123;</span><br><span class="line">        assertTrue(EnumSet.of(ChronoUnit.DAYS, ChronoUnit.HOURS).contains(unit));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="methodsource"><a class="markdownIt-Anchor" href="#methodsource"></a> @MethodSource</h2>
<p><code>@MethonSource</code>å…è®¸ä½ ä½¿ç”¨ä¸€ä¸ªMethodå·¥å‚æ¥æä¾›æºï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æä¾›è€…å¿…é¡»æ˜¯staticï¼Œè¿”å›çš„ç±»å‹éœ€è¦æ˜¯<code>Stream</code>æˆ–è€…<code>Arguments</code>ï¼Œæˆ–è€…æ˜¯å¯ä»¥è¢«JUnitè½¬åŒ–ä¸º<code>Stream</code>çš„ç±»å‹ï¼Œæ¯”å¦‚<code>Collection</code>,<code>DoubleStream</code>ç­‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodSourceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@MethodSource(&quot;stringProvider&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(String got, String expect)</span> &#123;</span><br><span class="line">        assertEquals(got, expect);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Stream&lt;Arguments&gt; <span class="title function_">stringProvider</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(</span><br><span class="line">            Arguments.of(<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;apple&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;banana&quot;</span>,<span class="string">&quot;banana&quot;</span>),</span><br><span class="line">            Arguments.of(<span class="string">&quot;pea&quot;</span>,<span class="string">&quot;pea&quot;</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="csvsource"><a class="markdownIt-Anchor" href="#csvsource"></a> @CsvSource</h2>
<p><code>@CsvSource</code>å…è®¸ä»¥åˆ†éš”ç¬¦åˆ†éš”è¾“å…¥åˆ—è¡¨ä¸­çš„å‚æ•°ã€‚é»˜è®¤çš„åˆ†éš”æ˜¯<code>,</code>ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡<code>delimiterString</code>è¿›è¡Œæ”¹å˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CsvSourceTest</span> &#123;</span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@CsvSource(&#123;</span></span><br><span class="line"><span class="meta">        &quot;1,1,2&quot;,</span></span><br><span class="line"><span class="meta">        &quot;2,2,4&quot;,</span></span><br><span class="line"><span class="meta">        &quot;3,3,6&quot;</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> add1,<span class="type">int</span> add2,<span class="type">int</span> expect)</span>&#123;</span><br><span class="line">        assertEquals(add1+add2, expect);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="csvfilesource"><a class="markdownIt-Anchor" href="#csvfilesource"></a> @CsvFileSource</h2>
<p><code>@CsvFileSource</code>å¯ä»¥ä½¿ç”¨csvæ–‡ä»¶è¿›è¡Œæµ‹è¯•ã€‚åˆ›å»º<code>test.csv</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹å¡«å……</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">add1,add2,expect</span><br><span class="line">1,1,2</span><br><span class="line">2,2,4</span><br><span class="line">3,2,5</span><br><span class="line">5,4,9</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CsvFileSourceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@CsvFileSource(resources = &quot;./test.csv&quot;, numLinesToSkip = 1)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> add1, <span class="type">int</span> add2, <span class="type">int</span> expect)</span> &#123;</span><br><span class="line">        assertEquals(add1 + add2, expect);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="argumentssource"><a class="markdownIt-Anchor" href="#argumentssource"></a> @ArgumentsSource</h2>
<p><code>@ArgumentsSource</code>å¯ä»¥ä½¿ç”¨<code>ArgumentsProvider</code>è¿›è¡Œè‡ªå®šä¹‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArgumentsSourceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@ArgumentsSource(MyArgumentsProvider.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWithArgumentsSource</span><span class="params">(String argument)</span> &#123;</span><br><span class="line">        assertNotNull(argument);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyArgumentsProvider</span> <span class="keyword">implements</span> <span class="title class_">ArgumentsProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Stream&lt;? <span class="keyword">extends</span> <span class="title class_">Arguments</span>&gt; provideArguments(ExtensionContext context) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> Stream.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>).map(Arguments::of);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‚æ•°è½¬æ¢ä¸å¢å¼º"><a class="markdownIt-Anchor" href="#å‚æ•°è½¬æ¢ä¸å¢å¼º"></a> å‚æ•°è½¬æ¢ä¸å¢å¼º</h2>
<p>å¯¹äºå‚æ•°åŒ–æµ‹è¯•çš„è¾“å…¥å‚æ•°ï¼ŒJUnitè¿˜èƒ½å¯¹è¾“å…¥å‚æ•°çš„è½¬åŒ–å¾ˆå¢å¼ºè¿›è¡Œå®šåˆ¶ï¼Œè¯¦ç»†çš„å¯ä»¥ç¿»é˜…<a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-argument-conversion">æ–‡æ¡£</a>ï¼Œæ­¤å¤„ä¸å†å¤šåšè¯´æ˜ã€‚</p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>JUnitæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æµ‹è¯•æ¡†æ¶ï¼Œèƒ½éå¸¸ä¾¿åˆ©çš„ç¼–å†™æµ‹è¯•ï¼Œé…åˆleetcodeè¿›è¡ŒDEBUGã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://junit.org/junit5/">JUnit</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1304048154181666">å»–é›ªå³°çš„Javaæ•™ç¨‹</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>junit</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå®ç°pbkdf2&amp;sha256åŠ å¯†éªŒè¯ç®—æ³•</title>
    <url>/2021/10/16/java-pbkdf2sha256/</url>
    <content><![CDATA[<p>æœ€è¿‘ç§»æ¤ä¸€ä¸ªflaské¡¹ç›®ï¼Œé‡Œé¢ä½¿ç”¨äº†werkzeugè¿›è¡ŒåŠ å¯†ã€‚ä¸ºäº†è¾¾åˆ°æ— ç¼è½¬æ¢ï¼Œæ‰€ä»¥éœ€è¦ç”¨javaå®ç°ã€‚<br />
å°é¢ã€Šã‚½ãƒ¼ã‚µãƒ¬ã‚¹ï¼Šã‚¢ãƒ©ã‚¤ãƒ´ï¼ï½the Worldâ€™s End Fallen Starï½ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æœ€è¿‘ç§»æ¤å®éªŒå®¤çš„ä¸€ä¸ª<code>flask</code>é¡¹ç›®ã€‚å…¶ä¸­ä½¿ç”¨äº†<code>werkzeug</code>ä¸­çš„<code>generate_password_hash</code>, <code>check_password_hash</code>ä¸¤ä¸ªå‡½æ•°æ¥åŠ å¯†å¯†ç å’ŒéªŒè¯å¯†ç ã€‚ä¸ºäº†ä¸¤ä¸ªåç«¯ä¹‹é—´çš„æ— ç¼è¡”æ¥ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªåç«¯åŠ å¯†éªŒè¯ç»“æœä¸€æ ·ï¼Œå› æ­¤ä¾¿æœ‰äº†æœ¬æ–‡ã€‚</p>
<h1 id="ç½‘ä¸Šè§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#ç½‘ä¸Šè§£å†³æ–¹æ¡ˆ"></a> ç½‘ä¸Šè§£å†³æ–¹æ¡ˆ</h1>
<p>è¿™ç§é—®é¢˜æˆ‘è®¤ä¸ºè¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œå…ˆåœ¨ç½‘ä¸Šæœäº†ä¸€ä¸‹ã€‚åœ¨<a href="https://blog.csdn.net/qq_25112523/article/details/84308134">csdn</a>ä¸Šæ‰¾åˆ°äº†å¦‚ä¸‹ä»£ç ã€‚æŒ‰ç…§åšä¸»æ‰€è¯´ï¼Œæ­¤ä»£ç èƒ½å¤Ÿæ— ç¼è¡”æ¥ï¼Œç„¶è€Œåœ¨éªŒè¯è¿‡ç¨‹æ—¶å‘ç°åŠ å¯†ç»“æœä¸ä¸€æ ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.InvalidKeySpecException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.KeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * PBKDF2_SHA256åŠ å¯†éªŒè¯ç®—æ³•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ…Œé€”L</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pbkdf2Sha256</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Pbkdf2Sha256.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SALT_BYTE_SIZE</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆå¯†æ–‡çš„é•¿åº¦(ä¾‹ï¼š64 * 4ï¼Œå¯†æ–‡é•¿åº¦ä¸º64)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">HASH_BIT_SIZE</span> <span class="operator">=</span> <span class="number">64</span> * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿­ä»£æ¬¡æ•°(é»˜è®¤è¿­ä»£æ¬¡æ•°ä¸º 2000)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DEFAULT_ITERATIONS</span> <span class="operator">=</span> <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç®—æ³•åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">algorithm</span> <span class="operator">=</span> <span class="string">&quot;PBKDF2&amp;SHA256&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password   å¯†ç æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> salt       åŠ ç›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iterations è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getEncodedHash</span><span class="params">(String password, String salt, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">        <span class="comment">// Returns only the last part of whole encoded password</span></span><br><span class="line">        <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            keyFactory = SecretKeyFactory.getInstance(<span class="string">&quot;PBKDF2WithHmacSHA256&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Could NOT retrieve PBKDF2WithHmacSHA256 algorithm&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">KeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PBEKeySpec</span>(password.toCharArray(), salt.getBytes(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)), iterations, HASH_BIT_SIZE);</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            secret = keyFactory.generateSecret(keySpec);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidKeySpecException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Could NOT generate secret key&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨Base64è¿›è¡Œè½¬ç å¯†æ–‡</span></span><br><span class="line"><span class="comment">//        byte[] rawHash = secret.getEncoded();</span></span><br><span class="line"><span class="comment">//        byte[] hashBase64 = Base64.getEncoder().encode(rawHash);</span></span><br><span class="line"><span class="comment">//        return new String(hashBase64);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä½¿ç”¨åå…­è¿›åˆ¶å¯†æ–‡</span></span><br><span class="line">        <span class="keyword">return</span> toHex(secret.getEncoded());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬äºŒè¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hex     åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] fromHex(String hex) &#123;</span><br><span class="line">        <span class="type">byte</span>[] binary = <span class="keyword">new</span> <span class="title class_">byte</span>[hex.length() / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; binary.length; i++) &#123;</span><br><span class="line">            binary[i] = (<span class="type">byte</span>) Integer.parseInt(hex.substring(<span class="number">2</span> * i, <span class="number">2</span> * i + <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> binary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array     äºŒè¿›åˆ¶æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>      </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">toHex</span><span class="params">(<span class="type">byte</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">bi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, array);</span><br><span class="line">        <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> bi.toString(<span class="number">16</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">paddingLength</span> <span class="operator">=</span> (array.length * <span class="number">2</span>) - hex.length();</span><br><span class="line">        <span class="keyword">if</span> (paddingLength &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;%0&quot;</span> + paddingLength + <span class="string">&quot;d&quot;</span>, <span class="number">0</span>) + hex;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> hex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯†æ–‡åŠ ç›     (è·å–â€˜SALT_BYTE_SIZEâ€™é•¿åº¦çš„ç›å€¼)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getsalt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ç›å€¼ä½¿ç”¨ASCIIè¡¨çš„æ•°å­—åŠ å¤§å°å†™å­—æ¯ç»„æˆ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> SALT_BYTE_SIZE;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">char</span>[] rs = <span class="keyword">new</span> <span class="title class_">char</span>[length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> rand.nextInt(<span class="number">3</span>);</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="number">0</span>) &#123;</span><br><span class="line">                rs[i] = (<span class="type">char</span>) (rand.nextInt(<span class="number">10</span>) + <span class="number">48</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="number">1</span>) &#123;</span><br><span class="line">                rs[i] = (<span class="type">char</span>) (rand.nextInt(<span class="number">26</span>) + <span class="number">65</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rs[i] = (<span class="type">char</span>) (rand.nextInt(<span class="number">26</span>) + <span class="number">97</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(rs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * é»˜è®¤è¿­ä»£æ¬¡æ•°ï¼š2000</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password      æ˜æ–‡å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encode(password, getsalt());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password      æ˜æ–‡å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iterations    è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encode(password, getsalt(), iterations);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * é»˜è®¤è¿­ä»£æ¬¡æ•°ï¼š2000</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password      æ˜æ–‡å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> salt          ç›å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, String salt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encode(password, salt, DEFAULT_ITERATIONS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€ç»ˆè¿”å›çš„æ•´ä¸²å¯†æ–‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ³¨ï¼šæ­¤æ–¹æ³•è¿”å›å¯†æ–‡å­—ç¬¦ä¸²ç»„æˆï¼šç®—æ³•åç§°+è¿­ä»£æ¬¡æ•°+ç›å€¼+å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * ä¸éœ€è¦çš„ç›´æ¥ç”¨getEncodedHashæ–¹æ³•è¿”å›çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password   å¯†ç æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> salt       åŠ ç›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iterations è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, String salt, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">        <span class="comment">// returns hashed password, along with algorithm, number of iterations and salt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">hash</span> <span class="operator">=</span> getEncodedHash(password, salt, iterations);</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s$%d$%s$%s&quot;</span>, algorithm, iterations, salt, hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password       æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hashedPassword å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">verification</span><span class="params">(String password, String hashedPassword)</span> &#123;</span><br><span class="line">        <span class="comment">//hashedPassword = ç®—æ³•åç§°+è¿­ä»£æ¬¡æ•°+ç›å€¼+å¯†æ–‡;</span></span><br><span class="line">        String[] parts = hashedPassword.split(<span class="string">&quot;\\$&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (parts.length != <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è§£æå¾—åˆ°è¿­ä»£æ¬¡æ•°å’Œç›å€¼è¿›è¡Œç›å€¼</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">iterations</span> <span class="operator">=</span> Integer.parseInt(parts[<span class="number">1</span>]);</span><br><span class="line">        <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> parts[<span class="number">2</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash</span> <span class="operator">=</span> encode(password, salt, iterations);</span><br><span class="line">        <span class="keyword">return</span> hash.equals(hashedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="ä¿®æ”¹"><a class="markdownIt-Anchor" href="#ä¿®æ”¹"></a> ä¿®æ”¹</h1>
<p>è¿™é‡Œå…ˆè´´ä¸€æ®µåŠ å¯†å‰åçš„ä»£ç å’Œpythonçš„è°ƒç”¨å…¥å£</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŠ å¯†å‰åçš„ä»£ç </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">raw password</span></span><br><span class="line">123456</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">encoded password</span></span><br><span class="line">pbkdf2:sha256:260000$hxymrVhMaA4CszrW$460d382eef1ba3fe27e34520ae4a0f9e3ab7b4b6c6bdb26133f771d7b57e9450</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python è°ƒç”¨å…¥å£</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_password_hash</span>(<span class="params"></span></span><br><span class="line"><span class="params">    password: <span class="built_in">str</span>, method: <span class="built_in">str</span> = <span class="string">&quot;pbkdf2:sha256&quot;</span>, salt_length: <span class="built_in">int</span> = <span class="number">16</span></span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Hash a password with the given method and salt with a string of</span></span><br><span class="line"><span class="string">    the given length. The format of the string returned includes the method</span></span><br><span class="line"><span class="string">    that was used so that :func:`check_password_hash` can check the hash.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The format for the hashed string looks like this::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        method$salt$hash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This method can **not** generate unsalted passwords but it is possible</span></span><br><span class="line"><span class="string">    to set param method=&#x27;plain&#x27; in order to enforce plaintext passwords.</span></span><br><span class="line"><span class="string">    If a salt is used, hmac is used internally to salt the password.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If PBKDF2 is wanted it can be enabled by setting the method to</span></span><br><span class="line"><span class="string">    ``pbkdf2:method:iterations`` where iterations is optional::</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        pbkdf2:sha256:80000$salt$hash</span></span><br><span class="line"><span class="string">        pbkdf2:sha256$salt$hash</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param password: the password to hash.</span></span><br><span class="line"><span class="string">    :param method: the hash method to use (one that hashlib supports). Can</span></span><br><span class="line"><span class="string">                   optionally be in the format ``pbkdf2:method:iterations``</span></span><br><span class="line"><span class="string">                   to enable PBKDF2.</span></span><br><span class="line"><span class="string">    :param salt_length: the length of the salt in letters.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    salt = gen_salt(salt_length) <span class="keyword">if</span> method != <span class="string">&quot;plain&quot;</span> <span class="keyword">else</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    h, actual_method = _hash_internal(method, salt, password)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;actual_method&#125;</span>$<span class="subst">&#123;salt&#125;</span>$<span class="subst">&#123;h&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ç½‘ä¸Šçš„ä»£ç å’Œpythonçš„æ³¨é‡Šå¯ä»¥å¾—çŸ¥ï¼ŒåŠ å¯†åæ•°æ®åˆ†ä¸ºç®—æ³•<code>pbkdf2:sha256</code>ã€è¿­ä»£æ¬¡æ•°<code>260000</code>ã€ç›<code>hxymrVhMaA4CszrW</code>å’ŒåŠ å¯†ç»“æœ<code>460d382eef1ba3fe27e34520ae4a0f9e3ab7b4b6c6bdb26133f771d7b57e9450</code>å››æ®µã€‚<br />
å› æ­¤å¯¹ä¸Šè¿°ä»£ç çš„ä»¥ä¸‹éƒ¨åˆ†è¿›è¡Œä¿®æ”¹ï¼Œä¸»è¦ä¿®æ”¹è¿­ä»£æ¬¡æ•°ï¼Œç®—æ³•åï¼Œæ‹¼æ¥è¿‡ç¨‹å’ŒéªŒè¯è¿‡ç¨‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿­ä»£æ¬¡æ•°(é»˜è®¤è¿­ä»£æ¬¡æ•°ä¸º 260000)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DEFAULT_ITERATIONS</span> <span class="operator">=</span> <span class="number">260000</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç®—æ³•åç§°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">algorithm</span> <span class="operator">=</span> <span class="string">&quot;pbkdf2:sha256&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœ€ç»ˆè¿”å›çš„æ•´ä¸²å¯†æ–‡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ³¨ï¼šæ­¤æ–¹æ³•è¿”å›å¯†æ–‡å­—ç¬¦ä¸²ç»„æˆï¼šç®—æ³•åç§°+è¿­ä»£æ¬¡æ•°+ç›å€¼+å¯†æ–‡ ä¸éœ€è¦çš„ç›´æ¥ç”¨getEncodedHashæ–¹æ³•è¿”å›çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> password   å¯†ç æ˜æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> salt       åŠ ç›</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> iterations è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, String salt, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">    <span class="comment">// returns hashed password, along with algorithm, number of iterations and salt</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">hash</span> <span class="operator">=</span> getEncodedHash(password, salt, iterations);</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">&quot;%s:%d$%s$%s&quot;</span>, algorithm, iterations, salt, hash);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * éªŒè¯å¯†ç </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> password       æ˜æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hashedPassword å¯†æ–‡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">verification</span><span class="params">(String password, String hashedPassword)</span> &#123;</span><br><span class="line">    <span class="comment">// hashedPassword = ç®—æ³•åç§°+è¿­ä»£æ¬¡æ•°+ç›å€¼+å¯†æ–‡;</span></span><br><span class="line">    String[] parts = hashedPassword.split(<span class="string">&quot;\\$&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (parts.length != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    String[] parts2 = parts[<span class="number">0</span>].split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (parts2.length != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è§£æå¾—åˆ°è¿­ä»£æ¬¡æ•°å’Œç›å€¼è¿›è¡Œç›å€¼</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">iterations</span> <span class="operator">=</span> Integer.parseInt(parts2[<span class="number">2</span>]);</span><br><span class="line">    <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> parts[<span class="number">1</span>];</span><br><span class="line">    <span class="type">String</span> <span class="variable">hash</span> <span class="operator">=</span> encode(password, salt, iterations);</span><br><span class="line">    <span class="keyword">return</span> hash.equals(hashedPassword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å®Œæ•´ä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´ä»£ç "></a> å®Œæ•´ä»£ç </h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zju.manager_svr.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.InvalidKeySpecException;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.KeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKeyFactory;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.PBEKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * pbkdf2_sha256 from:</span></span><br><span class="line"><span class="comment"> * modify from https://blog.csdn.net/qq_25112523/article/details/84308134</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›çš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">SALT_BYTE_SIZE</span> <span class="operator">=</span> <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆå¯†æ–‡çš„é•¿åº¦(ä¾‹ï¼š64 * 4ï¼Œå¯†æ–‡é•¿åº¦ä¸º64)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">HASH_BIT_SIZE</span> <span class="operator">=</span> <span class="number">64</span> * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿­ä»£æ¬¡æ•°(é»˜è®¤è¿­ä»£æ¬¡æ•°ä¸º 260000)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Integer</span> <span class="variable">DEFAULT_ITERATIONS</span> <span class="operator">=</span> <span class="number">260000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç®—æ³•åç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">algorithm</span> <span class="operator">=</span> <span class="string">&quot;pbkdf2:sha256&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password   å¯†ç æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> salt       åŠ ç›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iterations è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getEncodedHash</span><span class="params">(String password, String salt, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">        <span class="comment">// Returns only the last part of whole encoded password</span></span><br><span class="line">        <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            keyFactory = SecretKeyFactory.getInstance(<span class="string">&quot;PBKDF2WithHmacSHA256&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Could NOT retrieve PBKDF2WithHmacSHA256 algorithm&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">KeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PBEKeySpec</span>(password.toCharArray(), salt.getBytes(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>)), iterations,</span><br><span class="line">                HASH_BIT_SIZE);</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            secret = keyFactory.generateSecret(keySpec);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidKeySpecException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;Could NOT generate secret key&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨Base64è¿›è¡Œè½¬ç å¯†æ–‡</span></span><br><span class="line">        <span class="comment">// byte[] rawHash = secret.getEncoded();</span></span><br><span class="line">        <span class="comment">// byte[] hashBase64 = Base64.getEncoder().encode(rawHash);</span></span><br><span class="line">        <span class="comment">// return new String(hashBase64);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨åå…­è¿›åˆ¶å¯†æ–‡</span></span><br><span class="line">        <span class="keyword">return</span> toHex(secret.getEncoded());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬äºŒè¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hex åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] fromHex(String hex) &#123;</span><br><span class="line">        <span class="type">byte</span>[] binary = <span class="keyword">new</span> <span class="title class_">byte</span>[hex.length() / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; binary.length; i++) &#123;</span><br><span class="line">            binary[i] = (<span class="type">byte</span>) Integer.parseInt(hex.substring(<span class="number">2</span> * i, <span class="number">2</span> * i + <span class="number">2</span>), <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> binary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬åå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array äºŒè¿›åˆ¶æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">toHex</span><span class="params">(<span class="type">byte</span>[] array)</span> &#123;</span><br><span class="line">        <span class="type">BigInteger</span> <span class="variable">bi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigInteger</span>(<span class="number">1</span>, array);</span><br><span class="line">        <span class="type">String</span> <span class="variable">hex</span> <span class="operator">=</span> bi.toString(<span class="number">16</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">paddingLength</span> <span class="operator">=</span> (array.length * <span class="number">2</span>) - hex.length();</span><br><span class="line">        <span class="keyword">if</span> (paddingLength &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> String.format(<span class="string">&quot;%0&quot;</span> + paddingLength + <span class="string">&quot;d&quot;</span>, <span class="number">0</span>) + hex;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> hex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯†æ–‡åŠ ç› (è·å–â€˜SALT_BYTE_SIZEâ€™é•¿åº¦çš„ç›å€¼)</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getsalt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ç›å€¼ä½¿ç”¨ASCIIè¡¨çš„æ•°å­—åŠ å¤§å°å†™å­—æ¯ç»„æˆ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> SALT_BYTE_SIZE;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">char</span>[] rs = <span class="keyword">new</span> <span class="title class_">char</span>[length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> rand.nextInt(<span class="number">3</span>);</span><br><span class="line">            <span class="keyword">if</span> (t == <span class="number">0</span>) &#123;</span><br><span class="line">                rs[i] = (<span class="type">char</span>) (rand.nextInt(<span class="number">10</span>) + <span class="number">48</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="number">1</span>) &#123;</span><br><span class="line">                rs[i] = (<span class="type">char</span>) (rand.nextInt(<span class="number">26</span>) + <span class="number">65</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                rs[i] = (<span class="type">char</span>) (rand.nextInt(<span class="number">26</span>) + <span class="number">97</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(rs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡ é»˜è®¤è¿­ä»£æ¬¡æ•°ï¼š260000</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password æ˜æ–‡å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encode(password, getsalt());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password   æ˜æ–‡å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iterations è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encode(password, getsalt(), iterations);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¯†æ–‡ é»˜è®¤è¿­ä»£æ¬¡æ•°ï¼š260000</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password æ˜æ–‡å¯†ç </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> salt     ç›å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, String salt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> encode(password, salt, DEFAULT_ITERATIONS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€ç»ˆè¿”å›çš„æ•´ä¸²å¯†æ–‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * æ³¨ï¼šæ­¤æ–¹æ³•è¿”å›å¯†æ–‡å­—ç¬¦ä¸²ç»„æˆï¼šç®—æ³•åç§°+è¿­ä»£æ¬¡æ•°+ç›å€¼+å¯†æ–‡ ä¸éœ€è¦çš„ç›´æ¥ç”¨getEncodedHashæ–¹æ³•è¿”å›çš„å¯†æ–‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password   å¯†ç æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> salt       åŠ ç›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iterations è¿­ä»£æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String password, String salt, <span class="type">int</span> iterations)</span> &#123;</span><br><span class="line">        <span class="comment">// returns hashed password, along with algorithm, number of iterations and salt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">hash</span> <span class="operator">=</span> getEncodedHash(password, salt, iterations);</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s:%d$%s$%s&quot;</span>, algorithm, iterations, salt, hash);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯å¯†ç </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password       æ˜æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hashedPassword å¯†æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">verification</span><span class="params">(String password, String hashedPassword)</span> &#123;</span><br><span class="line">        <span class="comment">// hashedPassword = ç®—æ³•åç§°+è¿­ä»£æ¬¡æ•°+ç›å€¼+å¯†æ–‡;</span></span><br><span class="line">        String[] parts = hashedPassword.split(<span class="string">&quot;\\$&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (parts.length != <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] parts2 = parts[<span class="number">0</span>].split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (parts2.length != <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è§£æå¾—åˆ°è¿­ä»£æ¬¡æ•°å’Œç›å€¼è¿›è¡Œç›å€¼</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">iterations</span> <span class="operator">=</span> Integer.parseInt(parts2[<span class="number">2</span>]);</span><br><span class="line">        <span class="type">String</span> <span class="variable">salt</span> <span class="operator">=</span> parts[<span class="number">1</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">hash</span> <span class="operator">=</span> encode(password, salt, iterations);</span><br><span class="line">        <span class="keyword">return</span> hash.equals(hashedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="éªŒè¯"><a class="markdownIt-Anchor" href="#éªŒè¯"></a> éªŒè¯</h1>
<p>ç¼–å†™æµ‹è¯•ç±»å¯¹ç®—æ³•è¿›è¡Œæµ‹è¯•ï¼ŒéªŒè¯ç»“æœæ˜¯å¦ä¸€æ ·ã€‚åŠ å¯†åçš„å¯†ç ç”±pythonç«¯æä¾›ï¼Œæµ‹è¯•ç»“æœéƒ½é€šè¿‡è¯´æ˜åŠ å¯†ç»“æœä¸€æ ·ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zju.manager_svr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertTrue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zju.manager_svr.util.HashUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.ParameterizedTest;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.params.provider.CsvSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashUtilTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@CsvSource(&#123;</span></span><br><span class="line"><span class="meta">            &quot;123456,pbkdf2:sha256:260000$hxymrVhMaA4CszrW$460d382eef1ba3fe27e34520ae4a0f9e3ab7b4b6c6bdb26133f771d7b57e9450&quot;,</span></span><br><span class="line"><span class="meta">            &quot;string,pbkdf2:sha256:260000$ygNNi7PGWBbb6QT1$82c85a39863313c75d6da0921f22d19ba501df387e9a7bdc30535ab4942109e9&quot; &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">passwordCheckTest</span><span class="params">(String password, String expected)</span> &#123;</span><br><span class="line">        assertTrue(HashUtil.verification(password, expected));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æœ¬æ¬¡ç§»æ¤è¿‡ç¨‹ä¸­ï¼Œå¯†ç åŠ å¯†ä¸€è‡´å¤§æ¦‚æ˜¯æœ€éº»çƒ¦çš„é—®é¢˜ä¹‹ä¸€ã€‚åœ¨æ­¤è§£å†³è¿™ä¸ªé—®é¢˜ä»¥ä¾¿æ—¥åç¿»é˜…ã€‚</p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://blog.csdn.net/qq_25112523/article/details/84308134">pbkdf2&amp;sha256åŠ å¯†éªŒè¯ç®—æ³• | å¯†ç åŠ å¯†</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>python</tag>
        <tag>flask</tag>
      </tags>
  </entry>
  <entry>
    <title>dockerä¸­è¿è¡Œnodejsé¡¹ç›®</title>
    <url>/2021/10/24/node-docker/</url>
    <content><![CDATA[<p>è¢«å®éªŒå®¤å‰ç«¯é¡¹ç›®æ•´è£‚å¼€çš„æˆ‘æƒ³èµ·æ¥è¿˜æœ‰dockerè¿™ä¸€æ–¹æ³•<br />
å°é¢ã€ŠPARQUETã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>è¿è¡Œå®éªŒå®¤é¡¹ç›®çš„æ—¶å€™å‘ç°æœ‰ä¸ª<code>node-sass</code>æ¨¡å—ï¼Œå®‰è£…çš„æ—¶å€™è¯´éœ€è¦python2ç¯å¢ƒã€‚ç½‘ä¸Šæœ‰è§£å†³æ–¹æ³•æ˜¯åˆ é™¤<code>node-modules</code>ï¼Œç„¶åå®‰è£…<code>windows-build-tools</code>åœ¨é‡æ–°è£…ä¾èµ–ã€‚ç»“æœæˆ‘è¯•å®Œå‘ç°ä¸è¡Œï¼Œäºæ˜¯æœ‰è¯´æ³•è¯´è£…æœ€æ–°ç‰ˆçš„<code>node-sass</code>ï¼Œè£…å®Œåè¿è¡ŒåæŠ¥é”™è¯´ç‰ˆæœ¬ä¸å…¼å®¹ï¼Œç›´æ¥æŠŠæˆ‘æ°”æ­»ã€‚æœ€åæˆ‘å¿½ç„¶æƒ³èµ·æ¥è¿˜æœ‰<code>docker</code>å¯ä»¥ä½¿ç”¨ï¼Œå› æ­¤å†™ä¸‹æ­¤æ–‡ï¼Œè®°å½•å°†nodeé¡¹ç›®dockeråŒ–ã€‚</p>
<h1 id="dockeråŒ–"><a class="markdownIt-Anchor" href="#dockeråŒ–"></a> dockeråŒ–</h1>
<h2 id="dockerfile"><a class="markdownIt-Anchor" href="#dockerfile"></a> Dockerfile</h2>
<p>åœ¨é¡¹ç›®é‡Œæ–°å»º<code>Dockerfile</code>æ–‡ä»¶ï¼Œå†™ä¸‹ä»¥ä¸‹å†…å®¹ã€‚é¡¹ç›®ä¸­<code>node-sass</code>çš„ç‰ˆæœ¬ä¸º<code>4.12.0</code>ï¼ŒæŸ¥è¯¢<a href="https://github.com/sass/node-sass">node-sass</a>æ¨èçš„ç‰ˆæœ¬ä¸ºnode 12ã€‚æ­¤å¤–è¿˜å¯ä»¥çœ‹åˆ°å…ˆæ‹·è´<code>package.json</code>æ–‡ä»¶è€Œéå…¨éƒ¨æ–‡ä»¶ï¼Œè¿™æ˜¯åˆ©ç”¨<code>docker</code>çš„ç¼“å­˜ï¼Œå‡å°‘æ¯æ¬¡é‡å»ºé•œåƒçš„æ—¶é—´ï¼Œè§£é‡Š<a href="http://bitjudo.com/blog/2014/03/13/building-efficient-dockerfiles-node-dot-js/">è§æ­¤</a></p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create app directory</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr/src/app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install app dependencies</span></span><br><span class="line"><span class="comment"># A wildcard is used to ensure both package.json AND package-lock.json are copied</span></span><br><span class="line"><span class="comment"># where available (npm@5+)</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yarn install</span></span><br><span class="line"><span class="comment"># If you are building your code for production</span></span><br><span class="line"><span class="comment"># RUN npm ci --only=production</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bundle app source</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [ <span class="string">&quot;yarn&quot;</span>, <span class="string">&quot;start&quot;</span> ]</span></span><br></pre></td></tr></table></figure>
<h3 id="è¿è¡Œ"><a class="markdownIt-Anchor" href="#è¿è¡Œ"></a> è¿è¡Œ</h3>
<p>è¿è¡Œåªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build . -t &lt;your tag username&gt;</span><br><span class="line">docker run -p 3000:3000 -d &lt;your tag username&gt;</span><br></pre></td></tr></table></figure>
<h2 id="dockerignore"><a class="markdownIt-Anchor" href="#dockerignore"></a> .dockerignore</h2>
<p>æœ‰äº›æ–‡ä»¶å¹¶ä¸éœ€è¦è¢«åŠ å…¥dockeré•œåƒä¸­ï¼Œæ¯”å¦‚<code>node_modules</code>ã€‚<code>node_modules</code>è¾ƒå¤§ä¸”ä¼šè¦†ç›–é•œåƒä¸­çš„ä¾èµ–ï¼Œå› æ­¤éœ€è¦å¿½ç•¥æ‰ã€‚å®Œæ•´<code>.dockerignore</code>æ–‡ä»¶è§ä¸‹ã€‚</p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line">node_modules</span><br><span class="line">.idea</span><br><span class="line">npm-debug.log*</span><br><span class="line">yarn-debug.log*</span><br><span class="line">yarn-error.log*</span><br></pre></td></tr></table></figure>
<h2 id="docker-composeyml"><a class="markdownIt-Anchor" href="#docker-composeyml"></a> docker-compose.yml</h2>
<p>æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦å°†é•œåƒè¿›è¡ŒæœåŠ¡åŒ–ï¼Œå› æ­¤éœ€è¦ç¼–å†™<code>docker-compoes.yml</code>æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸­æ–°å»º<code>docker-compose.yml</code>æ–‡ä»¶ï¼Œç¼–å†™å¦‚ä¸‹ã€‚</p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line">version: <span class="string">&quot;3.9&quot;</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;3000:3000&quot;</span></span><br></pre></td></tr></table></figure>
<p>æœ‰æ—¶å€™éœ€è¦å¤šä¸ª<code>docker compose</code>ä¹‹é—´é€šä¿¡ï¼Œæ­¤æ—¶å¯ä»¥å…ˆé€šè¿‡æ‰§è¡Œ<code>docker network ls</code>å‘½ä»¤æ¥æŸ¥æ‰¾ç½‘ç»œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œç»“æœ</span></span><br><span class="line">&gt; docker network <span class="built_in">ls</span></span><br><span class="line">NETWORK ID     NAME                 DRIVER    SCOPE</span><br><span class="line">dfe18b9ff74e   alsprj_lnmp          bridge    <span class="built_in">local</span></span><br><span class="line">764431292ca3   bridge               bridge    <span class="built_in">local</span></span><br><span class="line">99ba555f79f4   host                 host      <span class="built_in">local</span></span><br><span class="line">0fe0af6d1a07   live2d_api_default   bridge    <span class="built_in">local</span></span><br><span class="line">2eaa1467e191   none                 null      <span class="built_in">local</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘æƒ³è¦å½“å‰é¡¹ç›®ä¸<code>alsprj_lnmp</code>å¤„äºåŒä¸€ç½‘ç»œç¯å¢ƒï¼Œå°±åªéœ€åœ¨æˆ‘è¦è¿æ¥çš„<code>docker-compose.yml</code>ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line">networks:</span><br><span class="line">  default:</span><br><span class="line">    external:</span><br><span class="line">     name: alsprj_lnmp</span><br></pre></td></tr></table></figure>
<h3 id="è¿è¡Œ-2"><a class="markdownIt-Anchor" href="#è¿è¡Œ-2"></a> è¿è¡Œ</h3>
<p>è¿è¡Œåªéœ€è¦æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure>
<h1 id="ç»“æœ"><a class="markdownIt-Anchor" href="#ç»“æœ"></a> ç»“æœ</h1>
<p>é€šè¿‡<code>docker</code>ï¼Œå®éªŒå®¤å‰ç«¯é¡¹ç›®æ€»ç®—è·‘èµ·æ¥äº†ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.1/terminal.png" alt="" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.1/success.png" alt="" /></p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://nodejs.org/zh-cn/docs/guides/nodejs-docker-webapp/">æŠŠä¸€ä¸ª Node.js web åº”ç”¨ç¨‹åºç»™ Docker åŒ–</a></p>
<p><a href="http://bitjudo.com/blog/2014/03/13/building-efficient-dockerfiles-node-dot-js/">Building Efficient Dockerfiles - Node.js</a></p>
<p><a href="https://www.jianshu.com/p/1099815985dd">å¤šä¸ªdocker-composeä¹‹é—´çš„ç½‘ç»œé€šä¿¡</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿œç¨‹æ–‡ä»¶æ‹·è´</title>
    <url>/2021/11/02/remote-copy/</url>
    <content><![CDATA[<p>å®éªŒå®¤åˆ†é…äº†æœåŠ¡å™¨ï¼Œæœ‰å¿…è¦äº†è§£ä»¥ä¸‹è¿œç¨‹æ•°æ®çš„æ‹·è´<br />
å°é¢ã€Šæœˆã«å¯„ã‚Šãã†ä¹™å¥³ã®ä½œæ³•ã€‹</p>
<span id="more"></span>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å‘å®éªŒå®¤ç”³è¯·äº†ä¸€ä¸ªæœåŠ¡å™¨å‡†å¤‡ç‚¼ä¸¹ï¼Œç¬¬ä¸€æ­¥æš‚æ—¶æ‰“ç®—å…ˆä¸Šä¼ æ•°æ®é›†ã€‚å¯¹æœåŠ¡å™¨ä¸Šæ–‡ä»¶çš„è¿œç¨‹æ‹·è´åªç”¨è¿‡VNCå’Œvscodeã€‚vscodeåœ¨æ‰“å¼€æœåŠ¡å™¨ä¸­å«æœ‰è¾ƒå¤šæ–‡ä»¶çš„ç›®å½•å®¹æ˜“å¡æ­»ï¼Œä¸”æ‹·è´æ–‡ä»¶çš„è¿›åº¦ä¹Ÿä¸å®¹æ˜“è§‚å¯Ÿï¼Œåªèƒ½é€šè¿‡å½“å‰çš„ç½‘é€Ÿè¿›è¡Œåˆ¤æ–­ã€‚VNCåªæ‹·è´è¿‡ä¸€äº›å°å‹æ–‡ä»¶ï¼Œä½†æ˜¯ä¸ªäººçŒœæµ‹å¯¹å¤§æ–‡ä»¶çš„ä¼ è¾“ä¹Ÿä¸å¤ªè¡Œã€‚å› æ­¤æœ‰å¿…è¦äº†è§£ä¸€ä¸‹linuxè‡ªå¸¦çš„scpå‘½ä»¤ã€‚</p>
<h1 id="scp"><a class="markdownIt-Anchor" href="#scp"></a> scp</h1>
<p>scpå‘½ä»¤æ˜¯secure copyçš„ç¼©å†™ï¼Œæ˜¯ä¸€ä¸ªè¿œç¨‹æ–‡ä»¶æ‹·è´å‘½ä»¤ã€‚</p>
<h2 id="è¯­æ³•"><a class="markdownIt-Anchor" href="#è¯­æ³•"></a> è¯­æ³•</h2>
<p>å¯¹äºè¿™ç§å‘½ä»¤é€šè¿‡<code>man</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å…¶è¯¦ç»†çš„æ–‡æ¡£ã€‚<code>man scp</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp [-12346BCpqrv] [-c cipher] [-F ssh_config] [-i identity_file] [-l <span class="built_in">limit</span>] [-o ssh_option] [-P port] </span><br><span class="line">[-S program] [[user@]host1:]file1 ... [[user@]host2:]file2</span><br></pre></td></tr></table></figure>
<h2 id="å‚æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‚æ•°è¯´æ˜"></a> å‚æ•°è¯´æ˜</h2>
<ul>
<li>-1: å¼ºåˆ¶ä½¿ç”¨ssh1</li>
<li>-2: å¼ºåˆ¶ä½¿ç”¨ssh2</li>
<li>-3: é€šè¿‡æœ¬åœ°hostä¼ è¾“ä¸¤ä¸ªè¿œç¨‹æœåŠ¡å™¨ç›´æ¥çš„æ‹·è´ã€‚å¦‚æœæ²¡æœ‰è¯¥é€‰é¡¹ï¼Œå°†ä¼šç›´æ¥åœ¨ä¸¤ä¸ªè¿œç¨‹æœåŠ¡å™¨ä¹‹é—´æ‹·è´ã€‚</li>
<li>-4: å¼ºåˆ¶scpåªä½¿ç”¨ipv4</li>
<li>-6: å¼ºåˆ¶scpåªæ˜¯ç”¨ipv6</li>
<li>-B: é€‰æ‹©æ‰¹æ¬¡æ¨¡å¼ï¼ˆä¸ä½¿ç”¨å¯†ç æˆ–è€…å¯†é’¥ï¼‰</li>
<li>-C: å¼€å¯å‹ç¼©æ¨¡å¼</li>
<li>-c cipher: ä»¥cipherå°†æ•°æ®ä¼ è¾“è¿›è¡ŒåŠ å¯†ï¼Œè¿™ä¸ªé€‰é¡¹å°†ç›´æ¥ä¼ é€’ç»™ssh</li>
<li>-F ssh_config: æŒ‡å®šä¸€ä¸ªæ›¿ä»£çš„sshé…ç½®æ–‡ä»¶ï¼Œæ­¤å‚æ•°ç›´æ¥ä¼ é€’ç»™ssh</li>
<li>-i identity_file: ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–ä¼ è¾“æ—¶ä½¿ç”¨çš„å¯†é’¥æ–‡ä»¶ï¼Œæ­¤å‚æ•°ç›´æ¥ä¼ é€’ç»™ssh</li>
<li>-l limit: å¸¦å®½é™åˆ¶ï¼Œå•ä½Kbit/s</li>
<li>-o ssh_option: ä¼ è¾“å¯é€‰é¡¹åˆ°sshä¸­ï¼Œå¹¶æ²¡æœ‰scp flag</li>
<li>-P: æŒ‡å®šè¿œç¨‹æœåŠ¡å™¨çš„ç«¯å£ï¼Œæ³¨æ„å¤§å†™Pï¼Œå› ä¸ºå°å†™å·²ç»è¢«ä½¿ç”¨äº†</li>
<li>-p: ä¿ç•™åŸå§‹æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ï¼Œè®¿é—®æ—¶é—´å’Œè®¿é—®æƒé™</li>
<li>-q: å®‰é™æ¨¡å¼ï¼Œä¸æ˜¾ç¤ºè¿›åº¦æ¡</li>
<li>-r: é€’å½’æ‹·è´æ•´ä¸ªæ–‡ä»¶å¤¹</li>
<li>-S program: æŒ‡å®šåŠ å¯†ä¼ è¾“æ—¶æ‰€ä½¿ç”¨çš„ç¨‹åºã€‚æ­¤ç¨‹åºå¿…é¡»èƒ½å¤Ÿç†è§£ssh(1)çš„é€‰é¡¹</li>
<li>-v: è¯¦ç»†æ¨¡å¼</li>
</ul>
<h2 id="å®ä¾‹"><a class="markdownIt-Anchor" href="#å®ä¾‹"></a> å®ä¾‹</h2>
<p>åºŸè¯è¯´äº†ä¸€å †ä¸å¦‚ç›´æ¥ä¸Šæ‰‹å†™æµ‹è¯•</p>
<h3 id="æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹"><a class="markdownIt-Anchor" href="#æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹"></a> æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp local_file remote_username@remote_ip:remote_folder </span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">scp local_file remote_username@remote_ip:remote_file </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/copy_file_to_remote.png" alt="" /></p>
<h3 id="æœ¬åœ°ç›®å½•å¤åˆ¶åˆ°è¿œç¨‹"><a class="markdownIt-Anchor" href="#æœ¬åœ°ç›®å½•å¤åˆ¶åˆ°è¿œç¨‹"></a> æœ¬åœ°ç›®å½•å¤åˆ¶åˆ°è¿œç¨‹</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp -r local_folder remote_username@remote_ip:remote_folder </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/copy_folder_to_remote.png" alt="" /></p>
<h3 id="è¿œç¨‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°"><a class="markdownIt-Anchor" href="#è¿œç¨‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°"></a> è¿œç¨‹æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp remote_username@remote_ip:remote_file local_file</span><br><span class="line"><span class="comment"># or </span></span><br><span class="line">scp remote_username@remote_ip:remote_file local_folder </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/copy_file_from_remote.png" alt="" /></p>
<h3 id="è¿œç¨‹ç›®å½•å¤åˆ¶åˆ°æœ¬åœ°"><a class="markdownIt-Anchor" href="#è¿œç¨‹ç›®å½•å¤åˆ¶åˆ°æœ¬åœ°"></a> è¿œç¨‹ç›®å½•å¤åˆ¶åˆ°æœ¬åœ°</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scp -r remote_username@remote_ip:remote_folder local_folder </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/copy_folder_from_remote.png" alt="" /></p>
<h1 id="sftp"><a class="markdownIt-Anchor" href="#sftp"></a> sftp</h1>
<p>åœ¨çœ‹scpå‘½ä»¤æ–‡æ¡£çš„é€‚åˆå‘ç°äº†é‡Œé¢æœ‰å†™sftp(secure file transfer program)ã€‚å‡ºäºå¥½å¥‡ï¼Œä¾¿æŸ¥è¯¢ä¸€ä¸‹sftpçš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<h2 id="è¯­æ³•-2"><a class="markdownIt-Anchor" href="#è¯­æ³•-2"></a> è¯­æ³•</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sftp [-1246aCfpqrv] [-B buffer_size] [-b batchfile] [-c cipher] [-D sftp_server_path] [-F ssh_config]</span><br><span class="line">          [-i identity_file] [-l <span class="built_in">limit</span>] [-o ssh_option] [-P port] [-R num_requests] [-S program]</span><br><span class="line">          [-s subsystem | sftp_server] host</span><br><span class="line">sftp [user@]host[:file ...]</span><br><span class="line">sftp [user@]host[:<span class="built_in">dir</span>[/]]</span><br><span class="line">sftp -b batchfile [user@]host</span><br></pre></td></tr></table></figure>
<p>è®¸å¤šå‚æ•°ä¸scpç±»ä¼¼è¿™é‡Œä¸å†å¤šè¯´</p>
<h2 id="å®ä¾‹-2"><a class="markdownIt-Anchor" href="#å®ä¾‹-2"></a> å®ä¾‹</h2>
<h3 id="è¿æ¥"><a class="markdownIt-Anchor" href="#è¿æ¥"></a> è¿æ¥</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sftp -P port user@ip</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/sftp_connect.png" alt="" /></p>
<h3 id="è·å–è¿œç¨‹æ–‡ä»¶"><a class="markdownIt-Anchor" href="#è·å–è¿œç¨‹æ–‡ä»¶"></a> è·å–è¿œç¨‹æ–‡ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sftp&gt; get remoteFile</span><br><span class="line">sftp&gt; get remoteFile localFile</span><br><span class="line">sftp&gt; get -r someDirectory</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/sftp_get.png" alt="" /></p>
<h3 id="ä¸Šä¼ æœ¬åœ°æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä¸Šä¼ æœ¬åœ°æ–‡ä»¶"></a> ä¸Šä¼ æœ¬åœ°æ–‡ä»¶</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sftp&gt; put localFile</span><br><span class="line">sftp&gt; get localFile remoteFile</span><br><span class="line">sftp&gt; put -r localDirectory</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.1.0/sftp_put.png" alt="" /></p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://www.runoob.com/linux/linux-comm-scp.html">Linux scpå‘½ä»¤</a><br />
<a href="https://www.digitalocean.com/community/tutorials/how-to-use-sftp-to-securely-transfer-files-with-a-remote-server">How To Use SFTP to Securely Transfer Files with a Remote Server</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>matplotlibå´©æºƒé—®é¢˜è®°å½•</title>
    <url>/2021/11/04/matplotlib-crash/</url>
    <content><![CDATA[<h1 id="å‰æ™¯æè¦"><a class="markdownIt-Anchor" href="#å‰æ™¯æè¦"></a> å‰æ™¯æè¦</h1>
<p>å› ä¸ºéœ€è¦å®‰è£…æ–°çš„condaç¯å¢ƒæ¥è¿›è¡Œæ–°çš„é¡¹ç›®ï¼Œäºæ˜¯ä¹å°±æ–°å»ºäº†condaç¯å¢ƒã€‚è£…å®Œseabornåå‘ç°ï¼Œå›¾åƒæ²¡æ³•æ˜¾ç¤ºã€‚ç»è¿‡ä¸€ç³»åˆ—çš„æ’æŸ¥åå‘ç°é—®é¢˜å‡ºåœ¨äº†matplotlibä¸Šã€‚</p>
<h1 id="é—®é¢˜å¤ç°"><a class="markdownIt-Anchor" href="#é—®é¢˜å¤ç°"></a> é—®é¢˜å¤ç°</h1>
<h2 id="æµ‹è¯•ä»£ç "><a class="markdownIt-Anchor" href="#æµ‹è¯•ä»£ç "></a> æµ‹è¯•ä»£ç </h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np </span><br><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line"></span><br><span class="line">x = np.arange(<span class="number">1</span>,<span class="number">11</span>) </span><br><span class="line">y =  <span class="number">2</span>  * x +  <span class="number">5</span> </span><br><span class="line">plt.title(<span class="string">&quot;test&quot;</span>) </span><br><span class="line"> </span><br><span class="line">plt.xlabel(<span class="string">&quot;x &quot;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&quot;y &quot;</span>)</span><br><span class="line">plt.plot(x,y) </span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<h2 id="é—®é¢˜æˆªå›¾"><a class="markdownIt-Anchor" href="#é—®é¢˜æˆªå›¾"></a> é—®é¢˜æˆªå›¾</h2>
<p>å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœä¸€ç¯‡ç©ºç™½ï¼Œç„¶åç¨‹åºå´©æºƒã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.9/screenshot.png" alt="" /></p>
<h1 id="è§£å†³"><a class="markdownIt-Anchor" href="#è§£å†³"></a> è§£å†³</h1>
<p>è¿™ä¸ªé—®é¢˜æœ‰ç‚¹æ¶å¿ƒçš„åœ°æ–¹åœ¨äºåŸºæœ¬æ‰¾ä¸åˆ°é”™è¯¯ä¿¡æ¯ï¼Œåœ¨å°è¯•è¿‡é™çº§ã€é‡å¯ã€é‡è£…åä¹Ÿæ²¡æœ‰è§£å†³ã€‚åœ¨æˆ‘èº«è¾¹çš„äººåŒæ ·ç¢°åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘æ„è¯†åˆ°è¿™ä¸æ˜¯æˆ‘ä¸ªäººçš„é—®é¢˜ï¼Œäºæ˜¯ä¹åœ¨githubçš„issueæ‰¾åˆ°äº†è§£ç­”ã€‚é—®é¢˜å¤„åœ¨äº†matplotlibçš„ä¾èµ–ä¸Šã€‚éœ€è¦å°†<code>freestyle</code>åŒ…ä»<code>2.11.0</code>é™åˆ°<code>2.10.4</code>ã€‚éšåé—®é¢˜è§£å†³ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">conda install freetype==2.10.4 --force-reinstall</span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>è¿™ä¸ªé—®é¢˜ä¼¼ä¹æ˜¯<code>conda-forge</code>çš„ä¾èµ–é…ç½®ä¸å¯¹ï¼Œæ²¡è¯•è¿‡<code>pip</code>èƒ½ä¸èƒ½è§£å†³ï¼Œå¸Œæœ›åç»­èƒ½å¤Ÿä¿®å¤ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://github.com/matplotlib/matplotlib/issues/21511">[Bug]: Matplotlib crashes Python</a></p>
<p><a href="https://stackoverflow.com/questions/69786885/after-conda-update-python-kernel-crashes-when-matplotlib-is-used/69788527#69788527">After conda update, python kernel crashes when matplotlib is used</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>bug</tag>
        <tag>matplotlib</tag>
      </tags>
  </entry>
  <entry>
    <title>neo4jç®€å•å…¥é—¨å’Œå‰ç«¯å¯è§†åŒ–</title>
    <url>/2021/11/10/neo4j-simple-tutorial/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€ŠD.C.4 Plus Harmonyã€‹</p>
</blockquote>
<h1 id="neo4jå’ŒçŸ¥è¯†å›¾è°±ç®€ä»‹"><a class="markdownIt-Anchor" href="#neo4jå’ŒçŸ¥è¯†å›¾è°±ç®€ä»‹"></a> neo4jå’ŒçŸ¥è¯†å›¾è°±ç®€ä»‹</h1>
<blockquote>
<p>Neo4jæ˜¯ç”±Neo4j,Incå¼€å‘çš„ä¸€ä¸ªå›¾æ•°æ®åº“ç®¡ç†ç³»ç»Ÿã€‚å…¶å¼€å‘äººå‘˜å°†å…¶æè¿°ä¸ºä¸€ä¸ªå…·æœ‰æœ¬åœ°å›¾å­˜å‚¨å’Œå¤„ç†çš„ç¬¦åˆACIDäº‹åŠ¡çš„æ•°æ®åº“ï¼ŒNeo4jåœ¨GPL3åè®®ä¸‹å¼€æºç¤¾åŒºç‰ˆï¼Œè¿˜å…·æœ‰åœ¨å•†ä¸šé—­æºåè®®ä¸‹çš„åœ¨çº¿å¤‡ä»½å’Œé«˜å¯ç”¨æ‹“å±•ã€‚Neoè¿˜å…è®¸Neo4jåœ¨é—­æºå•†ä¸šä¸­ä½¿ç”¨è¿™äº›æ’ä»¶ã€‚<br />
Neo4jæ˜¯ç”±Javaå®ç°ï¼ŒåŒæ—¶å¯ä»¥è¢«å…¶ä»–è¯­è¨€å†™çš„è½¯ä»¶ä½¿ç”¨äº‹åŠ¡æ€§HTTPç«¯ç‚¹æˆ–è€…äºŒè¿›åˆ¶â€œBoltâ€åè®®é€šè¿‡CypheræŸ¥è¯¢è¯­è¨€æ¥è¿›è¡Œè®¿é—®ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šç¿»è¯‘è‡ªWikipediaã€‚ç®€å•æ¥è¯´Neo4jæ˜¯ä¸€ä¸ªä»¥å›¾å½¢å¼å­˜å‚¨çš„ä¸€ä¸ªNOSQLã€‚</p>
<blockquote>
<p>çŸ¥è¯†å›¾è°±ï¼ˆKnowledge Graphï¼‰ï¼Œåœ¨å›¾ä¹¦æƒ…æŠ¥ç•Œç§°ä¸ºçŸ¥è¯†åŸŸå¯è§†åŒ–æˆ–çŸ¥è¯†é¢†åŸŸæ˜ å°„åœ°å›¾ï¼Œæ˜¯æ˜¾ç¤ºçŸ¥è¯†å‘å±•è¿›ç¨‹ä¸ç»“æ„å…³ç³»çš„ä¸€ç³»åˆ—å„ç§ä¸åŒçš„å›¾å½¢ï¼Œç”¨å¯è§†åŒ–æŠ€æœ¯æè¿°çŸ¥è¯†èµ„æºåŠå…¶è½½ä½“ï¼ŒæŒ–æ˜ã€åˆ†æã€æ„å»ºã€ç»˜åˆ¶å’Œæ˜¾ç¤ºçŸ¥è¯†åŠå®ƒä»¬ä¹‹é—´çš„ç›¸äº’è”ç³»ã€‚<br />
çŸ¥è¯†å›¾è°±ï¼Œæ˜¯é€šè¿‡å°†åº”ç”¨æ•°å­¦ã€å›¾å½¢å­¦ã€ä¿¡æ¯å¯è§†åŒ–æŠ€æœ¯ã€ä¿¡æ¯ç§‘å­¦ç­‰å­¦ç§‘çš„ç†è®ºä¸æ–¹æ³•ä¸è®¡é‡å­¦å¼•æ–‡åˆ†æã€å…±ç°åˆ†æç­‰æ–¹æ³•ç»“åˆï¼Œå¹¶åˆ©ç”¨å¯è§†åŒ–çš„å›¾è°±å½¢è±¡åœ°å±•ç¤ºå­¦ç§‘çš„æ ¸å¿ƒç»“æ„ã€å‘å±•å†å²ã€å‰æ²¿é¢†åŸŸä»¥åŠæ•´ä½“çŸ¥è¯†æ¶æ„è¾¾åˆ°å¤šå­¦ç§‘èåˆç›®çš„çš„ç°ä»£ç†è®ºã€‚</p>
</blockquote>
<p>å¯¹äºè¿™ç§çŸ¥è¯†å›¾è°±ï¼Œæœ€å¥½æ˜¯ç”¨neo4jè¿™ç§å›¾æ•°æ®åº“å­˜å‚¨ã€‚æ•ˆæœå¦‚ä¸‹<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/introduce.png" alt="" /></p>
<h1 id="neo4jå®‰è£…"><a class="markdownIt-Anchor" href="#neo4jå®‰è£…"></a> neo4jå®‰è£…</h1>
<p>å¯ä»¥ç›´æ¥åˆ°<a href="https://neo4j.com/">å®˜ç½‘</a>è¿›è¡Œä¸åŒç‰ˆæœ¬çš„é€‰æ‹©å®‰è£…ã€‚æˆ‘è¿™é‡Œé€‰æ‹©<a href="https://neo4j.com/download/?ref=get-started-dropdown-cta">desktop</a>å®‰è£…ã€‚</p>
<h1 id="å¯åŠ¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨"></a> å¯åŠ¨</h1>
<p>å¯åŠ¨æ¯”è¾ƒç®€å•ï¼Œå¼€ç®±å³ç”¨ã€‚å¯ä»¥ç‚¹å‡»ä¸‹å›¾çš„startå¯åŠ¨æ•°æ®åº“æ˜¯ï¼Œç„¶åè¿›è¡Œopenæ‰“å¼€å†…ç½®æµè§ˆå™¨ã€‚ä¹Ÿå¯ä»¥æµè§ˆå™¨ä¸­æ‰“å¼€<code>http://localhost:7474/browser/</code>è¿›è¡Œè®¿é—®ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/start.png" alt="" /></p>
<h1 id="cypher-query"><a class="markdownIt-Anchor" href="#cypher-query"></a> Cypher query</h1>
<p>æ–°å»ºä¸€ä¸ªprojectå’Œdatabaseæ¥å¼€å§‹æˆ‘ä»¬çš„å­¦ä¹ ã€‚</p>
<h2 id="å¢"><a class="markdownIt-Anchor" href="#å¢"></a> å¢</h2>
<p>Cypher queryå¢åŠ èŠ‚ç‚¹éå¸¸ç®€å•<br />
é¦–å…ˆæ¥å¢åŠ ä¸€ä¸ªäººç‰©èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE (p:Person&#123;name:&quot;qxdn&quot;,age:21&#125;) return p</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/create-node.png" alt="" /><br />
è“è‰²çš„å°±æ˜¯åˆ›å»ºçš„èŠ‚ç‚¹ï¼Œå…¶ä¸­<code>CREATE</code>å°±æ˜¯åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…å…³ç³»ã€‚å…¶ä¸­<code>p</code>è¡¨ç¤ºçš„æ˜¯å˜é‡åï¼Œåç»­å¼•ç”¨è¿™ä¸ªèŠ‚ç‚¹çš„æ—¶å€™å¯ä»¥ä½¿ç”¨è¿™ä¸ªå˜é‡åã€‚å…¶ä¸­<code>&#123;&#125;</code>ä¸ºè¯¥èŠ‚ç‚¹çš„å±æ€§ï¼Œç±»ä¼¼äºjsonã€‚<code>return</code>ä¸ºè¿”å›è¾“å‡ºï¼ˆå¯é€‰ï¼‰ã€‚<br />
Cypherä¸­çš„èŠ‚ç‚¹è¡¨ç¤ºå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">()                  //åŒ¿åèŠ‚ç‚¹ï¼Œæ— æ ‡ç­¾</span><br><span class="line">(p:Person)          //ä½¿ç”¨å˜é‡på’Œæ ‡ç­¾Person</span><br><span class="line">(:Technology)       //æ— å˜é‡ï¼Œæ ‡ç­¾ä¸ºTechnology</span><br><span class="line">(work:Company)      //ä½¿ç”¨å˜é‡workå’Œæ ‡ç­¾Company</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥åˆ›å»ºæ›´å¤šçš„èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE (p:Person&#123;name:&quot;a&quot;,age:21&#125;) return p</span><br><span class="line">CREATE (p:Person&#123;name:&quot;b&quot;,age:21&#125;) return p</span><br><span class="line">CREATE (p:Person&#123;name:&quot;c&quot;,age:21&#125;) return p</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºå…³ç³»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (p1:Person &#123;name: &#x27;qxdn&#x27;&#125;)</span><br><span class="line">MATCH (p2:Person &#123;name: &#x27;a&#x27;&#125;)</span><br><span class="line">CREATE (p1)-[rel:IS_FRIENDS_WITH&#123;from:2021&#125;]-&gt;(p2)</span><br><span class="line">// OR ä½¿ç”¨MERGEå¯ä»¥é¿å…é‡å¤å®šä¹‰</span><br><span class="line">MATCH (p1:Person &#123;name:&#x27;b&#x27;&#125;), (p2:Person &#123;name:&quot;qxdn&quot;&#125;) </span><br><span class="line">MERGE (p1)&lt;-[:IS_FRIENDS_WITH&#123;from:2021&#125;]-(p2)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/rel1.png" alt="" /><br />
æ·»åŠ å…³ç³»çš„æ–¹æ³•è¿˜æ˜¯éå¸¸ç®€å•çš„ã€‚ä½¿ç”¨<code>[]</code>å³å¯è¡¨ç¤ºå…³ç³»ï¼Œ<code>:</code>åŒºåˆ†å˜é‡åå’Œæ ‡ç­¾ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨<code>&#123;&#125;</code>æè¿°å…³ç³»çš„å±æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„å…³ç³»æ˜¯æœ‰æ–¹å‘çš„ï¼Œéœ€è¦ç”¨<code>--&gt;</code>æˆ–<code>&lt;--</code>è¡¨ç¤ºã€‚ä¸Šå›¾å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºæ¥ã€‚å¦‚æœä¸çŸ¥é“æ–¹å‘å¯ä»¥ä½¿ç”¨<code>--</code>è¡¨ç¤ºï¼Œè¿™å¯¹ä¸æŸ¥è¯¢æ¥è¯´ä¼šæ›´ç®€å•ã€‚<br />
æ­¤å¤–åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™å°±å¯ä»¥æŒ‡æ˜å…³ç³»</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE (:Person&#123;name:&quot;d&quot;&#125;) -[:IS_FRIENDS_WITH&#123;from:2020&#125;]-&gt;(:Person&#123;name:&quot;e&quot;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="åˆ "><a class="markdownIt-Anchor" href="#åˆ "></a> åˆ </h2>
<p>åˆ é™¤å‘½ä»¤ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNEO4jä¸­åˆ é™¤èŠ‚ç‚¹éœ€è¦æ”¹èŠ‚ç‚¹æ²¡æœ‰å…³è”çš„å…³ç³»ã€‚<br />
ä¸ºäº†æœ‰æ›´å¥½çš„å±•ç¤ºæ•ˆæœï¼Œå…ˆå¢æ¡æ•°æ®</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (p:Person&#123;name:&quot;qxdn&quot;&#125;)</span><br><span class="line">CREATE (p)-[:BORIN]-&gt;(:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">//</span><br><span class="line">CREATE (:Person&#123;name:&quot;f&quot;&#125;) -[:IS_FRIENDS_WITH&#123;from:2020&#125;]-&gt;(:Person&#123;name:&quot;g&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/before-delete.png" alt="" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åˆ é™¤å…³ç³»</span><br><span class="line">MATCH (:Person &#123;name: &#x27;f&#x27;&#125;)-[r:IS_FRIENDS_WITH]-&gt;(:Person &#123;name: &#x27;g&#x27;&#125;)</span><br><span class="line">DELETE r</span><br><span class="line">// åˆ é™¤èŠ‚ç‚¹</span><br><span class="line">MATCH (p:Person &#123;name: &#x27;c&#x27;&#125;)</span><br><span class="line">DELETE p</span><br><span class="line">// åˆ é™¤èŠ‚ç‚¹å’Œå…³ç³»</span><br><span class="line">MATCH (p1:Person &#123;name: &#x27;d&#x27;&#125;)-[r:IS_FRIENDS_WITH]-&gt;(p2:Person &#123;name: &#x27;e&#x27;&#125;)</span><br><span class="line">DELETE p1,p2,r</span><br><span class="line">// æ–­å¼€ä¸€ä¸ªèŠ‚ç‚¹çš„å…³ç³»å’Œå…¶è‡ªèº«</span><br><span class="line">MATCH (c:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">DETACH DELETE c</span><br><span class="line">// åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„å±æ€§</span><br><span class="line">MATCH (n:Person &#123;name: &#x27;qxdn&#x27;&#125;)</span><br><span class="line">REMOVE n.age</span><br><span class="line">// OR</span><br><span class="line">MATCH (n:Person &#123;name: &#x27;a&#x27;&#125;)</span><br><span class="line">SET n.age = null</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/after-delete.png" alt="åˆ é™¤ä¹‹å" /></p>
<h2 id="æŸ¥"><a class="markdownIt-Anchor" href="#æŸ¥"></a> æŸ¥</h2>
<p>å…ˆæ‰§è¡Œä¸€ä¸‹è¯­å¥å¢åŠ èŠ‚ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//</span><br><span class="line">CREATE (:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">// </span><br><span class="line">CREATE (:Country&#123;name:&quot;USA&quot;&#125;)</span><br><span class="line">//</span><br><span class="line">MATCH (p:Person&#123;name:&quot;qxdn&quot;&#125;),(c:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">MERGE (p)-[:BORN_IN]-&gt;(c)</span><br><span class="line">//</span><br><span class="line">MATCH (p:Person&#123;name:&quot;a&quot;&#125;),(c:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">MERGE (p)-[:BORN_IN]-&gt;(c)</span><br><span class="line">//</span><br><span class="line">MATCH (p:Person&#123;name:&quot;b&quot;&#125;),(c:Country&#123;name:&quot;USA&quot;&#125;)</span><br><span class="line">MERGE (p)-[:BORN_IN]-&gt;(c)</span><br><span class="line">//</span><br><span class="line">MATCH (p:Person&#123;name:&quot;g&quot;&#125;),(c:Country&#123;name:&quot;USA&quot;&#125;)</span><br><span class="line">MERGE (p)-[:BORN_IN]-&gt;(c)</span><br><span class="line">//</span><br><span class="line">MATCH (p:Person&#123;name:&quot;f&quot;&#125;),(c:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">MERGE (p)-[:BORN_IN]-&gt;(c)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/match1.png" alt="" /></p>
<p>æŸ¥è¯¢è¯­å¥ä¸»è¦é <code>MATCH</code>å…³é”®è¯ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºsqlä¸­çš„<code>SELECT</code></p>
<p>æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹ï¼Œåªè¾“å‡º25ä¸ªé¿å…è¿‡å¤šèŠ‚ç‚¹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (n) </span><br><span class="line">RETURN n </span><br><span class="line">LIMIT 25</span><br></pre></td></tr></table></figure>
<p>ç»“æœä¸ä¸Šå›¾ä¸€æ ·<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/match1.png" alt="" /></p>
<p>æŸ¥è¯¢qxdnå‡ºç”Ÿçš„å›½å®¶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (:Person &#123;name: &#x27;qxdn&#x27;&#125;)-[:BORN_IN]-&gt;(c:Country)</span><br><span class="line">RETURN c</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/match2.png" alt="" /></p>
<p>æŸ¥è¯¢qxdnå’Œaåšæœ‹å‹çš„èµ·å§‹å¹´</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (:Person &#123;name: &#x27;qxdn&#x27;&#125;)-[r:IS_FRIENDS_WITH]-&gt;(:Person &#123;name: &#x27;a&#x27;&#125;)</span><br><span class="line">RETURN r.from</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/match3.png" alt="" /></p>
<p>æŸ¥è¯¢æ‰€æœ‰ä¸­å›½å‡ºç”Ÿçš„äºº</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (p:Person)-[:BORN_IN]-&gt;(c:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">RETURN p,c</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/match4.png" alt="" /></p>
<h2 id="æ”¹"><a class="markdownIt-Anchor" href="#æ”¹"></a> æ”¹</h2>
<p>æ”¹ä¸»è¦æ˜¯ä½¿ç”¨<code>SET</code>å…³é”®è¯<br />
ä¿®æ”¹açš„å‡ºç”Ÿå›½</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MATCH (p:Person&#123;name:&quot;a&quot;&#125;)-[:BORN_IN]-(c:Country&#123;name:&quot;China&quot;&#125;)</span><br><span class="line">SET c.name = &quot;USA&quot;</span><br><span class="line">RETURN p,c</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/set.png" alt="" /></p>
<h1 id="å‰ç«¯å¯è§†åŒ–"><a class="markdownIt-Anchor" href="#å‰ç«¯å¯è§†åŒ–"></a> å‰ç«¯å¯è§†åŒ–</h1>
<p>å‰ç«¯å¯è§†åŒ–å¯ä»¥ä½¿ç”¨<code>neovis.js</code>ã€‚è¿™æ˜¯ä½¿ç”¨vis.jså¯¹neo4jè¿›è¡Œå®šåˆ¶ï¼Œå¯ä»¥åœ¨å‰ç«¯ç›´æ¥æ“ä½œneo4jã€‚ç”±äºå®éªŒå®¤é¡¹ç›®ä¸éœ€è¦ç®¡å•¥å®‰å…¨ï¼Œå› æ­¤ä¹Ÿä¸ç®¡æ˜æ–‡å¯†ç äº†ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆcloneä¸€ä¸‹å®˜ç½‘çš„repoã€‚å¹¶ä¿®æ”¹å…¶ä¸­çš„<code>simple-example.html</code>ã€‚ä¿®æ”¹å…¶ä¸­çš„<code>config</code>å˜é‡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">				<span class="attr">container_id</span>: <span class="string">&quot;viz&quot;</span>, <span class="comment">//jqueryçš„å®¹å™¨id</span></span><br><span class="line">				<span class="attr">server_url</span>: <span class="string">&quot;bolt://localhost:7687&quot;</span>, <span class="comment">//æœåŠ¡å™¨url</span></span><br><span class="line">				<span class="attr">server_user</span>: <span class="string">&quot;qxdn&quot;</span>,</span><br><span class="line">				<span class="attr">server_password</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line"></span><br><span class="line">				<span class="attr">labels</span>: &#123;</span><br><span class="line">					<span class="comment">//&quot;Character&quot;: &quot;name&quot;,</span></span><br><span class="line">					<span class="string">&quot;Person&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;caption&quot;</span>: <span class="string">&quot;name&quot;</span>, <span class="comment">//èŠ‚ç‚¹æ˜¾ç¤ºçš„å†…å®¹ </span></span><br><span class="line">						<span class="string">&quot;title_properties&quot;</span>: [ <span class="comment">//é¼ æ ‡ç§»åˆ°èŠ‚ç‚¹ä¸Šæ˜¾ç¤ºçš„å†…å®¹</span></span><br><span class="line">							<span class="string">&quot;name&quot;</span>,</span><br><span class="line">							<span class="string">&quot;age&quot;</span></span><br><span class="line">						]</span><br><span class="line">					&#125;,</span><br><span class="line">					<span class="string">&quot;Country&quot;</span>: &#123;</span><br><span class="line">						<span class="string">&quot;caption&quot;</span>: <span class="string">&quot;name&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				<span class="attr">relationships</span>: &#123;</span><br><span class="line">				&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">				<span class="attr">initial_cypher</span>: <span class="string">&quot;MATCH p=()--&gt;() RETURN p&quot;</span>    <span class="comment">// åˆå§‹åŒ–çš„cypherè¯­å¥</span></span><br><span class="line">			&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.8/front.png" alt="" /></p>
<h2 id="å®Œæ•´ä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´ä»£ç "></a> å®Œæ•´ä»£ç </h2>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Neovis.js Simple Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">html</span>,</span></span><br><span class="line"><span class="language-css">		<span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">font</span>: <span class="number">16pt</span> arial;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">		<span class="selector-id">#viz</span> &#123;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">width</span>: <span class="number">900px</span>;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">height</span>: <span class="number">700px</span>;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">border</span>: <span class="number">1px</span> solid lightgray;</span></span><br><span class="line"><span class="language-css">			<span class="attribute">font</span>: <span class="number">22pt</span> arial;</span></span><br><span class="line"><span class="language-css">		&#125;</span></span><br><span class="line"><span class="language-css">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- <span class="doctag">FIXME:</span> load from dist --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../dist/neovis.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://code.jquery.com/jquery-3.2.1.min.js&quot;</span></span></span><br><span class="line"><span class="tag">		<span class="attr">integrity</span>=<span class="string">&quot;sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// define config car</span></span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// instantiate nodevis object</span></span></span><br><span class="line"><span class="language-javascript">		<span class="comment">// draw</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> viz;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="keyword">var</span> config = &#123;</span></span><br><span class="line"><span class="language-javascript">				<span class="attr">container_id</span>: <span class="string">&quot;viz&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">				<span class="attr">server_url</span>: <span class="string">&quot;bolt://localhost:7687&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">				<span class="attr">server_user</span>: <span class="string">&quot;qxdn&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">				<span class="attr">server_password</span>: <span class="string">&quot;123456&quot;</span>,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">				<span class="attr">labels</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">					<span class="comment">//&quot;Character&quot;: &quot;name&quot;,</span></span></span><br><span class="line"><span class="language-javascript">					<span class="string">&quot;Person&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">						<span class="string">&quot;caption&quot;</span>: <span class="string">&quot;name&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">						<span class="string">&quot;title_properties&quot;</span>: [</span></span><br><span class="line"><span class="language-javascript">							<span class="string">&quot;name&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">							<span class="string">&quot;age&quot;</span></span></span><br><span class="line"><span class="language-javascript">						]</span></span><br><span class="line"><span class="language-javascript">					&#125;,</span></span><br><span class="line"><span class="language-javascript">					<span class="string">&quot;Country&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">						<span class="string">&quot;caption&quot;</span>: <span class="string">&quot;name&quot;</span></span></span><br><span class="line"><span class="language-javascript">					&#125;</span></span><br><span class="line"><span class="language-javascript">				&#125;,</span></span><br><span class="line"><span class="language-javascript">				<span class="attr">relationships</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">				&#125;,</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">				<span class="attr">initial_cypher</span>: <span class="string">&quot;MATCH p=()--&gt;() RETURN p&quot;</span></span></span><br><span class="line"><span class="language-javascript">			&#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">			viz = <span class="keyword">new</span> <span class="title class_">NeoVis</span>.<span class="title function_">default</span>(config);</span></span><br><span class="line"><span class="language-javascript">			viz.<span class="title function_">render</span>();</span></span><br><span class="line"><span class="language-javascript">			<span class="variable language_">console</span>.<span class="title function_">log</span>(viz);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;draw()&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;viz&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	Cypher query: <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">rows</span>=<span class="string">&quot;4&quot;</span> <span class="attr">cols</span>=<span class="string">50</span> <span class="attr">id</span>=<span class="string">&quot;cypher&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reload&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Stabilize&quot;</span> <span class="attr">id</span>=<span class="string">&quot;stabilize&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	$(<span class="string">&quot;#reload&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">var</span> cypher = $(<span class="string">&quot;#cypher&quot;</span>).<span class="title function_">val</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		<span class="keyword">if</span> (cypher.<span class="property">length</span> &gt; <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">			viz.<span class="title function_">renderWithCypher</span>(cypher);</span></span><br><span class="line"><span class="language-javascript">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">			<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;reload&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">			viz.<span class="title function_">reload</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">		&#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	&#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	$(<span class="string">&quot;#stabilize&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">		viz.<span class="title function_">stabilize</span>();</span></span><br><span class="line"><span class="language-javascript">	&#125;)</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æœ¬æ–‡ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹neo4jä»¥åŠå…¶çš„Cypher Queryè¯­å¥ï¼Œè¿˜æœ‰å‰ç«¯å¯è§†åŒ–çš„æ–¹æ¡ˆã€‚å…³äºCypheræ›´è¯¦ç»†çš„ç”¨æ³•å’Œå‰ç«¯æ›´å¤šå‚æ•°åŒ–çš„å®šåˆ¶å¯ä»¥çœ‹å®˜æ–¹çš„æ•™ç¨‹ï¼Œé“¾æ¥æ”¾åœ¨äº†ä¸‹æ–¹çš„å‚è€ƒèµ„æ–™é‡Œé¢ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://en.wikipedia.org/wiki/Neo4j">Neo4j wikipedia</a></p>
<p><a href="https://baike.baidu.com/item/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/8120012">çŸ¥è¯†å›¾è°±</a></p>
<p><a href="https://neo4j.com/developer/cypher/querying/">Querying with Cypher</a></p>
<p><a href="https://neo4j.com/developer/cypher/guide-cypher-basics/">guide-cypher-basics</a></p>
<p><a href="https://github.com/neo4j-contrib/neovis.js">neovis.js</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>nosql</tag>
        <tag>neo4j</tag>
      </tags>
  </entry>
  <entry>
    <title>ç±³æ¸¸ç¤¾çˆ¬è™«</title>
    <url>/2021/11/12/mihoyo-bbs-crawler/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šæ‚ ä¹…ã®ã‚«ãƒ³ãƒ‘ãƒãƒ©ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºä¸ªäººæ¯”è¾ƒå–œæ¬¢ç±³æ¸¸ç¤¾çš„COSå›¾å’ŒåŒäººå›¾ï¼ŒåŒæ—¶è§‰å¾—å…¶è´¨é‡æ»¡é«˜çš„ï¼Œå› æ­¤æ‰“ç®—çˆ¬å–å…¶å›¾ç‰‡ã€‚</p>
<p>å®Œæ•´é™„å¸¦ç®€æ˜“cliçš„ä»£ç æ”¾åœ¨äº†<a href="https://github.com/qxdn/mihoyo-bbs-crawler">GitHub</a></p>
<h1 id="å…³é—­debugæ¨¡å¼"><a class="markdownIt-Anchor" href="#å…³é—­debugæ¨¡å¼"></a> å…³é—­Debugæ¨¡å¼</h1>
<p>é¦–å…ˆå…ˆåˆ†æåŸç¥çš„é¡µé¢ï¼Œæ‰“å¼€åŸç¥çš„<a href="https://bbs.mihoyo.com/ys/home/49">COSé¡µé¢</a>ï¼Œä¸€å¦‚æ—¢å¾€çš„æ‰“å¼€è°ƒè¯•é¡µé¢ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.7/f12.png" alt="" /><br />
å¯ä»¥çœ‹åˆ°ç±³æ¸¸ç¤¾å¯¹åˆ†ææºä»£ç åšäº†ä¸€äº›é˜²èŒƒï¼Œåˆ†ææ—¶ä¼šå§‹ç»ˆå¡åœ¨debugé¡µé¢ä¸Šã€‚ä½†æ˜¯è¿™ä¹Ÿéš¾ä¸å€’æˆ‘ä»¬ã€‚ç›´æ¥ç‚¹å‡»ä¸‹æ–¹çš„deactivateæŒ‰é’®ï¼Œå³å¯å…³é—­debugæ¨¡å¼ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.7/deactivate.png" alt="" /></p>
<h1 id="åˆ†æè¯·æ±‚"><a class="markdownIt-Anchor" href="#åˆ†æè¯·æ±‚"></a> åˆ†æè¯·æ±‚</h1>
<p>ä»¥åŸç¥COSçš„çƒ­é—¨å›¾ç‰‡ä¸ºä¾‹ã€‚åœ¨è°ƒè¯•é¡µé¢ä¸‹æ‰“å¼€åŸç¥COSé¡µé¢çš„çƒ­é—¨å›¾ç‰‡ï¼Œåˆ†æå…¶ä¸­çš„è¯·æ±‚ã€‚ä»ç½‘é¡µæºä»£ç ä¸­å¯ä»¥å‘ç°ç±³æ¸¸ç¤¾æ˜¯ä¸€ä¸ªåŠ¨æ€é¡µé¢ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æ˜¯å‘æœåŠ¡å™¨åŠ¨æ€è¯·æ±‚ã€‚å› æ­¤åœ¨networkç•Œé¢ä¸­æ‰¾åˆ°å«æœ‰å†…å®¹jsonçš„è¯·æ±‚ã€‚æ‰¾åˆ°çš„ç•Œé¢å¦‚ä¸‹ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.7/get1.png" alt="request" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.7/get-perview.png" alt="preview" /></p>
<p>ç”±æ­¤åˆ†æè¯·æ±‚å‚æ•°ï¼Œå¾—åˆ°å¦‚ä¸‹å‚æ•°:</p>
<ul>
<li>apiåœ°å€: <a href="https://bbs-api.mihoyo.com/post/wapi/getForumPostList">https://bbs-api.mihoyo.com/post/wapi/getForumPostList</a></li>
<li>fourm_id</li>
<li>gids</li>
<li>is_good</li>
<li>is_hot</li>
<li>page_size</li>
</ul>
<p>æ¥ä¸‹æ¥é€ä¸ªåˆ†æå„ä¸ªå‚æ•°ã€‚</p>
<!--TOC-->
<p><a href="#%E5%AE%8C%E6%95%B4%E5%8F%82%E6%95%B0%E6%84%8F%E4%B9%89">å®Œæ•´çš„å‚æ•°å«ä¹‰</a></p>
<!--TOC-->
<h2 id="apiåœ°å€"><a class="markdownIt-Anchor" href="#apiåœ°å€"></a> apiåœ°å€</h2>
<p>è§‚å¯Ÿ<code>æœ€æ–°å›å¤</code>ã€<code>æœ€æ–°å‘å¸–</code>ã€<code>çƒ­é—¨</code>ã€<code>ç²¾å</code>ã€<code>æ—¥æ¦œ</code>ã€<code>å‘¨æ¦œ</code>ã€<code>æœˆæ¦œ</code>ã€‚å¯ä»¥å¾—åˆ°å„ä¸ªå†…å®¹å¯¹åº”çš„apiåœ°å€ã€‚</p>
<ul>
<li>baseurl: <a href="https://bbs-api.mihoyo.com/post/wapi">https://bbs-api.mihoyo.com/post/wapi</a></li>
<li>api
<ul>
<li>/getForumPostList:
<ul>
<li><code>æœ€æ–°å›å¤</code></li>
<li><code>æœ€æ–°å‘å¸–</code></li>
<li><code>çƒ­é—¨</code></li>
<li><code>æ—¥æ¦œ</code></li>
<li><code>å‘¨æ¦œ</code></li>
<li><code>æœˆæ¦œ</code></li>
</ul>
</li>
<li>/forumGoodPostFullList:
<ul>
<li><code>ç²¾å</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="forum_id"><a class="markdownIt-Anchor" href="#forum_id"></a> forum_id</h2>
<p>forum_idä¸ºç¤¾åŒºçš„idï¼Œä¸åŒç¤¾åŒºçš„idä¸åŒã€‚å„å¤§ç¤¾åŒºå¯¹åº”idå¦‚ä¸‹ã€‚</p>
<ul>
<li>åŸç¥
<ul>
<li>COS: 49</li>
<li>åŒäººå›¾: 29</li>
</ul>
</li>
<li>å´©3
<ul>
<li>åŒäººå›¾: 4</li>
</ul>
</li>
<li>å¤§åˆ«å¢…
<ul>
<li>COS: 47</li>
<li>åŒäººå›¾: 39</li>
</ul>
</li>
<li>æ˜Ÿç©¹é“é“
<ul>
<li>åŒäººå›¾: 56</li>
</ul>
</li>
<li>å´©2
<ul>
<li>åŒäººå›¾: 40</li>
</ul>
</li>
<li>æœªå®š
<ul>
<li>åŒäººå›¾: 38</li>
</ul>
</li>
</ul>
<h2 id="gids"><a class="markdownIt-Anchor" href="#gids"></a> gids</h2>
<p>gidsåœ¨jsonä¸­å¯ä»¥çœ‹åˆ°æ˜¯æŒ‡game_idï¼Œå„å¤§æ¸¸æˆçš„game_idå¯¹åº”å¦‚ä¸‹</p>
<ul>
<li>å´©3: 1</li>
<li>åŸç¥: 2</li>
<li>å´©2: 3</li>
<li>æœªå®š: 4</li>
<li>å¤§åˆ«å¢…: 5</li>
<li>æ˜Ÿç©¹é“é“: 6</li>
</ul>
<h2 id="is_good"><a class="markdownIt-Anchor" href="#is_good"></a> is_good</h2>
<p>è¯¥å‚æ•°ä¸ºä¸€ä¸ªboolå€¼ï¼Œè¡¨ç¤ºæ˜¯å¦ä¸ºç²¾åã€‚å®é™…ä¸ŠåŸºæœ¬ç”¨ä¸åˆ°ï¼Œç²¾åæŸ¥è¯¢ä¸ç”¨è¿™ä¸ªã€‚</p>
<h2 id="is_hot"><a class="markdownIt-Anchor" href="#is_hot"></a> is_hot</h2>
<p>è¯¥å‚æ•°ä¸ºä¸€ä¸ªboolå€¼ï¼Œè¡¨ç¤ºæ˜¯å¦ä¸ºçƒ­é—¨ã€‚</p>
<h2 id="sort_type"><a class="markdownIt-Anchor" href="#sort_type"></a> sort_type</h2>
<p>åœ¨è§‚å¯Ÿæœ€æ–°å‘å¸–å’Œæœ€æ–°å›å¤é¡µé¢è¯·æ±‚æ—¶å‘ç°è¯¥å‚æ•°ã€‚è¯¥å‚æ•°ä¸ºä¸€ä¸ªintå˜é‡ï¼Œå¯é€‰å€¼ä¸º1æˆ–è€…2ã€‚å¯¹åº”å†…å®¹å¦‚ä¸‹</p>
<ul>
<li>æœ€æ–°å›å¤: 1</li>
<li>æœ€æ–°å‘å¸–: 2</li>
</ul>
<h2 id="type"><a class="markdownIt-Anchor" href="#type"></a> type</h2>
<p>åœ¨è§‚å¯Ÿæ¦œå•çš„è¯·æ±‚æ—¶å‘æ³„è¯¥å‚æ•°ã€‚è¯¥å‚æ•°ä¸ºä¸€ä¸ªintå˜é‡ï¼Œå¯é€‰å€¼ä¸º1ã€2ã€3ï¼Œå¯¹åº”å†…å®¹å¦‚ä¸‹</p>
<ul>
<li>æ—¥æ¦œ: 1</li>
<li>å‘¨æ¦œ: 2</li>
<li>æœˆæ¦œ: 3</li>
</ul>
<h1 id="å®Œæ•´å‚æ•°æ„ä¹‰"><a class="markdownIt-Anchor" href="#å®Œæ•´å‚æ•°æ„ä¹‰"></a> å®Œæ•´å‚æ•°æ„ä¹‰</h1>
<ul>
<li>api:
<ul>
<li>/forumGoodPostFullList: ç”¨äºæŸ¥è¯¢ç²¾å</li>
<li>/getForumPostList: ç”¨äºçƒ­é—¨ã€æœ€æ–°å›å¤ã€æœ€æ–°å‘å¸–ã€æ¦œå•</li>
</ul>
</li>
<li>fourm_id: ç¤¾åŒºid</li>
<li>gids: æ¸¸æˆid</li>
<li>is_good: æ˜¯å¦ä¸ºç²¾å</li>
<li>is_hot: æ˜¯å¦ä¸ºçƒ­é—¨</li>
<li>page_size: è¿”å›postçš„æ•°é‡</li>
<li>sort_type: ç”¨äºæŸ¥è¯¢å’ŒåŒºåˆ«æœ€æ–°å›å¤å’Œæœ€æ–°å‘å¸–</li>
<li>type: ç”¨äºæ¦œå•æŸ¥è¯¢ï¼ŒåŒºåˆ†æ—¥æ¦œã€å‘¨æ¦œå’Œæœˆæ¦œ</li>
</ul>
<h1 id="jsonåˆ†æ"><a class="markdownIt-Anchor" href="#jsonåˆ†æ"></a> jsonåˆ†æ</h1>
<p>ç±³æ¸¸ç¤¾è¿”å›çš„jsonåŸºæœ¬ç›¸åŒï¼Œä½†æ˜¯ç²¾åè¿”å›çš„ä¸å…¶ä»–ç•¥æœ‰ä¸åŒã€‚ä¸»è¦ä¸ºå…¶ä¸­ä¸€ä¸ªkeyä¸åŒï¼Œç²¾åæ˜¯<code>posts</code>ã€å…¶ä½™æ˜¯<code>list</code></p>
<h2 id="ç²¾å"><a class="markdownIt-Anchor" href="#ç²¾å"></a> ç²¾å</h2>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;retcode&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;posts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;post&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;post_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;f_forum_id&quot;</span><span class="punctuation">:</span> <span class="number">29</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;179065436&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ã€è§‚æµ‹æ¢ã€‘ç¶ç‹çˆ·é”…å·´-â‘¡&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é€æœˆèŠ‚é‡Œæƒ¹äººç–¼çˆ±çš„é”…å·´å¤´åƒäºŒæœŸæ¥å•¦~\nä¸€å…±4å¼ ï¼ŒæŒ‰ç…§å›¾çš„é¡ºåºåˆ†åˆ«æ˜¯ï¼š\nâ‘ é”…é”…å®³ç¾ï¼ˆè¿™è¡¨æƒ…å°±å‡ºç°è¿‡ä¸¤ä¸ªç¬é—´ï¼Œå¤ªå°‘äº†ï¼‰\nâ‘¡é”…é”…å§”å±ˆï¼ˆé­ˆçŒ«çŒ«ä¸ç†é”…ï¼ï¼‰\nâ‘¢é”…åƒçªå¤´ï¼ˆåˆé‡é¦™è±æƒ…æ™¯ï¼‰\nâ‘£é”…é”…ç¥åƒï¼ˆç¶ç¥åƒï¼‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/0f0dc49e5b4f3f579119e81c2d98a1c1_61295632854955864.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;view_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="number">1633624612</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/c8e8c7e273b31f7e16ce65d5220c18c0_1642884008313599219.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/2897e34888a2ef7ccafa099202432971_149407973314057590.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/0f0dc49e5b4f3f579119e81c2d98a1c1_61295632854955864.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/36eb746e02be4563e086c15571f3f8e3_3412574759048499179.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/affa15e44b7eb4c2359e3464c5549715_874705953357861664.png&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;post_status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_official&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;topic_ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="number">105</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="number">439</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="number">559</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="number">761</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;view_status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;max_floor&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_original&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;republish_authorization&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;reply_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-10-22 08:03:01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_deleted&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;structured_content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;structured_content_rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;review_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_profit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_in_profit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;forum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">29</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒäººå›¾&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2020/04/05/f8b71f0c5b81976d7e36c8ae014f9e5b.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;topics&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">53</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åŒäººå›¾&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/09/09/61f2fe15f5fd3d976690855337ba5ba9_7313218117241578974.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">105</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¡¨æƒ…åŒ…&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2019/06/27/178fc0552cf615c5c40fd8bb9a1556ab.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">439</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;é¦™è±&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2020/11/25/8a4309c40e68e3e42fb64931e8fad6fc.jpeg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">559</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¤´åƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/04/01/d76532e1f634d57646dcbc1852eba6a8_2131217136772532601.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">761</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ¥ç‚¹ç¨¿å¤´&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/09/06/e58af9f46cdf0e920386f44dbc089617_4917005110024976346.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;179065436&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å­æ—–&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;introduce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ‡’ç™Œæ™šæœŸæ‚£è€…+é‡åº¦æ‚é£Ÿæ€§é€‰æ‰‹ï¼Œæˆ‘åªä¼šç”»å¤§å¤´&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30015&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;certification&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è§‚æµ‹è€…ã€ç”»å¸ˆ&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;level_exp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">7493</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_following&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_followed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;avatar_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://img-static.mihoyo.com/avatar/avatar30015.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;pendant&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;self_operation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;attitude&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_collected&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;stat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;view_num&quot;</span><span class="punctuation">:</span> <span class="number">4353</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;reply_num&quot;</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;like_num&quot;</span><span class="punctuation">:</span> <span class="number">490</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;bookmark_num&quot;</span><span class="punctuation">:</span> <span class="number">47</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;forward_num&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;help_sys&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;top_up&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;top_n&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;answer_num&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/0f0dc49e5b4f3f579119e81c2d98a1c1_61295632854955864.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;810604&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27423117&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;image_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/c8e8c7e273b31f7e16ce65d5220c18c0_1642884008313599219.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;785773&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27423068&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/2897e34888a2ef7ccafa099202432971_149407973314057590.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;818320&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27423098&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/0f0dc49e5b4f3f579119e81c2d98a1c1_61295632854955864.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;810604&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27423117&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/36eb746e02be4563e086c15571f3f8e3_3412574759048499179.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2000</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;889738&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27423123&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/10/08/179065436/affa15e44b7eb4c2359e3464c5549715_874705953357861664.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">270</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;140855&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;27423168&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10544616&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_official_master&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_user_master&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;hot_reply_exist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;vote_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;last_modify_time&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;recommend_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;vod_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_block_on&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;forum_rank_info&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;last_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;is_last&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;next_offset&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="å…¶ä½™è¿”å›"><a class="markdownIt-Anchor" href="#å…¶ä½™è¿”å›"></a> å…¶ä½™è¿”å›</h2>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;retcode&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;OK&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;post&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;post_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11794784&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;f_forum_id&quot;</span><span class="punctuation">:</span> <span class="number">49</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;283837710&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;subject&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ã€cosã€‘å¾€ç”Ÿå ‚ç¬¬ä¸ƒåä¸ƒä»£å ‚ä¸»å°±æ˜¯èƒ¡æ¡ƒæˆ‘å•¦ï¼&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¯ä»¥è¯´è¿™æ˜¯æˆ‘cosè¿‡æœ€ä¸åƒçš„ä¸€ä¸ªè§’è‰²äº†ï¼Œåšèƒ¡æ¡ƒçš„ä¼ è¯´ä»»åŠ¡è§‰å¾—å¥¹è¡¨é¢æ´»æ³¼å¯çˆ± å®é™…ä¸Šå¿ƒç†åˆå¾ˆæˆç†Ÿè±è¾¾ï¼Œè¿˜æœ‰ç‚¹å°è…¹é»‘ï¼Œè¿™æ ·çš„åå·®å¥½éš¾è¡¨è¾¾ï¼Œæˆ‘ä¸€ç‚¹ä¹Ÿä¸å¯çˆ±ï¼Œå†ä¹Ÿä¸ä¼šå‡ºäº†ã€‚ã€‚ã€‚&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/11/09/283837710/eaf9376a42d40973d43a90a113828e93_1442388115152832304.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;view_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;created_at&quot;</span><span class="punctuation">:</span> <span class="number">1636438339</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/11/09/283837710/96b35bf328a9884fb15021c5377372ec_53917698238889953.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/11/09/283837710/eaf9376a42d40973d43a90a113828e93_1442388115152832304.jpg&quot;</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;post_status&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_official&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;topic_ids&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="number">525</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="number">547</span></span><br><span class="line">                    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;view_status&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;max_floor&quot;</span><span class="punctuation">:</span> <span class="number">2495</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_original&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;republish_authorization&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;reply_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-11-12 10:00:12&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_deleted&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;structured_content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;structured_content_rows&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;review_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_profit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_in_profit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;forum&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">49</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;COS&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/04/29/0cd5fbc21feccc3dbccf7ddd3a14cded.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;topics&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">525</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;èƒ¡æ¡ƒ&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/02/27/5f567ecb567640f0a9e26775f6aa4942.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">547</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Cosplay&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/09/09/9a3b4ee5699c95707df85fb77bce39f2_1763133664448316116.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_top&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_good&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_interactive&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;game_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content_type&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;uid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;283837710&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å°ç™½Nanno&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;introduce&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å…¨ç½‘éƒ½å«å°ç™½Nannoï¼Œè§†é¢‘åœ¨æŠ–éŸ³å¿«æ‰‹bç«™               &quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;100061&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;gender&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;certification&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;label&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Coser&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;level_exp&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">10211</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_following&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_followed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;avatar_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://img-static.mihoyo.com/communityweb/upload/a57113d5e6173a05f7980c978c5a2bd6.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;pendant&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;self_operation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;attitude&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_collected&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;stat&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;view_num&quot;</span><span class="punctuation">:</span> <span class="number">529292</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;reply_num&quot;</span><span class="punctuation">:</span> <span class="number">3664</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;like_num&quot;</span><span class="punctuation">:</span> <span class="number">113866</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;bookmark_num&quot;</span><span class="punctuation">:</span> <span class="number">4978</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;forward_num&quot;</span><span class="punctuation">:</span> <span class="number">543</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;help_sys&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;top_up&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;top_n&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;answer_num&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;cover&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/11/09/283837710/eaf9376a42d40973d43a90a113828e93_1442388115152832304.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">4032</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2268</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4346689&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30556208&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11794784&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;image_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/11/09/283837710/96b35bf328a9884fb15021c5377372ec_53917698238889953.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">3865</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2174</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4443075&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30556207&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11794784&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://upload-bbs.mihoyo.com/upload/2021/11/09/283837710/eaf9376a42d40973d43a90a113828e93_1442388115152832304.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">4032</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">2268</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;4346689&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;crop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;is_user_set_cover&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;image_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30556208&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_ENTITY_POST&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;entity_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;11794784&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_official_master&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_user_master&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;hot_reply_exist&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;vote_count&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;last_modify_time&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;recommend_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;vod_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;is_block_on&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;forum_rank_info&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;last_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;is_last&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;is_origin&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="å®Œæ•´ä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´ä»£ç "></a> å®Œæ•´ä»£ç </h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum, unique</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BasicSpider</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.base_url = <span class="string">&quot;https://bbs-api.mihoyo.com/post/wapi/&quot;</span></span><br><span class="line">        <span class="comment"># api åœ°å€</span></span><br><span class="line">        self.api = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># ç¤¾åŒº id</span></span><br><span class="line">        self.forum_id = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># å«ä¹‰æœªçŸ¥ ä¼¼ä¹æ˜¯game_id</span></span><br><span class="line">        self.gids = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># ç²¾å“</span></span><br><span class="line">        self.is_good = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># çƒ­é—¨</span></span><br><span class="line">        self.is_hot = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># æ¸¸æˆå</span></span><br><span class="line">        self.game_name = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># è¯·æ±‚å¤´</span></span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://bbs.mihoyo.com/&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;https://bbs.mihoyo.com/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">self, page_size: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        è·å–è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sync_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        ä»¥åŒæ­¥çš„æ–¹å¼è·å–å›¾ç‰‡åœ°å€ é»˜è®¤20å¼ ï¼Œå°±ç®—ä¸ä¼ page_sizeä¹Ÿæ˜¯20</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sync_get</span>(<span class="params">self, params: <span class="built_in">dict</span> = <span class="literal">None</span>, is_good: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        ä»¥åŒæ­¥çš„æ–¹å¼è·å–response</span></span><br><span class="line"><span class="string">        params: è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="string">        is_good: æ˜¯å¦ä¸ºç²¾å</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        r = httpx.get(self.api, params=params, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> self.handle_response(r, is_good=is_good)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        ä»¥å¼‚æ­¥çš„æ–¹å¼è·å–å›¾ç‰‡åœ°å€ é»˜è®¤20å¼ ï¼Œå°±ç®—ä¸ä¼ page_sizeä¹Ÿæ˜¯20</span></span><br><span class="line"><span class="string">        TODO æµ‹è¯•</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_get</span>(<span class="params">self, params: <span class="built_in">dict</span> = <span class="literal">None</span>, is_good: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        ä»¥å¼‚æ­¥çš„æ–¹å¼è·å–response</span></span><br><span class="line"><span class="string">        params: è¯·æ±‚å‚æ•°</span></span><br><span class="line"><span class="string">        is_good: æ˜¯å¦ä¸ºç²¾å</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient() <span class="keyword">as</span> client:</span><br><span class="line">            r = <span class="keyword">await</span> client.get(self.api, params=params, headers=self.headers)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.handle_response(r, is_good=is_good)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_response</span>(<span class="params">self, response, is_good: <span class="built_in">bool</span> = <span class="literal">False</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        å¤„ç†è¿”å›çš„è¯·æ±‚</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        urls = []</span><br><span class="line">        <span class="keyword">if</span> is_good:</span><br><span class="line">            posts = response.json()[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;posts&quot;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            posts = response.json()[<span class="string">&quot;data&quot;</span>][<span class="string">&quot;list&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> post <span class="keyword">in</span> posts:</span><br><span class="line">            images = post[<span class="string">&quot;post&quot;</span>][<span class="string">&quot;images&quot;</span>]</span><br><span class="line">            <span class="keyword">for</span> image <span class="keyword">in</span> images:</span><br><span class="line">                urls.append(image)</span><br><span class="line">        <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_game_name</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> self.game_name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RankType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æ’è¡Œæ¦œç±»å‹</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># æ—¥æ¦œ</span></span><br><span class="line">    Daily = <span class="number">1</span></span><br><span class="line">    <span class="comment"># å‘¨æ¦œ</span></span><br><span class="line">    Weekly = <span class="number">2</span></span><br><span class="line">    <span class="comment"># æœˆæ¦œ</span></span><br><span class="line">    Monthly = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LatestType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æœ€æ–°å›å¤æˆ–è€…æ˜¯æœ€æ–°å‘å¸–</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># æœ€æ–°å›å¤</span></span><br><span class="line">    LatestComment = <span class="number">1</span></span><br><span class="line">    <span class="comment"># æœ€æ–°å‘å¸–</span></span><br><span class="line">    LatestPost = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æ¸¸æˆç±»å‹</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># åŸç¥</span></span><br><span class="line">    Genshin = <span class="number">2</span></span><br><span class="line">    <span class="comment"># å´©3</span></span><br><span class="line">    Honkai3rd = <span class="number">1</span></span><br><span class="line">    <span class="comment"># å¤§åˆ«å¢… è¯è¯´å¤§åˆ«å¢…ä¸ºå•¥æ˜¯DBY</span></span><br><span class="line">    DBY = <span class="number">5</span></span><br><span class="line">    <span class="comment"># æ˜Ÿç©¹é“é“</span></span><br><span class="line">    StarRail = <span class="number">6</span></span><br><span class="line">    <span class="comment"># å´©2</span></span><br><span class="line">    Honkai2 = <span class="number">3</span></span><br><span class="line">    <span class="comment"># æœªå®š è¿™åå­—çœŸå¥‡æ€ª</span></span><br><span class="line">    TearsOfThemis = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@unique</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForumType</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ç¤¾åŒºç±»å‹ è¦ä¸æ¸¸æˆç±»å‹ä¸€è‡´</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># åŸç¥ cos</span></span><br><span class="line">    GenshinCos = <span class="number">49</span></span><br><span class="line">    <span class="comment"># åŸç¥ åŒäººå›¾</span></span><br><span class="line">    GenshinPic = <span class="number">29</span></span><br><span class="line">    <span class="comment"># å´©3 åŒäººå›¾</span></span><br><span class="line">    Honkai3rdPic = <span class="number">4</span></span><br><span class="line">    <span class="comment"># å¤§åˆ«å¢… COS</span></span><br><span class="line">    DBYCOS = <span class="number">47</span></span><br><span class="line">    <span class="comment"># å¤§åˆ«å¢… åŒäººå›¾</span></span><br><span class="line">    DBYPIC = <span class="number">39</span></span><br><span class="line">    <span class="comment"># æ˜Ÿç©¹é“é“ åŒäººå›¾</span></span><br><span class="line">    StarRailPic = <span class="number">56</span></span><br><span class="line">    <span class="comment"># å´©2 åŒäººå›¾</span></span><br><span class="line">    Honkai2Pic = <span class="number">40</span></span><br><span class="line">    <span class="comment"># æœªå®š åŒäººå›¾</span></span><br><span class="line">    TearsOfThemisPic = <span class="number">38</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_gids</span>(<span class="params">forum: <span class="built_in">str</span></span>) -&gt; GameType:</span><br><span class="line">    forum2gid = &#123;</span><br><span class="line">        <span class="string">&quot;GenshinCos&quot;</span>: GameType.Genshin,</span><br><span class="line">        <span class="string">&quot;GenshinPic&quot;</span>: GameType.Genshin,</span><br><span class="line">        <span class="string">&quot;Honkai3rdPic&quot;</span>: GameType.Honkai3rd,</span><br><span class="line">        <span class="string">&quot;DBYCOS&quot;</span>: GameType.DBY,</span><br><span class="line">        <span class="string">&quot;DBYPIC&quot;</span>: GameType.DBY,</span><br><span class="line">        <span class="string">&quot;StarRailPic&quot;</span>: GameType.StarRail,</span><br><span class="line">        <span class="string">&quot;Honkai2Pic&quot;</span>: GameType.Honkai2,</span><br><span class="line">        <span class="string">&quot;TearsOfThemisPic&quot;</span>: GameType.TearsOfThemis</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> forum2gid[forum]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rank</span>(<span class="title class_ inherited__">BasicSpider</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æ¦œå•</span></span><br><span class="line"><span class="string">    url: https://bbs.mihoyo.com/ys/imgRanking/49</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, forum_id: ForumType, <span class="built_in">type</span>: RankType</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.api = parse.urljoin(self.base_url, <span class="string">&quot;getImagePostList&quot;</span>)</span><br><span class="line">        self.forum_id = forum_id.value</span><br><span class="line">        gametype = get_gids(forum_id.name)</span><br><span class="line">        self.gids = gametype.value</span><br><span class="line">        <span class="comment"># æ—¥æ¦œ</span></span><br><span class="line">        self.<span class="built_in">type</span> = <span class="built_in">type</span>.value</span><br><span class="line">        self.game_name = gametype.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">self, page_size: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;forum_id&quot;</span>: self.forum_id,</span><br><span class="line">            <span class="string">&quot;gids&quot;</span>: self.gids,</span><br><span class="line">            <span class="string">&quot;page_size&quot;</span>: page_size,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: self.<span class="built_in">type</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sync_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">21</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> self.sync_get(self.get_params(page_size))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> self.async_get(self.get_params(page_size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Hot</span>(<span class="title class_ inherited__">BasicSpider</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    çƒ­é—¨</span></span><br><span class="line"><span class="string">    url: https://bbs.mihoyo.com/ys/home/49?type=hot</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, forum_id: ForumType</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.api = parse.urljoin(self.base_url, <span class="string">&quot;getForumPostList&quot;</span>)</span><br><span class="line">        self.forum_id = forum_id.value</span><br><span class="line">        gametype = get_gids(forum_id.name)</span><br><span class="line">        self.gids = gametype.value</span><br><span class="line">        self.is_hot = <span class="literal">True</span></span><br><span class="line">        self.game_name = gametype.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">self, page_size: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;forum_id&quot;</span>: self.forum_id,</span><br><span class="line">            <span class="string">&quot;gids&quot;</span>: self.gids,</span><br><span class="line">            <span class="string">&quot;is_good&quot;</span>: self.is_good,</span><br><span class="line">            <span class="string">&quot;is_hot&quot;</span>: self.is_hot,</span><br><span class="line">            <span class="string">&quot;page_size&quot;</span>: page_size</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sync_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> self.sync_get(self.get_params(page_size))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> self.async_get(self.get_params(page_size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Good</span>(<span class="title class_ inherited__">BasicSpider</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ç²¾å</span></span><br><span class="line"><span class="string">    url: https://bbs.mihoyo.com/ys/home/49?type=good</span></span><br><span class="line"><span class="string">    åŸç¥COSç²¾åç›®å½•ç›®å‰ä¸ºç©º</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, forum_id: ForumType</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.api = parse.urljoin(self.base_url, <span class="string">&quot;forumGoodPostFullList&quot;</span>)</span><br><span class="line">        self.forum_id = forum_id.value</span><br><span class="line">        gametype = get_gids(forum_id.name)</span><br><span class="line">        self.gids = gametype.value</span><br><span class="line">        self.game_name = gametype.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">self, page_size: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;forum_id&quot;</span>: self.forum_id,</span><br><span class="line">            <span class="string">&quot;gids&quot;</span>: self.gids,</span><br><span class="line">            <span class="string">&quot;page_size&quot;</span>: page_size</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sync_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> self.sync_get(self.get_params(page_size), is_good=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> self.async_get(self.get_params(page_size), is_good=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Latest</span>(<span class="title class_ inherited__">BasicSpider</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æœ€æ–°å›å¤å’Œå‘å¸–</span></span><br><span class="line"><span class="string">    url: https://bbs.mihoyo.com/ys/home/49?type=1</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, forum_id: ForumType, sort_type: LatestType</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.api = parse.urljoin(self.base_url, <span class="string">&quot;getForumPostList&quot;</span>)</span><br><span class="line">        self.forum_id = forum_id.value</span><br><span class="line">        gametype = get_gids(forum_id.name)</span><br><span class="line">        self.gids = gametype.value</span><br><span class="line">        <span class="comment"># æ’åºç±»å‹</span></span><br><span class="line">        self.sort_type = sort_type.value</span><br><span class="line">        self.game_name = gametype.name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_params</span>(<span class="params">self, page_size: <span class="built_in">int</span></span>) -&gt; <span class="type">Dict</span>:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;forum_id&quot;</span>: self.forum_id,</span><br><span class="line">            <span class="string">&quot;gids&quot;</span>: self.gids,</span><br><span class="line">            <span class="string">&quot;page_size&quot;</span>: page_size,</span><br><span class="line">            <span class="string">&quot;is_good&quot;</span>: self.is_good,</span><br><span class="line">            <span class="string">&quot;is_hot&quot;</span>: self.is_hot,</span><br><span class="line">            <span class="string">&quot;sort_type&quot;</span>: self.sort_type</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sync_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> self.sync_get(self.get_params(page_size))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_get_urls</span>(<span class="params">self, page_size: <span class="built_in">int</span> = <span class="number">20</span></span>) -&gt; <span class="type">List</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> self.async_get(self.get_params(page_size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    gh = Good(ForumType.Honkai2Pic)</span><br><span class="line">    urls = gh.sync_get_urls()</span><br><span class="line">    <span class="built_in">print</span>(urls)</span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æœ¬æ¬¡å®Œæˆäº†å¸¦æœ‰ç®€å•cliçš„ç±³æ¸¸ç¤¾çˆ¬è™«ï¼Œå¹¶å®ç°äº†ä¸€å¥—ç®€å•çš„åŒæ­¥å’Œå¼‚æ­¥apiã€‚ä¸‹ä¸€æ­¥è®¡åˆ’è¿›è¡Œå®šæ—¶å¯åŠ¨ä»»åŠ¡ã€‚</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
      </tags>
  </entry>
  <entry>
    <title>CMDé”™è¯¯ æ­¤æ—¶ä¸åº”æœ‰&amp;</title>
    <url>/2021/11/14/cmd-error-was-unexpected/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šãƒãƒ©ã¨çš‡å¥³ã¨é‡è‰¯çŒ«ãƒãƒ¼ãƒˆã€‹</p>
</blockquote>
<h1 id="é—®é¢˜æè¿°"><a class="markdownIt-Anchor" href="#é—®é¢˜æè¿°"></a> é—®é¢˜æè¿°</h1>
<p>æ‰“å¼€cmdçš„æ—¶å€™ç›´æ¥å‡ºé”™ï¼Œæç¤ºâ€œæ­¤æ—¶ä¸åº”æœ‰&amp;â€ï¼Œè‹±æ–‡ç‰ˆåº”è¯¥æ˜¯â€œ&amp; was unexpected at this timeâ€ã€‚é—®é¢˜çš„å®é™…æƒ…å†µè§ä¸‹å›¾ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.6/error.png" alt="" /></p>
<h1 id="é—®é¢˜è§£å†³"><a class="markdownIt-Anchor" href="#é—®é¢˜è§£å†³"></a> é—®é¢˜è§£å†³</h1>
<p>å¹¸è¿çš„æ˜¯åœ¨stack overflowä¸Šèƒ½å¤Ÿæ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚é¦–å…ˆç»è¿‡æµ‹è¯•<code>cmd.exe /d</code>èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚<code>cmd.exe /d</code>å‘½ä»¤å¯ä»¥é˜»æ­¢æ³¨å†Œè¡¨ä¸­çš„<code>AutoRun</code>è¿è¡Œã€‚è¿™ä¸€ç‚¹å¯ä»¥åœ¨<code>cmd.exe /?</code>ä¸­æŸ¥çœ‹æœ‰å“ªäº›æ³¨å†Œè¡¨éœ€è¦æ£€æŸ¥ã€‚</p>
<p>éœ€è¦æŸ¥é˜…çš„æ³¨å†Œè¡¨ä¸€å…±æœ‰ä¸¤å¤„</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Command Processor</span><br><span class="line">HKEY_CURRENT_USER\SOFTWARE\Microsoft\Command Processor</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>Win+R</code>å¹¶è¾“å…¥<code>regedit</code>æ‰“å¼€æ³¨å†Œè¡¨ã€‚æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.6/regedit1.png" alt="" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.6/regedit2.png" alt="" /></p>
<p>å¯ä»¥çœ‹åˆ°<code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\Command Processor</code>çš„<code>AutoRun</code>ä¸­æœ‰ä¸€ä¸ªå¥‡æ€ªçš„å€¼ã€‚è¿™é‡Œç›´æ¥åˆ é™¤å³å¯ï¼Œæˆ–è€…è¿è¡Œä¸‹é¢çš„æŒ‡ä»¤ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢æ‰€æœ‰å®šä¹‰äº†AutoRunçš„ä½ç½®</span></span><br><span class="line"><span class="built_in">Get-ItemProperty</span> <span class="literal">-ea</span> Ignore (<span class="string">&#x27;HKCU:&#x27;</span>, <span class="string">&#x27;HKLM:&#x27;</span> <span class="operator">-replace</span> <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\Software\Microsoft\Command Processor&#x27;</span>) AutoRun </span><br><span class="line"><span class="comment"># æŸ¥çœ‹å¦‚æœæ‰§è¡Œäº†å‘½ä»¤ä¼šå‘ç”Ÿä»€ä¹ˆ</span></span><br><span class="line"><span class="built_in">Get-ItemProperty</span> <span class="literal">-ea</span> Ignore (<span class="string">&#x27;HKCU:&#x27;</span>, <span class="string">&#x27;HKLM:&#x27;</span> <span class="operator">-replace</span> <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\Software\Microsoft\Command Processor&#x27;</span>) AutoRun | Remove-</span><br><span class="line">ItemProperty <span class="literal">-Name</span> AutoRun <span class="literal">-WhatIf</span></span><br><span class="line"><span class="comment"># åˆ é™¤ -WhatIfå³å¯æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="built_in">Get-ItemProperty</span> <span class="literal">-ea</span> Ignore (<span class="string">&#x27;HKCU:&#x27;</span>, <span class="string">&#x27;HKLM:&#x27;</span> <span class="operator">-replace</span> <span class="string">&#x27;$&#x27;</span>, <span class="string">&#x27;\Software\Microsoft\Command Processor&#x27;</span>) AutoRun | Remove-</span><br><span class="line">ItemProperty <span class="literal">-Name</span> AutoRun</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.6/solution.png" alt="è¿è¡Œç»“æœ" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.6/result1.png" alt="è¿è¡Œåçš„æ³¨å†Œè¡¨" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.6/result2.png" alt="è¿è¡Œåæ­£å¸¸çš„CMD" /></p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>è¿™ä¸ªå¥‡è‘©çš„å°é—®é¢˜æœ‰ç‚¹éš¾å—ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªè½¯ä»¶å¹²çš„ã€‚æ‰€å¹¸stack overflowä¸Šæœ‰é—®é¢˜çš„å®šä½æ–¹æ³•å’Œè§£å†³è¿‡ç¨‹ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://stackoverflow.com/questions/59480657/cmd-exe-throws-error-was-unexpected-at-this-time">cmd.exe throws error â€œ&amp; was unexpected at this time.â€</a></p>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
        <tag>cmd</tag>
      </tags>
  </entry>
  <entry>
    <title>do{...}while(0)çš„ç”¨æ³•</title>
    <url>/2021/11/22/do-while-0/</url>
    <content><![CDATA[<h1 id="æºç "><a class="markdownIt-Anchor" href="#æºç "></a> æºç </h1>
<p>åœ¨AliOS-Thingsä¸­çš„<code>k_task.c</code>æ–‡ä»¶ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°è°ƒç”¨<code>NULL_PARA_CHK(task)</code>ã€‚å…¶åŠŸèƒ½æ˜¯æ£€æŸ¥taskå˜é‡æ˜¯å¦ä¸ºNULLå€¼ï¼Œå®Œæ•´çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NULL_PARA_CHK(para)        \</span></span><br><span class="line"><span class="meta">    do &#123;                           \</span></span><br><span class="line"><span class="meta">        <span class="keyword">if</span> (para == NULL) &#123;        \</span></span><br><span class="line"><span class="meta">            return RHINO_NULL_PTR; \</span></span><br><span class="line"><span class="meta">        &#125;                          \</span></span><br><span class="line"><span class="meta">    &#125; while (0)</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¯¥å‡½æ•°å°±æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ¥äº†ã€‚è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„å—ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨å¤§æ‹¬å·å‘¢ã€‚</p>
<h1 id="ç”¨å¤„"><a class="markdownIt-Anchor" href="#ç”¨å¤„"></a> ç”¨å¤„</h1>
<p>è¿™æ˜¯ä¸€ä¸ªcè¯­è¨€å¯ä»¥ä½¿ç”¨çš„æ„é€ å‡½æ•°ï¼Œå…¶åœ¨åé¢åŠ åˆ†å·ä¹Ÿæ²¡é—®é¢˜ï¼Œåœ¨ifåé¢åŠ è¯¥å®ä¹Ÿæ²¡é—®é¢˜ã€‚è¿™æ ·è¯´å¯èƒ½æœ‰ç‚¹éš¾ç†è§£,è¿˜æ˜¯ç”¨æ¡ˆä¾‹æ¥è¯´æ¯”è¾ƒå¥½ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå®å®šä¹‰å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> f(x) foo(x);bar(x)</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬å¦‚ä»¥ä¸‹æ–¹æ³•è°ƒç”¨æ—¶ä¸ä¼šæœ‰é—®é¢˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">f(x);</span><br><span class="line"><span class="comment">// å®é™…</span></span><br><span class="line">foo(x);bar(x);</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ”¾åˆ°ifè¯­å¥é‡Œé¢å°±ä¼šäº§ç”Ÿé—®é¢˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    f(x);</span><br><span class="line"><span class="comment">// å®é™…</span></span><br><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    foo(x);</span><br><span class="line">bar(x);</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ifåé¢ä½¿ç”¨è¯¥å®çš„æ—¶å€™ï¼Œbar(x)åœ¨ifå¤–é¢æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚å¦‚æœæˆ‘ä»¬ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥å‘¢ï¼Ÿé‡æ–°å®šä¹‰å®å¦‚ä¸‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> f(x) &#123;foo(x);bar(x);&#125;</span></span><br></pre></td></tr></table></figure>
<p>æ˜¾ç„¶æ”¾åˆ°äº†ä¸Šé¢çš„ifç¯å¢ƒä¸­æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å†åŠ ä¸€ä¸ªelseå°±æœ‰é—®é¢˜äº†ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">    f(x);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    other();</span><br><span class="line"><span class="comment">// å®é™…</span></span><br><span class="line"><span class="keyword">if</span> (cond)</span><br><span class="line">&#123;</span><br><span class="line">    foo(x);</span><br><span class="line">    bar(x);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    other();</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°åœ¨å¤§æ‹¬å·åé¢å¤šäº†ä¸€ä¸ªåˆ†å·ï¼Œåœ¨è¯¥æƒ…å†µä¸‹ä¼šæœ‰è¯­æ³•é—®é¢˜ã€‚å› æ­¤æˆ‘ä»¬é‡æ–°ä¿®æ”¹å®å®šä¹‰å¦‚ä¸‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> f(x) do&#123;foo(x);bar(x);&#125;while(0)</span></span><br></pre></td></tr></table></figure>
<p>åœ¨doâ€¦while(0)å®å®šä¹‰ä¸­ï¼Œdoâ€¦whileè¯­å¥ä¿è¯äº†doä¸­çš„ä»£ç ä¸€å®šä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œè€Œwhile(0)ä¿è¯å…¶åªè¢«æ‰§è¡Œä¸€æ¬¡ã€‚ä¸”ä½¿ç”¨è¿™ç§å®åœ¨ä¸Šè¿°çš„if elseè¯­å¥ä¸­ä¹Ÿä¸ä¼šå‡ºé”™ã€‚ä¹Ÿå¯ä»¥åœ¨åé¢åŠ ä¸Šåˆ†å·ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(cond)</span><br><span class="line">    f(x);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    other();</span><br><span class="line"><span class="comment">// å®é™…</span></span><br><span class="line"><span class="keyword">if</span>(cond)</span><br><span class="line">    <span class="keyword">do</span>&#123;</span><br><span class="line">        foo(x);</span><br><span class="line">        bar(x);</span><br><span class="line">    &#125;<span class="keyword">while</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    other();</span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>äº†è§£åˆ°äº†cè¯­è¨€å®å®šä¹‰ä¸€ç§ç¥å¥‡çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿäº†è§£åˆ°äº†doâ€¦whileè¯­å¥çš„ä¸€ä¸ªç”¨å¤„ã€‚çŸ¥è¯†upã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://stackoverflow.com/questions/154136/why-use-apparently-meaningless-do-while-and-if-else-statements-in-macros">Why use apparently meaningless do-while and if-else statements in macros?</a></p>
]]></content>
      <categories>
        <category>c</category>
      </categories>
      <tags>
        <tag>c</tag>
      </tags>
  </entry>
  <entry>
    <title>haas100çƒ§å½•å¤±è´¥é—®é¢˜è§£å†³</title>
    <url>/2021/11/16/haas-burn-error/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€ŠEã‚¹ã‚¯ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ•ã€‹</p>
</blockquote>
<h1 id="é—®é¢˜æè¿°"><a class="markdownIt-Anchor" href="#é—®é¢˜æè¿°"></a> é—®é¢˜æè¿°</h1>
<p>haas100æ— æ³•è¿›è¡Œçƒ§å½•ï¼ŒæŠ¥é”™<code>Please connect the serial port of the board to the PC,then reset the board.</code>ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/error-in-burn.png" alt="çƒ§å½•é”™è¯¯" /></p>
<h1 id="é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a> é—®é¢˜è§£å†³æ–¹æ¡ˆ</h1>
<p><code>Please connect the serial port of th board to the PC,then reset the board.</code>è¿™ä¸ªé—®é¢˜æ‰¾ä¸åˆ°å•¥è§£å†³èµ„æ–™ï¼Œå®˜æ–¹ç¾¤é‡Œé—®äº†ä¹Ÿæ²¡æœ‰æ²¡äººå›åº”ã€‚åªèƒ½è‡ªå·±ç¿»é˜…ä¸€ä¸‹haasç™¾äº‹é€šæŸ¥æŸ¥æœ‰æ²¡æœ‰ç±»ä¼¼èµ„æºã€‚æ‰¾åˆ°äº†å…¶ä¸­ä¸€æ¡ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ã€æƒ…å½¢5ã€‘: æç¤ºâ€œPlease reboot board nowâ€<br />
è§£å†³åŠæ³•ï¼šç›®å‰å‘ç°éƒ¨åˆ†HaaS100/ EDU K1 ç”±äºå‡ºå‚å›ºä»¶ä¸­æ²¡æœ‰äºŒçº§bootï¼Œç°è±¡å°±æ˜¯ä¸€ç›´æåç”¨æˆ·please reboot board nowï¼›é‡åˆ°è¯¥é—®é¢˜çš„åŒå­¦è¯·å…ˆå‚è€ƒè¿™ä¸ªæ–‡æ¡£è¯·ç”¨ä¸‹é¢é“¾æ¥ä¸­çš„â€œWindows GUIâ€å·¥å…·çƒ§å½•å³å¯è§£å†³ã€‚ä¹‹åå†ç”¨vscode + haas studioçƒ§å½•ä¹Ÿä¸ä¼šå‡ºç°é—®é¢˜ã€‚</p>
</blockquote>
<p>ç”±æ­¤æˆ‘ä»¬åˆæ­¥çŒœæµ‹å¯èƒ½æ˜¯äºŒçº§bootå‡ºäº†é—®é¢˜ï¼Œå¯¼è‡´haas studioæ— æ³•å¯¹haas100è¿›è¡Œè½¯é‡å¯ã€‚å› æ­¤æˆ‘ä»¬æ‰“å¼€<code>&#123;Your Project&#125;\hardware\chip\haas1000\release\write_flash_gui</code>è¿è¡Œå…¶ä¸­çš„<code>haas1000_write_flash_main.exe</code>ã€‚ç»“æœå‘ç°é—ªé€€ã€‚æ— æ³•å‘ç°æ˜æ˜¾åŸå› ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä»å‘½ä»¤è¡Œæ‰“å¼€ï¼Œå¾ˆæ˜æ˜¾çš„å°±èƒ½çœ‹åˆ°é”™è¯¯åŸå› ã€‚æ¯”è¾ƒæ˜æ˜¾æ˜¯é˜¿é‡Œçš„äººå‘˜åœ¨ç¼–è¯‘çƒ§å½•å·¥å…·å‡ºäº†é—®é¢˜ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/error-in-gui.png" alt="guié”™è¯¯" /></p>
<p>è€ƒè™‘åˆ°ä¹‹å‰æœ‰äººä½¿ç”¨è¯¥å·¥å…·çƒ§å½•æˆåŠŸè¿‡ï¼Œä¸”è¯¥å·¥å…·æ˜¯ä½¿ç”¨git cloneä¸‹æ¥çš„ã€‚é‚£ä¹ˆå¯ä»¥å»githubæ‰¾æ‰¾çœ‹æœ‰å“ªä¸ªç‰ˆæœ¬çš„æ˜¯çƒ§å½•çš„ã€‚</p>
<blockquote>
<p>2021-11-18æ›´æ–°ï¼š<em>é—ªé€€åŸå› åœ¨äºç¼ºå°‘<code>productline_cfg.xml</code>æ–‡ä»¶ï¼Œä¸‹è½½<a href="https://raw.githubusercontent.com/alibaba/AliOS-Things/dev_3.1.0_haas/platform/mcu/haas1000/release/write_flash_gui/productline_cfg.xml">productline_cfg.xml</a>å¹¶æ”¾å…¥<code>wirte_flash_gui</code>æ–‡ä»¶å¤¹å³å¯ï¼Œä¸å¿…å†ä¸‹è½½æ•´ä»½å·¥ç¨‹</em></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/alibaba/AliOS-Things.git -b dev_3.1.0_haas</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¸Šé¢çš„gitå‘½ä»¤ï¼Œæ‰“å¼€<code>&#123;your path&#125;/AliOS-Things/platform/mcu/haas1000/release/write_flash_gui</code>ç›®å½•ä¸­çš„<code>haas1000_write_flash_main.exe</code>ã€‚è¿™æ¬¡å¯ä»¥çœ‹åˆ°guiå·¥å…·æ‰“å¼€æˆåŠŸäº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/gui.png" alt="" /></p>
<p>åç»­çš„å·¥ä½œå°±å’Œå®˜æ–¹çš„æ“ä½œä¸€æ ·äº†ï¼Œå®˜æ–¹æ•™ç¨‹é“¾æ¥æ”¾åœ¨äº†åº•ä¸‹çš„å‚è€ƒèµ„æ–™ä¸­ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¸æ˜¯åªå‡çº§äºŒçº§bootï¼Œè€Œæ˜¯å…¨éƒ¨é‡æ–°çƒ§å†™ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/gui-burn.png" alt="æˆåŠŸå…¨éƒ¨çƒ§å†™" /></p>
<p>æœ€åæµ‹è¯•èƒ½å¦çƒ§å†™æˆ‘ä»¬çš„å·¥ç¨‹ï¼Œçƒ§å†™ç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘çš„ä»£ç æˆåŠŸçš„çƒ§å½•è¿›äº†æ¿å­ä¸­ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/burn-success.png" alt="çƒ§å½•ç»“æœ" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/result.png" alt="è¿è¡Œç»“æœ" /></p>
<h1 id="å¤–è°ˆ"><a class="markdownIt-Anchor" href="#å¤–è°ˆ"></a> å¤–è°ˆ</h1>
<p>è¿è¡Œ<code>aos make clean</code>å‘ç°å‡ºé”™ï¼Œé”™è¯¯åŸå› è§ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/bin/bash: -c: line 1: syntax error: unexpected end of file</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/clean-error.png" alt="" /></p>
<p>è¿™ä¸ªé—®é¢˜å€’æ˜¯æ¯”è¾ƒå¸¸è§ï¼Œå› ä¸ºWindowsçš„EOL(End of Line)æ˜¯ç”±å›è½¦CRå’Œæ¢è¡ŒLFç»„æˆï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ä¸²å£è¾“å‡ºä¸­åŠ ä¸Š\r\næ‰èƒ½æ¢è¡Œã€‚è€ŒLinuxä¸­çš„EOLæ˜¯LFã€‚å› æ­¤åœ¨Linuxä¸­è¿è¡ŒWindowsä¸­å†™çš„æ–‡ä»¶ä¼šæœ‰è¿™ä¸ªé—®é¢˜ã€‚<br />
ä»é”™è¯¯å¼€å¤´çš„<code>/usr/bin/bash</code>å¯ä»¥å‘ç°æ˜¯Linuxçš„bashï¼Œä¸ªäººæ¨æµ‹è¿™ä¸ªåº”è¯¥æ˜¯å› ä¸ºæˆ‘çš„ç”µè„‘é‡Œé¢è£…æœ‰wsl2ã€‚ä»makefileçœ‹ä¸€ä¸‹éœ€è¦åˆ é™¤çš„æ–‡ä»¶ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(OS)</span>, Windows_NT)</span><br><span class="line">	<span class="variable">$(CPRE)</span> if exist aos_sdk rmdir /s /q aos_sdk</span><br><span class="line">	<span class="variable">$(CPRE)</span> if exist binary rmdir /s /q binary</span><br><span class="line">	<span class="variable">$(CPRE)</span> if exist out rmdir /s /q out</span><br><span class="line">	<span class="variable">$(CPRE)</span> if exist aos.elf del /f /q aos.elf</span><br><span class="line">	<span class="variable">$(CPRE)</span> if exist aos.map del /f /q aos.map</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿå‘ç°aos_sdkæ–‡ä»¶å¤¹ä¸º*.aåº”è¯¥æ˜¯åˆ°æ—¶å€™è¦é“¾æ¥çš„ç±»åº“ï¼ŒEOLæ˜¯LFã€‚outæ–‡ä»¶å¤¹é‡Œé¢æ˜¯*.dï¼Œ*.oè¿˜æœ‰binæ–‡ä»¶ï¼ŒåŸºæœ¬ä¸Šä¸ºç¼–è¯‘ä¸­é—´äº§ç‰©å’Œæœ€ç»ˆæ–‡ä»¶ï¼ŒEOLä¸ºCRLFï¼Œaos.elfå’Œaos.mapçš„ROLéƒ½æ˜¯CRLFï¼ŒåŒæ—¶å‘ç°æ‰§è¡Œ<code>aos make clean</code>åå°±åˆ é™¤äº†aos_sdkä¸­çš„å†…å®¹ã€‚</p>
<p>æ˜ç™½äº†åŸå› å°±å¾ˆå®¹æ˜“è§£å†³è¯¥é—®é¢˜äº†ã€‚çœ‹makefileä¸­çš„å‘½ä»¤ï¼Œåº”è¯¥æ˜¯ç”¨cmdè¿è¡Œã€‚å› æ­¤åªéœ€è¦åœ¨makefileçš„ç¬¬ä¸€è¡ŒåŠ ä¸Šä¸€å¥<code>SHELL := C:\Windows\System32\cmd.exe</code>ã€‚æŒ‡å®šè¿è¡Œçš„shellä¸ºcmdå³å¯ã€‚ä¿®æ”¹åçš„è¿è¡Œç»“æœå¦‚ä¸‹ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.5/clean-success.png" alt="" /></p>
<h1 id="å¤–è°ˆ2"><a class="markdownIt-Anchor" href="#å¤–è°ˆ2"></a> å¤–è°ˆ2</h1>
<blockquote>
<p>æ²¡æƒ³åˆ°å§ï¼Œè¿˜æœ‰2ã€‚å…¶å®æ˜¯æˆ‘æ‡’å¾—æ–°å»ºä¸€ä¸ªæ–‡ç« äº†ã€‚</p>
</blockquote>
<p>æœ¬æ¬¡ä¸»è¦æ·»åŠ ä¸€ä¸ªpowershellä¸­æ¿€æ´»aosçš„å°è„šæœ¬ã€‚ç”±äºæˆ‘ä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢haasè¿™ä¸ªæ’ä»¶çš„ç›®å‰ç‰ˆæœ¬ã€‚å› ä¸ºä»–æ€»æ˜¯åœ¨å„ä¸ªç›®å½•ä¸‹å¯åŠ¨ï¼Œå¹¶æ–°å»ºä¸€ä¸ªç»ˆç«¯ä¿®æ”¹ç¯å¢ƒå˜é‡ã€‚äºæ˜¯æˆ‘å¹³æ—¶ä¸ç”¨haasæ—¶å°±æŠŠè¿™ä¸ªæ’ä»¶ç¦ç”¨äº†ï¼Œä½†æ˜¯ç”±äºæˆ‘å¶å°”ç”±éœ€è¦æ‰“å¼€haaså·¥ç¨‹ç¼–è¯‘ä¸€ç‚¹ç‚¹å†…å®¹ï¼Œæ­¤æ—¶éœ€è¦é‡æ–°æ¿€æ´»æ’ä»¶ç•¥å¾®æœ‰ç‚¹éº»çƒ¦ã€‚è€ƒè™‘åˆ°haas studioåŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨aos-toolså®Œæˆï¼Œæ‰€è°“çš„ä¿®æ”¹ç¯å¢ƒå˜é‡ä¹Ÿåªæ˜¯ä¸ºäº†æ–¹ä¾¿æ‰¾åˆ°aos-toolsã€‚åœ¨ç†Ÿæ‚‰äº†aosçš„å‡ ä¸ªåŸºæœ¬å‘½ä»¤åï¼Œä¸ä½¿ç”¨haas studioä¹Ÿèƒ½å¤Ÿå®Œæˆå¼€å‘ï¼Œè¿™æ ·åªéœ€è¦ä¸´æ—¶ä¿®æ”¹ç¯å¢ƒå˜é‡å°±å¯ä»¥ç›´æ¥å®Œæˆå·¥ç¨‹ï¼Œè€Œä¸ç”¨ä½¿ç”¨é‚£çƒ¦äººhaas studioäº†ã€‚</p>
<p>æ¿€æ´»è„šæœ¬å¦‚ä¸‹ï¼Œå’Œhaasçš„å‘½ä»¤ä¸€æ ·ï¼Œå°†ä¸‹é¢çš„è·¯å¾„æ”¹ä¸ºä½ çš„è·¯å¾„ã€‚ç„¶ååªéœ€è¦å°†è¿™æ®µä»£ç ä¿å­˜æˆ<code>activate.ps1</code>æˆ–è€…å…¶ä»–ä½ è‡ªå·±å‘½åçš„æ–‡ä»¶ï¼Œä½†è¦æ³¨æ„ç»“å°¾ä¸º<code>.ps1</code>ã€‚ç„¶ååœ¨powershellè¿è¡Œå°±å¯ä»¥ä¸´æ—¶æ¿€æ´»<code>aos</code>äº†ã€‚<code>$Env:Path</code>åªæ˜¯ä¸´æ—¶ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œåªéœ€è¦å…³é—­è¯¥ç»ˆç«¯å°±å¯ä»¥å…³é—­haasï¼Œå› æ­¤å°±æ²¡å†™deactivateæ–‡ä»¶ã€‚å¦‚æœè¯´éœ€è¦ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥æ¿€æ´»çš„è¯ï¼Œä¹Ÿå¯ä»¥å°†å…¶æ”¾åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜æˆ activate.ps1</span></span><br><span class="line"><span class="variable">$Env:Path</span>=<span class="string">&quot;C:\ProgramData\aos\miniconda3;C:\ProgramData\aos\miniconda3\Scripts;C:\ProgramData\aos\miniconda3\Library\bin;<span class="variable">$Env:Path</span>&quot;</span> ; </span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=&gt; powershell.exe detected, set miniconda env finished.&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>åœ¨æˆåŠŸçƒ§å†™åï¼Œæˆ‘ç©äº†ä¸€ä¸‹haas100è¿™å—æ¿å­ï¼Œæ„Ÿè§‰æ¿å­è¿˜æ˜¯ä¸é”™ï¼Œåšçš„è¿˜è¡Œã€‚ä½†æ˜¯è¿™ä¸ªå¼€å‘å·¥å…·å®åœ¨ä¸è¡Œï¼Œé—®é¢˜æœ‰ç‚¹å¤šã€‚å¸Œæœ›é˜¿é‡Œèƒ½å¤Ÿå®Œå–„ä¸€ä¸‹ï¼Œä¸ç„¶è¿™ä¸ªå·¥å…·å°±ä¼šåŠé€€å¥½å¤šäººäº†ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://blog.csdn.net/HaaSTech/article/details/119028477">å¦‚ä½•å‡çº§HaaS100 / HaaS EDU K1çš„äºŒçº§boot</a></p>
<p><a href="https://help.aliyun.com/document_detail/302383.html">çƒ§å½•å›ºä»¶</a></p>
]]></content>
      <categories>
        <category>c</category>
      </categories>
      <tags>
        <tag>c</tag>
        <tag>haas</tag>
      </tags>
  </entry>
  <entry>
    <title>U-Netè®ºæ–‡ç¬”è®°</title>
    <url>/2022/01/27/unet-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šæ¹›è“ç‰¢ç¬¼ Rail of MÃ¶biusã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºå®éªŒå®¤é¡¹ç›®ä½¿ç”¨äº†U-Netç½‘ç»œå› æ­¤è¯»äº†ä¸€ä¸‹è®ºæ–‡æ¥äº†è§£ä¸€ä¸‹ã€‚</p>
<p>å·ç§¯ç¥ç»ç½‘ç»œçš„å…¸å‹åº”ç”¨æ˜¯åˆ†ç±»ä»»åŠ¡ï¼Œè€ŒåŒ»å­¦å½±åƒéœ€è¦ä½ç½®ä¿¡æ¯ï¼Œå³å¯¹æ¯ä¸€ä¸ªåƒç´ æ‰“æ ‡ç­¾ã€‚æ­¤å¤–åŒ»å­¦å½±åƒçš„æ•°æ®é›†å¾ˆå°‘ã€‚<br />
åœ¨U-Netä¹‹å‰Hence,Ciresanç­‰äººè®­ç»ƒäº†ä¸€ç§åŸºäºæ»‘åŠ¨çª—å£çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªåƒç´ å‘¨å›´çš„å±€éƒ¨åŒºåŸŸï¼ˆpatchï¼‰çš„åƒç´ æ¥é¢„æµ‹è¯¥åƒç´ çš„ç±»åˆ«ã€‚è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªä¼˜ç‚¹:</p>
<ul>
<li>å¯ä»¥è¿›è¡Œç±»åˆ«çš„å®šä½</li>
<li>æ¯ä¸ªpatchå¯ä»¥è§†ä¸ºæ•°æ®å¢å¼ºå¢å¤§è®­ç»ƒé›†çš„æ•°æ®é‡ã€‚</li>
</ul>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•ä¹Ÿæœ‰ä¸¤ä¸ªç¼ºç‚¹:</p>
<ul>
<li>é€Ÿåº¦å¾ˆæ…¢ï¼Œå› ä¸ºç½‘ç»œéœ€è¦è®¡ç®—æ¯ä¸ªpatchï¼ŒåŒæ—¶æ¯ä¸ªpatchè¿˜æœ‰å¤§é‡é‡å å†—ä½™</li>
<li>éœ€è¦æƒè¡¡å®šä½å‡†ç¡®åº¦å’Œä½¿ç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå› ä¸ºå¤§patchéœ€è¦æ›´å¤šçš„æ± åŒ–å±‚ï¼Œä¼šå‡å°‘å®šä½çš„å‡†ç¡®åº¦ã€‚è€Œå°patchåªèƒ½è®©ç½‘ç»œçœ‹åˆ°ä¸€ç‚¹å†…å®¹ã€‚</li>
</ul>
<p>å¯¹æ­¤U-Netæå‡ºäº†æ–°çš„ç½‘ç»œç»“æ„ã€‚è€Œå¯¹äºåŒ»å­¦å½±åƒæ•°æ®é›†å°‘ï¼ŒU-Netæå‡ºäº†ä½¿ç”¨å¼¹æ€§å½¢å˜æ¥è¿›è¡Œæ•°æ®å¢å¼ºå¢åŠ æ•°æ®é›†ã€‚</p>
<h1 id="u-netç½‘ç»œç»“æ„"><a class="markdownIt-Anchor" href="#u-netç½‘ç»œç»“æ„"></a> U-Netç½‘ç»œç»“æ„</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.4/U-Net.png" alt="U-Netç»“æ„" /></p>
<p>U-Netçš„å…¶ä¸­ä¸€ä¸ªåˆ›æ–°ç‚¹å°±æ˜¯å…¶ç½‘ç»œç»“æ„ï¼Œå…¶åˆ†ä¸ºå·¦ä¾§çš„contrating pathå’Œå³ä¾§çš„expansive pathã€‚å·¦ä¾§ä¸ºå…¸å‹çš„å·ç§¯ç¥ç»ç½‘ç»œï¼Œä½¿ç”¨ä¸¤ä¸ª3Ã—3å·ç§¯å±‚ï¼Œæ¯ä¸€ä¸ªå·ç§¯åæœ‰ä¸€ä¸ªéçº¿æ€§çš„RELUï¼Œç„¶åç”¨2Ã—2çš„æœ€å¤§æ± åŒ–å±‚è¿›è¡Œä¸‹é‡‡æ ·ï¼Œä¸‹é‡‡æ ·ä¹‹åå°†é€šé“æ•°ç¿»å€ã€‚å³ä¾§çš„expansive pathæ¯ä¸€æ­¥ä¸ºä½¿ç”¨ä¸€ä¸ª2Ã—2çš„å·ç§¯ä¸Šé‡‡æ ·å‡åŠé€šé“æ•°ï¼Œå¹¶å°†å·¦ä¾§çš„ç‰¹å¾å›¾æ‹¼æ¥èµ·æ¥ï¼ˆconcatï¼‰ï¼Œç„¶åä½¿ç”¨é€šè¿‡ä¸¤ä¸ª3Ã—3çš„å·ç§¯å±‚ï¼Œæ¯ä¸€ä¸ªæœ‰RELUæ¿€æ´»å‡½æ•°ã€‚åœ¨æœ€åä¸€å±‚ä½¿ç”¨1Ã—1å·ç§¯å°†é€šé“è½¬æ¢ä¸ºéœ€è¦çš„ç±»åˆ«ã€‚æ•´ä¸ªç½‘ç»œä¸€å…±æœ‰23ä¸ªå·ç§¯å±‚ã€‚</p>
<p>æ•´ä¸ªç½‘ç»œæ˜¯ä¸€ä¸ªencoder-decoderç»“æ„ï¼Œç”±äºå½¢çŠ¶åƒUå‹æ‰€ä»¥è¢«å‘½åä¸ºU-Netã€‚</p>
<h1 id="3d-u-netç»“æ„"><a class="markdownIt-Anchor" href="#3d-u-netç»“æ„"></a> 3D U-Netç»“æ„</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.4/3D_U-Net.png" alt="3D U-Netç»“æ„" /><br />
3D U-Netçš„ç»“æ„ä¸U-NetåŸºæœ¬ä¸€è‡´ï¼Œå°±æ˜¯å·ç§¯ç­‰æ“ä½œå˜æˆä¸‰ç»´æ“ä½œï¼ŒåŒæ—¶ç›¸æ¯”U-Netè¿˜å¢åŠ äº†BatchNormå±‚ï¼Œç»“æ„å›¾ä¸­è¿˜å¯ä»¥çœ‹å‡ºä¸Šé‡‡æ ·çš„æ—¶å€™é€šé“æ•°å¹¶æ²¡æœ‰å‡åŠã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/1505.04597">Ronneberger O, Fischer P, Brox T. U-net: Convolutional networks for biomedical image segmentation[C]//International Conference on Medical image computing and computer-assisted intervention. Springer, Cham, 2015: 234-241.</a></p>
<p><a href="https://arxiv.org/abs/1606.06650">Ã‡iÃ§ek Ã–, Abdulkadir A, Lienkamp S S, et al. 3D U-Net: learning dense volumetric segmentation from sparse annotation[C]//International conference on medical image computing and computer-assisted intervention. Springer, Cham, 2016: 424-432.</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>javaå…¨è§’è½¬åŠè§’</title>
    <url>/2022/02/24/sbc2dbc/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šãƒãƒ­ãƒ¼ãƒ»ãƒ¬ãƒ‡ã‚£ï¼ -Superior Entelecheia-ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºé¡¹ç›®ä¸­çš„æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†â€œ+â€å·ï¼Œä¹‹å‰å°±å› ä¸ºç©ºæ ¼çš„åŸå› ç¢°åˆ°äº†â€œå‡ç©ºæ ¼â€ï¼Œæ‰€ä»¥å°±æ¢ä¸ºâ€œ+â€å·ã€‚ä½†æ˜¯è®©äººæ²¡æœ‰æƒ³åˆ°çš„æ¢æˆåŠ å·ä¹Ÿæœ‰ä¸€æ ·çš„é—®é¢˜ã€‚</p>
<h1 id="é—®é¢˜æè¿°"><a class="markdownIt-Anchor" href="#é—®é¢˜æè¿°"></a> é—®é¢˜æè¿°</h1>
<p>è§‚å¯Ÿä¸‹é¢ä¸¤ç§â€œ+â€å·ï¼Œä¹Ÿè®¸ä¸åŒäººçœ‹åˆ°çš„ç»“æœä¸ä¸€æ ·ã€‚ä¸è¿‡åœ¨æˆ‘è¿™å¾®ä¿¡ä¸Šçœ‹åˆ°çš„ä¸¤ç§â€œ+â€å·æ˜¯ä¸€æ ·çš„ã€‚ç„¶è€Œåœ¨ç¨‹åºä¸­è¿™ä¸¤ç§â€œ+â€å·çš„ç¼–ç æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª<a href="https://tool.chinaz.com/tools/unicode.aspx">å·¥å…·</a>ä¸­çš„ä¸­æ–‡è½¬unicodeçš„æ¯”è¾ƒï¼Œä»–ä»¬åˆ†åˆ«æ˜¯\uff0bå’Œ\u002bã€‚è¿™å°±å¯¼è‡´æœ‰äººè¾“å…¥äº†æŸ¥è¯¢ä¿¡æ¯ä½†æ˜¯å´æ²¡æœ‰è§¦å‘æ­£ç¡®çš„æŸ¥è¯¢ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ï¼‹   \uff0b  #å…¨å®½åŠ å·</span><br><span class="line">+    \u002b</span><br></pre></td></tr></table></figure>
<p>å°±å…¶åŸå› è¿˜æ˜¯å…¨è§’(fullwidth)å’ŒåŠè§’(Halfwidth)ã€‚</p>
<blockquote>
<p>In CJK (Chinese, Japanese and Korean) computing, graphic characters are traditionally classed into fullwidth (in Taiwan and Hong Kong: å…¨å½¢; in CJK and Japanese: å…¨è§’) and halfwidth (in Taiwan and Hong Kong: åŠå½¢; in CJK and Japanese: åŠè§’) characters. With fixed-width fonts, a halfwidth character occupies half the width of a fullwidth character, hence the name.<br />
In the days of computer terminals and text mode computing, characters were normally laid out in a grid, often 80 columns by 24 or 25 lines. Each character was displayed as a small dot matrix, often about 8 pixels wide, and an SBCS (single byte character set) was generally used to encode characters of western languages.<br />
For a number of practical and aesthetic reasons, Han characters would need to be twice as wide as these fixed-width SBCS characters. These â€œfullwidth charactersâ€ were typically encoded in a DBCS (double byte character set), although less common systems used other variable-width character sets that used more bytes per character.<br />
Halfwidth and Fullwidth Forms is also the name of a Unicode block U+FF00â€“FFEF.</p>
</blockquote>
<p>ç®€å•æ¥è¯´å°±æ˜¯æ±‰å­—ç”¨åŠè§’æ˜¾ç¤ºå¤ªçª„äº†ï¼Œå› æ­¤ä½¿ç”¨å…¨è§’æ˜¾ç¤ºï¼Œé¡ºä¾¿ä¹Ÿå°±æŠŠè‹±æ–‡ä¸€èµ·å…¨è§’äº†ã€‚ä¸è¿‡ç³»ç»Ÿè¾“å…¥ä¸€èˆ¬éƒ½æ˜¯éœ€è¦åŠè§’</p>
<h1 id="å…¨è§’ä¸åŠè§’è½¬æ¢"><a class="markdownIt-Anchor" href="#å…¨è§’ä¸åŠè§’è½¬æ¢"></a> å…¨è§’ä¸åŠè§’è½¬æ¢</h1>
<p>æˆ‘æŸ¥åˆ°çš„ä¸€äº›èµ„æ–™ï¼Œç§°å‘¼å…¨è§’SBCSã€åŠè§’DBCSã€‚æ ¹æ®ä¸Šæ–‡ä¸­wikiçš„è¯´æ³•ä¼¼ä¹æ˜¯åçš„ã€‚åº”è¯¥å…¨è§’æ˜¯DBCSã€åŠè§’æ˜¯SBCSã€‚</p>
<h2 id="è½¬æ¢"><a class="markdownIt-Anchor" href="#è½¬æ¢"></a> è½¬æ¢</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsciiUtil</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">DBC_SPACE</span> <span class="operator">=</span> <span class="number">12288</span>; <span class="comment">// å…¨è§’ç©ºæ ¼ 12288</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">SBC_SPACE</span> <span class="operator">=</span> <span class="number">32</span>; <span class="comment">// åŠè§’ç©ºæ ¼ 32</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ASCII character 33-126 &lt;-&gt; unicode 65281-65374</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">ASCII_START</span> <span class="operator">=</span> <span class="number">33</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">ASCII_END</span> <span class="operator">=</span> <span class="number">126</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">UNICODE_START</span> <span class="operator">=</span> <span class="number">65281</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">UNICODE_END</span> <span class="operator">=</span> <span class="number">65374</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> <span class="variable">DBC_SBC_STEP</span> <span class="operator">=</span> <span class="number">65248</span>; <span class="comment">// å…¨è§’åŠè§’è½¬æ¢é—´éš”</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">sbc2dbc</span><span class="params">(<span class="type">char</span> src)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (src == SBC_SPACE) &#123;</span><br><span class="line">            <span class="keyword">return</span> DBC_SPACE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (src &gt;= ASCII_START &amp;&amp; src &lt;= ASCII_END) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">char</span>) (src + DBC_SBC_STEP);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Convert from SBC case to DBC case åŠè§’åˆ°å…¨è§’</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> DBC case</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sbc2dbcCase</span><span class="params">(String src)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (src == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] c = src.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; c.length; i++) &#123;</span><br><span class="line">            c[i] = sbc2dbc(c[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">dbc2sbc</span><span class="params">(<span class="type">char</span> src)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (src == DBC_SPACE) &#123;</span><br><span class="line">            <span class="keyword">return</span> SBC_SPACE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (src &lt;= UNICODE_END &amp;&amp; src&gt;=UNICODE_START) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">char</span>) (src - DBC_SBC_STEP);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> src;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Convert from DBC case to SBC case. å…¨è§’åˆ°åŠè§’</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SBC case string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">dbc2sbcCase</span><span class="params">(String src)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (src == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] c = src.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; c.length; i++) &#123;</span><br><span class="line">            c[i] = dbc2sbc(c[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æµ‹è¯•"><a class="markdownIt-Anchor" href="#æµ‹è¯•"></a> æµ‹è¯•</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsciiTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ParameterizedTest</span></span><br><span class="line">    <span class="meta">@CsvSource(&#123;</span></span><br><span class="line"><span class="meta">        &quot;+,ï¼‹&quot;,</span></span><br><span class="line"><span class="meta">        &quot;helloworld,ï½ˆï½…ï½Œï½Œï½ï½—ï½ï½’ï½Œï½„&quot;</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sbcDbcTest</span><span class="params">(String sbc,String dbc)</span>&#123;</span><br><span class="line">        assertEquals(sbc, AsciiUtil.dbc2sbcCase(dbc));</span><br><span class="line">        assertEquals(dbc, AsciiUtil.sbc2dbcCase(sbc));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="æ„Ÿæƒ³"><a class="markdownIt-Anchor" href="#æ„Ÿæƒ³"></a> æ„Ÿæƒ³</h1>
<p>é˜…å†è¾ƒå°‘çš„æˆ‘æ²¡æƒ³åˆ°ä¼šç¢°åˆ°è¿™ç§é—®é¢˜ï¼Œâ€œæ°¸è¿œä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„è¾“å…¥â€è¿™å¥è¯è¯´çš„å¾ˆå¯¹ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://codepoints.net/halfwidth_and_fullwidth_forms">Halfwidth and Fullwidth Forms</a></p>
<p><a href="https://en.wikipedia.org/wiki/Halfwidth_and_fullwidth_forms#Half">Halfwidth and fullwidth forms</a></p>
<p><a href="https://www.jianshu.com/p/22000cb102c5">javaå­—ç¬¦å…¨è§’åŠè§’è½¬æ¢</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨dart-sassæ›¿æ¢node-sass</title>
    <url>/2022/04/09/nodesass2dartsass/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šã‚ã«ã¾ã‚‹â˜†ã±ã«ã£ãã€‹</p>
</blockquote>
<h1 id="é—®é¢˜æè¿°"><a class="markdownIt-Anchor" href="#é—®é¢˜æè¿°"></a> é—®é¢˜æè¿°</h1>
<p>ä½¿ç”¨<code>yarn install</code>å‘½ä»¤çš„æ—¶å€™æ— æ³•å®‰è£…ä¾èµ–ï¼Œå…·ä½“é—®é¢˜å¦‚ä¸‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.2/error.png" alt="error" /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[4/4] Building fresh packages...</span><br><span class="line">[1/4] â   core-js</span><br><span class="line">[2/4] â   node-sass</span><br><span class="line">[-/4] â   waiting...</span><br><span class="line">error D:\Code\zju_project\2021\temp\alsprj_fe\node_modules\node-sass: Command failed.</span><br></pre></td></tr></table></figure>
<p>ä»”ç»†æŸ¥çœ‹æè¿°å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦é”™è¯¯æ˜¯node-sasså¼•èµ·çš„ã€‚æŸ¥çœ‹node-sassçš„<a href="https://github.com/sass/node-sass">READEME</a>å¯ä»¥çœ‹æ‡‚node-sasså¯¹nodeçš„ç‰ˆæœ¬æœ‰è¦æ±‚ã€‚æˆ‘node16æ”¯æŒçš„æ˜¯node-sass 7.0+è€ŒåŸæœ¬çš„æ˜¯ç»™4.14ä¸æ”¯æŒ</p>
<blockquote>
<table>
<thead>
<tr>
<th>NodeJS</th>
<th>Supported node-sass version</th>
<th>Node Module</th>
</tr>
</thead>
<tbody>
<tr>
<td>Node 17</td>
<td>7.0+</td>
<td>102</td>
</tr>
<tr>
<td>Node 16</td>
<td>6.0+</td>
<td>93</td>
</tr>
<tr>
<td>Node 15</td>
<td>5.0+, &lt;7.0</td>
<td>88</td>
</tr>
<tr>
<td>Node 14</td>
<td>4.14+</td>
<td>83</td>
</tr>
<tr>
<td>Node 13</td>
<td>4.13+, &lt;5.0</td>
<td>79</td>
</tr>
<tr>
<td>Node 12</td>
<td>4.12+</td>
<td>72</td>
</tr>
<tr>
<td>Node 11</td>
<td>4.10+, &lt;5.0</td>
<td>67</td>
</tr>
<tr>
<td>Node 10</td>
<td>4.9+, &lt;6.0</td>
<td>64</td>
</tr>
<tr>
<td>Node 8</td>
<td>4.5.3+, &lt;5.0</td>
<td>57</td>
</tr>
<tr>
<td>Node &lt;8</td>
<td>&lt;5.0</td>
<td>&lt;57</td>
</tr>
</tbody>
</table>
</blockquote>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ¡ˆ"></a> è§£å†³æ–¹æ¡ˆ</h1>
<p>å…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯æ›´æ¢nodeç‰ˆæœ¬,åœ¨unixç³»ç»Ÿä¸Šæœ‰nè¿™ç±»å·¥å…·,è€Œwindowsæ²¡æœ‰ã€‚å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯æœ¬æ¬¡æåˆ°çš„ç”¨dart-sassæ›¿æ¢node-sassã€‚ç›´æ¥æ›¿æ¢è¿˜ä¸è¡Œï¼Œéœ€è¦æ”¹åï¼Œå› æ­¤æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å³å¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add node-sass@npm:dart-sass</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.2/result.png" alt="è¿è¡Œç»“æœ" /></p>
<p>å®‰è£…å®Œæˆï¼Œè¿è¡Œ<code>yarn start</code>å¯ä»¥çœ‹åˆ°é¡¹ç›®æ­£å¸¸è¿è¡Œ</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://zhuanlan.zhihu.com/p/168018388">ä½¿ç”¨dart-sassä»£æ›¿node-sass</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>nodejs</tag>
        <tag>sass</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨pythonä¸Šä¼ æ–‡ä»¶åˆ°å¾®ä¿¡å°ç¨‹åºäº‘å­˜å‚¨</title>
    <url>/2022/05/01/wx-cloud-upload/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šæ™‚è¨ˆä»•æ›ã‘ã®ãƒ¬ã‚¤ãƒ©ã‚¤ãƒ³ -æœéœ§ã«æ•£ã‚‹èŠ±-ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å°ç¨‹åºä¸Šäº†äº‘æ‰˜ç®¡åä¸æ‰“ç®—ç»§ç»­ä½¿ç”¨å…¶ä»–å›¾åºŠï¼Œè€Œæ˜¯ä½¿ç”¨äº‘æ‰˜ç®¡è‡ªå¸¦çš„å›¾åºŠã€‚è€Œç”±äºæ—¶é—´ç´§è¿«åªèƒ½åœ¨æœ¬åœ°ä½¿ç”¨äº‘æ‰˜ç®¡æä¾›çš„æœåŠ¡å™¨è°ƒç”¨å¯¹è±¡å­˜å‚¨api</p>
<p>äº‘æ‰˜ç®¡ä¸Šä¼ æ–‡ä»¶çš„æ–‡æ¡£åœ¨è¿™é‡Œ</p>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/upload.html">ä¸Šä¼ æ–‡ä»¶æ–‡æ¡£</a></p>
<div class="note info simple"><p>å¦‚æœä½ ä¸Šä¼ å¸¦æœ‰ä¸­æ–‡åçš„æ–‡ä»¶ï¼Œæˆ–è€…ä¸Šä¼ çš„è·¯å¾„æœ‰ä¸­æ–‡åæ—¶ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹requestsåº“çš„æºç ï¼Œå¦åˆ™æ–‡ä»¶ä¸Šä¼ æˆåŠŸåæ— æ³•æ´»åŠ¨ä¸‹è½½é“¾æ¥<br />
ä¿®æ”¹<code>requests/models.py</code>çš„<code>prepare_body</code>é‡Œçš„<code>complexjson.dumps</code>å‚æ•°ï¼ŒåŠ ä¸€ä¸ª<code>ensure_ascii=False</code><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.0.1/info.png" alt="ä¿®æ”¹å†…å®¹" /></p>
</div>
<h1 id="æµç¨‹"><a class="markdownIt-Anchor" href="#æµç¨‹"></a> æµç¨‹</h1>
<p>è·å–å°ç¨‹åºæ€»ä½“æµç¨‹å¯ä»¥ç®€å•åˆ†ä¸ºä¸‹é¢å‡ æ­¥</p>
<ul>
<li>1ã€è·å–è°ƒç”¨å‡­è¯access_token</li>
<li>2ã€è·å–æ–‡ä»¶ä¸Šä¼ æ¶ˆæ¯</li>
<li>3ã€ä¸Šä¼ æ–‡ä»¶</li>
<li>4ã€è·å–ä¸‹è½½æ–‡ä»¶çš„é“¾æ¥</li>
</ul>
<h1 id="å‡†å¤‡configæ–‡ä»¶"><a class="markdownIt-Anchor" href="#å‡†å¤‡configæ–‡ä»¶"></a> å‡†å¤‡configæ–‡ä»¶</h1>
<p>å› ä¸ºaccess_tokenæ¯å¤©éƒ½æœ‰è°ƒç”¨ä¸Šé™ï¼Œä¸”æœ‰2å°æ—¶æ—¶é™ï¼Œæœ€å¥½æ˜¯å°†access_tokenç¼“å­˜ä¸‹æ¥ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨ç®€å•çš„jsonæ–‡ä»¶æ¥å­˜</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;appid&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// å°ç¨‹åºappid å¿…å¡«</span></span><br><span class="line">    <span class="attr">&quot;secret&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// app secret å¿…å¡«</span></span><br><span class="line">    <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// äº‘æ‰˜ç®¡ç¯å¢ƒ env</span></span><br><span class="line">    <span class="attr">&quot;create_time&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// tokenåˆ›å»ºæ—¶é—´ è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">    <span class="attr">&quot;expires_in&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// tokenè¿‡æœŸæ—¶é—´ è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line">    <span class="attr">&quot;access_token&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span> <span class="comment">// token è‡ªåŠ¨ç”Ÿæˆ</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯configçš„è¯»å–å’Œä¿å­˜</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_config</span>(<span class="params">path=<span class="string">&quot;./config.json&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–é…ç½®ï¼Œä¸»è¦æ˜¯è¯»å–ç¼“å­˜çš„access_token</span></span><br><span class="line"><span class="string">    args: è¯»å–è·¯å¾„</span></span><br><span class="line"><span class="string">    return: config</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        config = json.load(f)</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_config</span>(<span class="params">config, path=<span class="string">&quot;./config.json&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¿æŒé…ç½®</span></span><br><span class="line"><span class="string">    args: è¯»å–è·¯å¾„</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(config, f, indent=<span class="number">4</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="è·å–æ¥å£è°ƒç”¨å‡­è¯"><a class="markdownIt-Anchor" href="#è·å–æ¥å£è°ƒç”¨å‡­è¯"></a> è·å–æ¥å£è°ƒç”¨å‡­è¯</h1>
<p>æ¥ä¸‹æ¥æ ¹æ®æˆ‘ä»¬è¯»å–çš„configæ¥è·å–access_token</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_access_token</span>(<span class="params">appid: <span class="built_in">str</span>, secret: <span class="built_in">str</span>, config</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–è°ƒç”¨å‡­è¯</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/access-token/auth.getAccessToken.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        apppid: å°ç¨‹åºappid</span></span><br><span class="line"><span class="string">        secret: å°ç¨‹åºappSecret</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return: access_token</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># æ£€æŸ¥æœ¬åœ°token</span></span><br><span class="line">    token = config[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        now = <span class="built_in">int</span>(time.time())</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span> == token <span class="keyword">or</span> (now - config[<span class="string">&quot;create_time&quot;</span>]) &gt; config[<span class="string">&quot;expires_in&quot;</span>]:</span><br><span class="line">            resp = requests.get(</span><br><span class="line">                <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=&#123;0&#125;&amp;secret=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">                    appid, secret</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            resp = resp.json()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="literal">None</span> == resp[<span class="string">&quot;access_token&quot;</span>]:</span><br><span class="line">                <span class="keyword">raise</span> Exception(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">            <span class="comment"># ç¼“å­˜å¤„ç†</span></span><br><span class="line">            config[<span class="string">&quot;access_token&quot;</span>] = resp[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line">            config[<span class="string">&quot;create_time&quot;</span>] = <span class="built_in">int</span>(time.time())</span><br><span class="line">            config[<span class="string">&quot;expires_in&quot;</span>] = resp[<span class="string">&quot;expires_in&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> config[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·å–access tokenå¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>
<h1 id="è·å–äº‘å­˜å‚¨ä¸Šä¼ æ–‡ä»¶æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#è·å–äº‘å­˜å‚¨ä¸Šä¼ æ–‡ä»¶æ¶ˆæ¯"></a> è·å–äº‘å­˜å‚¨ä¸Šä¼ æ–‡ä»¶æ¶ˆæ¯</h1>
<p>åœ¨æ­£å¼ä¸Šä¼ å‰éœ€è¦è·å–ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸Šä¼ è·¯å¾„ï¼Œç­¾åç­‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_upload_file_info</span>(<span class="params">access_token: <span class="built_in">str</span>, env: <span class="built_in">str</span>, path: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/upload.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        access_token: </span></span><br><span class="line"><span class="string">        env: äº‘æ‰˜ç®¡çš„è·¯å¾„</span></span><br><span class="line"><span class="string">        path: å­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="string">    return:</span></span><br><span class="line"><span class="string">        json: &#123;</span></span><br><span class="line"><span class="string">            errcode,</span></span><br><span class="line"><span class="string">            errmsg,</span></span><br><span class="line"><span class="string">            url,</span></span><br><span class="line"><span class="string">            token,</span></span><br><span class="line"><span class="string">            authorization,</span></span><br><span class="line"><span class="string">            file_id,</span></span><br><span class="line"><span class="string">            cos_file_id</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">&quot;https://api.weixin.qq.com/tcb/uploadfile?access_token=&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            access_token</span><br><span class="line">        )</span><br><span class="line">        headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>&#125;</span><br><span class="line">        data = &#123;<span class="string">&quot;env&quot;</span>: env, <span class="string">&quot;path&quot;</span>: path&#125;</span><br><span class="line">        resp = requests.post(url, json=data, headers=headers)</span><br><span class="line">        <span class="comment"># è½¬json</span></span><br><span class="line">        resp = resp.json()</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> != resp[<span class="string">&quot;errcode&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">            <span class="built_in">print</span>(resp)</span><br><span class="line">            <span class="keyword">raise</span> Exception(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">        <span class="comment"># è¿”å›ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·å–æ–‡ä»¶ä¸Šä¼ é“¾æ¥å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>
<h1 id="ä¸Šä¼ æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä¸Šä¼ æ–‡ä»¶"></a> ä¸Šä¼ æ–‡ä»¶</h1>
<p>è·å–æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯åï¼Œéœ€è¦æ ¹æ®æ”¹ä¿¡æ¯ä¸Šä¼ æ–‡ä»¶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>(<span class="params">url, request_path, authorization, token, file_id, file</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/upload.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        url: ä¸Šä¼ å›¾ç‰‡è·¯å¾„ ç”±get_uploadè·å¾—çš„url</span></span><br><span class="line"><span class="string">        request_path: ä¸Šä¼ è·¯å¾„ï¼Œå’Œget_upload_file_infoå†…éƒ¨çš„ä¸€è‡´</span></span><br><span class="line"><span class="string">        authorization: infoè¿”å›çš„token</span></span><br><span class="line"><span class="string">        file_id: cos_file_id</span></span><br><span class="line"><span class="string">        file: æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line"><span class="string">    return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        form = &#123;</span><br><span class="line">            <span class="string">&quot;key&quot;</span>: request_path,</span><br><span class="line">            <span class="string">&quot;Signature&quot;</span>: authorization,</span><br><span class="line">            <span class="string">&quot;x-cos-security-token&quot;</span>: token,</span><br><span class="line">            <span class="string">&quot;x-cos-meta-fileid&quot;</span>: file_id,</span><br><span class="line">            <span class="string">&quot;file&quot;</span>: file,</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, files=form)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>
<h1 id="è·å–æ–‡ä»¶ä¸‹è½½é“¾æ¥"><a class="markdownIt-Anchor" href="#è·å–æ–‡ä»¶ä¸‹è½½é“¾æ¥"></a> è·å–æ–‡ä»¶ä¸‹è½½é“¾æ¥</h1>
<p>ä¸Šä¼ æ–‡ä»¶åæ˜¯æ²¡æœ‰è¿”å›ä¿¡æ¯çš„ï¼Œéœ€è¦æˆ‘ä»¬æ ¹æ®æ–‡ä»¶ä¸Šä¿¡æ¯çš„file_idè·å–</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_download_link</span>(<span class="params">access_token, env, file_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–æ–‡ä»¶ä¸‹è½½é“¾æ¥</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/download.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        access_token: è°ƒç”¨token</span></span><br><span class="line"><span class="string">        env: äº‘ç¯å¢ƒenv</span></span><br><span class="line"><span class="string">        file_id: file_id</span></span><br><span class="line"><span class="string">    return: æ–‡ä»¶ä¸‹è½½é“¾æ¥</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">&quot;https://api.weixin.qq.com/tcb/batchdownloadfile?access_token=&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            access_token</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">#headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;env&quot;</span>: env,</span><br><span class="line">            <span class="string">&quot;file_list&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;fileid&quot;</span>: file_id</span><br><span class="line">                    <span class="comment"># max_age</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url, json=data)</span><br><span class="line">        resp = resp.json()</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> != resp[<span class="string">&quot;errcode&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">            <span class="keyword">raise</span> Exception(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">        <span class="keyword">return</span> resp[<span class="string">&quot;file_list&quot;</span>][<span class="number">0</span>][<span class="string">&quot;download_url&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·å–ä¸‹è½½é“¾æ¥å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>
<h1 id="æ±‡æ€»"><a class="markdownIt-Anchor" href="#æ±‡æ€»"></a> æ±‡æ€»</h1>
<p>å„ä¸ªæµç¨‹ç¼–å†™å®Œæˆåç®€å•æ±‡æ€»ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">wx_upload_file</span>(<span class="params">config, filepath, uploadpath</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        config: é…ç½®</span></span><br><span class="line"><span class="string">        filepath: æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="string">        uploadpath: ä¸Šä¼ çš„è·¯å¾„ï¼Œä¸èƒ½ä»¥/å¼€å¤´ï¼Œä»¥/ç»“å°¾</span></span><br><span class="line"><span class="string">    return: url</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    realpath = os.path.realpath(filepath)</span><br><span class="line">    filename = os.path.basename(realpath)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(realpath, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="comment"># è·å–access_token</span></span><br><span class="line">    token = get_access_token(config[<span class="string">&quot;appid&quot;</span>], config[<span class="string">&quot;secret&quot;</span>], config)</span><br><span class="line">    <span class="comment"># è·å–ä¸Šä¼ æ–‡ä»¶é“¾æ¥</span></span><br><span class="line">    info = get_upload_file_info(token, config[<span class="string">&quot;env&quot;</span>], uploadpath + filename)</span><br><span class="line">    upload_file(</span><br><span class="line">        info[<span class="string">&quot;url&quot;</span>],</span><br><span class="line">        uploadpath + filename,</span><br><span class="line">        info[<span class="string">&quot;authorization&quot;</span>],</span><br><span class="line">        info[<span class="string">&quot;token&quot;</span>],</span><br><span class="line">        info[<span class="string">&quot;cos_file_id&quot;</span>],</span><br><span class="line">        data,</span><br><span class="line">    )</span><br><span class="line">    download_url = get_download_link(token, config[<span class="string">&quot;env&quot;</span>], info[<span class="string">&#x27;file_id&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> (download_url, info[<span class="string">&#x27;file_id&#x27;</span>])</span><br></pre></td></tr></table></figure>
<h1 id="å®Œæ•´ä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´ä»£ç "></a> å®Œæ•´ä»£ç </h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_access_token</span>(<span class="params">appid: <span class="built_in">str</span>, secret: <span class="built_in">str</span>, config</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–è°ƒç”¨å‡­è¯</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/access-token/auth.getAccessToken.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        apppid: å°ç¨‹åºappid</span></span><br><span class="line"><span class="string">        secret: å°ç¨‹åºappSecret</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return: access_token</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># æ£€æŸ¥æœ¬åœ°token</span></span><br><span class="line">    token = config[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        now = <span class="built_in">int</span>(time.time())</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span> == token <span class="keyword">or</span> (now - config[<span class="string">&quot;create_time&quot;</span>]) &gt; config[<span class="string">&quot;expires_in&quot;</span>]:</span><br><span class="line">            resp = requests.get(</span><br><span class="line">                <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=&#123;0&#125;&amp;secret=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">                    appid, secret</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line">            resp = resp.json()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="literal">None</span> == resp[<span class="string">&quot;access_token&quot;</span>]:</span><br><span class="line">                <span class="keyword">raise</span> Exception(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">            <span class="comment"># ç¼“å­˜å¤„ç†</span></span><br><span class="line">            config[<span class="string">&quot;access_token&quot;</span>] = resp[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line">            config[<span class="string">&quot;create_time&quot;</span>] = <span class="built_in">int</span>(time.time())</span><br><span class="line">            config[<span class="string">&quot;expires_in&quot;</span>] = resp[<span class="string">&quot;expires_in&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> config[<span class="string">&quot;access_token&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·å–access tokenå¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_upload_file_info</span>(<span class="params">access_token: <span class="built_in">str</span>, env: <span class="built_in">str</span>, path: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/upload.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        access_token: </span></span><br><span class="line"><span class="string">        env: äº‘æ‰˜ç®¡çš„è·¯å¾„</span></span><br><span class="line"><span class="string">        path: å­˜æ”¾ä½ç½®</span></span><br><span class="line"><span class="string">    return:</span></span><br><span class="line"><span class="string">        json: &#123;</span></span><br><span class="line"><span class="string">            errcode,</span></span><br><span class="line"><span class="string">            errmsg,</span></span><br><span class="line"><span class="string">            url,</span></span><br><span class="line"><span class="string">            token,</span></span><br><span class="line"><span class="string">            authorization,</span></span><br><span class="line"><span class="string">            file_id,</span></span><br><span class="line"><span class="string">            cos_file_id</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">&quot;https://api.weixin.qq.com/tcb/uploadfile?access_token=&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            access_token</span><br><span class="line">        )</span><br><span class="line">        headers = &#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=UTF-8&quot;</span>&#125;</span><br><span class="line">        data = &#123;<span class="string">&quot;env&quot;</span>: env, <span class="string">&quot;path&quot;</span>: path&#125;</span><br><span class="line">        resp = requests.post(url, json=data, headers=headers)</span><br><span class="line">        <span class="comment"># è½¬json</span></span><br><span class="line">        resp = resp.json()</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> != resp[<span class="string">&quot;errcode&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">            <span class="built_in">print</span>(resp)</span><br><span class="line">            <span class="keyword">raise</span> Exception(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">        <span class="comment"># è¿”å›ä¸Šä¼ æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·å–æ–‡ä»¶ä¸Šä¼ é“¾æ¥å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>(<span class="params">url, request_path, authorization, token, file_id, file</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/upload.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        url: ä¸Šä¼ å›¾ç‰‡è·¯å¾„ ç”±get_uploadè·å¾—çš„url</span></span><br><span class="line"><span class="string">        request_path: ä¸Šä¼ è·¯å¾„ï¼Œå’Œget_upload_file_infoå†…éƒ¨çš„ä¸€è‡´</span></span><br><span class="line"><span class="string">        authorization: infoè¿”å›çš„token</span></span><br><span class="line"><span class="string">        file_id: cos_file_id</span></span><br><span class="line"><span class="string">        file: æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line"><span class="string">    return: None</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        form = &#123;</span><br><span class="line">            <span class="string">&quot;key&quot;</span>: request_path,</span><br><span class="line">            <span class="string">&quot;Signature&quot;</span>: authorization,</span><br><span class="line">            <span class="string">&quot;x-cos-security-token&quot;</span>: token,</span><br><span class="line">            <span class="string">&quot;x-cos-meta-fileid&quot;</span>: file_id,</span><br><span class="line">            <span class="string">&quot;file&quot;</span>: file,</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url=url, files=form)</span><br><span class="line">        <span class="keyword">return</span> resp</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ä¸Šä¼ æ–‡ä»¶å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_download_link</span>(<span class="params">access_token, env, file_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–æ–‡ä»¶ä¸‹è½½é“¾æ¥</span></span><br><span class="line"><span class="string">    https://developers.weixin.qq.com/miniprogram/dev/wxcloudrun/src/development/storage/service/download.html</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        access_token: è°ƒç”¨token</span></span><br><span class="line"><span class="string">        env: äº‘ç¯å¢ƒenv</span></span><br><span class="line"><span class="string">        file_id: file_id</span></span><br><span class="line"><span class="string">    return: æ–‡ä»¶ä¸‹è½½é“¾æ¥</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">&quot;https://api.weixin.qq.com/tcb/batchdownloadfile?access_token=&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            access_token</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">#headers = &#123;&quot;Content-Type&quot;: &quot;application/json&quot;&#125;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;env&quot;</span>: env,</span><br><span class="line">            <span class="string">&quot;file_list&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;fileid&quot;</span>: file_id</span><br><span class="line">                    <span class="comment"># max_age</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">        &#125;</span><br><span class="line">        resp = requests.post(url, json=data)</span><br><span class="line">        resp = resp.json()</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> != resp[<span class="string">&quot;errcode&quot;</span>]:</span><br><span class="line">            <span class="built_in">print</span>(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">            <span class="keyword">raise</span> Exception(resp[<span class="string">&quot;errmsg&quot;</span>])</span><br><span class="line">        <span class="keyword">return</span> resp[<span class="string">&quot;file_list&quot;</span>][<span class="number">0</span>][<span class="string">&quot;download_url&quot;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;è·å–ä¸‹è½½é“¾æ¥å¤±è´¥&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_config</span>(<span class="params">path=<span class="string">&quot;./config.json&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è·å–é…ç½®ï¼Œä¸»è¦æ˜¯è¯»å–ç¼“å­˜çš„access_token</span></span><br><span class="line"><span class="string">    args: è¯»å–è·¯å¾„</span></span><br><span class="line"><span class="string">    return: config</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        config = json.load(f)</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_config</span>(<span class="params">config, path=<span class="string">&quot;./config.json&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¿æŒé…ç½®</span></span><br><span class="line"><span class="string">    args: è¯»å–è·¯å¾„</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(config, f, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wx_upload_file</span>(<span class="params">config, filepath, uploadpath</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        config: é…ç½®</span></span><br><span class="line"><span class="string">        filepath: æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="string">        uploadpath: ä¸Šä¼ çš„è·¯å¾„ï¼Œä¸èƒ½ä»¥/å¼€å¤´ï¼Œä»¥/ç»“å°¾</span></span><br><span class="line"><span class="string">    return: url</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    realpath = os.path.realpath(filepath)</span><br><span class="line">    filename = os.path.basename(realpath)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(realpath, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="comment"># è·å–access_token</span></span><br><span class="line">    token = get_access_token(config[<span class="string">&quot;appid&quot;</span>], config[<span class="string">&quot;secret&quot;</span>], config)</span><br><span class="line">    <span class="comment"># è·å–ä¸Šä¼ æ–‡ä»¶é“¾æ¥</span></span><br><span class="line">    info = get_upload_file_info(token, config[<span class="string">&quot;env&quot;</span>], uploadpath + filename)</span><br><span class="line">    upload_file(</span><br><span class="line">        info[<span class="string">&quot;url&quot;</span>],</span><br><span class="line">        uploadpath + filename,</span><br><span class="line">        info[<span class="string">&quot;authorization&quot;</span>],</span><br><span class="line">        info[<span class="string">&quot;token&quot;</span>],</span><br><span class="line">        info[<span class="string">&quot;cos_file_id&quot;</span>],</span><br><span class="line">        data,</span><br><span class="line">    )</span><br><span class="line">    download_url = get_download_link(token, config[<span class="string">&quot;env&quot;</span>], info[<span class="string">&#x27;file_id&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> (download_url, info[<span class="string">&#x27;file_id&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    config = load_config(<span class="string">&quot;./config.json&quot;</span>)</span><br><span class="line">    <span class="comment">#print(wx_upload_file(config, &quot;121.jpg&quot;, &quot;temp3/&quot;))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æœ‰url</span></span><br><span class="line">    <span class="comment"># print(wx_upload_file(config,&#x27;./temp.jpg&#x27;,&#x27;temp3/&#x27;))</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># # æ— url</span></span><br><span class="line">    path = <span class="string">&quot;./154190339_é™„ä»¶/&quot;</span></span><br><span class="line">    filenames = os.listdir(path)</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="built_in">print</span>(filename)</span><br><span class="line">        image = os.path.join(path, filename)</span><br><span class="line">        url = wx_upload_file(config, image, <span class="string">&quot;temp3/&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(url)</span><br><span class="line"></span><br><span class="line">    save_config(config, <span class="string">&quot;./config.json&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æœ‰ä¸€è¯´ä¸€ï¼Œè…¾è®¯æä¾›çš„cdnè¿˜æ˜¯æ¯”ä¹‹å‰è‡ªå·±æ­å»ºçš„è¦å¿«å¾ˆå¤šï¼Œå¾ˆèˆ’æœï¼Œå°±æ˜¯èŠ±é’±å¾ˆéš¾å—ã€‚</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å¾®ä¿¡å°ç¨‹åº</tag>
      </tags>
  </entry>
  <entry>
    <title>conda deactivateæŠ¥é”™UnicodeEncodeError</title>
    <url>/2022/05/02/conda-deactivate-error/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢: ã€Šä¿ºã®æ‹å¤©ä½¿ãŒãƒãƒ³ã‚³ãƒ„ã™ãã¦ã‚³ãƒ¯ï½ã„ã€‹</p>
</blockquote>
<h1 id="æè¿°"><a class="markdownIt-Anchor" href="#æè¿°"></a> æè¿°</h1>
<p>åœ¨è¿è¡Œconda deactivateçš„æ—¶å€™ç¢°åˆ°äº†ä¸€ä¸ªbug</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UnicodeEncodeError: &#x27;gbk&#x27; codec can&#x27;t encode character &#x27;\u03a2&#x27; in position 945: illegal multibyte sequence</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.2/error.png" alt="error" /></p>
<h1 id="é”™è¯¯åŸå› "><a class="markdownIt-Anchor" href="#é”™è¯¯åŸå› "></a> é”™è¯¯åŸå› </h1>
<p>è¿™æ˜¯å¾ˆæ˜æ˜¾æ˜¯ç¼–ç é—®é¢˜ï¼Œé‡åˆ°äº†ä¸­æ–‡å­—ç¬¦ã€‚è€Œé—®é¢˜åœ¨äºå“ªé‡Œå‡ºç°äº†ä¸­æ–‡ï¼Œå› ä¸ºæˆ‘åœ¨å®‰è£…ç¼–ç¨‹ç›¸å…³è½¯ä»¶æ—¶éƒ½ä¸ä¼šä½¿ç”¨ä¸­æ–‡è·¯å¾„ï¼Œå› æ­¤å¾ˆå¥‡æ€ªè¿™ä¸ªä¸­æ–‡åœ¨å“ªé‡Œã€‚ç„¶åä»”ç»†æŸ¥çœ‹æ•´ä¸ªè®°å½•æ‰¾åˆ°äº†ä¸€å¤„ä¸­æ–‡ï¼Œç„¶åå‘ç°è¿™ä¸ªä¸œè¥¿åœ¨ç¯å¢ƒå˜é‡é‡Œé¢ï¼Œæ ¹æ®ä½ç½®æŸ¥æ‰¾æ˜¯<code>å¾®ä¿¡webå¼€å‘è€…å·¥å…·</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.2/find.png" alt="" /></p>
<h1 id="è§£å†³æ–¹æ³•"><a class="markdownIt-Anchor" href="#è§£å†³æ–¹æ³•"></a> è§£å†³æ–¹æ³•</h1>
<p>å› ä¸ºæˆ‘ä¸æ€ä¹ˆéœ€è¦ä½¿ç”¨å¾®ä¿¡webå¼€å‘åŠ©æ‰‹ï¼Œå› æ­¤ç›´æ¥ä»ç¯å¢ƒéå†é‡Œé¢åˆ é™¤è¿™ä¸ªç¯å¢ƒå˜é‡å³å¯ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.2/fix.png" alt="é—®é¢˜è§£å†³" /></p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>ç°åœ¨é™¤äº†å®‰è£…è·¯å¾„è¦æ³¨æ„ä¸­æ–‡å¤–ï¼Œè¿˜å¾—æ³¨æ„ç¯å¢ƒå˜é‡é‡Œæœ‰æ²¡æœ‰ä¸­æ–‡äº†555</p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>conda</tag>
      </tags>
  </entry>
  <entry>
    <title>mmdetectionè‡ªå®šä¹‰æ•°æ®å¢å¼º</title>
    <url>/2022/05/05/mmdetection-custom-pipelines/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€ŠèŠ±ã®é‡ã«å’²ãã†ãŸã‹ãŸã®ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>ç›®å‰çš„æ•°æ®é›†å†…åŸºæœ¬æ˜¯æ£€æµ‹å°ç›®æ ‡ï¼Œä½†æ˜¯å› ä¸ºå°ç‰©ä½“æ£€æµ‹æ¯”è¾ƒå›°éš¾ï¼Œéœ€è¦æƒ³åŠæ³•æå‡å°ç›®æ ‡çš„æ£€æµ‹ç»“æœã€‚æœ€è¿‘è¯»äº†ä¸€ç¯‡ã€ŠAugmentation for small object detectionã€‹çš„è®ºæ–‡ï¼Œé‡Œé¢è®²äº†ä¸€äº›æ•°æ®å¢å¼ºçš„æ–¹æ³•æ¥æé«˜å°ç›®æ ‡çš„æ£€æµ‹æ•ˆæœã€‚</p>
<p>mmdetectionæ˜¯ä¸€ä¸ªåŸºäºpytorchçš„ç›®æ ‡æ£€æµ‹å·¥å…·ç®±ï¼Œç®€å•æ˜“ç”¨ã€‚æœ¬ç¯‡åšå®¢çš„ä¸»è¦ç›®çš„åŸºäºmmdetectionå®ç°ä¸€ä¸ªæ•°æ®å¢å¼ºæ–¹æ³•ã€‚</p>
<h1 id="smallobjectaugmentation"><a class="markdownIt-Anchor" href="#smallobjectaugmentation"></a> SmallObjectAugmentation</h1>
<p><a href="https://arxiv.org/abs/1902.07296">Augmentation for small object detection</a>çš„è®ºæ–‡é‡Œé¢è®²è¿°å‡ ç§å°ç›®æ ‡å¢å¼ºæ–¹æ³•</p>
<h2 id="è¿‡é‡‡æ ·"><a class="markdownIt-Anchor" href="#è¿‡é‡‡æ ·"></a> è¿‡é‡‡æ ·</h2>
<blockquote>
<p>In the first set of experiments, we investigate the effect of oversampling images containing small objects. We vary the oversampling ratio between two, three and four. Instead of actual stochastic oversampling, we create multiple copies of images with small objects offline for efficiency</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªèŠ±è´¹ç²¾åŠ›æ¯”è¾ƒå°‘ä¸”ç®€å•çš„æ–¹æ³•ï¼Œç®€å•æ¥è¯´å°±æ˜¯å¦‚æœå›¾ç‰‡ä¸­æœ‰å°ç›®æ ‡ï¼Œå°±åœ¨è®­ç»ƒé›†ä¸­å°†è¿™ä¸ªå›¾ç‰‡å¤šå¤åˆ¶å‡ æ¬¡ã€‚</p>
<h2 id="å¢å¼º"><a class="markdownIt-Anchor" href="#å¢å¼º"></a> å¢å¼º</h2>
<blockquote>
<p>In the second set of experiments, we investigate the effects of using augmentation on small object detection and segmentation. We copy and paste all small objects in each image once. We also oversample images with small objects to study the interaction between the oversampling and augmentation strategies.</p>
</blockquote>
<p>å¦ä¸€ç§æ–¹æ³•å°±æ˜¯åœ¨æ¯å¼ å›¾ç‰‡ä¸­ï¼Œå°†å›¾ç‰‡çš„åŒ…å«å°ç›®æ ‡å¤åˆ¶ç²˜è´´å¤šæ¬¡ã€‚åœ¨æ–‡ä¸­ä¸€å…±æå‡ºäº†ä¸‰ç§å¤åˆ¶ç²˜è´´ç­–ç•¥</p>
<ol>
<li>é€‰æ‹©ä¸€å¼ å›¾ä¸­çš„ä¸€ä¸ªå°ç›®æ ‡ï¼Œåœ¨éšæœºä½ç½®ä¸­å¤åˆ¶ç²˜è´´å¤šæ¬¡</li>
<li>é€‰æ‹©è®¸å¤šå°ç‰©ä½“ï¼Œå¤åˆ¶ç²˜è´´åœ¨éšæœºåœ°æ–¹</li>
<li>é€‰æ‹©æ¯å¼ å›¾ç‰‡çš„å…¨éƒ¨å°ç‰©ä½“ï¼Œå¤åˆ¶ç²˜è´´ä¸€æ¬¡åœ¨éšæœºåœ°æ–¹</li>
</ol>
<p>åæ–‡è¿˜æåˆ°å¤åˆ¶ç²˜è´´æ—¶éœ€è¦æ³¨æ„å¤åˆ¶ç²˜è´´çš„æ—¶å€™ä¸èƒ½å’Œä¹‹å‰çš„æ ‡ç­¾é‡å </p>
<h1 id="å®ç°"><a class="markdownIt-Anchor" href="#å®ç°"></a> å®ç°</h1>
<p>arXivä¸Šçš„è®ºæ–‡å¹¶æ²¡æœ‰ç»™å‡ºå®˜æ–¹å®ç°ï¼Œåªæœ‰ç¤¾åŒºå®ç°ã€‚å› æ­¤è¿™é‡Œç›´æ¥å‚è€ƒç¤¾åŒºçš„å®ç°æ–¹æ³•ã€‚</p>
<p>mmdetectionçš„<a href="https://mmdetection.readthedocs.io/en/v2.21.0/">æ–‡æ¡£</a>ä¸­ç»™å‡ºäº†è‡ªå®šä¹‰pipelinesæ•°æ®å¢å¼ºçš„æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°è‡ªå·±çš„<code>__init__</code>å‡½æ•°å’Œ<code>__call__</code>å‡½æ•°ï¼Œç„¶åé€šè¿‡<code>@PIPELINES.register_module()</code>æ³¨å†Œå³å¯ã€‚<code>__call__</code>å‡½æ•°çš„è¾“å…¥å‚æ•°å’Œè¾“å‡ºå‚æ•°éƒ½æ˜¯<code>results</code>ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«äº†å›¾åƒã€è¾¹ç•Œæ¡†å’Œæ ‡ç­¾ç­‰ä¿¡æ¯çš„å­—å…¸ã€‚</p>
<p>å®˜æ–¹æä¾›çš„pipelineså¦‚ä¸‹å›¾æ‰€ç¤º<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/data_pipeline.png" alt="pipeline figure" /></p>
<p>é€šè¿‡é˜…è¯»æºç å’Œè§‚çœ‹è¿™å¼ å›¾æˆ‘ä»¬å¯ä»¥å¾—çŸ¥æ¨¡å‹ä¸­æœ€åä½¿ç”¨çš„æ˜¯<code>results['img']</code>ã€<code>results['gt_bboxes']</code>ã€<code>results['gt_labels']</code>ç­‰ï¼Œå…¶ä¸­<code>gt_bboxes</code>çš„æ ¼å¼æ˜¯<code>(list[Tensor])</code>å…¶ä¸­æ¯ä¸ªbboxçš„æ ¼å¼æ˜¯<code>[tl_x, tl_y, br_x, br_y]</code>å³å·¦ä¸Šè§’çš„ç‚¹åæ ‡å’Œå³ä¸‹è§’çš„ç‚¹åæ ‡ã€‚</p>
<p>çŸ¥é“æ ¼å¼åå®ç°èµ·æ¥å°±æ¯”è¾ƒç®€å•ï¼Œæºç å°±æ”¾åœ¨æ–‡æœ«ã€‚</p>
<p>åœ¨<code>mmdet/datasets/pipelines</code>æ–‡ä»¶å¤¹å†…æ–°å»º<code>SmallObjectAugmentation.py</code>,å¹¶å†™å…¥æ–‡æœ«çš„æºç ã€‚</p>
<p>å¯¼å…¥æ¨¡å—æ—¶<code>mmdetection</code>æœ‰ä¸¤ç§æ–¹æ³•</p>
<h2 id="æ–¹æ³•ä¸€-é‡æ–°ç¼–è¯‘"><a class="markdownIt-Anchor" href="#æ–¹æ³•ä¸€-é‡æ–°ç¼–è¯‘"></a> æ–¹æ³•ä¸€ é‡æ–°ç¼–è¯‘</h2>
<p><a href="https://mmdetection.readthedocs.io/en/v2.21.0/get_started.html#install-mmdetection">å‚è€ƒ</a></p>
<p><code>mmdet/datasets/pipelines</code>é‡Œçš„<code>__init__.py</code>æ–‡ä»¶ä¸­æ·»åŠ <code>from .SmallObjectAugmentation import SmallObjectAugmentation</code>,<code>__all__</code>æ·»åŠ <code>'SmallObjectAugmentation'</code>ï¼Œå®Œæ•´ä¿®æ”¹è§ä¸‹<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/custom_init.png" alt="" /></p>
<p>ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip install -r requirements/build.txt</span><br><span class="line">pip install -v -e .  <span class="comment"># or &quot;python setup.py develop&quot;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å®Œæˆäº†ï¼Œå®é™…ä¸Šæ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ã€‚è¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ä½ çš„configæ–‡ä»¶ä¸­ä½¿ç”¨</p>
<h2 id="æ–¹æ³•äºŒ-ä¿®æ”¹config"><a class="markdownIt-Anchor" href="#æ–¹æ³•äºŒ-ä¿®æ”¹config"></a> æ–¹æ³•äºŒ ä¿®æ”¹config</h2>
<p><a href="https://mmdetection.readthedocs.io/en/v2.21.0/tutorials/data_pipeline.html#extend-and-use-custom-pipelines">å‚è€ƒ</a></p>
<p>è¿™ç§æ–¹æ³•æˆ‘æ²¡æœ‰æˆåŠŸï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•ä¸€ä¸‹</p>
<p>ä¿®æ”¹configæ–‡ä»¶ï¼Œåœ¨é‡Œé¢åŠ ä¸€æ¡ï¼Œä¿è¯è·¯å¾„æ˜¯è®­ç»ƒè„šæœ¬çš„ç›¸ä¼¼è·¯å¾„</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">custom_imports = <span class="built_in">dict</span>(imports=[<span class="string">&#x27;path.to.my_pipeline&#x27;</span>], allow_failed_imports=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<h1 id="æŸ¥çœ‹æ•°æ®å¢å¼ºæ•ˆæœ"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹æ•°æ®å¢å¼ºæ•ˆæœ"></a> æŸ¥çœ‹æ•°æ®å¢å¼ºæ•ˆæœ</h1>
<p>mmdetectionæœ‰æä¾›å·¥å…·è®©æˆ‘ä»¬çœ‹æ•°æ®å¢å¼ºçš„æ•ˆæœã€‚<br />
é¦–å…ˆå…ˆå‡†å¤‡ä¸€ä»½configæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œç›´æ¥ç»§æ‰¿<code>yolox_tiny_8x8_300e_coco.py</code>ä¿®æ”¹å…¶ä¸­çš„<code>train_pipeline</code>ï¼Œå»é™¤å…¶ä»–çš„æ•°æ®å¢å¼ºï¼Œåªç•™ä¸‹æˆ‘ä»¬è‡ªå·±çš„å¢å¼ºæ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">train_pipeline = [</span><br><span class="line">    <span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;SmallObjectAugmentation&#x27;</span>,all_objects=<span class="literal">True</span>,thresh=<span class="number">400</span>*<span class="number">400</span>,prob=<span class="number">0.7</span>),</span><br><span class="line">    <span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;DefaultFormatBundle&#x27;</span>),</span><br><span class="line">    <span class="built_in">dict</span>(<span class="built_in">type</span>=<span class="string">&#x27;Collect&#x27;</span>, keys=[<span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;gt_bboxes&#x27;</span>, <span class="string">&#x27;gt_labels&#x27;</span>])</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mmdetectionæä¾›çš„å·¥å…·æ¥æŸ¥çœ‹æˆ‘ä»¬çš„æ•ˆæœ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œä¸‹é¢è¿™å¥è¯ éœ€è¦æŠŠconfigçš„è·¯å¾„æ”¹æˆä½ çš„configè·¯å¾„</span></span><br><span class="line">python .\tools\misc\browse_dataset.py your_config_path</span><br></pre></td></tr></table></figure>
<h2 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h2>
<p>ä¸ºäº†å±•ç¤ºæ•ˆæœï¼Œæˆ‘è¿™é‡ŒæŠŠå‚æ•°éƒ½è°ƒçš„å¤¸å¼ äº†ç‚¹</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/augmentation1.png" alt="sample1" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/augmentation2.png" alt="sample2" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/augmentation3.png" alt="sample3" /></p>
<h1 id="è®­ç»ƒæ•ˆæœ"><a class="markdownIt-Anchor" href="#è®­ç»ƒæ•ˆæœ"></a> è®­ç»ƒæ•ˆæœ</h1>
<p>ä½¿ç”¨äº†æ•°æ®å¢å¼ºå‰åçš„å¯¹æ¯”å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°å®é™…çš„è®­ç»ƒæ•ˆæœæœ‰æé«˜1%ï¼Œå¯è§æ•ˆæœè¿˜æ˜¯å¯ä»¥çš„</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/old.png" alt="å¢å¼ºå‰" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.3/new.png" alt="å¢å¼ºå" /></p>
<h1 id="å¢å¼ºæºç "><a class="markdownIt-Anchor" href="#å¢å¼ºæºç "></a> å¢å¼ºæºç </h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ..builder <span class="keyword">import</span> PIPELINES</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@PIPELINES.register_module(<span class="params"><span class="string">&#x27;SmallObjectAugmentation&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SmallObjectAugmentation</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, thresh=<span class="number">64</span>*<span class="number">64</span>, prob=<span class="number">0.5</span>, copy_times=<span class="number">3</span>, epochs=<span class="number">30</span>, all_objects=<span class="literal">False</span>, one_object=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        SmallObjectAugmentation: https://arxiv.org/abs/1902.07296</span></span><br><span class="line"><span class="string">        https://github.com/zzl-pointcloud/Data_Augmentation_Zoo_for_Object_Detection/blob/master/augmentation_zoo/SmallObjectAugmentation.py</span></span><br><span class="line"><span class="string">        args:</span></span><br><span class="line"><span class="string">            thresh: small object thresh</span></span><br><span class="line"><span class="string">            prob: the probability of whether to augmentation</span></span><br><span class="line"><span class="string">            copy_times: how many times to copy anno</span></span><br><span class="line"><span class="string">            epochs: how many times try to create anno</span></span><br><span class="line"><span class="string">            all_object: copy all object once</span></span><br><span class="line"><span class="string">            one_object: copy one object</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        self.thresh = thresh</span><br><span class="line">        self.prob = prob</span><br><span class="line">        self.copy_times = copy_times</span><br><span class="line">        self.epochs = epochs</span><br><span class="line">        self.all_objects = all_objects</span><br><span class="line">        self.one_object = one_object</span><br><span class="line">        <span class="keyword">if</span> self.all_objects <span class="keyword">or</span> self.one_object:</span><br><span class="line">            self.copy_times = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_is_small_object</span>(<span class="params">self, height, width</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        åˆ¤æ–­æ˜¯å¦ä¸ºå°ç›®æ ‡</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> height*width &lt;= self.thresh:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_compute_overlap</span>(<span class="params">self, bbox_a, bbox_b</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        è®¡ç®—é‡å </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> bbox_a <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        left_max = <span class="built_in">max</span>(bbox_a[<span class="number">0</span>], bbox_b[<span class="number">0</span>])</span><br><span class="line">        top_max = <span class="built_in">max</span>(bbox_a[<span class="number">1</span>], bbox_b[<span class="number">1</span>])</span><br><span class="line">        right_min = <span class="built_in">min</span>(bbox_a[<span class="number">2</span>], bbox_b[<span class="number">2</span>])</span><br><span class="line">        bottom_min = <span class="built_in">min</span>(bbox_a[<span class="number">3</span>], bbox_b[<span class="number">3</span>])</span><br><span class="line">        inter = <span class="built_in">max</span>(<span class="number">0</span>, (right_min-left_max)) * <span class="built_in">max</span>(<span class="number">0</span>, (bottom_min-top_max))</span><br><span class="line">        <span class="keyword">if</span> inter != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_donot_overlap</span>(<span class="params">self, new_bbox, bboxes</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        æ˜¯å¦æœ‰é‡å </span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> bbox <span class="keyword">in</span> bboxes:</span><br><span class="line">            <span class="keyword">if</span> self._compute_overlap(new_bbox, bbox):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_copy_annot</span>(<span class="params">self, height, width, bbox, bboxes</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        åˆ›å»ºæ–°çš„æ ‡ç­¾</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        bbox_h, bbox_w = bbox[<span class="number">3</span>] - bbox[<span class="number">1</span>], bbox[<span class="number">2</span>] - bbox[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(self.epochs):</span><br><span class="line">            random_x, random_y = np.random.randint(<span class="built_in">int</span>(bbox_w / <span class="number">2</span>), <span class="built_in">int</span>(width - bbox_w / <span class="number">2</span>)), \</span><br><span class="line">                np.random.randint(<span class="built_in">int</span>(bbox_h / <span class="number">2</span>), <span class="built_in">int</span>(height - bbox_h / <span class="number">2</span>))</span><br><span class="line">            tl_x, tl_y = random_x - bbox_w/<span class="number">2</span>, random_y-bbox_h/<span class="number">2</span></span><br><span class="line">            br_x, br_y = tl_x + bbox_w, tl_y + bbox_h</span><br><span class="line">            <span class="keyword">if</span> tl_x &lt; <span class="number">0</span> <span class="keyword">or</span> br_x &gt; width <span class="keyword">or</span> tl_y &lt; <span class="number">0</span> <span class="keyword">or</span> tl_y &gt; height:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            new_bbox = np.array([tl_x, tl_y, br_x, br_y], dtype=np.int32)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._donot_overlap(new_bbox, bboxes):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> new_bbox</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_add_patch_in_img</span>(<span class="params">self, new_bbox, copy_bbox, image</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        å¤åˆ¶å›¾åƒåŒºåŸŸ</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        copy_bbox = copy_bbox.astype(np.int32)</span><br><span class="line">        image[new_bbox[<span class="number">1</span>]:new_bbox[<span class="number">3</span>], new_bbox[<span class="number">0</span>]:new_bbox[<span class="number">2</span>],</span><br><span class="line">              :] = image[copy_bbox[<span class="number">1</span>]:copy_bbox[<span class="number">3</span>], copy_bbox[<span class="number">0</span>]:copy_bbox[<span class="number">2</span>], :]</span><br><span class="line">        <span class="keyword">return</span> image</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, results</span>):</span><br><span class="line">        <span class="keyword">if</span> self.all_objects <span class="keyword">and</span> self.one_object:</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        <span class="keyword">if</span> np.random.rand() &gt; self.prob:</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">        img = results[<span class="string">&#x27;img&#x27;</span>]</span><br><span class="line">        bboxes = results[<span class="string">&#x27;gt_bboxes&#x27;</span>]</span><br><span class="line">        labels = results[<span class="string">&#x27;gt_labels&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        height, width = img.shape[<span class="number">0</span>], img.shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        small_object_list = []</span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bboxes)):</span><br><span class="line">            bbox = bboxes[idx]</span><br><span class="line">            bbox_h, bbox_w = bbox[<span class="number">3</span>] - bbox[<span class="number">1</span>], bbox[<span class="number">2</span>] - bbox[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> self._is_small_object(bbox_h, bbox_w):</span><br><span class="line">                small_object_list.append(idx)</span><br><span class="line"></span><br><span class="line">        length = <span class="built_in">len</span>(small_object_list)</span><br><span class="line">        <span class="comment"># æ— å°ç‰©ä½“</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == length:</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">        <span class="comment"># éšæœºé€‰æ‹©ä¸åŒçš„ç‰©ä½“å¤åˆ¶</span></span><br><span class="line">        copy_object_num = np.random.randint(<span class="number">0</span>, length)</span><br><span class="line">        <span class="keyword">if</span> self.all_objects:</span><br><span class="line">            <span class="comment"># å¤åˆ¶å…¨éƒ¨ç‰©ä½“</span></span><br><span class="line">            copy_object_num = length</span><br><span class="line">        <span class="keyword">if</span> self.one_object:</span><br><span class="line">            <span class="comment"># åªé€‰æ‹©ä¸€ä¸ªç‰©ä½“å¤åˆ¶</span></span><br><span class="line">            copy_object_num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        random_list = random.sample(<span class="built_in">range</span>(length), copy_object_num)</span><br><span class="line">        idx_of_small_objects = [small_object_list[idx] <span class="keyword">for</span> idx <span class="keyword">in</span> random_list]</span><br><span class="line">        select_bboxes = bboxes[idx_of_small_objects, :]</span><br><span class="line">        select_labels = labels[idx_of_small_objects]</span><br><span class="line"></span><br><span class="line">        bboxes = bboxes.tolist()</span><br><span class="line">        labels = labels.tolist()</span><br><span class="line">        <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(copy_object_num):</span><br><span class="line">            bbox = select_bboxes[idx]</span><br><span class="line">            label = select_labels[idx]</span><br><span class="line"></span><br><span class="line">            bbox_h, bbox_w = bbox[<span class="number">3</span>] - bbox[<span class="number">1</span>], bbox[<span class="number">2</span>] - bbox[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._is_small_object(bbox_h, bbox_w):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.copy_times):</span><br><span class="line">                new_bbox = self._create_copy_annot(height, width, bbox, bboxes)</span><br><span class="line">                <span class="keyword">if</span> new_bbox <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    img = self._add_patch_in_img(new_bbox, bbox, img)</span><br><span class="line">                    bboxes.append(new_bbox)</span><br><span class="line">                    labels.append(label)</span><br><span class="line">                </span><br><span class="line">        </span><br><span class="line">        results[<span class="string">&#x27;img&#x27;</span>] = img</span><br><span class="line">        results[<span class="string">&#x27;gt_bboxes&#x27;</span>] = np.array(bboxes)</span><br><span class="line">        results[<span class="string">&#x27;gt_labels&#x27;</span>] = np.array(labels)</span><br><span class="line">        <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æœ€åæ„Ÿè°¢<a href="https://infinite-zh.com/">InfiniteZh</a>å¸®æˆ‘è·‘äº†ä¸€ä¸‹è®­ç»ƒã€‚æ¢äº†ç”µè„‘è¿˜æ˜¯è·‘ä¸åŠ¨å¤§æ¨¡å‹5555ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/1902.07296">Augmentation for small object detection</a></p>
<p><a href="https://github.com/zzl-pointcloud/Data_Augmentation_Zoo_for_Object_Detection">Data_Augmentation_Zoo_for_Object_Detection</a></p>
<p><a href="https://mmdetection.readthedocs.io/en/v2.21.0/">mmdetection doc</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>mmdetection</tag>
        <tag>æ•°æ®å¢å¼º</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨javaåå°„è¿›è¡Œéç©ºæ£€æŸ¥å’Œè½¬æ¢</title>
    <url>/2022/07/26/java-reflect-check-null/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šå–«èŒ¶ã‚¹ãƒ†ãƒ©ã¨æ­»ç¥ã®è¶ã€‹</p>
</blockquote>
<h1 id="é—®é¢˜æè¿°"><a class="markdownIt-Anchor" href="#é—®é¢˜æè¿°"></a> é—®é¢˜æè¿°</h1>
<p>ç°åœ¨æˆ‘æœ‰ä¸€ä¸‹å‡ ä¸ªç±»,éœ€è¦åœ¨<code>UpdateForm</code>å’Œ<code>StringModel</code>ä¹‹é—´è½¬æ¢ã€‚åŒæ—¶å¯¹<code>StringModel</code>çš„éƒ¨åˆ†å­—æ®µè¿›è¡Œä¸€äº›éç©ºæ£€æŸ¥ã€‚å®é™…çš„<code>StringModel</code>å’Œ<code>UpdateForm</code>å­—æ®µè¾ƒå¤š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseModel</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringModel</span> <span class="keyword">extends</span> <span class="title class_">BaseModel</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String choice;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;model &#123;id=&quot;</span> + <span class="built_in">this</span>.getId() +<span class="string">&quot;,name=&quot;</span>+<span class="built_in">this</span>.name+<span class="string">&quot;,choice=&quot;</span>+<span class="built_in">this</span>.choice + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiChoiceForm</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String label;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean selected=<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateForm</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;MultiChoiceForm&gt; choice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="é€šè¿‡åå°„è·å–å±æ€§"><a class="markdownIt-Anchor" href="#é€šè¿‡åå°„è·å–å±æ€§"></a> é€šè¿‡åå°„è·å–å±æ€§</h1>
<p>åœ¨è¿›è¡Œä¸€ç•ªæ€è€ƒåæˆ‘å†³å®šä½¿ç”¨åå°„æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨<code>getDeclaredFields()</code>å‡½æ•°è·å–ç±»çš„æ‰€æœ‰ç§æœ‰æˆå‘˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span></span><br><span class="line">    &#123;</span><br><span class="line">        test1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StringModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringModel</span>();</span><br><span class="line">        model.setId(<span class="number">1</span>);</span><br><span class="line">        model.setName(<span class="string">&quot;qxdn&quot;</span>);</span><br><span class="line">        model.setChoice(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>,model);</span><br><span class="line">        <span class="comment">// è·å–public</span></span><br><span class="line">        <span class="comment">//Field[] fields = model.getClass().getFields();</span></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å­—æ®µ åŒ…å«ç§æœ‰</span></span><br><span class="line">        Field[] fields = model.getClass().getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span>(Field field:fields)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;field name:%s,filed value:%s\n&quot;</span>,field.getName(),field.get(model));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException | IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>,model);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥æ‰§è¡Œçš„ç»“æœæ˜¯Exception</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java.lang.IllegalAccessException: class com.qxdn.App cannot access a member of class com.qxdn.model.StringModel with modifiers &quot;private&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯è¯´æ˜æˆ‘ä»¬æ²¡æœ‰æƒé™å»è®¿é—®ç§æœ‰æˆå‘˜,ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StringModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringModel</span>();</span><br><span class="line">        model.setId(<span class="number">1</span>);</span><br><span class="line">        model.setName(<span class="string">&quot;qxdn&quot;</span>);</span><br><span class="line">        model.setChoice(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>,model);</span><br><span class="line">        <span class="comment">// è·å–public</span></span><br><span class="line">        <span class="comment">//Field[] fields = model.getClass().getFields();</span></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å­—æ®µ åŒ…å«ç§æœ‰</span></span><br><span class="line">        Field[] fields = model.getClass().getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span>(Field field:fields)&#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®è®¿é—®æƒé™</span></span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;field name:%s,filed value:%s\n&quot;</span>,field.getName(),field.get(model));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException | IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>,model);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">model: model &#123;id=1,name=qxdn,choice=123&#125;</span><br><span class="line">field name:name,filed value:qxdn</span><br><span class="line">field name:choice,filed value:123</span><br><span class="line">model: model &#123;id=1,name=qxdn,choice=123&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œfieldæ²¡æœ‰çˆ¶ç±»çš„å±æ€§ï¼Œè¿™æ˜¯å› ä¸º<code>getDeclaredFields()</code>åªä¼šè·å–å½“å‰classçš„å±æ€§ï¼Œä¸åŒ…å«çˆ¶ç±»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å‡½æ•°è·å–åŒ…å«çˆ¶ç±»å±æ€§åœ¨å†…çš„æ‰€æœ‰å±æ€§ã€‚å› æ­¤æ·»åŠ <code>getAllFields</code>å‡½æ•°è·å–åŒ…å«çˆ¶ç±»çš„æ‰€æœ‰field</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span></span><br><span class="line">    &#123;</span><br><span class="line">        test1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Field&gt; <span class="title function_">getAllFields</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (clazz == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;Field&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(getAllFields(clazz.getSuperclass()));</span><br><span class="line">        List&lt;Field&gt; fields = Arrays.stream(clazz.getDeclaredFields())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        result.addAll(fields);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StringModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringModel</span>();</span><br><span class="line">        model.setId(<span class="number">1</span>);</span><br><span class="line">        model.setName(<span class="string">&quot;qxdn&quot;</span>);</span><br><span class="line">        model.setChoice(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>,model);</span><br><span class="line">        <span class="comment">// è·å–public</span></span><br><span class="line">        <span class="comment">//Field[] fields = model.getClass().getFields();</span></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å­—æ®µ åŒ…å«ç§æœ‰</span></span><br><span class="line">        List&lt;Field&gt; fields = getAllFields(model.getClass());</span><br><span class="line">        <span class="keyword">for</span>(Field field:fields)&#123;</span><br><span class="line">            <span class="comment">// è®¾ç½®è®¿é—®æƒé™</span></span><br><span class="line">            field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;field name:%s,filed value:%s\n&quot;</span>,field.getName(),field.get(model));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalArgumentException | IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>,model);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">model: model &#123;id=1,name=qxdn,choice=123&#125;</span><br><span class="line">field name:id,filed value:1</span><br><span class="line">field name:name,filed value:qxdn</span><br><span class="line">field name:choice,filed value:123</span><br><span class="line">model: model &#123;id=1,name=qxdn,choice=123&#125;</span><br></pre></td></tr></table></figure>
<h1 id="é€šè¿‡åå°„æ£€æµ‹éç©º"><a class="markdownIt-Anchor" href="#é€šè¿‡åå°„æ£€æµ‹éç©º"></a> é€šè¿‡åå°„æ£€æµ‹éç©º</h1>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkNonNull</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StringModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringModel</span>();</span><br><span class="line">    model.setId(<span class="number">1</span>);</span><br><span class="line">    model.setChoice(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>, model);</span><br><span class="line">    List&lt;Field&gt; fields = getAllFields(model.getClass());</span><br><span class="line">    <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®è®¿é—®æƒé™</span></span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == field.get(model)) &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;field \&quot;%s\&quot; is null\n&quot;</span>, field.getName());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException | IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>, model);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">model: model &#123;id=<span class="number">1</span>,name=<span class="literal">null</span>,choice=<span class="number">123</span>&#125;</span><br><span class="line">field <span class="string">&quot;name&quot;</span> is <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<h1 id="åå°„æ¥è¿›è¡Œç±»å‹è½¬æ¢"><a class="markdownIt-Anchor" href="#åå°„æ¥è¿›è¡Œç±»å‹è½¬æ¢"></a> åå°„æ¥è¿›è¡Œç±»å‹è½¬æ¢</h1>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfoUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">splitText</span> <span class="operator">=</span> <span class="string">&quot;â”‹&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encodeMultiChoiceForm</span><span class="params">(List&lt;MultiChoiceForm&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>  encodeMultiChoiceForm(list,splitText);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encodeMultiChoiceForm</span><span class="params">(List&lt;MultiChoiceForm&gt; list,String encoderText)</span>&#123;</span><br><span class="line">        <span class="type">StringJoiner</span> <span class="variable">joiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(encoderText);</span><br><span class="line">        <span class="keyword">for</span> (MultiChoiceForm form:list)&#123;</span><br><span class="line">            <span class="keyword">if</span> (form.getSelected())&#123;</span><br><span class="line">                joiner.add(form.getLabel());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> joiner.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;MultiChoiceForm&gt; <span class="title function_">decodeMultiChoiceForm</span><span class="params">(String raw)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  decodeMultiChoiceForm(raw,splitText);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;MultiChoiceForm&gt; <span class="title function_">decodeMultiChoiceForm</span><span class="params">(String raw,String decoderText)</span>&#123;</span><br><span class="line">        List&lt;MultiChoiceForm&gt; forms = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        String[] strs = raw.split(decoderText);</span><br><span class="line">        <span class="keyword">for</span>(String str:strs)&#123;</span><br><span class="line">            forms.add(<span class="keyword">new</span> <span class="title class_">MultiChoiceForm</span>(str,<span class="literal">true</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>  forms;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">convert</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">StringModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringModel</span>();</span><br><span class="line">    <span class="type">UpdateForm</span> <span class="variable">form</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateForm</span>();</span><br><span class="line">    form.setId(<span class="number">1</span>);</span><br><span class="line">    form.setName(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    List&lt;MultiChoiceForm&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">MultiChoiceForm</span>(<span class="string">&quot;1&quot;</span>, <span class="literal">true</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">MultiChoiceForm</span>(<span class="string">&quot;2&quot;</span>, <span class="literal">false</span>));</span><br><span class="line">    list.add(<span class="keyword">new</span> <span class="title class_">MultiChoiceForm</span>(<span class="string">&quot;3&quot;</span>, <span class="literal">true</span>));</span><br><span class="line">    form.setChoice(list);</span><br><span class="line">    <span class="type">String</span> <span class="variable">skipName</span> <span class="operator">=</span> <span class="string">&quot;id&quot;</span>; <span class="comment">// skip id</span></span><br><span class="line">    System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>, model);</span><br><span class="line">    System.out.printf(<span class="string">&quot;form: %s\n&quot;</span>, form);</span><br><span class="line">    List&lt;Field&gt; fields = getAllFields(form.getClass());</span><br><span class="line">    <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">        <span class="keyword">if</span> (field.getName().equals(skipName))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (field.getType().equals(String.class) &amp;&amp; !StrUtil.isBlankIfStr(field.get(form))) &#123;</span><br><span class="line">                <span class="type">Field</span> <span class="variable">modelField</span> <span class="operator">=</span> model.getClass().getDeclaredField(field.getName());</span><br><span class="line">                modelField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                modelField.set(model, field.get(form));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="literal">null</span> != field.get(form) &amp;&amp; !field.getType().equals(String.class)) &#123;</span><br><span class="line">                <span class="type">Field</span> <span class="variable">modelField</span> <span class="operator">=</span> model.getClass().getDeclaredField(field.getName());</span><br><span class="line">                modelField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (field.getType().equals(List.class)) &#123;</span><br><span class="line">                    modelField.set(model, InfoUtils.encodeMultiChoiceForm((List&lt;MultiChoiceForm&gt;) field.get(form)));</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    modelField.set(model, field.get(form));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException | IllegalAccessException | NoSuchFieldException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.printf(<span class="string">&quot;model: %s\n&quot;</span>, model);</span><br><span class="line">    System.out.printf(<span class="string">&quot;form: %s\n&quot;</span>, form);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">model: model &#123;id=null,name=null,choice=null&#125;</span><br><span class="line">form: UpdateForm(id=1, name=abc, choice=[MultiChoiceForm(label=1, selected=true), MultiChoiceForm(label=2, selected=false), MultiChoiceForm(label=3, selected=true)])</span><br><span class="line">model: model &#123;id=null,name=abc,choice=1â”‹3&#125;</span><br><span class="line">form: UpdateForm(id=1, name=abc, choice=[MultiChoiceForm(label=1, selected=true), MultiChoiceForm(label=2, selected=false), MultiChoiceForm(label=3, selected=true)])</span><br></pre></td></tr></table></figure>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>æœ¬æ¥æ˜¯åªçŸ¥é“javaæœ‰åå°„åŠŸèƒ½ï¼Œé€šå¸¸ç”¨æ¥åšæ¡†æ¶ï¼Œå€’æ˜¯ä¸æ€ä¹ˆç”¨ã€‚è¿™æ¬¡åœ¨ç±»å±æ€§å¤šäº†ä¹‹åï¼Œä¸”è¦å¤æ‚å¤„ç†çš„æ—¶å€™æ‰å‘ç°åå°„çš„å¥½å¤„ã€‚</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>åå°„</tag>
      </tags>
  </entry>
  <entry>
    <title>ConvNeXtè®ºæ–‡ç¬”è®°</title>
    <url>/2022/08/03/convnext-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šç´…æœˆã‚†ã‚Œã‚‹æ‹ã‚ã‹ã‚Šã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å¹´åˆçš„æ—¶å€™çœ‹åˆ°åˆ«äººæ¨èäº†ConvNeXtè®ºæ–‡ï¼Œçœ‹åˆ°äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œäº†è§£åˆ°äº†ConvNeXtæ¯”Swin Transformeræ•ˆæœå¥½ï¼Œå› æ­¤è¯»äº†ä¸€ä¸‹è¿™ç¯‡è®ºæ–‡ï¼Œå†™ä¸€ä¸‹ç¬”è®°ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/compare.png" alt="æ•ˆæœ" /></p>
<h1 id="convnextçš„æ”¹è¿›ç‚¹"><a class="markdownIt-Anchor" href="#convnextçš„æ”¹è¿›ç‚¹"></a> ConvNeXtçš„æ”¹è¿›ç‚¹</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/Improve.png" alt="æ€»ä½“æ”¹è¿›" /></p>
<p>ConvNeXtçš„æ€»ä½“æ”¹è¿›å¦‚ä¸Šæ‰€ç¤ºï¼Œå„ä¸ªæ”¹è¿›å’Œå…¶æ•ˆæœéƒ½å¯ä»¥çœ‹çš„æ¯”è¾ƒæ˜ç™½</p>
<h2 id="macro-design"><a class="markdownIt-Anchor" href="#macro-design"></a> Macro Design</h2>
<h3 id="changing-stage-compute-ratio"><a class="markdownIt-Anchor" href="#changing-stage-compute-ratio"></a> Changing stage compute ratio</h3>
<p>åœ¨åŸå…ˆçš„ResNetä¸­å„ä¸ªstageä¹‹é—´çš„æ¯”ä¾‹æ˜¯(3:4:6:4)ï¼Œè€Œåœ¨swin transformerä¸­è¿™ä¸ªæ¯”ä¾‹æ˜¯(1:1:3:1)åœ¨largeæ¨¡å‹ä¸­è¿™ä¸ªæ¯”ä¾‹æ˜¯(1:1:9:1)ï¼Œå› æ­¤ä½œè€…å°†ResNetå„ä¸ªé˜¶æ®µçš„æ¯”ä¾‹è®¾ç½®ä¸º(3:3:9:3)ï¼Œå‡†ç¡®ç‡ä»78.8%ä¸Šå‡åˆ°äº†79.4%ã€‚æ­¤å¤–ä½œè€…è¿˜è¡¨ç¤ºè¿™ä¸ªæ¯”ä¾‹è¿˜æœ‰ä¼˜åŒ–ç©ºé—´</p>
<h3 id="changing-stem-to-patchify"><a class="markdownIt-Anchor" href="#changing-stem-to-patchify"></a> Changing stem to â€œPatchifyâ€</h3>
<p>ä»€ä¹ˆæ˜¯stemï¼Ÿstemç®€å•æ¥è¯´å°±è¯´ç¬¬ä¸€ä¸ªä¸‹é‡‡æ ·ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯å‹ç¼©è¾“å…¥ï¼Œå‡å°‘è®¡ç®—é‡<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/stem.png" alt="stem" /><br />
åœ¨åŸæœ¬çš„ResNetä¸­ï¼Œstemå±‚ä½¿ç”¨çš„æ˜¯å·ç§¯æ ¸å¤§å°ä¸º7Ã—7ï¼Œstride=2çš„å·ç§¯æ ¸ï¼Œå…¶ç»“æœå°±æ˜¯4å€çš„ä¸‹é‡‡æ ·ã€‚è€Œåœ¨vitæ¨¡å‹ä¸­ï¼Œstemå±‚ç”¨çš„æ˜¯æ›´åŠ æ¿€è¿›çš„å·ç§¯ï¼Œå·ç§¯å¤§å°æ˜¯14æˆ–è€…16ï¼Œä¸”ç§»åŠ¨æ²¡æœ‰é‡å çš„ã€‚è€Œåœ¨swinä¸­stemä½¿ç”¨çš„æ˜¯ç›¸ä¼¼çš„å·ç§¯ï¼Œä½†æ˜¯å·ç§¯å¤§å°æ˜¯4Ã—4ã€‚å› æ­¤ConvNeXtä¸­ä½¿ç”¨çš„æ˜¯å·ç§¯å¤§å°4Ã—4ï¼Œstride=4çš„å·ç§¯ã€‚è¿™ä½¿å¾—å‡†ç¡®ç‡ä»79.4%ä¸Šå‡åˆ°79.6%ã€‚</p>
<h2 id="resnext-ify"><a class="markdownIt-Anchor" href="#resnext-ify"></a> ResNeXt-ify</h2>
<p>ResNeXtåœ¨å‡†ç¡®åº¦å’ŒFLOPsä¹‹é—´æœ‰ä¸€ä¸ªè¾ƒå¥½çš„æƒè¡¡ï¼ŒResNeXtçš„blockç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ç»“åˆäº†Inceptionçš„æ€æƒ³ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/resnext.png" alt="ResNeXt" /><br />
ä¸åŸæœ¬çš„ResNeXt blockä¸åŒçš„æ˜¯ï¼Œåœ¨ConvNeXtï¼ŒResNeXtçš„å·ç§¯éƒ¨åˆ†ä½¿ç”¨çš„Groupæ•°å’ŒChannelçš„æ•°é‡ç›¸åŒã€‚åŒæ—¶ï¼Œä½œè€…è¿˜è®¤ä¸ºdepthwiseå·ç§¯çš„æ“ä½œå’Œself-attentionç±»ä¼¼ã€‚è¿™ä½¿å¾—å‡†ç¡®ç‡ä¸‹é™åˆ°äº†78.3%,ä½†æ˜¯GFLOPsä»4.4ä¸‹é™åˆ°äº†2.4ã€‚</p>
<p>æ­¤å¤–è¿˜å°†ç½‘ç»œçš„channelæ”¹åˆ°äº†å’Œswinä¸€æ ·çš„96ï¼Œè¿™ä½¿å¾—å‡†ç¡®ç‡æé«˜åˆ°äº†80.5%ï¼Œä½†æ˜¯GFLOPsä¸Šå‡åˆ°äº†5.3</p>
<h2 id="inverted-bottleneck"><a class="markdownIt-Anchor" href="#inverted-bottleneck"></a> Inverted Bottleneck</h2>
<p>Transformer blockçš„MLPå±‚ä¸MobileNetV2çš„åè½¬ç“¶é¢ˆå±‚å¾ˆåƒï¼Œå› æ­¤ConvNeXtä¹Ÿè®¾è®¡äº†ä¸€ä¸ªåè½¬ç“¶é¢ˆå±‚å³ä¸­é—´ç²—ä¸¤è¾¹ç»†çš„ç»“æ„ã€‚åœ¨Transformerä¸­MLPçš„éšè—å±‚çš„ç»´åº¦éƒ½æ˜¯4å€äºè¾“å…¥ç»´åº¦ï¼Œå› æ­¤åè½¬ç“¶é¢ˆå±‚çš„ä¸­é—´å±‚ä¹Ÿæ˜¯å››å€ç¼©æ”¾ã€‚ä¸‹å›¾ä¸­(a)æ˜¯ResNetçš„blockï¼Œè€Œ(b)æ˜¯ConvNeXtå»ºç«‹çš„åè½¬ç“¶é¢ˆå±‚ï¼ŒÂ©æ˜¯é™ç©ºé—´depthwiseçš„å±‚ä¸Šç§»ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/InvertedBottleneck.png" alt="Inverted Bottleneck" /></p>
<p>ä½¿ç”¨åè½¬ç“¶é¢ˆåï¼Œå°æ¨¡å‹ä¸­å‡†ç¡®ç‡ä»80.5%ä¸Šå‡åˆ°80.6%ï¼Œå¤§æ¨¡å‹çš„å‡†ç¡®ç‡ä»81.9%ä¸Šå‡åˆ°82.6%ï¼Œä¸”FLOPséƒ½å‡å°ã€‚</p>
<h2 id="large-kernel-sizes"><a class="markdownIt-Anchor" href="#large-kernel-sizes"></a> Large Kernel Sizes</h2>
<h3 id="moving-up-depthwise-conv-layer"><a class="markdownIt-Anchor" href="#moving-up-depthwise-conv-layer"></a> Moving up depthwise conv layer</h3>
<p>å› ä¸ºåœ¨transformeræ¨¡å‹ä¸Šï¼ŒMSA(Multi head self-attetion)æ˜¯åœ¨MLPå‰é¢çš„ï¼Œå› æ­¤åœ¨åè½¬ç“¶é¢ˆçš„æ—¶å€™ï¼Œå°†depthwiseå·ç§¯æ”¾åˆ°å‰é¢ï¼Œå³Inverted Bottleneckä¸­çš„(b)åˆ°Â©ã€‚æ­¤å¤–ä¸­é—´çš„1Ã—1çš„å·ç§¯åœ¨ä»£ç é‡Œé¢æ˜¯ä½¿ç”¨å…¨è¿æ¥å±‚æ¥å®ç°çš„ï¼Œå› ä¸º1Ã—1å·ç§¯å’Œå…¨è¿æ¥å‡ ä¹ç­‰ä»·ã€‚</p>
<p>è¿™ä½¿å¾—FLOPsä¸‹é™åˆ°4.1Gï¼Œå‡†ç¡®ç‡åˆ°79.1%</p>
<h3 id="increasing-the-kernel-size"><a class="markdownIt-Anchor" href="#increasing-the-kernel-size"></a> Increasing the kernel size</h3>
<p>ä½œè€…å°è¯•å¢å¤§å·ç§¯æ ¸çš„å¤§å°ï¼Œå¯ä»¥çœ‹åˆ°å·ç§¯æ ¸åŠ åˆ°7Ã—7ä¹‹åè¶‹äºé¥±å’Œï¼Œå› æ­¤é€‰æ‹©åœ¨æ¯ä¸ªblockä¸­ä½¿ç”¨7Ã—7çš„å·ç§¯æ ¸ä½œä¸ºdepthwiseå·ç§¯ã€‚å‡†ç¡®ç‡ä¸Šå‡åˆ°äº†80.6%ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/filter.png" alt="kernel size" /></p>
<h2 id="micro-design"><a class="markdownIt-Anchor" href="#micro-design"></a> Micro Design</h2>
<h3 id="replacing-relu-with-gelu"><a class="markdownIt-Anchor" href="#replacing-relu-with-gelu"></a> Replacing ReLU with GELU</h3>
<p>å¤§å¤šæ•°å·ç§¯ç½‘ç»œä½¿ç”¨çš„æ˜¯RELUæ¿€æ´»ï¼Œè€Œtransformerå¤§å¤šä½¿ç”¨GELUæ¿€æ´»ï¼Œå› æ­¤ä½¿ç”¨GELUæ¿€æ´»ï¼Œè¿™å¯¹å‡†ç¡®ç‡æ²¡æœ‰ä»€ä¹ˆå½±å“</p>
<h3 id="fewer-activation-functions"><a class="markdownIt-Anchor" href="#fewer-activation-functions"></a> Fewer activation functions</h3>
<p>ç›¸è¾ƒäºResNetï¼Œtransformeræ‹¥æœ‰æ›´å°‘çš„æ¿€æ´»å‡½æ•°ã€‚æ¯ä¸€ä¸ªtransformer blockä¸­åªæœ‰1ä¸ªæ¿€æ´»å‡½æ•°åœ¨MLPå±‚ä¹‹ä¸­ï¼Œå› æ­¤ConvNeXtä¹Ÿåšç±»ä¼¼ï¼Œæ¯ä¸ªblockåœ¨ä¸¤ä¸ª1Ã—1ä¹‹é—´åŠ GELUæ¿€æ´»ã€‚å…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™ä½¿å¾—å‡†ç¡®ç‡ä»80.6%æå‡åˆ°äº†81.3%ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.5/block.png" alt="ConvNeXt Block" /></p>
<h3 id="fewer-normalization-layers"><a class="markdownIt-Anchor" href="#fewer-normalization-layers"></a> Fewer normalization layers</h3>
<p>transformer blockä¸­ä¹Ÿæ˜¯æ‹¥æœ‰è¾ƒå°‘çš„normå±‚ï¼Œå› æ­¤ä½œè€…åªä¿ç•™äº†1Ã—1å·ç§¯å‰é¢çš„BNå±‚ï¼Œè¿™ä½¿å¾—å‡†ç¡®ç‡åˆ°äº†81.4%ï¼Œè¶…è¿‡äº†Swin-Tã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä½œè€…å°è¯•æŠŠBNåŠ åœ¨Blockå‰é¢ï¼Œä½†æ˜¯æ•ˆæœæ²¡æœ‰ä»€ä¹ˆæå‡ã€‚</p>
<h3 id="substituting-bn-with-ln"><a class="markdownIt-Anchor" href="#substituting-bn-with-ln"></a> Substituting BN with LN</h3>
<p>åœ¨Transformerä¸­ç»å¸¸ä½¿ç”¨LNï¼Œå› æ­¤ä½œè€…ä½¿ç”¨LNæ›¿æ¢åŸæ¥çš„BNï¼Œè¿™ä½¿å¾—å‡†ç¡®ç‡ä¸Šå‡åˆ°äº†81.5%ã€‚</p>
<h3 id="separate-downsampling-layers"><a class="markdownIt-Anchor" href="#separate-downsampling-layers"></a> Separate downsampling layers</h3>
<p>åœ¨ResNetä¸­ç©ºé—´ä¸‹é‡‡æ ·æ˜¯åœ¨æ¯ä¸ªblock stageçš„å¼€å¤´å®Œæˆï¼Œé€šè¿‡ä½¿ç”¨3Ã—3å·ç§¯stride=2ï¼Œshortcutéƒ¨åˆ†ä½¿ç”¨1Ã—1å·ç§¯stride=2å®ç°ã€‚è€Œåœ¨swin transformerä¸­åœ¨æ¯ä¸ªstageä¹‹é—´ä½¿ç”¨ä¸€ä¸ªå•ç‹¬ä¸‹é‡‡æ ·å±‚ã€‚å› æ­¤ä½œè€…ä½¿ç”¨2Ã—2ï¼Œstride=2çš„å•ç‹¬ä¸‹é‡‡æ ·å±‚æ¥å®ç°ã€‚åŒæ—¶åœ¨ä¸‹é‡‡æ ·çš„å·ç§¯å‰ä½¿ç”¨layernormå¯ä»¥å¸®åŠ©å…¶æ”¶æ•›ï¼Œè€Œåœ¨stemå±‚çš„layernormåŠ åœ¨å·ç§¯åé¢ã€‚è¿™ä½¿å¾—å‡†ç¡®ç‡æé«˜åˆ°äº†82.0%ï¼Œè¶…è¿‡äº†Swinã€‚</p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>ä»¥ä¸Šå°±æ˜¯ä¸€ç›´æ‹–ç€æ²¡æ›´æ–°çš„ConvNeXtäº†ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¯å·ç§¯ç¥ç»ç½‘ç»œï¼Œå®ç°èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œä¸”æ•ˆæœè¦å¥½äºSwin-Tã€‚æ˜¯ä¸ªä¸é”™çš„ç½‘ç»œã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://stackoverflow.com/questions/68258188/why-does-cnns-usually-have-a-stem">Why does CNNs usually have a stem?</a></p>
<p><a href="https://arxiv.org/abs/1611.05431v2">Aggregated Residual Transformations for Deep Neural Networks</a></p>
<p><a href="https://arxiv.org/abs/2201.03545">A ConvNet for the 2020s</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹ä¸çº¿ç¨‹</title>
    <url>/2022/10/06/process-and-thread/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šã‚µã‚¯ãƒ©ãƒè©© ï¼æ«»ã®æ£®ã®ä¸Šã‚’èˆã†ï¼ã€‹</p>
</blockquote>
<h1 id="è¿›ç¨‹"><a class="markdownIt-Anchor" href="#è¿›ç¨‹"></a> è¿›ç¨‹</h1>
<h2 id="å®šä¹‰"><a class="markdownIt-Anchor" href="#å®šä¹‰"></a> å®šä¹‰</h2>
<blockquote>
<p>è¿›ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹æ‰§è¡Œçš„ç¨‹åºï¼Œæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬æ¦‚å¿µï¼Œæ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚</p>
</blockquote>
<h2 id="è¿›ç¨‹ç»„æˆéƒ¨åˆ†"><a class="markdownIt-Anchor" href="#è¿›ç¨‹ç»„æˆéƒ¨åˆ†"></a> è¿›ç¨‹ç»„æˆéƒ¨åˆ†</h2>
<p>è¿›ç¨‹å®ä½“=ç¨‹åºæ®µ+æ•°æ®æ®µ+è¿›ç¨‹æ§åˆ¶å—(process control blockï¼ŒPCB)</p>
<ul>
<li>ç¨‹åºæ®µï¼š ç¨‹åºä»£ç å­˜æ”¾ç¨‹åºæ®µ</li>
<li>æ•°æ®æ®µï¼š ç¨‹åºè¿è¡Œæ—¶ä½¿ç”¨ã€äº§ç”Ÿçš„è¿ç®—æ•°æ®ã€‚å¦‚å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡ã€å®å®šä¹‰çš„å¸¸é‡å°±å­˜æ”¾åœ¨æ•°æ®æ®µå†…</li>
<li>PCB: æ“ä½œç³»ç»Ÿé€šè¿‡PCBæ¥ç®¡ç†è¿›ç¨‹,å› æ­¤PCBä¸­åº”è¯¥åŒ…å«æ“ä½œç³»ç»Ÿå¯¹å…¶è¿›è¡Œç®¡ç†æ‰€éœ€çš„å„ç§ä¿¡æ¯</li>
</ul>
<h3 id="pcbçš„ç»„æˆéƒ¨åˆ†"><a class="markdownIt-Anchor" href="#pcbçš„ç»„æˆéƒ¨åˆ†"></a> PCBçš„ç»„æˆéƒ¨åˆ†</h3>
<ul>
<li>è¿›ç¨‹æè¿°ä¿¡æ¯
<ul>
<li>è¿›ç¨‹å”¯ä¸€çš„æ ‡è®°ç¬¦ï¼Œç±»ä¼¼å”¯ä¸€id</li>
<li>ç”¨æˆ·æ ‡è¯†ç¬¦ï¼Œè¿›ç¨‹å½’å±çš„ç”¨æˆ·ï¼Œç”¨æˆ·æ ‡è¯†ç¬¦ä¸»è¦ä¸ºå…±äº«å’Œä¿æŠ¤æœåŠ¡</li>
</ul>
</li>
<li>è¿›ç¨‹æ§åˆ¶å’Œç®¡ç†ä¿¡æ¯
<ul>
<li>è¿›ç¨‹å½“å‰çŠ¶æ€ï¼Œæ¯”å¦‚è¿è¡Œã€å°±ç»ªã€é˜»å¡ç­‰ï¼Œä½œä¸ºå¤„ç†æœºåˆ†é…è°ƒåº¦çš„ä¾æ®</li>
<li>è¿›ç¨‹ä¼˜å…ˆçº§ï¼Œæè¿°è¿›ç¨‹æŠ¢å å¤„ç†æœºçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„è¿›ç¨‹å¯ä»¥ä¼˜å…ˆè·å¾—å¤„ç†æœº</li>
</ul>
</li>
<li>èµ„æºåˆ†é…æ¸…å•
<ul>
<li>ç”¨äºè¯´æ˜æœ‰å…³å†…å­˜åœ°å€ç©ºé—´æˆ–è™šæ‹Ÿåœ°å€ç©ºé—´çš„çŠ¶å†µï¼Œæ‰€æ‰“å¼€æ–‡ä»¶çš„åˆ—è¡¨å’Œæ‰€ä½¿ç”¨çš„è¾“å…¥/è¾“å‡ºè®¾å¤‡ä¿¡æ¯</li>
</ul>
</li>
<li>CPU ç›¸å…³ä¿¡æ¯
<ul>
<li>æŒ‡ CPU ä¸­å„å¯„å­˜å™¨å€¼ï¼Œå½“è¿›ç¨‹è¢«åˆ‡æ¢æ—¶ï¼ŒCPUçŠ¶æ€ä¿¡æ¯éƒ½å¿…é¡»ä¿å­˜åœ¨ç›¸åº”çš„ PCBä¸­ï¼Œä»¥ä¾¿è¿›ç¨‹é‡æ–°æ‰§è¡Œæ—¶ï¼Œèƒ½å†ä»æ–­ç‚¹ç»§ç»­æ‰§è¡Œã€‚</li>
</ul>
</li>
</ul>
<h2 id="è¿›ç¨‹çš„çŠ¶æ€"><a class="markdownIt-Anchor" href="#è¿›ç¨‹çš„çŠ¶æ€"></a> è¿›ç¨‹çš„çŠ¶æ€</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.6/process-state.png" alt="è¿›ç¨‹çŠ¶æ€åˆ‡æ¢ å›¾æºè§æ°´å°" /></p>
<ul>
<li>åˆ›å»ºæ€ï¼ˆnewï¼‰ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»º</li>
<li>å°±ç»ªæ€ï¼ˆReadyï¼‰ï¼šå¯è¿è¡Œï¼Œä½†å› ä¸ºå…¶ä»–è¿›ç¨‹æ­£åœ¨è¿è¡Œè€Œæš‚åœåœæ­¢</li>
<li>è¿è¡Œæ€ï¼ˆRuningï¼‰ï¼šæ—¶åˆ»è¿›ç¨‹å ç”¨ CPU</li>
<li>ç»“æŸæ€ï¼ˆExitï¼‰ï¼šè¿›ç¨‹æ­£åœ¨ä»ç³»ç»Ÿä¸­æ¶ˆå¤±æ—¶çš„çŠ¶æ€</li>
<li>é˜»å¡çŠ¶æ€ï¼ˆBlockedï¼‰ï¼šè¯¥è¿›ç¨‹ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆæ¯”å¦‚IOè¯»å–ï¼‰åœæ­¢è¿è¡Œï¼Œè¿™æ—¶ï¼Œå³ä½¿ç»™å®ƒCPUæ§åˆ¶æƒï¼Œå®ƒä¹Ÿæ— æ³•è¿è¡Œ</li>
</ul>
<h2 id="è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢"><a class="markdownIt-Anchor" href="#è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢"></a> è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</h2>
<p>è¿›ç¨‹çš„ä»»ä½•æ“ä½œéƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œè¿›ç¨‹åˆ‡æ¢å‘ç”Ÿåœ¨å†…æ ¸æ€ã€‚</p>
<p>è¿›ç¨‹åˆ‡æ¢å°±æ˜¯æŠŠå‰ä¸€ä¸ªè¿›ç¨‹çš„CPUä¸Šä¸‹æ–‡ä¿å­˜èµ·æ¥ï¼Œç„¶ååŠ è½½å½“å‰ä»»åŠ¡çš„CPUä¸Šä¸‹æ–‡ï¼Œæœ€åè·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œä»»åŠ¡</p>
<h2 id="è¿›ç¨‹é€šä¿¡"><a class="markdownIt-Anchor" href="#è¿›ç¨‹é€šä¿¡"></a> è¿›ç¨‹é€šä¿¡</h2>
<h3 id="é€šä¿¡ä½œç”¨"><a class="markdownIt-Anchor" href="#é€šä¿¡ä½œç”¨"></a> é€šä¿¡ä½œç”¨</h3>
<p>è¿›ç¨‹çš„æ•°æ®ç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œç§æœ‰çš„ï¼Œä¸èƒ½ç›¸äº’è®¿é—®ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹è¿›ç¨‹ä¹‹é—´éœ€è¦é€šä¿¡æ¥å®ç°æŸåŠŸèƒ½æˆ–äº¤æ¢æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æ•°æ®ä¼ è¾“ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å°†å®ƒçš„æ•°æ®å‘é€ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
<li>å…±äº«æ•°æ®ï¼šå¤šä¸ªè¿›ç¨‹æƒ³è¦æ“ä½œå…±äº«æ•°æ®ï¼Œä¸€ä¸ªè¿›ç¨‹å¯¹å…±äº«æ•°æ®çš„ä¿®æ”¹ï¼Œåˆ«çš„è¿›ç¨‹åº”è¯¥ç«‹åˆ»çœ‹åˆ°ã€‚</li>
<li>é€šçŸ¥äº‹ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹éœ€è¦å‘å¦ä¸€ä¸ªæˆ–ä¸€ç»„è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œé€šçŸ¥å®ƒï¼ˆå®ƒä»¬ï¼‰å‘ç”Ÿäº†æŸç§äº‹ä»¶ï¼ˆå¦‚é€šçŸ¥è¿›ç¨‹é€€å‡ºï¼‰ã€‚</li>
<li>è¿›ç¨‹æ§åˆ¶ï¼šä¸€ä¸ªè¿›ç¨‹å¸Œæœ›æ§åˆ¶å¦ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œã€‚</li>
</ul>
<h3 id="è¿›ç¨‹é€šä¿¡-2"><a class="markdownIt-Anchor" href="#è¿›ç¨‹é€šä¿¡-2"></a> è¿›ç¨‹é€šä¿¡</h3>
<p>è¿›ç¨‹é€šä¿¡ï¼ˆInter Process Communicationï¼‰æœ‰ä¸¤ç§å½¢å¼ï¼š</p>
<ul>
<li>LPCï¼ˆlocal procedure callï¼‰ï¼šä¿¡å·é‡ã€ç®¡é“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å…±äº«å†…å­˜ã€socketç­‰</li>
<li>RPCï¼ˆremote procedure callï¼‰ï¼šåŸºäºç½‘ç»œåè®®å°è£…</li>
</ul>
<p>è¿›ç¨‹é€šä¿¡çš„æ–¹å¼å¤§æ¦‚åˆ†ä¸ºå…­ç§ã€‚</p>
<ul>
<li>ç®¡é“ï¼šåŒ…æ‹¬æ— åç®¡é“ï¼ˆpipeï¼‰åŠå‘½åç®¡é“ï¼ˆnamed pipeï¼‰ï¼Œæ— åç®¡é“å¯ç”¨äºå…·æœ‰çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚å‘½åç®¡é“å…‹æœäº†ç®¡é“æ²¡æœ‰åå­—çš„é™åˆ¶ï¼Œå› æ­¤ï¼Œé™¤å…·æœ‰ç®¡é“æ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œå®ƒè¿˜å…è®¸æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡ã€‚</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆmessageï¼‰ï¼šè¿›ç¨‹å¯ä»¥å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ï¼Œå…¶å®ƒçš„è¿›ç¨‹åˆ™å¯ä»¥è¯»å–é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>
<li>ä¿¡å·ï¼ˆsignalï¼‰ï¼šä¿¡å·ç”¨äºé€šçŸ¥å…¶å®ƒè¿›ç¨‹æœ‰æŸç§äº‹ä»¶å‘ç”Ÿã€‚</li>
<li>å…±äº«å†…å­˜ï¼ˆshared memoryï¼‰ï¼šå¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜ç©ºé—´ã€‚</li>
<li>ä¿¡å·é‡ï¼ˆsemaphoreï¼‰ï¼šä¹Ÿå«ä¿¡å·ç¯ï¼Œç”¨äºè¿›ç¨‹ä¹‹é—´å¯¹å…±äº«èµ„æºè¿›è¡ŒåŠ é”ã€‚</li>
<li>å¥—æ¥å­—ï¼ˆsocketï¼‰ï¼šå¯ç”¨äºä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡ã€‚</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.6/IPC.png" alt="" /></p>
<h1 id="çº¿ç¨‹"><a class="markdownIt-Anchor" href="#çº¿ç¨‹"></a> çº¿ç¨‹</h1>
<h2 id="å®šä¹‰-2"><a class="markdownIt-Anchor" href="#å®šä¹‰-2"></a> å®šä¹‰</h2>
<blockquote>
<p>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„å­ä»»åŠ¡ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œç”¨äºä¿è¯ç¨‹åºçš„å®æ—¶æ€§ï¼Œå®ç°è¿›ç¨‹å†…éƒ¨çš„å¹¶å‘ï¼›çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå¯è¯†åˆ«çš„æœ€å°æ‰§è¡Œå’Œè°ƒåº¦å•ä½ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ç‹¬è‡ªå ç”¨ä¸€ä¸ªè™šæ‹Ÿå¤„ç†å™¨ï¼šç‹¬è‡ªçš„å¯„å­˜å™¨ç»„ï¼ŒæŒ‡ä»¤è®¡æ•°å™¨å’Œå¤„ç†å™¨çŠ¶æ€ã€‚æ¯ä¸ªçº¿ç¨‹å®Œæˆä¸åŒçš„ä»»åŠ¡ï¼Œä½†æ˜¯å…±äº«åŒä¸€åœ°å€ç©ºé—´ï¼ˆä¹Ÿå°±æ˜¯åŒæ ·çš„åŠ¨æ€å†…å­˜ï¼Œæ˜ å°„æ–‡ä»¶ï¼Œç›®æ ‡ä»£ç ç­‰ç­‰ï¼‰ï¼Œæ‰“å¼€çš„æ–‡ä»¶é˜Ÿåˆ—å’Œå…¶ä»–å†…æ ¸èµ„æºã€‚</p>
</blockquote>
<p>ä¸€ä¸ªè¿›ç¨‹å†…å¯ä»¥æœ‰è®¸å¤šçº¿ç¨‹ï¼Œçº¿ç¨‹ä¸æ‹¥æœ‰è‡ªå·±çš„èµ„æºï¼Œçº¿ç¨‹ä¸å…¶ä»–çº¿ç¨‹å…±äº«è¿›ç¨‹å†…çš„èµ„æº</p>
<p>ä¸è¿›ç¨‹ç±»ä¼¼ï¼Œçº¿ç¨‹ä¹Ÿæœ‰TCB(Thread Control Block)</p>
<h2 id="çº¿ç¨‹çš„ç±»åˆ«"><a class="markdownIt-Anchor" href="#çº¿ç¨‹çš„ç±»åˆ«"></a> çº¿ç¨‹çš„ç±»åˆ«</h2>
<ul>
<li>ç”¨æˆ·çº§çº¿ç¨‹<br />
å†…æ ¸æ„è¯†ä¸åˆ°ç”¨æˆ·çº§çº¿ç¨‹çš„å­˜åœ¨ï¼Œä½¿ç”¨çº¿ç¨‹åº“è®¾è®¡å¤šçº¿ç¨‹ç¨‹åºï¼Œå¯¹äºä¸€ä¸ªè¿›ç¨‹æ¥è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹é˜»å¡ï¼Œæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚</li>
<li>å†…æ ¸çº§çº¿ç¨‹<br />
ç”±æ“ä½œç³»ç»Ÿå±‚é¢å®ç°çº¿ç¨‹ï¼Œåº”ç”¨ç¨‹åºæ²¡æœ‰å®ç°çº¿ç¨‹ç®¡ç†ï¼Œä½†æ˜¯åˆ‡æ¢çš„ä»£ä»·è¦æ¯”ç”¨æˆ·çº§çº¿ç¨‹å¤§</li>
</ul>
<h2 id="å¤šçº¿ç¨‹æ¨¡å‹"><a class="markdownIt-Anchor" href="#å¤šçº¿ç¨‹æ¨¡å‹"></a> å¤šçº¿ç¨‹æ¨¡å‹</h2>
<p>æœ‰äº›ç³»ç»ŸåŒæ—¶æ”¯æŒç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çº¿ç¨‹ç”±æ­¤äº§ç”Ÿäº†ä¸åŒçš„å¤šçº¿ç¨‹æ¨¡å‹ï¼Œå³å®ç°ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹çš„è¿æ¥æ–¹å¼ã€‚</p>
<ul>
<li>å¤šå¯¹ä¸€æ¨¡å‹ï¼š å¤šä¸ªç”¨æˆ·åŠçº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ã€‚æ¯ä¸ªç”¨æˆ·è¿›ç¨‹åªå¯¹åº”ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹
<ul>
<li>ä¼˜ç‚¹:ç”¨æˆ·çº§çº¿ç¨‹çš„åˆ‡æ¢åœ¨ç”¨æˆ·ç©ºé—´å³å¯å®Œæˆï¼Œä¸éœ€è¦åˆ‡æ¢åˆ°æ ¸å¿ƒæ€ï¼Œçº¿ç¨‹ç®¡ç†çš„ç³»ç»Ÿå¼€é”€å°ï¼Œæ•ˆç‡é«˜</li>
<li>ç¼ºç‚¹:å½“ä¸€ä¸ªç”¨æˆ·çº§çº¿ç¨‹è¢«é˜»å¡åï¼Œæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œå¹¶å‘åº¦ä¸é«˜ã€‚å¤šä¸ªçº¿ç¨‹ä¸å¯åœ¨å¤šæ ¸å¤„ç†æœºä¸Šå¹¶è¡Œè¿è¡Œ</li>
</ul>
</li>
<li>ä¸€å¯¹ä¸€æ¨¡å‹ï¼š ä¸€ä¸ªç”¨æˆ·åŠçº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº§çº¿ç¨‹ã€‚æ¯ä¸ªç”¨æˆ·è¿›ç¨‹æœ‰ä¸ç”¨æˆ·çº§çº¿ç¨‹åŒæ•°é‡çš„å†…æ ¸çº§çº¿ç¨‹
<ul>
<li>ä¼˜ç‚¹:å½“ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡åï¼Œåˆ«çš„çº¿ç¨‹è¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œå¹¶å‘èƒ½åŠ›å¼ºã€‚å¤šçº¿ç¨‹å¯åœ¨å¤šæ ¸å¤„ç†æœºä¸Šå¹¶è¡Œæ‰§è¡Œã€‚</li>
<li>ç¼ºç‚¹:ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹ä¼šå ç”¨å¤šä¸ªå†…æ ¸çº§çº¿ç¨‹ï¼Œçº¿ç¨‹åˆ‡æ¢ç”±æ“ä½œç³»ç»Ÿå†…æ ¸å®Œæˆï¼Œéœ€è¦åˆ‡æ¢åˆ°æ ¸å¿ƒæ€ï¼Œå› æ­¤çº¿ç¨‹ç®¡ç†çš„æˆæœ¬é«˜ï¼Œå¼€é”€å¤§ã€‚</li>
</ul>
</li>
<li>å¤šå¯¹å¤šæ¨¡å‹:nç”¨æˆ·åŠçº¿ç¨‹æ˜ å°„åˆ°mä¸ªå†…æ ¸çº§çº¿ç¨‹(n &gt;= mï¼‰ã€‚æ¯ä¸ªç”¨æˆ·è¿›ç¨‹å¯¹åº”mä¸ªå†…æ ¸çº§çº¿ç¨‹
<ul>
<li>å…‹æœäº†å¤šå¯¹ä¸€æ¨¡å‹å¹¶å‘åº¦ä¸é«˜çš„ç¼ºç‚¹ï¼Œåˆå…‹æœäº†ä¸€å¯¹ä¸€æ¨¡å‹ä¸­ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å ç”¨å¤ªå¤šå†…æ ¸çº§çº¿ç¨‹ï¼Œå¼€é”€å¤ªå¤§çš„ç¼ºç‚¹</li>
</ul>
</li>
</ul>
<h1 id="è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«"></a> è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</h1>
<table>
<thead>
<tr>
<th></th>
<th>è¿›ç¨‹</th>
<th>çº¿ç¨‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®šä¹‰</td>
<td>èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½</td>
<td>CPUæ‰§è¡Œçš„åŸºæœ¬å•ä½</td>
</tr>
<tr>
<td>åˆ‡æ¢å¼€é”€</td>
<td>å¤§</td>
<td>å°</td>
</tr>
<tr>
<td>åŒ…å«å…³ç³»</td>
<td>è¿›ç¨‹å†…å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹</td>
<td>çº¿ç¨‹ç”Ÿå­˜åœ¨è¿›ç¨‹å†…</td>
</tr>
<tr>
<td>å½±å“å…³ç³»</td>
<td>ä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“</td>
<td>ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰</td>
</tr>
<tr>
<td>èµ„æº</td>
<td>ç‹¬ç«‹çš„ä»£ç ç©ºé—´å’Œå†…å­˜ç©ºé—´</td>
<td>ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨</td>
</tr>
<tr>
<td>é€šä¿¡</td>
<td>è¿›ç¨‹é€šä¿¡</td>
<td>ç›´æ¥è¯»å†™æ•°æ®æ®µ</td>
</tr>
</tbody>
</table>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://cloud.tencent.com/developer/article/1688297">è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µã€åŒºåˆ«åŠè¿›ç¨‹çº¿ç¨‹é—´é€šä¿¡</a></p>
<p><a href="https://mp.weixin.qq.com/s/jhOSjVyRA6rNKqVT2pKMIQ">è¿›ç¨‹ã€çº¿ç¨‹ä¸åç¨‹å‚»å‚»åˆ†ä¸æ¸…ï¼Ÿä¸€æ–‡å¸¦ä½ åƒé€ï¼</a></p>
<p><a href="https://freecplus.net/d95f4eaf18eb46d19b82383519126dec.html">Cè¯­è¨€æŠ€æœ¯ç½‘</a></p>
<p><a href="https://mp.weixin.qq.com/s/iHQGe2J-4C405CYzBIqXNg">ä¸‰åˆ†é’ŸåŸºç¡€ï¼šç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>é¢ç»</tag>
        <tag>OS</tag>
      </tags>
  </entry>
  <entry>
    <title>æ­»é”</title>
    <url>/2022/10/19/dead-lock/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šçµ†ãã‚‰ã‚ãæ‹ã„ã‚ã¯ã€‹</p>
</blockquote>
<h1 id="æ­»é”çš„æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æ­»é”çš„æ¦‚å¿µ"></a> æ­»é”çš„æ¦‚å¿µ</h1>
<blockquote>
<p>æ­»é”æ˜¯æŒ‡å¤šä¸ªè¿›ç¨‹å› ç«äº‰èµ„æºè€Œé€ æˆçš„ä¸€ç§åƒµå±€ï¼ˆäº’ç›¸ç­‰å¾…ï¼‰ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œè¿™äº›è¿›ç¨‹éƒ½å°†æ— æ³•å‘å‰æ¨è¿›</p>
</blockquote>
<h1 id="æ­»é”äº§ç”Ÿçš„åŸå› "><a class="markdownIt-Anchor" href="#æ­»é”äº§ç”Ÿçš„åŸå› "></a> æ­»é”äº§ç”Ÿçš„åŸå› </h1>
<ul>
<li>ç³»ç»Ÿèµ„æºä¸è¶³</li>
<li>ç¨‹åºæ‰§è¡Œçš„é¡ºåºæœ‰é—®é¢˜</li>
<li>èµ„æºåˆ†é…ä¸å½“ç­‰</li>
</ul>
<h1 id="æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶"><a class="markdownIt-Anchor" href="#æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶"></a> æ­»é”äº§ç”Ÿçš„å¿…è¦æ¡ä»¶</h1>
<blockquote>
<p>äº§ç”Ÿæ­»é”å¿…é¡»æ»¡è¶³å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œä»»æ„ä¸€ä¸ªæ¡ä»¶ä¸æˆç«‹ï¼Œæ­»é”å°±ä¸ä¼šå‘ç”Ÿã€‚</p>
</blockquote>
<h2 id="äº’æ–¥æ¡ä»¶"><a class="markdownIt-Anchor" href="#äº’æ–¥æ¡ä»¶"></a> äº’æ–¥æ¡ä»¶</h2>
<p>åœ¨æŸä¸€æ®µæ—¶é—´å†…ï¼Œèµ„æºä»…è¢«ä¸€ä¸ªè¿›ç¨‹å æœ‰ã€‚è‹¥æœ‰å…¶ä»–è¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼Œåˆ™è¯·æ±‚è¿›ç¨‹åªèƒ½ç­‰å¾…ã€‚</p>
<h2 id="ä¸å‰¥å¤ºæ¡ä»¶"><a class="markdownIt-Anchor" href="#ä¸å‰¥å¤ºæ¡ä»¶"></a> ä¸å‰¥å¤ºæ¡ä»¶</h2>
<p>è¿›ç¨‹æ‰€è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹å¼ºè¡Œå¤ºèµ°ï¼Œåªèƒ½ç”±è·å¾—è¯¥èµ„æºçš„è¿›ç¨‹è‡ªå·±æ¥é‡Šæ”¾ã€‚</p>
<h2 id="è¯·æ±‚å¹¶ä¿æŒæ¡ä»¶"><a class="markdownIt-Anchor" href="#è¯·æ±‚å¹¶ä¿æŒæ¡ä»¶"></a> è¯·æ±‚å¹¶ä¿æŒæ¡ä»¶</h2>
<p>è¿›ç¨‹å·²ç»ä¿æŒäº†è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²ç»è¢«å…¶ä»–è¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹è¢«é˜»å¡ï¼Œä½†å¯¹è‡ªå·±è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</p>
<h2 id="å¾ªç¯ç­‰å¾…æ¡ä»¶"><a class="markdownIt-Anchor" href="#å¾ªç¯ç­‰å¾…æ¡ä»¶"></a> å¾ªç¯ç­‰å¾…æ¡ä»¶</h2>
<p>å­˜åœ¨ä¸€ç§è¿›ç¨‹èµ„æºçš„å¾ªç¯ç­‰å¾…é“¾ï¼Œé“¾ä¸­æ¯ä¸ªè¿›ç¨‹å·²è·å¾—çš„èµ„æºåŒæ—¶è¢«é“¾ä¸­ä¸‹ä¸€ä¸ªè¿›ç¨‹æ‰€è¯·æ±‚ã€‚</p>
<h1 id="å¤„ç†æ­»é”"><a class="markdownIt-Anchor" href="#å¤„ç†æ­»é”"></a> å¤„ç†æ­»é”</h1>
<h2 id="æ­»é”é¢„é˜²"><a class="markdownIt-Anchor" href="#æ­»é”é¢„é˜²"></a> æ­»é”é¢„é˜²</h2>
<blockquote>
<p>ç ´åæ­»é”çš„4ä¸ªå¿…è¦æ¡ä»¶</p>
</blockquote>
<h3 id="ç ´åäº’æ–¥æ¡ä»¶"><a class="markdownIt-Anchor" href="#ç ´åäº’æ–¥æ¡ä»¶"></a> ç ´åäº’æ–¥æ¡ä»¶</h3>
<p>æœ‰äº›èµ„æºå¿…é¡»äº’æ–¥ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•ç ´åäº’æ–¥æ¡ä»¶ã€‚</p>
<h3 id="ç ´åä¸å‰¥å¤ºæ¡ä»¶"><a class="markdownIt-Anchor" href="#ç ´åä¸å‰¥å¤ºæ¡ä»¶"></a> ç ´åä¸å‰¥å¤ºæ¡ä»¶</h3>
<p>å½“è¿›ç¨‹è¯·æ±‚æ–°èµ„æºå¾—ä¸åˆ°æ»¡è¶³æ—¶ï¼Œå¿…é¡»é‡Šæ”¾å·²ç»æŒæœ‰çš„èµ„æºï¼Œé‡æ–°ç”³è¯·ã€‚è¿™ä¸ªç­–ç•¥å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œåå¤çš„ç”³è¯·å’Œé‡Šæ”¾ä¼šå¯¼è‡´ç³»ç»Ÿå¼€é”€å¢åŠ ï¼Œé™ä½ç³»ç»Ÿååé‡ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå®¹æ˜“ä¿å­˜å’Œæ¢å¤çš„èµ„æºï¼Œä¾‹å¦‚CPUçš„å¯„å­˜å™¨å’Œå†…å­˜èµ„æºï¼Œä¸€èˆ¬ä¸èƒ½ç”¨äºæ‰“å°æœºä¹‹ç±»çš„èµ„æºã€‚</p>
<h3 id="ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶"><a class="markdownIt-Anchor" href="#ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶"></a> ç ´åè¯·æ±‚ä¸ä¿æŒæ¡ä»¶</h3>
<p>é‡‡ç”¨é¢„å…ˆé™æ€åˆ†é…æ–¹æ³•ï¼Œè¿›ç¨‹åœ¨è¿è¡Œä¹‹å‰ç”³è¯·å®Œå®ƒæ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œè¿™äº›èµ„æºä¸€ç›´å½’å®ƒæ‰€æœ‰ã€‚</p>
<p>å®¹æ˜“å‘ç”Ÿä¸¤ä¸ªé—®é¢˜ï¼š1.å¯¼è‡´éƒ¨åˆ†è¿›ç¨‹é¥¥é¥¿ç°è±¡ï¼Œæ°¸è¿œç”³è¯·ä¸æ»¡èµ„æºã€‚2.å¯¼è‡´èµ„æºæµªè´¹ï¼Œæœ‰äº›èµ„æºåªåœ¨è¿è¡ŒåˆæœŸæˆ–è€…ç»“æŸæ—¶å€™ä½¿ç”¨ã€‚</p>
<h3 id="ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶"><a class="markdownIt-Anchor" href="#ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶"></a> ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶</h3>
<p>ä¸ºäº†ç ´åå¾ªç¯ç­‰å¾…æ¡ä»¶ï¼Œå¯ä»¥é‡‡ç”¨é¡ºåºèµ„æºåˆ†é…æ³•ã€‚ç»™èµ„æºç¼–å·ï¼Œè¿›ç¨‹æŒ‰ç…§ç¼–å·é€’å¢çš„é¡ºåºè¯·æ±‚èµ„æºã€‚</p>
<p>å®¹æ˜“é€ æˆèµ„æºä½¿ç”¨çš„æµªè´¹å’Œç”¨æˆ·ç¼–ç¨‹çš„éº»çƒ¦ã€‚</p>
<h2 id="æ­»é”é¿å…"><a class="markdownIt-Anchor" href="#æ­»é”é¿å…"></a> æ­»é”é¿å…</h2>
<blockquote>
<p>åœ¨ä½¿ç”¨å‰è¿›è¡Œåˆ¤æ–­ï¼Œåªå…è®¸ä¸ä¼šäº§ç”Ÿæ­»é”çš„è¿›ç¨‹ç”³è¯·èµ„æº<br />
æ­»é”é¿å…æ˜¯åˆ©ç”¨é¢å¤–çš„æ£€éªŒä¿¡æ¯ï¼Œåœ¨åˆ†é…èµ„æºæ—¶åˆ¤æ–­æ˜¯å¦ä¼šå‡ºç°æ­»é”ï¼Œåªåœ¨ä¸ä¼šå‡ºç°æ­»é”çš„æƒ…å†µä¸‹æ‰åˆ†é…èµ„æº<br />
å„ç§æ­»é”é˜²æ­¢æ–¹æ³•èƒ½å¤Ÿé˜²æ­¢å‘ç”Ÿæ­»é”ï¼Œä½†å¿…ç„¶ä¼šé™ä½ç³»ç»Ÿå¹¶å‘æ€§ï¼Œå¯¼è‡´ä½æ•ˆçš„èµ„æºåˆ©ç”¨ç‡</p>
</blockquote>
<h3 id="å®‰å…¨çŠ¶æ€"><a class="markdownIt-Anchor" href="#å®‰å…¨çŠ¶æ€"></a> å®‰å…¨çŠ¶æ€</h3>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.7/safe-state.png" alt="å®‰å…¨çŠ¶æ€" /></p>
<p>å›¾ a çš„ç¬¬äºŒåˆ— Has è¡¨ç¤ºå·²æ‹¥æœ‰çš„èµ„æºæ•°ï¼Œç¬¬ä¸‰åˆ— Max è¡¨ç¤ºæ€»å…±éœ€è¦çš„èµ„æºæ•°ï¼ŒFree è¡¨ç¤ºè¿˜æœ‰å¯ä»¥ä½¿ç”¨çš„èµ„æºæ•°ã€‚ä»å›¾ a å¼€å§‹å‡ºå‘ï¼Œå…ˆè®© B æ‹¥æœ‰æ‰€éœ€çš„æ‰€æœ‰èµ„æºï¼ˆå›¾ bï¼‰ï¼Œè¿è¡Œç»“æŸåé‡Šæ”¾ Bï¼Œæ­¤æ—¶ Free å˜ä¸º 5ï¼ˆå›¾ cï¼‰ï¼›æ¥ç€ä»¥åŒæ ·çš„æ–¹å¼è¿è¡Œ C å’Œ Aï¼Œä½¿å¾—æ‰€æœ‰è¿›ç¨‹éƒ½èƒ½æˆåŠŸè¿è¡Œï¼Œå› æ­¤å¯ä»¥ç§°å›¾ a æ‰€ç¤ºçš„çŠ¶æ€æ—¶å®‰å…¨çš„ã€‚</p>
<p>å®šä¹‰ï¼šå¦‚æœæ²¡æœ‰æ­»é”å‘ç”Ÿï¼Œå¹¶ä¸”å³ä½¿æ‰€æœ‰è¿›ç¨‹çªç„¶è¯·æ±‚å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚ï¼Œä¹Ÿä»ç„¶å­˜åœ¨æŸç§è°ƒåº¦æ¬¡åºèƒ½å¤Ÿä½¿å¾—æ¯ä¸€ä¸ªè¿›ç¨‹è¿è¡Œå®Œæ¯•ï¼Œåˆ™ç§°è¯¥çŠ¶æ€æ˜¯å®‰å…¨çš„ã€‚</p>
<h3 id="é“¶è¡Œå®¶ç®—æ³•"><a class="markdownIt-Anchor" href="#é“¶è¡Œå®¶ç®—æ³•"></a> é“¶è¡Œå®¶ç®—æ³•</h3>
<p>é“¶è¡Œå®¶ç®—æ³•çš„ä¸»è¦æ€æƒ³æ˜¯é¿å…æ­»é”è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ã€‚æ¯æ¬¡è¿›è¡Œèµ„æºåˆ†é…æ—¶ï¼Œå®ƒå…ˆæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºæ»¡è¶³è¦æ±‚ï¼Œè‹¥æœ‰åˆ™å…ˆè¿›è¡Œåˆ†é…ï¼Œå¹¶å¯¹åˆ†é…åçš„æ–°çŠ¶æ€è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥ã€‚è‹¥æ–°çŠ¶æ€å®‰å…¨ï¼Œåˆ™æ­£æ˜¯åˆ†é…ä¸Šè¿°èµ„æºï¼Œå¦åˆ™æ‹’ç»åˆ†é…ä¸Šè¿°èµ„æºã€‚ç„¶åå›æ”¶å·²åˆ†é…çš„èµ„æºï¼Œè¿›è¡Œä¸‹ä¸€è½®åˆ†é…ã€‚è¿™æ ·èƒ½ä¿è¯èµ„æºå§‹ç»ˆå¤„äºå®‰å…¨çŠ¶æ€ï¼Œä»è€Œé¿å…æ­»é”å‘ç”Ÿã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.7/bank-unsafe.png" alt="" /><br />
ä¸Šå›¾cä¸ºä¸å®‰å…¨çŠ¶æ€ï¼Œå› æ­¤ç®—æ³•ä¼šæ‹’ç»è¿›å…¥å›¾cè¯·æ±‚</p>
<h2 id="æ­»é”æ£€æµ‹ä¸æ¢å¤"><a class="markdownIt-Anchor" href="#æ­»é”æ£€æµ‹ä¸æ¢å¤"></a> æ­»é”æ£€æµ‹ä¸æ¢å¤</h2>
<h3 id="æ­»é”æ£€æµ‹"><a class="markdownIt-Anchor" href="#æ­»é”æ£€æµ‹"></a> æ­»é”æ£€æµ‹</h3>
<h4 id="èµ„æºåˆ†é…å›¾"><a class="markdownIt-Anchor" href="#èµ„æºåˆ†é…å›¾"></a> èµ„æºåˆ†é…å›¾</h4>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.7/rag.jpg" alt="èµ„æºåˆ†é…å›¾" /></p>
<ul>
<li>åœ†åœˆä»£è¡¨è¿›ç¨‹</li>
<li>æ–¹æ¡†ä»£è¡¨ä¸€ç±»èµ„æº</li>
<li>è¿›ç¨‹åˆ°èµ„æºçš„æœ‰å‘è¾¹ä»£è¡¨è¯·æ±‚èµ„æºè¾¹</li>
<li>èµ„æºåˆ°è¿›ç¨‹çš„æœ‰å‘è¾¹ä»£è¡¨èµ„æºåˆ†é…è¾¹<br />
å¦‚å›¾æ‰€ç¤ºï¼ŒP1è¿›ç¨‹åˆ†å¾—ä¸¤ä¸ªR1èµ„æºï¼Œåˆè¯·æ±‚ä¸€ä¸ªR2èµ„æºï¼›P2è¿›ç¨‹åˆ†å¾—ä¸€ä¸ªR1èµ„æºå’ŒR2èµ„æºï¼Œåˆè¯·æ±‚äº†ä¸€ä¸ªR1èµ„æºã€‚</li>
</ul>
<h4 id="ç®€åŒ–èµ„æºåˆ†é…å›¾"><a class="markdownIt-Anchor" href="#ç®€åŒ–èµ„æºåˆ†é…å›¾"></a> ç®€åŒ–èµ„æºåˆ†é…å›¾</h4>
<p>ç®€åŒ–èµ„æºåˆ†é…å›¾æ­¥éª¤</p>
<ol>
<li>æ‰¾ä¸€ä¸ªéå­¤ç«‹ã€ä¸”åªæœ‰åˆ†é…è¾¹çš„è¿›ç¨‹èŠ‚ç‚¹ï¼Œå»æ‰åˆ†é…è¾¹ï¼Œå°†å…¶å˜ä¸ºå­¤ç«‹èŠ‚ç‚¹</li>
<li>å†æŠŠç›¸åº”çš„èµ„æºåˆ†é…ç»™ä¸€ä¸ªç­‰å¾…è¯¥èµ„æºçš„è¿›ç¨‹ï¼Œå³å°†è¯¥è¿›ç¨‹çš„ç”³è¯·è¾¹å˜ä¸ºåˆ†é…è¾¹</li>
<li>é‡å¤1ã€2</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.7/rag2.jpg" alt="åŒ–ç®€" /></p>
<ul>
<li>(1)åˆ°(2): R2å‰©ä½™1ä¸ªèµ„æºï¼Œåˆ†é…ç»™P1ï¼Œé‡Šæ”¾P1</li>
<li>(2)åˆ°(3): R1å‰©ä½™2ä¸ªèµ„æºï¼Œåˆ†é…ç»™P2ï¼Œé‡Šæ”¾P2</li>
</ul>
<p>è‹¥èƒ½æ¶ˆå»æ‰€æœ‰çš„è¾¹ï¼Œåˆ™è¯¥å›¾æ˜¯å¯å®Œå…¨ç®€åŒ–çš„ï¼Œæ­»é”çš„æ¡ä»¶æ˜¯å½“ä¸”ä»…å½“SçŠ¶æ€çš„èµ„æºåˆ†é…å›¾æ˜¯ä¸å¯å®Œå…¨ç®€åŒ–çš„</p>
<h3 id="æ­»é”æ¢å¤"><a class="markdownIt-Anchor" href="#æ­»é”æ¢å¤"></a> æ­»é”æ¢å¤</h3>
<ul>
<li>èµ„æºå‰¥å¤ºæ³•ã€‚æŒ‚èµ·æŸäº›æ­»é”è¿›ç¨‹å¹¶æŠ¢å¤ºå®ƒçš„èµ„æºï¼Œç›´åˆ°æ­»é”æ¥è§¦ã€‚ä½†è¦é˜²æ­¢è¢«æŒ‚èµ·çš„è¿›ç¨‹é•¿æ—¶é—´å¾—ä¸åˆ°èµ„æºè€Œé¥¥é¥¿ã€‚</li>
<li>æ’¤é”€è¿›ç¨‹æ³•ã€‚å¼ºåˆ¶æ’¤é”€éƒ¨åˆ†ã€ç”šè‡³å…¨éƒ¨æ­»é”è¿›ç¨‹å¹¶å‰¥å¤ºè¿™äº›èµ„æºã€‚</li>
<li>è¿›ç¨‹å›é€€æ³•ã€‚è®©ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å›é€€åˆ°è¶³ä»¥å›é¿æ­»é”çš„åœ°æ­¥ã€‚è¦æ±‚ä¿æŒè¿›ç¨‹çš„å†å²ä¿¡æ¯ï¼Œè®¾ç½®è¿˜åŸç‚¹ã€‚</li>
</ul>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://www.nowcoder.com/questionTerminal/09b51b00891543d6b08ace80c0704b01">ä»€ä¹ˆæ˜¯æ­»é”(deadlock)</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/25677118">æ­»é”äº§ç”Ÿçš„åŸå› åŠå››ä¸ªå¿…è¦æ¡ä»¶</a></p>
<p><a href="https://blog.csdn.net/zhangpower1993/article/details/89518780">æ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ã€é¢„é˜²å’Œé¿å…åŠæ³•</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/61221667">â€‹æ­»é”çš„äº§ç”Ÿã€é˜²æ­¢ã€é¿å…ã€æ£€æµ‹å’Œè§£é™¤</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
      <tags>
        <tag>é¢ç»</tag>
        <tag>OS</tag>
      </tags>
  </entry>
  <entry>
    <title>golangåƒåœ¾å›æ”¶</title>
    <url>/2022/10/21/go-gc/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Špieces/æ¸¡ã‚Šé³¥ã®ã‚½ãƒ ãƒ‹ã‚¦ãƒ ã€‹</p>
</blockquote>
<h1 id="go-v13-æ ‡è®°-æ¸…é™¤ç®—æ³•"><a class="markdownIt-Anchor" href="#go-v13-æ ‡è®°-æ¸…é™¤ç®—æ³•"></a> GO V1.3 æ ‡è®°-æ¸…é™¤ç®—æ³•</h1>
<p>æ­¤ç®—æ³•ä¸»è¦æœ‰ä¸¤ä¸ªä¸»è¦çš„æ­¥éª¤ï¼š</p>
<ul>
<li>æ ‡è®°(Mark phase)</li>
<li>æ¸…é™¤(Sweep phase)</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/mark-sweep.jpg" alt="mark-sweep" /></p>
<ol>
<li>STW(stop the world), æ‰¾å‡ºä¸å¯è¾¾çš„å¯¹è±¡ï¼Œç„¶ååšä¸Šæ ‡è®°ã€‚</li>
<li>å¼€å§‹æ ‡è®°ï¼Œç¨‹åºæ‰¾å‡ºå®ƒæ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ï¼Œå¹¶åšä¸Šæ ‡è®°ã€‚</li>
<li>æ ‡è®°å®Œäº†ä¹‹åï¼Œç„¶åå¼€å§‹æ¸…é™¤æœªæ ‡è®°çš„å¯¹è±¡ã€‚</li>
<li>åœæ­¢æš‚åœï¼Œè®©ç¨‹åºç»§ç»­è·‘ã€‚ç„¶åå¾ªç¯é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°processç¨‹åºç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</li>
</ol>
<p>æ‰€ä»¥Go V1.3ç‰ˆæœ¬ä¹‹å‰å°±æ˜¯ä»¥ä¸Šæ¥å®æ–½çš„,åœ¨æ‰§è¡ŒGCçš„åŸºæœ¬æµç¨‹å°±æ˜¯é¦–å…ˆå¯åŠ¨STWæš‚åœï¼Œç„¶åæ‰§è¡Œæ ‡è®°ï¼Œå†æ‰§è¡Œæ•°æ®å›æ”¶ï¼Œæœ€ååœæ­¢STW<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/before1_3.png" alt="GOv1.3ä»¥å‰" /></p>
<p>Go V1.3 åšäº†ç®€å•çš„ä¼˜åŒ–,å°†STWæå‰, å‡å°‘STWæš‚åœçš„æ—¶é—´èŒƒå›´ã€‚å°†STWçš„æ­¥éª¤æå‰äº†ä¸€æ­¥ï¼Œå› ä¸ºåœ¨Sweepæ¸…é™¤çš„æ—¶å€™ï¼Œå¯ä»¥ä¸éœ€è¦STWåœæ­¢ï¼Œå› ä¸ºè¿™äº›å¯¹è±¡å·²ç»æ˜¯ä¸å¯è¾¾å¯¹è±¡äº†ï¼Œä¸ä¼šå‡ºç°å›æ”¶å†™å†²çªç­‰é—®é¢˜ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/after1_3.png" alt="GOv1.3ä»¥å" /></p>
<h2 id="ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#ç¼ºç‚¹"></a> ç¼ºç‚¹ï¼š</h2>
<ul>
<li>STWï¼Œstop the worldï¼›è®©ç¨‹åºæš‚åœï¼Œç¨‹åºå‡ºç°å¡é¡¿(é‡è¦é—®é¢˜)</li>
<li>æ ‡è®°éœ€è¦æ‰«ææ•´ä¸ªheap</li>
<li>æ¸…é™¤æ•°æ®ä¼šäº§ç”Ÿheapç¢ç‰‡</li>
</ul>
<p>æ— è®ºå¦‚ä½•mark-sweepéƒ½ä¼šæš‚åœæ•´ä¸ªç¨‹åºï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜åœ¨GOv1.5ç‰ˆæœ¬å¼•å…¥äº†ä¸‰è‰²å¹¶å‘æ ‡è®°æ³•æ¥ä¼˜åŒ–</p>
<h1 id="go-v15-ä¸‰è‰²æ ‡è®°æ³•"><a class="markdownIt-Anchor" href="#go-v15-ä¸‰è‰²æ ‡è®°æ³•"></a> GO v1.5 ä¸‰è‰²æ ‡è®°æ³•</h1>
<p>Golangä¸­çš„åƒåœ¾å›æ”¶ä¸»è¦åº”ç”¨ä¸‰è‰²æ ‡è®°æ³•ï¼ŒGCè¿‡ç¨‹å’Œå…¶ä»–ç”¨æˆ·goroutineå¯å¹¶å‘è¿è¡Œï¼Œä½†éœ€è¦ä¸€å®šæ—¶é—´çš„STW(stop the world)</p>
<h2 id="å®šä¹‰"><a class="markdownIt-Anchor" href="#å®šä¹‰"></a> å®šä¹‰</h2>
<ul>
<li>é»‘è‰²ï¼šæ£€æµ‹åˆ°æœ‰è¢«å¼•ç”¨ï¼Œå¹¶ä¸”å·²ç»éå†å®Œå®ƒæ‰€æœ‰ç›´æ¥å¼•ç”¨çš„å¯¹è±¡æˆ–è€…å±æ€§</li>
<li>ç™½è‰²ï¼šè¿˜æ²¡æ£€æµ‹åˆ°æœ‰å¼•ç”¨çš„å¯¹è±¡ï¼ˆæ£€æµ‹å¼€å§‹å‰ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²ï¼Œæ£€æµ‹ç»“æŸåï¼Œæ²¡æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡éƒ½æ˜¯ç™½è‰²ï¼Œä¼šè¢«æ¸…æŸ¥æ‰ï¼‰</li>
<li>ç°è‰²ï¼šæ£€æµ‹åˆ°æœ‰è¢«å¼•ç”¨ï¼Œä½†æ˜¯ä»–çš„å±æ€§è¿˜æ²¡æœ‰è¢«éå†å®Œï¼Œç­‰éå†å®Œåä¹Ÿä¼šå˜æˆé»‘è‰²</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/tri-color-marking.png" alt="ä¸‰è‰²æ ‡è®°æ³•æµç¨‹" /></p>
<p>å¦‚æœä¸ä½¿ç”¨STWï¼Œè¿™ç§æ–¹å¼ä¼šé€ æˆæ ‡è®°ä¸å‡†ç¡®çš„é—®é¢˜ï¼Œä¸‹é¢ä¸¤ç§æƒ…å†µæ˜¯ä¸å¸Œæœ›å‘ç”Ÿçš„</p>
<ul>
<li>ä¸€ä¸ªç™½è‰²å¯¹è±¡è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨</li>
<li>ç™½è‰²å¯¹è±¡åˆè¢«æŸä¸ªç°è‰²ï¼ˆæˆ–è€…ä¸Šçº§æœ‰ç°è‰²å¯¹è±¡ï¼‰å¯¹è±¡å–æ¶ˆå¼•ç”¨ã€‚</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/non-stw.jpg" alt="æ²¡æœ‰STWçš„ä¸‰è‰²æ ‡è®°æ³•" /></p>
<p>ä¸ºäº†é˜²æ­¢ä¸Šé¢çš„ç°è±¡å‘ç”Ÿï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨STWï¼Œç›´æ¥ç¦æ­¢æ‰å…¶ä»–ç”¨æˆ·ç¨‹åºå¯¹å¯¹è±¡å¼•ç”¨å…³ç³»çš„å¹²æ‰°ï¼Œä½†æ˜¯STWçš„è¿‡ç¨‹æœ‰æ˜æ˜¾çš„èµ„æºæµªè´¹ï¼Œå¯¹æ‰€æœ‰çš„ç”¨æˆ·ç¨‹åºéƒ½æœ‰å¾ˆå¤§å½±å“ã€‚å› æ­¤Goçš„æ–¹æ³•æ˜¯ä½¿ç”¨æ’å…¥å±éšœå’Œåˆ é™¤å±éšœ</p>
<h2 id="å±éšœæœºåˆ¶"><a class="markdownIt-Anchor" href="#å±éšœæœºåˆ¶"></a> å±éšœæœºåˆ¶</h2>
<h3 id="å¼º-å¼±ä¸‰è‰²ä¸ç­‰å¼"><a class="markdownIt-Anchor" href="#å¼º-å¼±ä¸‰è‰²ä¸ç­‰å¼"></a> â€å¼º-å¼±â€œä¸‰è‰²ä¸ç­‰å¼</h3>
<ol>
<li>å¼ºä¸‰è‰²ä¸ç­‰å¼</li>
</ol>
<blockquote>
<p>ä¸å­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨åˆ°ç™½è‰²å¯¹è±¡çš„æŒ‡é’ˆ<br />
å¼ºä¸‰è‰²ä¸å˜è‰²å®é™…ä¸Šæ˜¯å¼ºåˆ¶æ€§çš„ä¸å…è®¸é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°æœ‰ç™½è‰²å¯¹è±¡è¢«è¯¯åˆ çš„æƒ…å†µ</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/strong-tri.png" alt="å¼ºä¸‰è‰²ä¸ç­‰å¼" /></p>
<ol start="2">
<li>å¼±ä¸‰è‰²ä¸ç­‰å¼</li>
</ol>
<blockquote>
<p>æ‰€æœ‰è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨çš„ç™½è‰²å¯¹è±¡éƒ½å¤„äºç°è‰²ä¿æŠ¤çŠ¶æ€<br />
å¼±ä¸‰è‰²ä¸å˜å¼å¼ºè°ƒï¼Œé»‘è‰²å¯¹è±¡å¯ä»¥å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªç™½è‰²å¯¹è±¡å¿…é¡»å­˜åœ¨å…¶ä»–ç°è‰²å¯¹è±¡å¯¹å®ƒçš„å¼•ç”¨ï¼Œæˆ–è€…å¯è¾¾å®ƒçš„é“¾è·¯ä¸Šæ¸¸å­˜åœ¨ç°è‰²å¯¹è±¡ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/weak-tri.png" alt="å¼±ä¸‰è‰²ä¸ç­‰å¼" /></p>
<h3 id="æ’å…¥å±éšœ"><a class="markdownIt-Anchor" href="#æ’å…¥å±éšœ"></a> æ’å…¥å±éšœ</h3>
<p><strong>å…·ä½“æ“ä½œï¼š</strong> åœ¨Aå¯¹è±¡å¼•ç”¨Bå¯¹è±¡çš„æ—¶å€™ï¼ŒBå¯¹è±¡è¢«æ ‡è®°ä¸ºç°è‰²ã€‚(å°†BæŒ‚åœ¨Aä¸‹æ¸¸ï¼ŒBå¿…é¡»è¢«æ ‡è®°ä¸ºç°è‰²)</p>
<p><strong>æ»¡è¶³ï¼š</strong> å¼ºä¸‰è‰²ä¸å˜å¼. (ä¸å­˜åœ¨é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡çš„æƒ…å†µäº†ï¼Œ å› ä¸ºç™½è‰²ä¼šå¼ºåˆ¶å˜æˆç°è‰²)</p>
<blockquote>
<p>è‰²å¯¹è±¡çš„å†…å­˜æ§½æœ‰ä¸¤ç§ä½ç½®, æ ˆå’Œå †. æ ˆç©ºé—´çš„ç‰¹ç‚¹æ˜¯å®¹é‡å°,ä½†æ˜¯è¦æ±‚ç›¸åº”é€Ÿåº¦å¿«,å› ä¸ºå‡½æ•°è°ƒç”¨å¼¹å‡ºé¢‘ç¹ä½¿ç”¨, æ‰€ä»¥â€œæ’å…¥å±éšœâ€æœºåˆ¶,åœ¨æ ˆç©ºé—´çš„å¯¹è±¡æ“ä½œä¸­ä¸ä½¿ç”¨. è€Œä»…ä»…ä½¿ç”¨åœ¨å †ç©ºé—´å¯¹è±¡çš„æ“ä½œä¸­<br />
å¯¹äºæ ˆçš„éƒ¨åˆ†ä½¿ç”¨STWä¿æŠ¤</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/insert.jpg" alt="æ’å…¥å±éšœ" /></p>
<h3 id="åˆ é™¤å±éšœ"><a class="markdownIt-Anchor" href="#åˆ é™¤å±éšœ"></a> åˆ é™¤å±éšœ</h3>
<p><strong>å…·ä½“æ“ä½œ:</strong> è¢«åˆ é™¤çš„å¯¹è±¡ï¼Œå¦‚æœè‡ªèº«ä¸ºç°è‰²æˆ–è€…ç™½è‰²ï¼Œé‚£ä¹ˆè¢«æ ‡è®°ä¸ºç°è‰²ã€‚</p>
<p><strong>æ»¡è¶³:</strong> å¼±ä¸‰è‰²ä¸å˜å¼. (ä¿æŠ¤ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„è·¯å¾„ä¸ä¼šæ–­)</p>
<blockquote>
<p>è¿™ç§æ–¹å¼çš„å›æ”¶ç²¾åº¦ä½ï¼Œä¸€ä¸ªå¯¹è±¡å³ä½¿è¢«åˆ é™¤äº†æœ€åä¸€ä¸ªæŒ‡å‘å®ƒçš„æŒ‡é’ˆä¹Ÿä¾æ—§å¯ä»¥æ´»è¿‡è¿™ä¸€è½®ï¼Œåœ¨ä¸‹ä¸€è½®GCä¸­è¢«æ¸…ç†æ‰ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.10/delete.jpg" alt="åˆ é™¤å±éšœ" /></p>
<h1 id="go-v18-æ··åˆå†™å±éšœhybrid-write-barrieræœºåˆ¶"><a class="markdownIt-Anchor" href="#go-v18-æ··åˆå†™å±éšœhybrid-write-barrieræœºåˆ¶"></a> GO v1.8 æ··åˆå†™å±éšœ(hybrid write barrier)æœºåˆ¶</h1>
<h2 id="æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„ç¼ºç‚¹"></a> æ’å…¥å†™å±éšœå’Œåˆ é™¤å†™å±éšœçš„ç¼ºç‚¹</h2>
<ul>
<li>æ’å…¥å†™å±éšœï¼šç»“æŸæ—¶éœ€è¦STWæ¥é‡æ–°æ‰«ææ ˆï¼Œæ ‡è®°æ ˆä¸Šå¼•ç”¨çš„ç™½è‰²å¯¹è±¡çš„å­˜æ´»ï¼›</li>
<li>åˆ é™¤å†™å±éšœï¼šå›æ”¶ç²¾åº¦ä½ï¼ŒGCå¼€å§‹æ—¶STWæ‰«æå †æ ˆæ¥è®°å½•åˆå§‹å¿«ç…§ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šä¿æŠ¤å¼€å§‹æ—¶åˆ»çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚</li>
</ul>
<p>Go V1.8ç‰ˆæœ¬å¼•å…¥äº†æ··åˆå†™å±éšœæœºåˆ¶ï¼ˆhybrid write barrierï¼‰ï¼Œé¿å…äº†å¯¹æ ˆre-scançš„è¿‡ç¨‹ï¼Œæå¤§çš„å‡å°‘äº†STWçš„æ—¶é—´ã€‚ç»“åˆäº†ä¸¤è€…çš„ä¼˜ç‚¹ã€‚</p>
<h2 id="æ··åˆå†™å±éšœ"><a class="markdownIt-Anchor" href="#æ··åˆå†™å±éšœ"></a> æ··åˆå†™å±éšœ</h2>
<p><strong>å…·ä½“æ“ä½œï¼š</strong></p>
<ol>
<li>GCå¼€å§‹å°†æ ˆä¸Šçš„å¯¹è±¡å…¨éƒ¨æ‰«æå¹¶æ ‡è®°ä¸ºé»‘è‰²(ä¹‹åä¸å†è¿›è¡Œç¬¬äºŒæ¬¡é‡å¤æ‰«æï¼Œæ— éœ€STW)ï¼Œ</li>
<li>GCæœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šåˆ›å»ºçš„æ–°å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²ã€‚</li>
<li>è¢«åˆ é™¤çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚</li>
<li>è¢«æ·»åŠ çš„å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ã€‚</li>
</ol>
<blockquote>
<p>éœ€è¦æ³¨æ„å±éšœæŠ€æœ¯æ˜¯ä¸åœ¨æ ˆä¸Šåº”ç”¨çš„ï¼Œå› ä¸ºè¦ä¿è¯æ ˆçš„è¿è¡Œæ•ˆç‡<br />
æ··åˆå†™å±éšœæ˜¯GCçš„ä¸€ç§å±éšœæœºåˆ¶ï¼Œæ‰€ä»¥åªæ˜¯å½“ç¨‹åºæ‰§è¡ŒGCçš„æ—¶å€™ï¼Œæ‰ä¼šè§¦å‘è¿™ç§æœºåˆ¶ã€‚</p>
</blockquote>
<p>Golangä¸­çš„æ··åˆå†™å±éšœæ»¡è¶³å¼±ä¸‰è‰²ä¸å˜å¼ï¼Œç»“åˆäº†åˆ é™¤å†™å±éšœå’Œæ’å…¥å†™å±éšœçš„ä¼˜ç‚¹ï¼Œåªéœ€è¦åœ¨å¼€å§‹æ—¶å¹¶å‘æ‰«æå„ä¸ªgoroutineçš„æ ˆï¼Œä½¿å…¶å˜é»‘å¹¶ä¸€ç›´ä¿æŒï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦STWï¼Œè€Œæ ‡è®°ç»“æŸåï¼Œå› ä¸ºæ ˆåœ¨æ‰«æåå§‹ç»ˆæ˜¯é»‘è‰²çš„ï¼Œä¹Ÿæ— éœ€å†è¿›è¡Œre-scanæ“ä½œäº†ï¼Œå‡å°‘äº†STWçš„æ—¶é—´</p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>GoV1.3- æ™®é€šæ ‡è®°æ¸…é™¤æ³•ï¼Œæ•´ä½“è¿‡ç¨‹éœ€è¦å¯åŠ¨STWï¼Œæ•ˆç‡æä½ã€‚</p>
<p>GoV1.5- ä¸‰è‰²æ ‡è®°æ³•ï¼Œ å †ç©ºé—´å¯åŠ¨å†™å±éšœï¼Œæ ˆç©ºé—´ä¸å¯åŠ¨ï¼Œå…¨éƒ¨æ‰«æä¹‹åï¼Œéœ€è¦é‡æ–°æ‰«æä¸€æ¬¡æ ˆ(éœ€è¦STW)ï¼Œæ•ˆç‡æ™®é€š</p>
<p>GoV1.8-ä¸‰è‰²æ ‡è®°æ³•ï¼Œæ··åˆå†™å±éšœæœºåˆ¶ï¼Œ æ ˆç©ºé—´ä¸å¯åŠ¨ï¼Œå †ç©ºé—´å¯åŠ¨ã€‚æ•´ä¸ªè¿‡ç¨‹å‡ ä¹ä¸éœ€è¦STWï¼Œæ•ˆç‡è¾ƒé«˜ã€‚</p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://www.yuque.com/aceld/golang/zhzanb#2a81bdfb">Golangä¸‰è‰²æ ‡è®°æ··åˆå†™å±éšœGCæ¨¡å¼å…¨åˆ†æ</a></p>
<p><a href="https://www.jianshu.com/p/4c5a303af470">[å…¸è—ç‰ˆ]Golangä¸‰è‰²æ ‡è®°ã€æ··åˆå†™å±éšœGCæ¨¡å¼å›¾æ–‡å…¨åˆ†æ</a></p>
]]></content>
      <categories>
        <category>é¢ç»</category>
      </categories>
      <tags>
        <tag>é¢ç»</tag>
        <tag>golang</tag>
        <tag>gc</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaåƒåœ¾å›æ”¶</title>
    <url>/2022/10/21/java-gc/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€ŠGolden Marriageã€‹</p>
</blockquote>
<h1 id="åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶"><a class="markdownIt-Anchor" href="#åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶"></a> åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯ä»¥å›æ”¶</h1>
<h2 id="å¼•ç”¨è®¡æ•°ç®—æ³•reference-counting-collector"><a class="markdownIt-Anchor" href="#å¼•ç”¨è®¡æ•°ç®—æ³•reference-counting-collector"></a> å¼•ç”¨è®¡æ•°ç®—æ³•(Reference Counting Collector)</h2>
<blockquote>
<p>é€šè¿‡åœ¨å¯¹è±¡å¤´ä¸­åˆ†é…ä¸€ä¸ªç©ºé—´æ¥ä¿å­˜è¯¥å¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼ˆReference Countï¼‰ã€‚å¦‚æœè¯¥å¯¹è±¡è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨ï¼Œåˆ™å®ƒçš„å¼•ç”¨è®¡æ•°åŠ  1ï¼Œå¦‚æœåˆ é™¤å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒçš„å¼•ç”¨è®¡æ•°å°±å‡ 1ï¼Œå½“è¯¥å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±ä¼šè¢«å›æ”¶</p>
</blockquote>
<ul>
<li>ä¼˜ç‚¹ï¼šå¼•ç”¨è®¡æ•°æ”¶é›†å™¨æ‰§è¡Œç®€å•ï¼Œåˆ¤å®šæ•ˆç‡é«˜ï¼Œäº¤ç»‡åœ¨ç¨‹åºè¿è¡Œä¸­ã€‚å¯¹ç¨‹åºä¸è¢«é•¿æ—¶é—´æ‰“æ–­çš„å®æ—¶ç¯å¢ƒæ¯”è¾ƒæœ‰åˆ©ã€‚</li>
<li>ç¼ºç‚¹ï¼š éš¾ä»¥æ£€æµ‹å‡ºå¯¹è±¡ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ã€‚åŒæ—¶ï¼Œå¼•ç”¨è®¡æ•°å™¨å¢åŠ äº†ç¨‹åºæ‰§è¡Œçš„å¼€é”€ã€‚æ‰€ä»¥Javaè¯­è¨€å¹¶æ²¡æœ‰é€‰æ‹©è¿™ç§ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨çš„ä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨å¼•ç”¨è®¡æ•°æ³•å¯¼è‡´ä¸¤ä¸ªå¯¹è±¡è™½ç„¶è¢«è®¾ç½®ä¸ºnullä½†æ˜¯å„è‡ªå¼•ç”¨å¯¹æ–¹å¯¼è‡´å¼•ç”¨è®¡æ•°å™¨æ— æ³•è¢«è®¾ç½®0ï¼Œä»è€Œå¯¼è‡´æ— æ³•è¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReferenceCountingGC</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ReferenceCountingGC</span><span class="params">(String name)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testGC</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">ReferenceCountingGC</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceCountingGC</span>(<span class="string">&quot;objA&quot;</span>);</span><br><span class="line">    <span class="type">ReferenceCountingGC</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceCountingGC</span>(<span class="string">&quot;objB&quot;</span>);</span><br><span class="line"></span><br><span class="line">    a.instance = b;</span><br><span class="line">    b.instance = a;</span><br><span class="line"></span><br><span class="line">    a = <span class="literal">null</span>;</span><br><span class="line">    b = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/cycle-reference.png" alt="å¾ªç¯å¼•ç”¨" /></p>
<h2 id="å¯è¾¾æ€§åˆ†æç®—æ³•reachability-analysis"><a class="markdownIt-Anchor" href="#å¯è¾¾æ€§åˆ†æç®—æ³•reachability-analysis"></a> å¯è¾¾æ€§åˆ†æç®—æ³•(Reachability Analysis)</h2>
<blockquote>
<p>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆReachability Analysisï¼‰çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œé€šè¿‡ä¸€äº›è¢«ç§°ä¸ºå¼•ç”¨é“¾ï¼ˆGC Rootsï¼‰çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡çš„è·¯å¾„è¢«ç§°ä¸ºï¼ˆReference Chain)ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼ˆå³ä» GC Roots èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹ä¸å¯è¾¾ï¼‰ï¼Œåˆ™è¯æ˜è¯¥å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/reachability-analysis.png" alt="å¯è¾¾æ€§åˆ†æ" /></p>
<p>å¯ä»¥ä½œä¸ºGC ROOTçš„å¯¹è±¡</p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆå³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li>
<li>JVM å†…éƒ¨çš„å¼•ç”¨</li>
<li>æ‰€æœ‰è¢«åŒæ­¥é”ï¼ˆsynchronized å…³é”®å­—ï¼‰æŒæœ‰çš„å¯¹è±¡<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-root.png" alt="GC ROOT" /></li>
</ul>
<h3 id="è™šæ‹Ÿæœºæ ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡"><a class="markdownIt-Anchor" href="#è™šæ‹Ÿæœºæ ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ä¸­å¼•ç”¨çš„å¯¹è±¡"></a> è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡</h3>
<p>æ­¤æ—¶çš„ sï¼Œå³ä¸º GC Rootï¼Œå½“ s ç½®ç©ºæ—¶ï¼ŒlocalParameter å¯¹è±¡ä¹Ÿæ–­æ‰äº†ä¸ GC Root çš„å¼•ç”¨é“¾ï¼Œå°†è¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StackLocalParameter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StackLocalParameter</span><span class="params">(String name)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testGC</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">StackLocalParameter</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StackLocalParameter</span>(<span class="string">&quot;localParameter&quot;</span>);</span><br><span class="line">    s = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡"><a class="markdownIt-Anchor" href="#æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡"></a> æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</h3>
<p>s ä¸º GC Rootï¼Œs ç½®ä¸º nullï¼Œç»è¿‡ GC åï¼Œs æ‰€æŒ‡å‘çš„ properties å¯¹è±¡ç”±äºæ— æ³•ä¸ GC Root å»ºç«‹å…³ç³»è¢«å›æ”¶ã€‚è€Œ m ä½œä¸ºç±»çš„é™æ€å±æ€§ï¼Œä¹Ÿå±äº GC Rootï¼Œparameter å¯¹è±¡ä¾ç„¶ä¸ GC root å»ºç«‹ç€è¿æ¥ï¼Œæ‰€ä»¥æ­¤æ—¶ parameter å¯¹è±¡å¹¶ä¸ä¼šè¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaStaicProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MethodAreaStaicProperties m;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MethodAreaStaicProperties</span><span class="params">(String name)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testGC</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MethodAreaStaicProperties</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodAreaStaicProperties</span>(<span class="string">&quot;properties&quot;</span>);</span><br><span class="line">    s.m = <span class="keyword">new</span> <span class="title class_">MethodAreaStaicProperties</span>(<span class="string">&quot;parameter&quot;</span>);</span><br><span class="line">    s = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡"><a class="markdownIt-Anchor" href="#æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡"></a> æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</h3>
<p>m å³ä¸ºæ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨ï¼Œä¹Ÿä¸º GC Rootï¼Œs ç½®ä¸º null åï¼Œfinal å¯¹è±¡ä¹Ÿä¸ä¼šå› æ²¡æœ‰ä¸ GC Root å»ºç«‹è”ç³»è€Œè¢«å›æ”¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodAreaStaicProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">MethodAreaStaicProperties</span> <span class="variable">m</span> <span class="operator">=</span> MethodAreaStaicProperties(<span class="string">&quot;final&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MethodAreaStaicProperties</span><span class="params">(String name)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testGC</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">MethodAreaStaicProperties</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MethodAreaStaicProperties</span>(<span class="string">&quot;staticProperties&quot;</span>);</span><br><span class="line">    s = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æœ¬åœ°æ–¹æ³•æ ˆä¸­-jniå³ä¸€èˆ¬è¯´çš„-native-æ–¹æ³•å¼•ç”¨çš„å¯¹è±¡"><a class="markdownIt-Anchor" href="#æœ¬åœ°æ–¹æ³•æ ˆä¸­-jniå³ä¸€èˆ¬è¯´çš„-native-æ–¹æ³•å¼•ç”¨çš„å¯¹è±¡"></a> æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆå³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</h3>
<p>ä»»ä½• Native æ¥å£éƒ½ä¼šä½¿ç”¨æŸç§æœ¬åœ°æ–¹æ³•æ ˆï¼Œå®ç°çš„æœ¬åœ°æ–¹æ³•æ¥å£æ˜¯ä½¿ç”¨ C è¿æ¥æ¨¡å‹çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„æœ¬åœ°æ–¹æ³•æ ˆå°±æ˜¯ C æ ˆã€‚å½“çº¿ç¨‹è°ƒç”¨ Java æ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿæœºä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§å¹¶å‹å…¥ Java æ ˆã€‚ç„¶è€Œå½“å®ƒè°ƒç”¨çš„æ˜¯æœ¬åœ°æ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿæœºä¼šä¿æŒ Java æ ˆä¸å˜ï¼Œä¸å†åœ¨çº¿ç¨‹çš„ Java æ ˆä¸­å‹å…¥æ–°çš„å¸§ï¼Œè™šæ‹Ÿæœºåªæ˜¯ç®€å•åœ°åŠ¨æ€è¿æ¥å¹¶ç›´æ¥è°ƒç”¨æŒ‡å®šçš„æœ¬åœ°æ–¹æ³•ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/JNI.png" alt="GC ROOT" /></p>
<h1 id="å››ç§å¼•ç”¨çŠ¶æ€"><a class="markdownIt-Anchor" href="#å››ç§å¼•ç”¨çŠ¶æ€"></a> å››ç§å¼•ç”¨çŠ¶æ€</h1>
<ul>
<li>å¼ºå¼•ç”¨(StrongReference):æ™®é€šçš„å¼•ç”¨éƒ½æ˜¯å¼ºå¼•ç”¨.<strong>å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£åƒåœ¾å›æ”¶å™¨ä¸ä¼šå›æ”¶</strong></li>
<li>è½¯å¼•ç”¨(SoftReference): <strong>æè¿°æœ‰äº›è¿˜æœ‰ç”¨ä½†å¹¶éå¿…éœ€çš„å¯¹è±¡ã€‚åœ¨ç³»ç»Ÿå°†è¦å‘ç”Ÿå†…å­˜æº¢å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œå°†ä¼šæŠŠè¿™äº›å¯¹è±¡åˆ—è¿›å›æ”¶èŒƒå›´è¿›è¡ŒäºŒæ¬¡å›æ”¶ã€‚</strong> å¦‚æœè¿™æ¬¡å›æ”¶è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œæ‰ä¼šæŠ›å‡ºå†…å­˜æº¢å‡ºå¼‚å¸¸ã€‚Javaä¸­çš„ç±»SoftReferenceè¡¨ç¤ºè½¯å¼•ç”¨ã€‚</li>
<li>å¼±å¼•ç”¨(WeakReference): <strong>æè¿°éå¿…éœ€å¯¹è±¡ã€‚è¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶ä¹‹å‰ï¼Œåƒåœ¾æ”¶é›†å™¨å·¥ä½œä¹‹åï¼Œæ— è®ºå½“å‰å†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œéƒ½ä¼šå›æ”¶æ‰åªè¢«å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡ã€‚</strong> Javaä¸­çš„ç±»WeakReferenceè¡¨ç¤ºå¼±å¼•ç”¨ã€‚</li>
<li>è™šå¼•ç”¨(PhantomReference): <strong>è¿™ä¸ªå¼•ç”¨å­˜åœ¨çš„å”¯ä¸€ç›®çš„å°±æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡è¢«æ”¶é›†å™¨å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥ï¼Œè¢«è™šå¼•ç”¨å…³è”çš„å¯¹è±¡ï¼Œå’Œå…¶ç”Ÿå­˜æ—¶é—´å®Œå…¨æ²¡å…³ç³»ã€‚</strong> å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚Javaä¸­çš„ç±»PhantomReferenceè¡¨ç¤ºè™šå¼•ç”¨ã€‚è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ— ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</li>
</ul>
<h1 id="åƒåœ¾å›æ”¶ç®—æ³•"><a class="markdownIt-Anchor" href="#åƒåœ¾å›æ”¶ç®—æ³•"></a> åƒåœ¾å›æ”¶ç®—æ³•</h1>
<h2 id="æ ‡è®°-æ¸…é™¤æ³•mark-sweep"><a class="markdownIt-Anchor" href="#æ ‡è®°-æ¸…é™¤æ³•mark-sweep"></a> æ ‡è®°-æ¸…é™¤æ³•(Mark-Sweep)</h2>
<blockquote>
<p>å…ˆé‡‡ç”¨æ ‡è®°ç¡®å®šå¯å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åå†æ ¹æ®æ ‡è®°æ¸…é™¤å†…å®¹</p>
</blockquote>
<ul>
<li>ä¼˜ç‚¹:é€Ÿåº¦å¿«ã€‚</li>
<li>ç¼ºç‚¹:å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡ï¼Œæ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/mark-sweep.jpg" alt="mark-sweep" /></li>
</ul>
<h2 id="å¤åˆ¶ç®—æ³•coping"><a class="markdownIt-Anchor" href="#å¤åˆ¶ç®—æ³•coping"></a> å¤åˆ¶ç®—æ³•(Coping)</h2>
<blockquote>
<p>å°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼Œæ¯ä¸€æ¬¡åªä½¿ç”¨ä¸€å—åŒºåŸŸã€‚å½“è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå°†ä¸è¢«å›æ”¶çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜åŒºåŸŸï¼Œæ¸…æ‰«å½“å‰åŒºåŸŸ</p>
</blockquote>
<ul>
<li>ä¼˜ç‚¹:ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</li>
<li>ç¼ºç‚¹:å ç”¨åŒå€å†…å­˜ï¼Œå¯ç”¨å†…å­˜å‡åŠ<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/copying.jpg" alt="copying" /></li>
</ul>
<h2 id="æ ‡è®°-æ•´ç†æ³•mark-compact"><a class="markdownIt-Anchor" href="#æ ‡è®°-æ•´ç†æ³•mark-compact"></a> æ ‡è®°-æ•´ç†æ³•(Mark-Compact)</h2>
<blockquote>
<p>å…ˆè¿›è¡Œæ ‡è®°ï¼Œå°†ä¸è¢«å›æ”¶çš„å†…å­˜ç©ºé—´è¿›è¡Œç§»åŠ¨æ’åºã€‚</p>
</blockquote>
<ul>
<li>ä¼˜ç‚¹:ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚</li>
<li>ç¼ºç‚¹:æ•ˆç‡ä½ï¼Œè¦è¿›è¡Œå†…å­˜çš„ç§»åŠ¨ï¼Œä¸”è¦è¿›è¡Œç¨‹åºå†…å­˜åœ°å€çš„æ”¹å˜ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/mark-compact.jpg" alt="mark-compact" /></li>
</ul>
<h2 id="åˆ†ä»£æ”¶é›†ç®—æ³•generational-collection"><a class="markdownIt-Anchor" href="#åˆ†ä»£æ”¶é›†ç®—æ³•generational-collection"></a> åˆ†ä»£æ”¶é›†ç®—æ³•(Generational Collection)</h2>
<blockquote>
<p>å°†å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£<br />
æ–°ç”Ÿä»£ä¸è€å¹´ä»£åŒºåŸŸçš„æ¯”ä¸º1ï¼š2<br />
æ–°ç”Ÿä»£åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸåˆ†åˆ«æ˜¯Edenã€S0ã€S1ï¼Œä»–ä»¬çš„æ¯”ä¾‹æ˜¯8ï¼š1ï¼š1</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¦åˆ†ä»£æ”¶é›†å‘¢ï¼Œè¿™æ˜¯å› ä¸ºåœ¨JVMä¸­ä½¿ç”¨æ ‡è®°æ•´ç†æ³•æ•ˆç‡è¾ƒä½ï¼Œè€Œæ ¹æ®åˆ†æå¤§å¤šæ•°æ—¶å€™è®¸å¤šå¯¹è±¡çš„å­˜æ´»çš„æ—¶é—´è¾ƒå°‘<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/why-generational.gif" alt="" /></p>
<p>JVMè™šæ‹Ÿæœºçš„å †ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/jvm-heap.png" alt="jvm heap" /></p>
<ul>
<li>æ–°ç”Ÿä»£:æ–°åˆ†é…å†…å­˜çš„å¯¹è±¡ï¼Œå½“å¹´è½»ä»£æ»¡äº†ä¼šå¼•èµ·minor gcï¼Œminor gcå‘ç”Ÿçš„æ¯”è¾ƒé¢‘ç¹</li>
<li>STOP THE WORLD EVENT(STW): æ‰€æœ‰çš„minor gcéƒ½æ˜¯STOP THE WORLD EVENTï¼Œæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹éƒ½ä¼šåœæ­¢ç›´åˆ°æ“ä½œå®Œæˆ</li>
<li>è€å¹´ä»£:è€å¹´ä»£å­˜ä¸€äº›é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œå½“è€å¹´ä»£éœ€è¦è¢«åƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šè§¦å‘major gcäº‹ä»¶</li>
<li>æ°¸ä¹…ä»£: å­˜æ”¾JVMè¶…å‚æ•°ï¼Œclasseså’Œmethodç­‰</li>
</ul>
<h3 id="ç®—æ³•æµç¨‹"><a class="markdownIt-Anchor" href="#ç®—æ³•æµç¨‹"></a> ç®—æ³•æµç¨‹</h3>
<ol>
<li>æ‰€æœ‰æ–°å¯¹è±¡è¢«åˆ†é…çš„æ—¶å€™éƒ½æ”¾å…¥edenåŒºï¼Œä¸¤ä¸ªsurvivoråŒºåœ¨å¼€å§‹çš„æ—¶å€™éƒ½ä¸ºç©º<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step1.png" alt="step 1" /></li>
<li>å½“edenåŒºæ»¡çš„æ—¶å€™è§¦å‘ä¸€æ¬¡minor gc<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step2.png" alt="step 2" /></li>
<li>ä»ç„¶æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡æ”¾å…¥ç¬¬ä¸€ä¸ªsurvivoråŒºS0ï¼ŒedenåŒºå†…æ— è¢«å¼•ç”¨çš„å¯¹è±¡è¢«æ¸…ç©º<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step3.png" alt="step 3" /></li>
<li>ä¸‹ä¸€æ¬¡minor gcæ—¶ï¼ŒedenåŒºåšæ³•ç›¸åŒï¼Œä½†æ˜¯æ­¤æ—¶ä»ç„¶æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡ç§»åŠ¨åˆ°ç¬¬äºŒä¸ªsurvivoråŒºS1ï¼Œæ­¤å¤–S0å†…æ— è¢«å¼•ç”¨çš„å¯¹è±¡åˆ é™¤ï¼Œä»æœ‰è¢«å¼•ç”¨çš„å¯¹è±¡æ”¾åˆ°S1åŒºã€‚æ­¤æ—¶S0å’ŒedenåŒºéƒ½æ˜¯ç©ºçš„ï¼ŒS1åŒºä¸­çš„ä¸€äº›å¯¹è±¡æœ‰ä¸åŒçš„å¹´é¾„(age)<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step4.png" alt="step 4" /></li>
<li>ä¸‹ä¸€æ¬¡minor gcæ—¶ï¼Œé‡å¤åŒæ ·çš„æ“ä½œï¼Œä¸è¿‡æ­¤æ—¶äº’æ¢ä¸¤ä¸ªsurvivoråŒºï¼Œè¢«å¼•ç”¨çš„å¯¹è±¡ç§»åŠ¨åŒºåŸŸåŒæ—¶å¢åŠ å¹´é¾„<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step5.png" alt="step 5" /></li>
<li>åœ¨å¤šæ¬¡minor gcåï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„å¹´é¾„åˆ°è¾¾é˜ˆå€¼(å‡è®¾æ˜¯8)ï¼Œæ­¤æ—¶å°†è¿™ä¸ªå¯¹è±¡ä»å¹´è½»ä»£ç§»åŠ¨åˆ°è€å¹´ä»£<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step6.png" alt="step 6" /></li>
<li>minor gcä¼šæŠŠä¸€äº›å¯¹è±¡æ”¾åˆ°è€å¹´ä»£çš„åŒºåŸŸ<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step7.png" alt="step 7" /></li>
<li>è€å¹´ä»£å¿«æ»¡çš„æ—¶å€™ä¼šå‘èµ·major gcï¼Œå¯¹è€å¹´ä»£è¿›è¡Œæ¸…ç†å¹¶é‡ç»„ã€‚è€å¹´ä»£ä½¿ç”¨çš„æ˜¯æ ‡è®°é‡ç»„æ³•<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.8/gc-step8.png" alt="step 8" /></li>
</ol>
<h2 id="è€å¹´ä»£"><a class="markdownIt-Anchor" href="#è€å¹´ä»£"></a> è€å¹´ä»£</h2>
<p>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šè¿›å…¥è€å¹´ä»£</p>
<h3 id="å¤§å¯¹è±¡"><a class="markdownIt-Anchor" href="#å¤§å¯¹è±¡"></a> å¤§å¯¹è±¡</h3>
<p>å¤§å¯¹è±¡æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œå³ä½¿edenä¸ºç©ºä¹Ÿä¼šè¿›å…¥è€å¹´ä»£ï¼Œè¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†é¿å…åœ¨EdenåŒºåŠ2ä¸ªSurvivoråŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜å¤åˆ¶ã€‚</p>
<h3 id="é•¿æœŸå­˜æ´»å¯¹è±¡"><a class="markdownIt-Anchor" href="#é•¿æœŸå­˜æ´»å¯¹è±¡"></a> é•¿æœŸå­˜æ´»å¯¹è±¡</h3>
<p>å¯¹è±¡åœ¨Eden,SurvivoråŒºä¸­æ¯ç»å†ä¸€æ¬¡Minor GCï¼Œå¹´é¾„å°±å¢åŠ 1å²ã€‚å½“å¹´é¾„å¢åŠ åˆ°15å²æ—¶ï¼Œè¿™æ—¶å€™å°±ä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ã€‚è¿™é‡Œçš„15å¯ä»¥è°ƒæ•´ã€‚ï¼ˆMarked Wordé‡Œé¢æœ‰ä¸€ä¸ªå­—æ®µå­˜å‚¨ageï¼Œä¸º4ä½ï¼‰</p>
<h3 id="åŠ¨æ€å¯¹è±¡å¹´é¾„"><a class="markdownIt-Anchor" href="#åŠ¨æ€å¯¹è±¡å¹´é¾„"></a> åŠ¨æ€å¯¹è±¡å¹´é¾„</h3>
<p>å¦‚æœSurvivorç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»åˆå¤§äºSurvivorç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å°±å¯ä»¥ç›´æ¥è¿›å»è€å¹´åŒºï¼Œæ— éœ€ç­‰ä½ â€œæˆå¹´â€ã€‚</p>
<h1 id="åƒåœ¾å›æ”¶å™¨"><a class="markdownIt-Anchor" href="#åƒåœ¾å›æ”¶å™¨"></a> åƒåœ¾å›æ”¶å™¨</h1>
<p>åƒåœ¾å›æ”¶å™¨ç±»å‹</p>
<ul>
<li>Serial Garbage Collector</li>
<li>Parallel Garbage Collector</li>
<li>CMS Garbage Collector</li>
<li>G1 Garbage Collector</li>
<li>Z Garbage Collector</li>
</ul>
<h2 id="ä¸²è¡Œåƒåœ¾å›æ”¶å™¨serial-garbage-collector"><a class="markdownIt-Anchor" href="#ä¸²è¡Œåƒåœ¾å›æ”¶å™¨serial-garbage-collector"></a> ä¸²è¡Œåƒåœ¾å›æ”¶å™¨(Serial Garbage Collector)</h2>
<ul>
<li>å•çº¿ç¨‹ï¼Œé‡‡ç”¨å¤åˆ¶ç®—æ³•ã€‚</li>
<li>æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆSTWï¼‰ï¼Œå¹¶é‡‡ç”¨å•ç‹¬çš„çš„çº¿ç¨‹è¿›è¡Œ GC</li>
<li>é€‚ç”¨äºå• CPUã€å¹¶ä¸”å¯¹åº”ç”¨ç¨‹åºçš„æš‚åœæ—¶é—´è¦æ±‚ä¸é«˜çš„æƒ…å†µï¼Œæ‰€ä»¥ä¸å¤ªé€‚åˆå½“å‰çš„ç”Ÿäº§ç¯å¢ƒã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -XX:+UseSerialGC -jar Application.java</span><br></pre></td></tr></table></figure>
<h2 id="å¹¶è¡Œåƒåœ¾å›æ”¶å™¨parallel-garbage-collector"><a class="markdownIt-Anchor" href="#å¹¶è¡Œåƒåœ¾å›æ”¶å™¨parallel-garbage-collector"></a> å¹¶è¡Œåƒåœ¾å›æ”¶å™¨(Parallel Garbage Collector)</h2>
<ul>
<li>å¤šçº¿ç¨‹</li>
<li>ç›¸è¾ƒäºä¸²è¡Œåƒåœ¾å›æ”¶å™¨è€Œè¨€æ€§èƒ½ç¨æœ‰æå‡ï¼Œå®ƒä¹Ÿæ˜¯éœ€è¦STW</li>
<li>å¹¶è¡Œåƒåœ¾å›æ”¶å™¨é€‚ç”¨äºå¤šCPUçš„æœåŠ¡å™¨ã€å¹¶ä¸”èƒ½æ¥å—çŸ­æš‚çš„åº”ç”¨æš‚åœçš„ç¨‹åºã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -XX:+UseParallelGC -jar Application.java</span><br></pre></td></tr></table></figure>
<h2 id="cmsæ”¶é›†å™¨"><a class="markdownIt-Anchor" href="#cmsæ”¶é›†å™¨"></a> CMSæ”¶é›†å™¨</h2>
<blockquote>
<p>ä¸€ç§ä»¥è·å–æœ€çŸ­å“åº”æ—¶é—´ä¸ºç›®æ ‡çš„è€å¹´ä»£æ”¶é›†å™¨ã€‚CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„</p>
</blockquote>
<ul>
<li>ç‰¹ç‚¹</li>
</ul>
<p>åŸºäºæ ‡è®°-æ¸…é™¤ç®—æ³•å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p>
<ul>
<li>åº”ç”¨åœºæ™¯</li>
</ul>
<p>é€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚webç¨‹åºã€b/sæœåŠ¡ã€‚</p>
<ul>
<li>è¿è¡Œè¿‡ç¨‹
<ul>
<li>åˆå§‹æ ‡è®°ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯ä»å­˜åœ¨Stop The Worldé—®é¢˜</li>
<li>å¹¶å‘æ ‡è®°ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ä¸”ç”¨æˆ·çº¿ç¨‹å¯å¹¶å‘æ‰§è¡Œ</li>
<li>é‡æ–°æ ‡è®°ï¼šä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨Stop The Worldé—®é¢˜</li>
<li>å¹¶å‘æ¸…é™¤ï¼šå¯¹æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å›æ”¶ï¼ˆæ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># java9æ ‡ä¸ºdeprecad java14è¢«å®Œå…¨åˆ é™¤ </span></span><br><span class="line">java -XX:+UseConcMarkSweepGC -jar Application.java</span><br></pre></td></tr></table></figure>
<h2 id="g1æ”¶é›†å™¨garbage-first-garbage-collector"><a class="markdownIt-Anchor" href="#g1æ”¶é›†å™¨garbage-first-garbage-collector"></a> G1æ”¶é›†å™¨(Garbage First Garbage Collector)</h2>
<blockquote>
<p>jdk1.7ä»¥åæ‰å¼•å…¥ï¼Œæ›¿ä»£äº†CMS<br />
G1å¹¶æ²¡æœ‰å°†å†…å­˜è¿›è¡Œç‰©ç†åˆ’åˆ†ï¼Œå®ƒåªæ˜¯å°†å †å†…å­˜åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ªç­‰å¤§çš„Region</p>
</blockquote>
<ul>
<li>é€‚ç”¨åœºæ™¯
<ul>
<li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰</li>
<li>è¶…å¤§å †å†…å­˜ï¼ˆå†…å­˜å¤§çš„ï¼‰ï¼Œä¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼ˆRegionï¼‰ï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥ä½œä¸ºEdenã€Survivorã€Oldã€H</li>
<li>åŒºåŸŸå†…éƒ¨æ˜¯æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯å¤åˆ¶ç®—æ³•</li>
</ul>
</li>
<li>G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥)</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -XX:+UseG1GC -jar Application.java</span><br></pre></td></tr></table></figure>
<h2 id="zæ”¶é›†å™¨z-garbage-collectors"><a class="markdownIt-Anchor" href="#zæ”¶é›†å™¨z-garbage-collectors"></a> Zæ”¶é›†å™¨(Z Garbage Collectors)</h2>
<p>Zæ”¶é›†å™¨æ˜¯ä¸€ä¸ªä½å»¶æ—¶æ”¶é›†å™¨ï¼Œåœ¨java11ä¸­ä½œä¸ºå®éªŒæ€§è´¨å¼•å…¥</p>
<ul>
<li>åº”ç”¨çº¿ç¨‹åœæ­¢æ—¶é—´ä¸è¶…è¿‡10ms</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># java15ä»¥å‰</span></span><br><span class="line">java -XX:+UnlockExperimentalVMOptions -XX:+UseZGC Application.java</span><br><span class="line"><span class="comment"># java15ä»¥å</span></span><br><span class="line">java -XX:+UseZGC Application.java</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://www.oracle.com/webfolder/technetwork/tutorials/obe/java/gc01/index.html">Java Garbage Collection Basics</a></p>
<p><a href="https://www.infoq.cn/article/zoyqri4c-bfkmubmzmkn">å’±ä»¬ä»å¤´åˆ°å°¾è¯´ä¸€æ¬¡ Java åƒåœ¾å›æ”¶</a></p>
<p><a href="https://blog.csdn.net/u012988901/article/details/99317272">Javaå››ç§å¼•ç”¨ç±»å‹: å¼ºå¼•ç”¨ã€å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ã€è™šå¼•ç”¨</a></p>
<p><a href="https://bbs.huaweicloud.com/blogs/296981">ä¸‡å­—é•¿æ–‡ï¼æ·±å…¥è¯¦è§£Javaåƒåœ¾å›æ”¶ï¼ˆGCï¼‰æœºåˆ¶</a></p>
<p><a href="https://www.baeldung.com/jvm-garbage-collectors">JVM Garbage Collectors</a></p>
]]></content>
      <categories>
        <category>é¢ç»</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>é¢ç»</tag>
        <tag>gc</tag>
      </tags>
  </entry>
  <entry>
    <title>dubboå°è¯•</title>
    <url>/2022/11/20/dubbo-starter/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šgolden marriageã€‹</p>
</blockquote>
<h1 id="dubbo"><a class="markdownIt-Anchor" href="#dubbo"></a> dubbo</h1>
<p>Dubboæ˜¯é˜¿é‡Œå¼€å‘çš„ä¸€ä¸ªRPCæœåŠ¡æ¡†æ¶ï¼Œç”¨äºè§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹çš„æœåŠ¡æ²»ç†ä¸é€šä¿¡é—®é¢˜ã€‚åæ¥æçŒ®ç»™äº†Apacheï¼Œç°åœ¨æ˜¯Apache Dubboã€‚</p>
<h1 id="dubboæ¶æ„"><a class="markdownIt-Anchor" href="#dubboæ¶æ„"></a> dubboæ¶æ„</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.4.11/architecture.png" alt="" /></p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Provider</code></td>
<td>æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</td>
</tr>
<tr>
<td><code>Consumer</code></td>
<td>è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹</td>
</tr>
<tr>
<td><code>Registry</code></td>
<td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</td>
</tr>
<tr>
<td><code>Monitor</code></td>
<td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</td>
</tr>
<tr>
<td><code>Container</code></td>
<td>æœåŠ¡è¿è¡Œå®¹å™¨</td>
</tr>
</tbody>
</table>
<ol start="0">
<li>æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</li>
<li>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</li>
<li>æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</li>
</ol>
<h1 id="demoç»“æ„"><a class="markdownIt-Anchor" href="#demoç»“æ„"></a> demoç»“æ„</h1>
<p>åœ¨è¿™æ¬¡demoçš„ç»“æ„å¦‚ä¸‹ï¼Œé€šè¿‡<code>tree</code>å‘½ä»¤è¾“å‡ºå¦‚ä¸‹ã€‚å…¶ä¸­<code>dubbo-demo-api</code>æ˜¯æœåŠ¡æä¾›ç«¯å’Œæ¶ˆè´¹ç«¯å…¬ç”¨çš„apiï¼Œ<code>dubbo-demo-consumer</code>å’Œ<code>dubbo-demo-provider</code>åˆ†åˆ«æ˜¯æœåŠ¡çš„æ¶ˆè´¹ç«¯å’Œæä¾›ç«¯</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”‚  .gitignore</span><br><span class="line">â”‚  pom.xml</span><br><span class="line">â”œâ”€dubbo-demo-api</span><br><span class="line">â”‚  â”‚  pom.xml</span><br><span class="line">â”‚  â”‚</span><br><span class="line">â”‚  â””â”€src</span><br><span class="line">â”‚      â””â”€main</span><br><span class="line">â”‚          â””â”€java</span><br><span class="line">â”‚              â””â”€com</span><br><span class="line">â”‚                  â””â”€qxdn</span><br><span class="line">â”‚                      â””â”€demo</span><br><span class="line">â”‚                          â””â”€dubbo</span><br><span class="line">â”‚                              â””â”€api</span><br><span class="line">â”‚                                      HelloService.java</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€dubbo-demo-consumer</span><br><span class="line">â”‚  â”‚  pom.xml</span><br><span class="line">â”‚  â”‚</span><br><span class="line">â”‚  â””â”€src</span><br><span class="line">â”‚      â””â”€main</span><br><span class="line">â”‚          â”œâ”€java</span><br><span class="line">â”‚          â”‚  â””â”€com</span><br><span class="line">â”‚          â”‚      â””â”€qxdn</span><br><span class="line">â”‚          â”‚          â””â”€demo</span><br><span class="line">â”‚          â”‚              â””â”€dubbo</span><br><span class="line">â”‚          â”‚                  â””â”€consumer</span><br><span class="line">â”‚          â”‚                          ConsumerApplication.java</span><br><span class="line">â”‚          â”‚</span><br><span class="line">â”‚          â””â”€resources</span><br><span class="line">â”‚                  application.yml</span><br><span class="line">â”‚                  log4j.properties</span><br><span class="line">â”‚</span><br><span class="line">â””â”€dubbo-demo-provider</span><br><span class="line">    â”‚  pom.xml</span><br><span class="line">    â”‚</span><br><span class="line">    â””â”€src</span><br><span class="line">        â””â”€main</span><br><span class="line">            â”œâ”€java</span><br><span class="line">            â”‚  â””â”€com</span><br><span class="line">            â”‚      â””â”€qxdn</span><br><span class="line">            â”‚          â””â”€demo</span><br><span class="line">            â”‚              â””â”€dubbo</span><br><span class="line">            â”‚                  â””â”€provider</span><br><span class="line">            â”‚                          EmbeddedZooKeeper.java</span><br><span class="line">            â”‚                          HelloServiceImpl.java</span><br><span class="line">            â”‚                          ProviderApplication.java</span><br><span class="line">            â”‚</span><br><span class="line">            â””â”€resources</span><br><span class="line">                    application.yml</span><br><span class="line">                    log4j.properties</span><br></pre></td></tr></table></figure>
<h1 id="çˆ¶çº§pom"><a class="markdownIt-Anchor" href="#çˆ¶çº§pom"></a> çˆ¶çº§POM</h1>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qxdn.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.3.16.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>3.0.7<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">slf4j-log4j12.version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">slf4j-log4j12.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.7.5<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo-demo-api<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo-demo-provider<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>dubbo-demo-consumer<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Spring Boot --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-dependencies-zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;dubbo.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j-log4j12.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h1 id="æ¥å£"><a class="markdownIt-Anchor" href="#æ¥å£"></a> æ¥å£</h1>
<h2 id="pom"><a class="markdownIt-Anchor" href="#pom"></a> POM</h2>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qxdn.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>11<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skip_maven_deploy</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip_maven_deploy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ¥å£-2"><a class="markdownIt-Anchor" href="#æ¥å£-2"></a> æ¥å£</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// HelloService.java</span></span><br><span class="line"><span class="keyword">package</span> com.qxdn.demo.dubbo.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">sayHello</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> CompletableFuture&lt;String&gt; <span class="title function_">sayHelloAsync</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(sayHello(name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="æœåŠ¡æä¾›è€…"><a class="markdownIt-Anchor" href="#æœåŠ¡æä¾›è€…"></a> æœåŠ¡æä¾›è€…</h1>
<h2 id="pom-2"><a class="markdownIt-Anchor" href="#pom-2"></a> POM</h2>
<p>è¿™é‡Œä½¿ç”¨zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qxdn.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo-provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qxdn.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- dubbo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-dependencies-zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- dubbo starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®"><a class="markdownIt-Anchor" href="#é…ç½®"></a> é…ç½®</h2>
<h3 id="applicationyml"><a class="markdownIt-Anchor" href="#applicationyml"></a> application.yml</h3>
<p>æœåŠ¡æ³¨å†Œä¸­å¿ƒé€‰æ‹©è‡ªå·±çš„zookeeperçš„åœ°å€</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-demo-provider</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">zk-registry</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="attr">config-center:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="attr">metadata-report:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br></pre></td></tr></table></figure>
<h3 id="log4jproperties"><a class="markdownIt-Anchor" href="#log4jproperties"></a> log4j.properties</h3>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">###set log levels###</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">info, stdout</span></span><br><span class="line"><span class="comment">###output to the console###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">[%d&#123;dd/MM/yy HH:mm:ss:SSS z&#125;] %t %5p %c&#123;2&#125;: %m%n</span></span><br></pre></td></tr></table></figure>
<h2 id="provider"><a class="markdownIt-Anchor" href="#provider"></a> Provider</h2>
<h3 id="impl"><a class="markdownIt-Anchor" href="#impl"></a> Impl</h3>
<p>è¿™é‡Œå®ŒæˆRPCæœåŠ¡çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//HelloServiceImpl.java</span></span><br><span class="line"><span class="keyword">package</span> com.qxdn.demo.dubbo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qxdn.demo.dubbo.api.HelloService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboService;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.rpc.RpcContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DubboService</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">HelloService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;Hello &quot;</span> + name + <span class="string">&quot;, request from consumer: &quot;</span> + RpcContext.getServiceContext().getRemoteAddressString());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello &quot;</span> + name + <span class="string">&quot;from: &quot;</span>  + RpcContext.getServiceContext().getLocalAddressString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="zookeeper"><a class="markdownIt-Anchor" href="#zookeeper"></a> zookeeper</h3>
<p>zookeeperå¯ä»¥åˆ°apacheçš„å®˜ç½‘<a href="https://zookeeper.apache.org/releases.html">ä¸‹è½½</a></p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ«äººçš„embedzookeeper,æºç åœ¨<a href="https://github.com/spring-attic/spring-xd/blob/v1.3.1.RELEASE/spring-xd-dirt/src/main/java/org/springframework/xd/dirt/zookeeper/ZooKeeperUtils.java">github</a></p>
<h3 id="application"><a class="markdownIt-Anchor" href="#application"></a> Application</h3>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qxdn.demo.dubbo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">EmbeddedZooKeeper</span>(<span class="number">2181</span>, <span class="literal">false</span>).start();</span><br><span class="line"></span><br><span class="line">        SpringApplication.run(ProviderApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;dubbo service started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æœåŠ¡æ¶ˆè´¹è€…"><a class="markdownIt-Anchor" href="#æœåŠ¡æ¶ˆè´¹è€…"></a> æœåŠ¡æ¶ˆè´¹è€…</h1>
<h2 id="pom-3"><a class="markdownIt-Anchor" href="#pom-3"></a> POM</h2>
<p>è¿™é‡Œä½¿ç”¨zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒ</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qxdn.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo-consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.qxdn.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-demo-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- dubbo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-dependencies-zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- dubbo starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®-2"><a class="markdownIt-Anchor" href="#é…ç½®-2"></a> é…ç½®</h2>
<h3 id="applicationyml-2"><a class="markdownIt-Anchor" href="#applicationyml-2"></a> application.yml</h3>
<p>æœåŠ¡æ³¨å†Œä¸­å¿ƒé€‰æ‹©è‡ªå·±çš„zookeeperçš„åœ°å€</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-springboot-demo-consumer</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">zk-registry</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="attr">config-center:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="attr">metadata-report:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br></pre></td></tr></table></figure>
<h3 id="log4jproperties-2"><a class="markdownIt-Anchor" href="#log4jproperties-2"></a> log4j.properties</h3>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">###set log levels###</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">info, stdout</span></span><br><span class="line"><span class="comment">###output to the console###</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">[%d&#123;dd/MM/yy HH:mm:ss:SSS z&#125;] %t %5p %c&#123;2&#125;: %m%n</span></span><br></pre></td></tr></table></figure>
<h2 id="consumer"><a class="markdownIt-Anchor" href="#consumer"></a> Consumer</h2>
<p><code>@DubboReference</code>ä¸­çš„<code>loadbalance</code>æ˜¯è´Ÿè½½å‡å¾ˆçš„æ–¹æ¡ˆï¼Œè¿™é‡Œé€‰æ‹©éšæœºï¼Œæ­¤å¤–æ³¨è§£ä¹Ÿå¯ä»¥ä½¿ç”¨<code>version</code>è¿›è¡ŒæœåŠ¡çš„è¿‡æ»¤</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qxdn.demo.dubbo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qxdn.demo.dubbo.api.HelloService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.common.constants.LoadbalanceRules;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboReference;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference(loadbalance = LoadbalanceRules.RANDOM)</span></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(ConsumerApplication.class, args);</span><br><span class="line">        <span class="type">ConsumerApplication</span> <span class="variable">application</span> <span class="operator">=</span> context.getBean(ConsumerApplication.class);</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> application.doSayHello(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;result: &quot;</span> + result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doSayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> helloService.sayHello(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h1>
<h2 id="æœåŠ¡æä¾›è€…çš„è¾“å‡º"><a class="markdownIt-Anchor" href="#æœåŠ¡æä¾›è€…çš„è¾“å‡º"></a> æœåŠ¡æä¾›è€…çš„è¾“å‡º</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">[20/11/22 03:22:54:208 CST] NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181  INFO server.NIOServerCnxnFactory: Accepted socket connection from /127.0.0.1:51634</span><br><span class="line">[20/11/22 03:22:54:208 CST] NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181  INFO server.ZooKeeperServer: Client attempting to establish new session at /127.0.0.1:51634</span><br><span class="line">[20/11/22 03:22:54:209 CST] SyncThread:0  INFO server.ZooKeeperServer: Established session 0x1000cab1b92000a with negotiated timeout 60000 for client /127.0.0.1:51634</span><br><span class="line">[20/11/22 03:22:54:352 CST] NettyServerWorker-3-9  INFO netty4.NettyServerHandler:  [DUBBO] The connection of /192.168.31.35:51635 -&gt; /192.168.31.35:20880 is established., dubbo version: 3.0.7, current host: 192.168.31.35</span><br><span class="line">[20/11/22 03:22:54:455 CST] NettyServerWorker-3-9  INFO netty4.NettyServerHandler:  [DUBBO] The connection of /192.168.31.35:51635 -&gt; /192.168.31.35:20880 is disconnected., dubbo version: 3.0.7, current host: 192.168.31.35</span><br><span class="line">[20/11/22 03:22:54:493 CST] ProcessThread(sid:0 cport:2181):  INFO server.PrepRequestProcessor: Got user-level KeeperException when processing sessionid:0x1000cab1b92000a type:create cxid:0x3 zxid:0x4e txntype:-1 reqpath:n/a Error Path:/services/dubbo-demo-provider Error:KeeperErrorCode = NodeExists for /services/dubbo-demo-provider</span><br><span class="line">[20/11/22 03:22:55:081 CST] DubboServerHandler-192.168.31.35:20880-thread-25  INFO provider.HelloServiceImpl: Hello java, request from consumer: 192.168.31.35:51631</span><br><span class="line">[20/11/22 03:37:05:560 CST] Dubbo-framework-cache-refreshing-scheduler-thread-1  INFO metadata.AbstractCacheManager$CacheRefreshTask:  [DUBBO] Dumping mapping caches, latest entries 0, dubbo version: 3.0.7, current host: 192.168.31.35</span><br></pre></td></tr></table></figure>
<h2 id="æœåŠ¡æ¶ˆè´¹è€…çš„è¾“å‡º"><a class="markdownIt-Anchor" href="#æœåŠ¡æ¶ˆè´¹è€…çš„è¾“å‡º"></a> æœåŠ¡æ¶ˆè´¹è€…çš„è¾“å‡º</h2>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">2 03:22:54:588 CST] main  INFO metadata.MetadataInfo:  [DUBBO] metadata revision changed: null -&gt; 0ef9521ed22939bb2e1da2ea8012f84d, app: dubbo-springboot-demo-consumer, services: 1, dubbo version: 3.0.7, current host: 192.168.31.35</span><br><span class="line">[20/11/22 03:22:55:063 CST] main  INFO deploy.DefaultApplicationDeployer:  [DUBBO] Dubbo Application[1.1](dubbo-springboot-demo-consumer) is ready., dubbo version: 3.0.7, current host: 192.168.31.35</span><br><span class="line">[20/11/22 03:22:55:068 CST] main  INFO consumer.ConsumerApplication: Started ConsumerApplication in 3.234 seconds (JVM running for 4.244)</span><br><span class="line">[20/11/22 03:22:55:071 CST] pool-1-thread-1  INFO event.AwaitingNonWebApplicationListener:  [Dubbo] Current Spring Boot Application is await...</span><br><span class="line">[20/11/22 03:22:55:084 CST] main  INFO consumer.ConsumerApplication: result: Hello javafrom: 192.168.31.35:20880</span><br><span class="line">[20/11/22 03:32:53:388 CST] Dubbo-framework-cache-refreshing-scheduler-thread-1  INFO metadata.AbstractCacheManager$CacheRefreshTask:  [DUBBO] Dumping mapping caches, latest entries 1, dubbo version: 3.0.7, current host: 192.168.31.35</span><br><span class="line">[20/11/22 03:32:54:201 CST] Dubbo-framework-cache-refreshing-scheduler-thread-1  INFO metadata.AbstractCacheManager$CacheRefreshTask:  [DUBBO] Dumping meta caches, latest entries 1, dubbo version: 3.0.7, current host: 192.168.31.35</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ä¸¤è¾¹éƒ½æœ‰è°ƒç”¨ç»“æœçš„è¾“å‡º</p>
<h1 id="å¯èƒ½çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#å¯èƒ½çš„é—®é¢˜"></a> å¯èƒ½çš„é—®é¢˜</h1>
<h2 id="dependencymanagement"><a class="markdownIt-Anchor" href="#dependencymanagement"></a> <dependencyManagement/></h2>
<p>å¯åŠ¨ç¨‹åºæ—¶å€™å‡ºç°é—®é¢˜å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/springframework/core/metrics/ApplicationStartup</span><br><span class="line">	at org.springframework.boot.SpringApplication.&lt;init&gt;(SpringApplication.java:251)</span><br><span class="line">	at org.springframework.boot.SpringApplication.&lt;init&gt;(SpringApplication.java:264)</span><br><span class="line">	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1311)</span><br><span class="line">	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1300)</span><br><span class="line">	at com.example.simple.dubbo_demo_provider.ProviderApplication.main(ProviderApplication.java:10)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: org.springframework.core.metrics.ApplicationStartup</span><br><span class="line">	at java.net.URLClassLoader.findClass(URLClassLoader.java:382)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)</span><br><span class="line">	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">	... 5 more</span><br></pre></td></tr></table></figure>
<p>ç»è¿‡æŸ¥æ‰¾<a href="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/maven_dependencymanagement%E5%A4%9A%E6%A8%A1%E5%9D%97%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98/">èµ„æ–™</a>å‘ç°æ˜¯å› ä¸ºçˆ¶POMçš„<code>parent</code>é‡Œæ˜¯<code>spring-boot-parent</code>è€Œä¸”è¿˜è‡ªå®šä¹‰äº†<code>&lt;dependencyManagement/&gt;</code>ä½¿å¾—å­æ¨¡å—é‡Œæ‰¾ä¸åˆ°å¯¹åº”çš„ä¾èµ–moduleã€‚</p>
<p>è§£å†³æ–¹æ³•å°±æ˜¯åœ¨åŸå…ˆçš„çˆ¶POM<code>&lt;dependencyManagement/&gt;</code>é‡Œé¢åŠ ä¸Š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="slf4j-class-path-contains-multiple-slf4j-bindings"><a class="markdownIt-Anchor" href="#slf4j-class-path-contains-multiple-slf4j-bindings"></a> SLF4J: Class path contains multiple SLF4J bindings</h2>
<p>SLF4Jç»‘å®šå¤šä¸ªå®ç°</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/C:/Users/qianx/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/C:/Users/qianx/.m2/repository/org/slf4j/slf4j-log4j12/1.7.25/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [ch.qos.logback.classic.util.ContextSelectorStaticBinder]</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºé¡¹ç›®ä¸­SLF4Jæœ‰å¤šç§å®ç°ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æˆ–è€…IDEçš„ä¾èµ–åˆ†ææ¥æ‰¾åˆ°ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mvn dependency:tree</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># result</span><br><span class="line">[INFO] --- maven-dependency-plugin:2.8:tree (default-cli) @ dubbo-demo-provider ---</span><br><span class="line">[INFO] com.qxdn.demo:dubbo-demo-provider:jar:0.0.1-SNAPSHOT</span><br><span class="line">[INFO] +- com.qxdn.demo:dubbo-demo-api:jar:0.0.1-SNAPSHOT:compile</span><br><span class="line">[INFO] +- org.apache.dubbo:dubbo:jar:3.0.7:compile</span><br><span class="line">[INFO] |  +- org.springframework:spring-context:jar:5.3.23:compile</span><br><span class="line">[INFO] |  |  +- org.springframework:spring-aop:jar:5.3.23:compile</span><br><span class="line">[INFO] |  |  +- org.springframework:spring-beans:jar:5.3.23:compile</span><br><span class="line">[INFO] |  |  \- org.springframework:spring-expression:jar:5.3.23:compile</span><br><span class="line">[INFO] |  +- com.alibaba.spring:spring-context-support:jar:1.0.8:compile</span><br><span class="line">[INFO] |  +- org.javassist:javassist:jar:3.28.0-GA:compile</span><br><span class="line">[INFO] |  +- io.netty:netty-all:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-buffer:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-dns:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-haproxy:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-http:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-http2:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-memcache:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-mqtt:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-redis:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-smtp:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-socks:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-stomp:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-codec-xml:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-common:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-handler:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-native-unix-common:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-handler-proxy:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-resolver:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-resolver-dns:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-rxtx:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-sctp:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-udt:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-classes-epoll:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-classes-kqueue:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-resolver-dns-classes-macos:jar:4.1.84.Final:compile</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-native-epoll:jar:linux-x86_64:4.1.84.Final:runtime</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-native-epoll:jar:linux-aarch_64:4.1.84.Final:runtime</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-native-kqueue:jar:osx-x86_64:4.1.84.Final:runtime</span><br><span class="line">[INFO] |  |  +- io.netty:netty-transport-native-kqueue:jar:osx-aarch_64:4.1.84.Final:runtime</span><br><span class="line">[INFO] |  |  +- io.netty:netty-resolver-dns-native-macos:jar:osx-x86_64:4.1.84.Final:runtime</span><br><span class="line">[INFO] |  |  \- io.netty:netty-resolver-dns-native-macos:jar:osx-aarch_64:4.1.84.Final:runtime</span><br><span class="line">[INFO] |  +- com.google.code.gson:gson:jar:2.9.1:compile</span><br><span class="line">[INFO] |  +- org.yaml:snakeyaml:jar:1.30:compile</span><br><span class="line">[INFO] |  \- com.alibaba:fastjson:jar:1.2.70:compile</span><br><span class="line">[INFO] +- org.apache.dubbo:dubbo-dependencies-zookeeper:pom:3.0.7:compile</span><br><span class="line">[INFO] |  +- org.apache.curator:curator-x-discovery:jar:4.2.0:compile</span><br><span class="line">[INFO] |  |  +- org.apache.curator:curator-recipes:jar:4.2.0:compile</span><br><span class="line">[INFO] |  |  |  \- org.apache.curator:curator-framework:jar:4.2.0:compile</span><br><span class="line">[INFO] |  |  |     \- org.apache.curator:curator-client:jar:4.2.0:compile</span><br><span class="line">[INFO] |  |  |        \- com.google.guava:guava:jar:27.0.1-jre:compile</span><br><span class="line">[INFO] |  |  |           +- com.google.guava:failureaccess:jar:1.0.1:compile</span><br><span class="line">[INFO] |  |  |           +- com.google.guava:listenablefuture:jar:9999.0-empty-to-avoid-conflict-with-guava:compile</span><br><span class="line">[INFO] |  |  |           +- org.checkerframework:checker-qual:jar:2.5.2:compile</span><br><span class="line">[INFO] |  |  |           +- com.google.errorprone:error_prone_annotations:jar:2.2.0:compile</span><br><span class="line">[INFO] |  |  |           +- com.google.j2objc:j2objc-annotations:jar:1.1:compile</span><br><span class="line">[INFO] |  |  |           \- org.codehaus.mojo:animal-sniffer-annotations:jar:1.17:compile</span><br><span class="line">[INFO] |  |  \- com.fasterxml.jackson.core:jackson-databind:jar:2.13.4.2:compile</span><br><span class="line">[INFO] |  |     +- com.fasterxml.jackson.core:jackson-annotations:jar:2.13.4:compile</span><br><span class="line">[INFO] |  |     \- com.fasterxml.jackson.core:jackson-core:jar:2.13.4:compile</span><br><span class="line">[INFO] |  \- org.apache.zookeeper:zookeeper:jar:3.4.14:compile</span><br><span class="line">[INFO] |     +- com.github.spotbugs:spotbugs-annotations:jar:3.1.9:compile</span><br><span class="line">[INFO] |     |  \- com.google.code.findbugs:jsr305:jar:3.0.2:compile</span><br><span class="line">[INFO] |     +- jline:jline:jar:0.9.94:compile</span><br><span class="line">[INFO] |     \- org.apache.yetus:audience-annotations:jar:0.5.0:compile</span><br><span class="line">[INFO] +- org.apache.dubbo:dubbo-spring-boot-starter:jar:3.0.7:compile</span><br><span class="line">[INFO] |  \- org.apache.dubbo:dubbo-spring-boot-autoconfigure:jar:3.0.7:compile</span><br><span class="line">[INFO] |     \- org.apache.dubbo:dubbo-spring-boot-autoconfigure-compatible:jar:3.0.7:compile</span><br><span class="line">[INFO] +- org.springframework.boot:spring-boot-starter:jar:2.7.5:compile</span><br><span class="line">[INFO] |  +- org.springframework.boot:spring-boot:jar:2.7.5:compile</span><br><span class="line">[INFO] |  +- org.springframework.boot:spring-boot-starter-logging:jar:2.7.5:compile</span><br><span class="line">[INFO] |  |  +- ch.qos.logback:logback-classic:jar:1.2.11:compile</span><br><span class="line">[INFO] |  |  |  \- ch.qos.logback:logback-core:jar:1.2.11:compile</span><br><span class="line">[INFO] |  |  +- org.apache.logging.log4j:log4j-to-slf4j:jar:2.17.2:compile</span><br><span class="line">[INFO] |  |  |  \- org.apache.logging.log4j:log4j-api:jar:2.17.2:compile</span><br><span class="line">[INFO] |  |  \- org.slf4j:jul-to-slf4j:jar:1.7.36:compile</span><br><span class="line">[INFO] |  +- jakarta.annotation:jakarta.annotation-api:jar:1.3.5:compile</span><br><span class="line">[INFO] |  \- org.springframework:spring-core:jar:5.3.23:compile</span><br><span class="line">[INFO] |     \- org.springframework:spring-jcl:jar:5.3.23:compile</span><br><span class="line">[INFO] +- org.springframework.boot:spring-boot-autoconfigure:jar:2.7.5:compile</span><br><span class="line">[INFO] +- org.slf4j:slf4j-api:jar:1.7.36:compile</span><br><span class="line">[INFO] +- org.slf4j:slf4j-log4j12:jar:1.7.25:compile</span><br><span class="line">[INFO] +- log4j:log4j:jar:1.2.17:compile</span><br><span class="line">[INFO] \- org.projectlombok:lombok:jar:1.18.24:provided</span><br><span class="line">[INFO]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ‰¾åˆ°ä¾èµ–åä¿®æ”¹</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="failed-to-execute-goal-on-project-xxx"><a class="markdownIt-Anchor" href="#failed-to-execute-goal-on-project-xxx"></a> Failed to execute goal on project xxx</h2>
<p>æ‰§è¡Œ<code>mvn dependency:tree</code>çš„æ—¶å€™é”™è¯¯å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Failed to execute goal on project dubbo-demo-provider: Could not resolve dependencies for project com.qxdn.demo:dubbo-demo-provider:jar:0.0.1-SNAPSHOT: Could not find artifact com.qxdn.demo:dubbo-demo-api:jar:0.0.1-SNAPSHOT</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mvn clean install</span><br></pre></td></tr></table></figure>
<h1 id="å®Œæ•´ä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´ä»£ç "></a> å®Œæ•´ä»£ç </h1>
<p>å®Œæ•´ä»£ç åœ°å€åœ¨<a href="https://github.com/qxdn/dubbo-demo">github</a></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://dubbo.apache.org/zh/">dubboæ–‡æ¡£</a></p>
<p><a href="https://msdemt.github.io/posts/java/%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/maven_dependencymanagement%E5%A4%9A%E6%A8%A1%E5%9D%97%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98/">Maven_dependencyManagementå¤šæ¨¡å—è¦†ç›–é—®é¢˜</a></p>
<p><a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">Introduction to the Dependency Mechanism</a></p>
<p><a href="https://github.com/apache/dubbo/issues/6316">quick start fails</a></p>
<p><a href="https://stackoverflow.com/questions/33071002/spring-boot-multiple-slf4j-bindings">Spring Boot: multiple SLF4J bindings</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>dubbo</tag>
        <tag>rpc</tag>
      </tags>
  </entry>
  <entry>
    <title>java-volatile</title>
    <url>/2022/12/05/java-volatile/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šåƒã®åˆƒæ¿¤ã€æ¡ƒèŠ±æŸ“ã®çš‡å§«ã€‹</p>
</blockquote>
<blockquote>
<p>åœ¨åŒæ­¥æ‰§è¡Œä¸é‡è¦çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ã€è¿è¡Œæ—¶åˆ»å’Œå¤„ç†å™¨ä¼šè¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼Œè™½ç„¶è¿™äº›ä¼˜åŒ–é€šå¸¸æ˜¯æœ‰ç›Šçš„ï¼Œä½†æ˜¯æœ‰æ—¶å€™ä¼šæœ‰ä¸€äº›å¾®å¦™çš„é—®é¢˜<br />
ç¼“å­˜å’ŒæŒ‡ä»¤é‡æ’æ˜¯å¹¶å‘ä¸­å®¹æ˜“å‡ºé—®é¢˜çš„ä¼˜åŒ–ï¼Œåœ¨Javaå’ŒJVMä¸­æä¾›äº†è®¸å¤šæ–¹æ³•æ¥æ§åˆ¶å†…å­˜é¡ºåºï¼Œvolatileå…³é”®å­—ä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€</p>
</blockquote>
<h1 id="å¤šå¤„ç†å™¨ç»“æ„"><a class="markdownIt-Anchor" href="#å¤šå¤„ç†å™¨ç»“æ„"></a> å¤šå¤„ç†å™¨ç»“æ„</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.0/cpu.png" alt="" /></p>
<p>è®¡ç®—æœºæ‰§è¡Œç¨‹åºçš„æ—¶å€™æ¯æ¡æŒ‡ä»¤éƒ½æ˜¯åœ¨CPUä¸­æ‰§è¡Œçš„ï¼Œè€Œæ‰§è¡ŒæŒ‡ä»¤è¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…æ¶‰åŠåˆ°æ•°æ®çš„è¯»å–å’Œå†™å…¥ã€‚ç”±äºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®æ˜¯å­˜æ”¾åœ¨ä¸»å­˜ï¼ˆç‰©ç†å†…å­˜ï¼‰å½“ä¸­çš„ï¼Œè¿™æ—¶å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºCPUæ‰§è¡Œé€Ÿåº¦å¾ˆå¿«ï¼Œè€Œä»å†…å­˜è¯»å–æ•°æ®å’Œå‘å†…å­˜å†™å…¥æ•°æ®çš„è¿‡ç¨‹è·ŸCPUæ‰§è¡ŒæŒ‡ä»¤çš„é€Ÿåº¦æ¯”èµ·æ¥è¦æ…¢çš„å¤šï¼Œå› æ­¤å¦‚æœä»»ä½•æ—¶å€™å¯¹æ•°æ®çš„æ“ä½œéƒ½è¦é€šè¿‡å’Œå†…å­˜çš„äº¤äº’æ¥è¿›è¡Œï¼Œä¼šå¤§å¤§é™ä½æŒ‡ä»¤æ‰§è¡Œçš„é€Ÿåº¦ã€‚å› æ­¤åœ¨CPUé‡Œé¢å°±æœ‰äº†é«˜é€Ÿç¼“å­˜ã€‚</p>
<p>å½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šå°†è¿ç®—éœ€è¦çš„æ•°æ®ä»ä¸»å­˜å¤åˆ¶ä¸€ä»½åˆ°CPUçš„é«˜é€Ÿç¼“å­˜å½“ä¸­ï¼Œé‚£ä¹ˆCPUè¿›è¡Œè®¡ç®—æ—¶å°±å¯ä»¥ç›´æ¥ä»å®ƒçš„é«˜é€Ÿç¼“å­˜è¯»å–æ•°æ®å’Œå‘å…¶ä¸­å†™å…¥æ•°æ®ï¼Œå½“è¿ç®—ç»“æŸä¹‹åï¼Œå†å°†é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedObj</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">// Changes made to sharedVar in one thread</span></span><br><span class="line">   <span class="comment">// may not immediately reflect in other thread</span></span><br><span class="line">   <span class="keyword">static</span> <span class="type">int</span> <span class="variable">sharedVar</span> <span class="operator">=</span> <span class="number">6</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨<code>SharedObj</code>ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹è¿è¡Œåœ¨ä¸¤ä¸ªä¸åŒçš„å¤„ç†å™¨ä¸Šï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹æœ‰ä¸€ä»½æœ¬åœ°çš„<code>sharedVariable</code>ç¼“å­˜ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹æ”¹å˜å…¶å˜é‡ï¼Œå¯èƒ½ä¸ä¼šé©¬ä¸Šåæ˜ åˆ°ä¸»çº¿ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸ä¼šæ³¨æ„åˆ°æ•°æ®æ”¹å˜äº†ï¼Œå¯¼è‡´äº†æ•°æ®çš„ä¸ä¸€è‡´ã€‚å…³äºç¼“å­˜ä¸€è‡´æ€§å¯ä»¥è¯»<a href="https://en.wikipedia.org/wiki/Cache_coherence">è¿™ç¯‡</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.0/shared-memory.png" alt="" /></p>
<h1 id="volatileä½œç”¨"><a class="markdownIt-Anchor" href="#volatileä½œç”¨"></a> volatileä½œç”¨</h1>
<h2 id="å†…å­˜å¯è§æ€§"><a class="markdownIt-Anchor" href="#å†…å­˜å¯è§æ€§"></a> å†…å­˜å¯è§æ€§</h2>
<p>å¯è§æ€§é—®é¢˜ä¸»è¦æŒ‡ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡å€¼ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹å´çœ‹ä¸åˆ°ã€‚å¼•èµ·å¯è§æ€§é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯æ¯ä¸ªçº¿ç¨‹æ‹¥æœ‰è‡ªå·±çš„ä¸€ä¸ªé«˜é€Ÿç¼“å­˜åŒºâ€”â€”çº¿ç¨‹å·¥ä½œå†…å­˜ã€‚volatileå…³é”®å­—èƒ½æœ‰æ•ˆçš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">readerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (temp != num) &#123;</span><br><span class="line">                    temp = num;</span><br><span class="line">                    System.out.println(<span class="string">&quot;reader: value of num = &quot;</span> + num);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">writerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                num++;</span><br><span class="line">                System.out.println(<span class="string">&quot;writer: changed value to = &quot;</span> + num);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€€å‡ºç¨‹åºï¼Œå¦åˆ™readerThreadä¼šä¸€ç›´ç­‰</span></span><br><span class="line">            System.exit(<span class="number">0</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        readerThread.start();</span><br><span class="line">        writerThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">reader: value of num = 1</span><br><span class="line">writer: changed value to = 1</span><br><span class="line">writer: changed value to = 2</span><br><span class="line">writer: changed value to = 3</span><br><span class="line">writer: changed value to = 4</span><br><span class="line">writer: changed value to = 5</span><br></pre></td></tr></table></figure>
<p>æ²¡åŠ volatileçš„æ—¶å€™readeråªè¯»åˆ°0-1çš„å˜åŒ–ã€‚</p>
<p>æ¥ä¸‹æ¥ä¿®æ”¹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> num;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">writer: changed value to = 1</span><br><span class="line">reader: value of num = 1</span><br><span class="line">writer: changed value to = 2</span><br><span class="line">reader: value of num = 2</span><br><span class="line">writer: changed value to = 3</span><br><span class="line">reader: value of num = 3</span><br><span class="line">writer: changed value to = 4</span><br><span class="line">reader: value of num = 4</span><br><span class="line">writer: changed value to = 5</span><br><span class="line">reader: value of num = 5</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¾“å‡ºreaderå¯ä»¥è¯»åˆ°numçš„å˜åŒ–ï¼ŒvolatileæŒ‡ç¤ºç¼–è¯‘å™¨ï¼Œè¿™ä¸ªå˜é‡æ˜¯å…±äº«çš„ä¸”ä¸ç¨³å®šï¼Œæ¯æ¬¡è¦åˆ°ä¸»ç¨‹åºä¸­è¯»å–ã€‚</p>
<h2 id="ç¦æ­¢æŒ‡ä»¤é‡æ’"><a class="markdownIt-Anchor" href="#ç¦æ­¢æŒ‡ä»¤é‡æ’"></a> ç¦æ­¢æŒ‡ä»¤é‡æ’</h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œå¤„ç†å™¨ä¸ºäº†æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œå¯èƒ½ä¼šå¯¹è¾“å…¥ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒä¸ä¿è¯ç¨‹åºä¸­å„ä¸ªè¯­å¥çš„æ‰§è¡Œå…ˆåé¡ºåºåŒä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼Œä½†æ˜¯å®ƒä¼šä¿è¯ç¨‹åºæœ€ç»ˆæ‰§è¡Œç»“æœå’Œä»£ç é¡ºåºæ‰§è¡Œçš„ç»“æœæ˜¯ä¸€è‡´çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">10</span>;    <span class="comment">//è¯­å¥1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">2</span>;    <span class="comment">//è¯­å¥2</span></span><br><span class="line">a = a + <span class="number">3</span>;    <span class="comment">//è¯­å¥3</span></span><br><span class="line">r = a*a;     <span class="comment">//è¯­å¥4</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æœ‰4ä¸ªè¯­å¥ï¼Œé‚£ä¹ˆå¯èƒ½çš„ä¸€ä¸ªæ‰§è¡Œé¡ºåºæ˜¯ï¼š<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.0/reorder.jpg" alt="" /><br />
ä½†æ˜¯æ‰§è¡Œé¡ºåºä¸å¯èƒ½æ˜¯:è¯­å¥2-è¯­å¥1-è¯­å¥4-è¯­å¥3ã€‚å› ä¸ºå¤„ç†å™¨åœ¨è¿›è¡Œé‡æ’åºæ—¶æ˜¯ä¼šè€ƒè™‘æŒ‡ä»¤ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ï¼Œå¦‚æœä¸€ä¸ªæŒ‡ä»¤Instruction 2å¿…é¡»ç”¨åˆ°Instruction 1çš„ç»“æœï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šä¿è¯Instruction 1ä¼šåœ¨Instruction 2ä¹‹å‰æ‰§è¡Œã€‚</p>
<p>è™½ç„¶é‡æ’ä¸å½±å“å•çº¿ç¨‹å†…ç¨‹åºæ‰§è¡Œç»“æœï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸­ä¼šæœ‰å½±å“</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹1:</span></span><br><span class="line">context = loadContext();   <span class="comment">//è¯­å¥1</span></span><br><span class="line">inited = <span class="literal">true</span>;             <span class="comment">//è¯­å¥2</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//çº¿ç¨‹2:</span></span><br><span class="line"><span class="keyword">while</span>(!inited )&#123;</span><br><span class="line">  sleep()</span><br><span class="line">&#125;</span><br><span class="line">doSomethingwithconfig(context);</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºè¯­å¥1å’Œè¯­å¥2æ²¡æœ‰æ•°æ®ä¾èµ–æ€§ï¼Œå› æ­¤å¯èƒ½ä¼šè¢«é‡æ’åºã€‚å‡å¦‚å‘ç”Ÿäº†é‡æ’åºï¼Œåœ¨çº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆæ‰§è¡Œè¯­å¥2ï¼Œè€Œæ­¤æ˜¯çº¿ç¨‹2ä¼šä»¥ä¸ºåˆå§‹åŒ–å·¥ä½œå·²ç»å®Œæˆï¼Œé‚£ä¹ˆå°±ä¼šè·³å‡ºwhileå¾ªç¯ï¼Œå»æ‰§è¡ŒdoSomethingwithconfig(context)æ–¹æ³•ï¼Œè€Œæ­¤æ—¶contextå¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œå°±ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ã€‚</p>
<blockquote>
<p>åœ¨Javaä¸­ï¼Œvolatileå…³é”®å­—é™¤äº†å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨å°±æ˜¯é˜²æ­¢JVMçš„æŒ‡ä»¤é‡æ’åºã€‚å¦‚æœæˆ‘ä»¬å°†å˜é‡å£°æ˜ä¸ºvolatileï¼Œåœ¨å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œè¯»å†™æ“ä½œçš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ’å…¥ç‰¹å®šçš„å†…å­˜å±éšœçš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚</p>
</blockquote>
<h1 id="volatileä¸ä¿è¯åŸå­æ€§"><a class="markdownIt-Anchor" href="#volatileä¸ä¿è¯åŸå­æ€§"></a> volatileä¸ä¿è¯åŸå­æ€§</h1>
<p>volatileå…³é”®å­—ä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œä½†æ˜¯ä¸ä¿è¯å¯¹å˜é‡æ“ä½œæ˜¯åŸå­æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            threadPool.execute(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">500</span>;j++)&#123;</span><br><span class="line">                    num++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç­‰5ç§’ä¿è¯æ‰§è¡Œå®Œä¸Šé¢ä»£ç </span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç æŒ‰ç…§é¢„æœŸåº”è¯¥æ˜¯è¾“å‡º2500ï¼Œç„¶è€Œå®é™…çš„è¾“å‡ºç»“æœä¸ä¸€å®šæ˜¯2500ï¼Œæ¯”å¦‚2136ã€‚<br />
è¿™æ˜¯å› ä¸º<code>num++</code>ä¸æ˜¯åŸå­æ€§çš„ï¼Œå…¶åŒ…å«ä¸‰æ­¥</p>
<ul>
<li>è¯»å–numçš„å€¼ã€‚</li>
<li>å¯¹numåŠ 1ã€‚</li>
<li>å°†numçš„å€¼å†™å›å†…å­˜ã€‚</li>
</ul>
<p>æ”¹è¿›ä¹Ÿå¾ˆç®€å•ï¼Œä½¿ç”¨<code>synchronized</code>ã€<code>Lock</code>æˆ–è€…<code>JUC</code>å³å¯ã€‚</p>
<h2 id="synchronized"><a class="markdownIt-Anchor" href="#synchronized"></a> synchronized</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span>&#123;</span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            threadPool.execute(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">500</span>;j++)&#123;</span><br><span class="line">                    demo.increase();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç­‰5ç§’ä¿è¯æ‰§è¡Œå®Œä¸Šé¢ä»£ç </span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="juc"><a class="markdownIt-Anchor" href="#juc"></a> JUC</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">num</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span>&#123;</span><br><span class="line">        num.getAndIncrement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            threadPool.execute(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">500</span>;j++)&#123;</span><br><span class="line">                    demo.increase();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç­‰5ç§’ä¿è¯æ‰§è¡Œå®Œä¸Šé¢ä»£ç </span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="lock"><a class="markdownIt-Anchor" href="#lock"></a> Lock</h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        num++;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="type">Demo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Demo</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">            threadPool.execute(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">500</span>;j++)&#123;</span><br><span class="line">                    demo.increase();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç­‰5ç§’ä¿è¯æ‰§è¡Œå®Œä¸Šé¢ä»£ç </span></span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        System.out.println(num);</span><br><span class="line">        threadPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="javaå’Œccä¸­volatileçš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#javaå’Œccä¸­volatileçš„åŒºåˆ«"></a> Javaå’ŒC/C++ä¸­volatileçš„åŒºåˆ«</h1>
<p>Javaå’ŒC/C++ä¸­çš„volatileå…³é”®å­—ä¸ä¸€æ ·ï¼Œåœ¨javaä¸­volatileå‘Šè¯‰ç¼–è¯‘å™¨å˜é‡ä¸èƒ½ç¼“å­˜è¯¥å€¼ï¼Œéœ€è¦åˆ°ä¸»å­˜ä¸­å»è¯»å–</p>
<p>C/C++ä¸­ï¼Œå¼€å‘åµŒå…¥å¼è®¾å¤‡éœ€è¦volatileï¼Œéœ€è¦è¯»å–å’Œå†™å…¥å†…å­˜æ˜ å°„çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå…¶å€¼å¯èƒ½éšæ—¶å˜åŒ–ï¼Œæ‰€ä»¥ç”¨volatileå‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦å°†å…¶ä¼˜åŒ–ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a class="markdownIt-Anchor" href="#å‚è€ƒèµ„æ–™"></a> å‚è€ƒèµ„æ–™</h1>
<p><a href="https://www.baeldung.com/java-volatile">Guide to the Volatile Keyword in Java</a></p>
<p><a href="https://www.cnblogs.com/dolphin0520/p/3920373.html">Javaå¹¶å‘ç¼–ç¨‹ï¼švolatileå…³é”®å­—è§£æ</a></p>
<p><a href="https://www.geeksforgeeks.org/volatile-keyword-in-java/">volatile Keyword in Java</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>å¹¶å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå®ç°ä¾èµ–æ³¨å…¥</title>
    <url>/2022/12/15/python-dependency-injection/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šå½¼å¥³ã¯é«˜å¤©ã«ç¥ˆã‚‰ãªã„ -quantum girlfriend-ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºåœ¨å†™<code>nonebot</code>æ’ä»¶çš„æ—¶å€™è§‰å¾—<code>nonebot</code>çš„ä¾èµ–æ³¨å…¥éå¸¸çš„ç¥å¥‡ï¼Œå°±è¯»äº†ä¸€ä¸‹æºç ï¼Œå‘ç°å…¶å®åŸç†å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸Javaçš„Springæ¡†æ¶ç›¸æ¯”è¿˜æ˜¯ä¸å¤ªä¸€æ ·ï¼Œå› æ­¤å°±å†™ä¸€ä¸‹ç¬”è®°å¹¶è‡ªå·±å®ç°ä¸€ä¸‹æ ¸å¿ƒä»£ç ã€‚</p>
<h1 id="nonebotä¸­çš„ä¾èµ–æ³¨å…¥"><a class="markdownIt-Anchor" href="#nonebotä¸­çš„ä¾èµ–æ³¨å…¥"></a> nonebotä¸­çš„ä¾èµ–æ³¨å…¥</h1>
<p>åœ¨<code>nonebot2</code>ä¸­æˆ‘ä»¬å¯¹äºä¸€ä¸ªæ’ä»¶éƒ¨åˆ†çš„å“åº”å‡½æ•°ä¸€èˆ¬è¿™æ ·å†™</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@repeat_matcher.handle(<span class="params">[Cooldown(<span class="params"><span class="number">2</span></span>)]</span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">repeat_message</span>(<span class="params">bot:Bot,event:GroupMessageEvent</span>):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ<code>nonebot2</code>æ¡†æ¶åœ¨æ”¶åˆ°æ¶ˆæ¯æ—¶ä¼šæ ¹æ®äº‹ä»¶å‚æ•°ç”Ÿæˆ<code>Event</code>ï¼Œæ”¶åˆ°æ¶ˆæ¯çš„æœºå™¨äººidç”Ÿæˆ<code>Bot</code>å‚æ•°ï¼Œç„¶åæŒ‰ç…§ä¼˜å…ˆçº§éå†<code>matcher</code>æ‰§è¡Œå‡½æ•°ã€‚æ­¤æ—¶ä¼šå°†<code>Bot</code>ã€<code>Event</code>ç­‰å‚æ•°æ³¨å…¥åˆ°æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å‡½æ•°ä¸­ï¼Œé™¤äº†æ¡†æ¶è‡ªå·±å®šä¹‰çš„ä¾èµ–ä»¥å¤–è¿˜æœ‰<code>Depends</code>å‡½æ•°æ¥åŒ…è£…ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ä¾èµ–ã€‚</p>
<p>ä»Šå¤©ä¸»è¦è®²çš„æ˜¯<code>nonebot2</code>æ˜¯æ€ä¹ˆå®ç°è¿™ä¸ªä¾èµ–æ³¨å…¥äº†</p>
<h1 id="nonebotæµç¨‹"><a class="markdownIt-Anchor" href="#nonebotæµç¨‹"></a> nonebotæµç¨‹</h1>
<p><code>nonebot2</code>æ¡†æ¶æµç¨‹å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.1/handle-event.png" alt="æµç¨‹å›¾" /></p>
<p>ä¸‹é¢ä»¥<code>fastapi</code>ä½œä¸ºé©±åŠ¨å™¨å’Œ<code>onebotV11</code>ä½œä¸ºé€‚é…å™¨æ¥å…·ä½“è®²ä¸€ä¸‹å…·ä½“çš„ä¾èµ–æ³¨å…¥æµç¨‹ï¼Œæ­¤å¤„åªè€ƒè™‘ä¾èµ–æ³¨å…¥ç›¸å…³å†…å®¹ï¼Œä¸æ¢è®¨å‚æ•°æ ¡=æ ¡éªŒã€<code>Rule</code>ã€<code>Permission</code>ç­‰</p>
<p>åˆå§‹åŒ–çš„æ¨¡æ¿é¦–å…ˆæ˜¯æ‰§è¡Œ<code>nonebot.init()</code>ï¼Œè¿™é‡Œåˆå§‹åŒ–<code>driver</code>ï¼Œé»˜è®¤çš„<code>driver</code>æ˜¯<code>fastapi</code>ï¼Œç„¶åç»™<code>driver</code>æ³¨å†Œ<code>adapter</code>ã€‚<code>adapter</code>ä¸­é€šè¿‡<code>_setup(self)</code>æ–¹æ³•æ¥æ³¨å†Œ<code>http</code>ã€<code>websocket</code>çš„å“åº”å‡½æ•°ã€‚</p>
<p>äº‹ä»¶çš„å“åº”å‡½æ•°æµç¨‹ä¸»è¦å¦‚ä¸‹,æ­¤å¤„çœå»äº†ä¸€äº›å‚æ•°æ£€æŸ¥ã€tokenæ£€æŸ¥ã€Botå’ŒEventå‚æ•°ç”Ÿæˆã€Ruleæ£€æŸ¥ã€æƒé™æ£€æŸ¥è¿˜æœ‰ä¸€äº›å‰å¤„ç†åå¤„ç†çš„hookå‡½æ•°</p>
<blockquote>
<p><code>adapter._handle_ws(self, websocket: WebSocket)</code> -&gt; <code>bot.handle_event(event)</code> -&gt; <code>message.handle_event(bot,event)</code> -&gt; <code>message._check_matcher(priority, matcher, bot, event, stack, dependency_cache)</code> -&gt; <code>message._run_matcher(Matcher, bot, event, state, stack, dependency_cache)</code> -&gt; <code>matcher.run(bot, event, state, stack, dependency_cache)</code> -&gt; <code>matcher.simple_run(bot, event, state, stack, dependency_cache)</code> -&gt; <code>Dependent.__call__(matcher,bot,event,state,stack,dependency_cache)</code></p>
</blockquote>
<p>å› æ­¤å¯ä»¥çœ‹åˆ°æŠ›å¼€è®¸å¤šå‚æ•°çš„é¢„å¤„ç†ï¼Œnonebotè§£å†³ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒä»£ç åœ¨<code>Dependent</code>çš„<code>__call__</code>å‡½æ•°ä¸­</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨<code>message._check_matcher(priority, matcher, bot, event, stack, dependency_cache)</code>è¿™ä¸€æ­¥ä¸­å·²ç»å°†å…¨éƒ¨é¢„å…ˆå®šä¹‰å¥½çš„å‚æ•°ä¼ å…¥å‡½æ•°ï¼Œè¿™é‡Œä¸åŒ…å«ç”¨æˆ·å®šä¹‰çš„Dependsï¼Œç”¨æˆ·å®šä¹‰çš„Dependsè¦åˆ°Dependent.solveæ—¶è§£å†³</p>
</blockquote>
<h1 id="nonebotä¾èµ–æ³¨å…¥æ ¸å¿ƒ"><a class="markdownIt-Anchor" href="#nonebotä¾èµ–æ³¨å…¥æ ¸å¿ƒ"></a> nonebotä¾èµ–æ³¨å…¥æ ¸å¿ƒ</h1>
<h2 id="ä¾èµ–æ³¨å…¥å®¹å™¨"><a class="markdownIt-Anchor" href="#ä¾èµ–æ³¨å…¥å®¹å™¨"></a> ä¾èµ–æ³¨å…¥å®¹å™¨</h2>
<p><code>nonebot2</code>çš„ä¾èµ–æ³¨å…¥å®¹å™¨æ˜¯<code>Dependent</code>ç±»ï¼Œå…ˆæ¥çœ‹å…¶ä¸­çš„æ ¸å¿ƒå‡½æ•°</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dependent</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_param</span>(<span class="params">self, name: <span class="built_in">str</span>, param: inspect.Parameter</span>) -&gt; Param:</span><br><span class="line">        <span class="keyword">for</span> allow_type <span class="keyword">in</span> self.allow_types:</span><br><span class="line">            field_info = allow_type._check_param(self, name, param)</span><br><span class="line">            <span class="keyword">if</span> field_info:</span><br><span class="line">                <span class="keyword">return</span> field_info</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">f&quot;Unknown parameter <span class="subst">&#123;name&#125;</span> for function <span class="subst">&#123;self.call&#125;</span> with type <span class="subst">&#123;param.annotation&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls: <span class="type">Type</span>[T],</span></span><br><span class="line"><span class="params">        *,</span></span><br><span class="line"><span class="params">        call: <span class="type">Callable</span>[..., <span class="type">Any</span>],</span></span><br><span class="line"><span class="params">        parameterless: <span class="type">Optional</span>[<span class="type">List</span>[<span class="type">Any</span>]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        allow_types: <span class="type">Optional</span>[<span class="type">List</span>[<span class="type">Type</span>[Param]]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; T:</span><br><span class="line">        signature = get_typed_signature(call)</span><br><span class="line">        params = signature.parameters</span><br><span class="line">        dependent = cls(</span><br><span class="line">            call=call,</span><br><span class="line">            allow_types=allow_types,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> param_name, param <span class="keyword">in</span> params.items():</span><br><span class="line">            default_value = Required</span><br><span class="line">            <span class="keyword">if</span> param.default != param.empty:</span><br><span class="line">                default_value = param.default</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(default_value, Param):</span><br><span class="line">                field_info = default_value</span><br><span class="line">                default_value = field_info.default</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                field_info = dependent.parse_param(param_name, param)</span><br><span class="line">                default_value = field_info.default</span><br><span class="line"></span><br><span class="line">            annotation: <span class="type">Any</span> = <span class="type">Any</span></span><br><span class="line">            required = default_value == Required</span><br><span class="line">            <span class="keyword">if</span> param.annotation != param.empty:</span><br><span class="line">                annotation = param.annotation</span><br><span class="line">            annotation = get_annotation_from_field_info(</span><br><span class="line">                annotation, field_info, param_name</span><br><span class="line">            )</span><br><span class="line">            dependent.params.append(</span><br><span class="line">                ModelField(</span><br><span class="line">                    name=param_name,</span><br><span class="line">                    type_=annotation,</span><br><span class="line">                    class_validators=<span class="literal">None</span>,</span><br><span class="line">                    model_config=CustomConfig,</span><br><span class="line">                    default=<span class="literal">None</span> <span class="keyword">if</span> required <span class="keyword">else</span> default_value,</span><br><span class="line">                    required=required,</span><br><span class="line">                    field_info=field_info,</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        parameterless_params = [</span><br><span class="line">            dependent.parse_parameterless(param) <span class="keyword">for</span> param <span class="keyword">in</span> (parameterless <span class="keyword">or</span> [])</span><br><span class="line">        ]</span><br><span class="line">        dependent.parameterless.extend(parameterless_params)</span><br><span class="line"></span><br><span class="line">        logger.trace(</span><br><span class="line">            <span class="string">f&quot;Parsed dependent with call=<span class="subst">&#123;call&#125;</span>, &quot;</span></span><br><span class="line">            <span class="string">f&quot;params=<span class="subst">&#123;[param.field_info <span class="keyword">for</span> param <span class="keyword">in</span> dependent.params]&#125;</span>, &quot;</span></span><br><span class="line">            <span class="string">f&quot;parameterless=<span class="subst">&#123;dependent.parameterless&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dependent</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, **kwargs: <span class="type">Any</span></span>) -&gt; R:</span><br><span class="line">            values = <span class="keyword">await</span> self.solve(**kwargs)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> is_coroutine_callable(self.call):</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">await</span> self.call(**values)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">await</span> run_sync(self.call)(**values)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params"></span></span><br><span class="line"><span class="params">            self,</span></span><br><span class="line"><span class="params">            **params: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">        </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">            values: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> checker <span class="keyword">in</span> self.pre_checkers:</span><br><span class="line">                <span class="keyword">await</span> checker._solve(**params)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> param <span class="keyword">in</span> self.parameterless:</span><br><span class="line">                <span class="keyword">await</span> param._solve(**params)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> field <span class="keyword">in</span> self.params:</span><br><span class="line">                field_info = field.field_info</span><br><span class="line">                <span class="keyword">assert</span> <span class="built_in">isinstance</span>(field_info, Param), <span class="string">&quot;Params must be subclasses of Param&quot;</span></span><br><span class="line">                value = <span class="keyword">await</span> field_info._solve(**params)</span><br><span class="line">                <span class="keyword">if</span> value <span class="keyword">is</span> Undefined:</span><br><span class="line">                    value = field.get_default()</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    values[field.name] = check_field_type(field, value)</span><br><span class="line">                <span class="keyword">except</span> TypeMisMatch:</span><br><span class="line">                    logger.debug(</span><br><span class="line">                        <span class="string">f&quot;<span class="subst">&#123;field_info&#125;</span> &quot;</span></span><br><span class="line">                        <span class="string">f&quot;type <span class="subst">&#123;<span class="built_in">type</span>(value)&#125;</span> not match depends <span class="subst">&#123;self.call&#125;</span> &quot;</span></span><br><span class="line">                        <span class="string">f&quot;annotation <span class="subst">&#123;field._type_display()&#125;</span>, ignored&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> values</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿è¡Œä¹‹å‰ï¼Œå…ˆå¯¹è¦æ³¨å…¥çš„å‡½æ•°æ‰§è¡Œ<code>parse</code>å‡½æ•°ï¼Œé¦–å…ˆé€šè¿‡åå°„æ¥è·å–å‡½æ•°çš„ç­¾åå’Œå‚æ•°ã€‚ç„¶åç”Ÿæˆä¸€ä¸ª<code>Dependent</code>å®¹å™¨ã€‚éå†å‚æ•°ï¼Œè¯¥å‡½æ•°çš„æ‰€æœ‰å‚æ•°åŒ…è£…æˆ<code>Param</code>çš„å­ç±»ï¼Œè¿™é‡Œçš„<code>Param</code>æ˜¯æˆ‘ä»¬ä¾èµ–æ³¨å…¥çš„æœ€å°å•å…ƒä¼šåœ¨åé¢è®²ã€‚å¹¶ä¸”åŠ åˆ°<code>Dependent</code>å®¹å™¨çš„<code>params</code>é‡Œé¢ã€‚</p>
<blockquote>
<p>å‡½æ•°å‚æ•°ä¸­å¸¦çš„ * ä¼šä½¿å¾— * åé¢çš„å‚æ•°åªèƒ½é€šè¿‡æŒ‡å®šå‚æ•°åçš„å½¢å¼ä¼ </p>
</blockquote>
<p>å†çœ‹<code>solve</code>å‡½æ•°,å®šä¹‰äº†ä¸€ä¸ªå­—å…¸ï¼Œkeyæ˜¯å‚æ•°åï¼Œvalueæ˜¯å‚æ•°å€¼ã€‚è¯¥å‡½æ•°é€šè¿‡éå†è‡ªå·±çš„<code>params</code>å‚æ•°ï¼Œé€šè¿‡<code>param</code>çš„<code>_solve</code>å‡½æ•°æ¥æå–å¯¹åº”å‚æ•°åçš„å‚æ•°å€¼ã€‚ç„¶åå°†æå–åˆ°çš„å‚æ•°å€¼å¡«å……åˆ°å­—å…¸ä¸­ï¼Œè¿™æ ·è™½ç„¶ä¼ è¿›æ¥äº†è®¸å¤šå‚æ•°ï¼Œä½†æ˜¯å®é™…æ‰§è¡Œçš„æ³¨å…¥çš„å‚æ•°æ˜¯å‡½æ•°æ‰€æ‹¥æœ‰çš„éƒ¨åˆ†ã€‚</p>
<h2 id="ä¾èµ–æ³¨å…¥æ ¸å¿ƒ"><a class="markdownIt-Anchor" href="#ä¾èµ–æ³¨å…¥æ ¸å¿ƒ"></a> ä¾èµ–æ³¨å…¥æ ¸å¿ƒ</h2>
<p>ä¸Šé¢æˆ‘ä»¬è¯´äº†<code>nonebot2</code>ä¸­ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ˜¯<code>Param</code>ç±»</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Param</span>(abc.ABC, FieldInfo):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¾èµ–æ³¨å…¥çš„åŸºæœ¬å•å…ƒ â€”â€” å‚æ•°ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ç»§æ‰¿è‡ª `pydantic.fields.FieldInfo`ï¼Œç”¨äºæè¿°å‚æ•°ä¿¡æ¯ï¼ˆä¸åŒ…æ‹¬å‚æ•°åï¼‰ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, name: <span class="built_in">str</span>, param: inspect.Parameter</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_parameterless</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, value: <span class="type">Any</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params">self, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BotParam</span>(<span class="title class_ inherited__">Param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;&#123;ref&#125;`nonebot.adapters.Bot` å‚æ•°&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: Dependent, name: <span class="built_in">str</span>, param: inspect.Parameter</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;BotParam&quot;</span>]:</span><br><span class="line">        <span class="keyword">from</span> nonebot.adapters <span class="keyword">import</span> Bot</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> param.default == param.empty:</span><br><span class="line">            <span class="keyword">if</span> generic_check_issubclass(param.annotation, Bot):</span><br><span class="line">                <span class="keyword">if</span> param.annotation <span class="keyword">is</span> <span class="keyword">not</span> Bot:</span><br><span class="line">                    dependent.pre_checkers.append(</span><br><span class="line">                        _BotChecker(</span><br><span class="line">                            Required,</span><br><span class="line">                            field=ModelField(</span><br><span class="line">                                name=name,</span><br><span class="line">                                type_=param.annotation,</span><br><span class="line">                                class_validators=<span class="literal">None</span>,</span><br><span class="line">                                model_config=CustomConfig,</span><br><span class="line">                                default=<span class="literal">None</span>,</span><br><span class="line">                                required=<span class="literal">True</span>,</span><br><span class="line">                            ),</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">return</span> cls(Required)</span><br><span class="line">            <span class="keyword">elif</span> param.annotation == param.empty <span class="keyword">and</span> name == <span class="string">&quot;bot&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> cls(Required)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params">self, bot: <span class="string">&quot;Bot&quot;</span>, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="keyword">return</span> bot</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DependParam</span>(<span class="title class_ inherited__">Param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å­ä¾èµ–å‚æ•°&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls,</span></span><br><span class="line"><span class="params">        dependent: Dependent,</span></span><br><span class="line"><span class="params">        name: <span class="built_in">str</span>,</span></span><br><span class="line"><span class="params">        param: inspect.Parameter,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;DependParam&quot;</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(param.default, DependsInner):</span><br><span class="line">            dependency: T_Handler</span><br><span class="line">            <span class="keyword">if</span> param.default.dependency <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">assert</span> param.annotation <span class="keyword">is</span> <span class="keyword">not</span> param.empty, <span class="string">&quot;Dependency cannot be empty&quot;</span></span><br><span class="line">                dependency = param.annotation</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dependency = param.default.dependency</span><br><span class="line">            sub_dependent = Dependent[<span class="type">Any</span>].parse(</span><br><span class="line">                call=dependency,</span><br><span class="line">                allow_types=dependent.allow_types,</span><br><span class="line">            )</span><br><span class="line">            dependent.pre_checkers.extend(sub_dependent.pre_checkers)</span><br><span class="line">            sub_dependent.pre_checkers.clear()</span><br><span class="line">            <span class="keyword">return</span> cls(</span><br><span class="line">                Required, use_cache=param.default.use_cache, dependent=sub_dependent</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_parameterless</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, value: <span class="type">Any</span></span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, DependsInner):</span><br><span class="line">            <span class="keyword">assert</span> value.dependency, <span class="string">&quot;Dependency cannot be empty&quot;</span></span><br><span class="line">            dependent = Dependent[<span class="type">Any</span>].parse(</span><br><span class="line">                call=value.dependency, allow_types=dependent.allow_types</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> cls(Required, use_cache=value.use_cache, dependent=dependent)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        stack: <span class="type">Optional</span>[AsyncExitStack] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        dependency_cache: <span class="type">Optional</span>[T_DependencyCache] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        **kwargs: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        use_cache: <span class="built_in">bool</span> = self.extra[<span class="string">&quot;use_cache&quot;</span>]</span><br><span class="line">        dependency_cache = &#123;&#125; <span class="keyword">if</span> dependency_cache <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> dependency_cache</span><br><span class="line"></span><br><span class="line">        sub_dependent: Dependent = self.extra[<span class="string">&quot;dependent&quot;</span>]</span><br><span class="line">        sub_dependent.call = cast(<span class="type">Callable</span>[..., <span class="type">Any</span>], sub_dependent.call)</span><br><span class="line">        call = sub_dependent.call</span><br><span class="line"></span><br><span class="line">        <span class="comment"># solve sub dependency with current cache</span></span><br><span class="line">        sub_values = <span class="keyword">await</span> sub_dependent.solve(</span><br><span class="line">            stack=stack,</span><br><span class="line">            dependency_cache=dependency_cache,</span><br><span class="line">            **kwargs,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># run dependency function</span></span><br><span class="line">        task: asyncio.Task[<span class="type">Any</span>]</span><br><span class="line">        <span class="keyword">if</span> use_cache <span class="keyword">and</span> call <span class="keyword">in</span> dependency_cache:</span><br><span class="line">            solved = <span class="keyword">await</span> dependency_cache[call]</span><br><span class="line">        <span class="keyword">elif</span> is_gen_callable(call) <span class="keyword">or</span> is_async_gen_callable(call):</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">isinstance</span>(</span><br><span class="line">                stack, AsyncExitStack</span><br><span class="line">            ), <span class="string">&quot;Generator dependency should be called in context&quot;</span></span><br><span class="line">            <span class="keyword">if</span> is_gen_callable(call):</span><br><span class="line">                cm = run_sync_ctx_manager(contextmanager(call)(**sub_values))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cm = asynccontextmanager(call)(**sub_values)</span><br><span class="line">            task = asyncio.create_task(stack.enter_async_context(cm))</span><br><span class="line">            dependency_cache[call] = task</span><br><span class="line">            solved = <span class="keyword">await</span> task</span><br><span class="line">        <span class="keyword">elif</span> is_coroutine_callable(call):</span><br><span class="line">            task = asyncio.create_task(call(**sub_values))</span><br><span class="line">            dependency_cache[call] = task</span><br><span class="line">            solved = <span class="keyword">await</span> task</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            task = asyncio.create_task(run_sync(call)(**sub_values))</span><br><span class="line">            dependency_cache[call] = task</span><br><span class="line">            solved = <span class="keyword">await</span> task</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> solved</span><br></pre></td></tr></table></figure>
<p><code>Param</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸ºäº†æ–¹ä¾¿è§£é‡Šæˆ‘ä»¬æ”¾ä¸¤ä¸ªå…·ä½“çš„å®ç°ç±»ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸¤ä¸ªå‡½æ•°ï¼Œ<code>_check_param</code>å’Œ<code>_solve</code>ï¼Œ<code>_check_param</code>å‡½æ•°å°†ç¬¦åˆ<code>Param</code>çš„å‚æ•°åŒ…è£…æˆ<code>Param</code>è¿”å›å¦åˆ™è¿”å›<code>None</code>ï¼Œæ¯”å¦‚<code>BotParam</code>åªå¤„ç†<code>Bot</code>ç±»ï¼Œ<code>DependParam</code>åªå¤„ç†<code>DependInner</code>ï¼ŒåŒæ—¶<code>_check_param</code>ä¸ä»…å¯ä»¥é€šè¿‡<code>annotation</code>æ³¨å…¥ä¹Ÿå¯ä»¥é€šè¿‡å‚æ•°åæ³¨å…¥ã€‚<code>_solve</code>å‡½æ•°åˆ™æ˜¯ä»<code>**kwargs</code>ä¸­è·å–å¯¹åº”çš„å€¼ï¼Œå¯¹äºå®ç°å·²ç»é¢„å®šå¥½çš„<code>bot</code>å‚æ•°å› ä¸ºå‚æ•°åå’Œå‚æ•°å€¼éƒ½æ˜¯ç¡®å®šçš„æ‰€ä»¥å¾ˆç®€å•ï¼Œè€Œ<code>DependParam</code>å› ä¸ºæ˜¯ç”¨æˆ·è‡ªå·±å®šä¹‰çš„ç±»å‹åŒ…è£…ä¸”éœ€è¦å¤„ç†åµŒå¥—çš„å­<code>Dependent</code>ï¼Œç›¸å¯¹å¤„ç†èµ·æ¥éº»çƒ¦ã€‚</p>
<h2 id="å¤„ç†æµç¨‹å›¾"><a class="markdownIt-Anchor" href="#å¤„ç†æµç¨‹å›¾"></a> å¤„ç†æµç¨‹å›¾</h2>
<p>å¹²è¯´æœ‰ç‚¹æ¯ç‡¥ï¼Œè¿˜æ˜¯æ¥ä¸€å¼ æµç¨‹å›¾å§<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.1/DI-flow.png" alt="ä¾èµ–æ³¨å…¥æµç¨‹å›¾" /></p>
<h1 id="å®ç°ä¾èµ–æ³¨å…¥"><a class="markdownIt-Anchor" href="#å®ç°ä¾èµ–æ³¨å…¥"></a> å®ç°ä¾èµ–æ³¨å…¥</h1>
<p>æå–<code>nonebot2</code>ä¸­ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒä»£ç ï¼Œå»é™¤äº†ä¸€äº›å‚æ•°æ£€æŸ¥ã€matcheré€‰æ‹©å’Œhookï¼Œåªä¿ç•™äº†å‚æ•°æ³¨å…¥éƒ¨åˆ†ã€‚</p>
<p>å®Œæ•´ä»£ç åœ¨<a href="https://github.com/qxdn/dependency-injection">github</a></p>
<h2 id="exceptionpy"><a class="markdownIt-Anchor" href="#exceptionpy"></a> <a href="http://exception.py">exception.py</a></h2>
<p>ä¸»è¦ä¸ºè§£æè¿‡ç¨‹ä¸­ä¼šé‡åˆ°çš„å¼‚å¸¸</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TypeMisMatch</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å‚æ•°ç±»å‹ä¸åŒ¹é…</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="modelpy"><a class="markdownIt-Anchor" href="#modelpy"></a> <a href="http://model.py">model.py</a></h2>
<p>ä¸»è¦ä¸ºé¢„å…ˆå®šä¹‰å¥½çš„ä¸€å®šä¼šå‡ºç°çš„å‚æ•°ç±»å‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestObj</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    é¢„å…ˆå®šä¹‰å¥½çš„æ¨¡å‹TestObj</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,<span class="built_in">id</span>:<span class="built_in">int</span></span>):</span><br><span class="line">        self.<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    é¢„å…ˆå®šä¹‰å¥½çš„æ¨¡å‹Person</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name:<span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.name = name</span><br></pre></td></tr></table></figure>
<h2 id="utilspy"><a class="markdownIt-Anchor" href="#utilspy"></a> <a href="http://utils.py">utils.py</a></h2>
<p>ä¸»è¦ä¸ºä¸€äº›å·¥å…·ï¼Œæ£€æŸ¥<code>override</code>ï¼Œè·å–å‡½æ•°å‚æ•°ï¼Œæ£€æŸ¥æ˜¯å¦å­ç±»ç­‰</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar,<span class="type">Callable</span>,<span class="type">Any</span>,<span class="type">Dict</span>,<span class="type">Union</span>,<span class="type">Type</span>,<span class="type">Tuple</span>,TypeVar</span><br><span class="line"><span class="keyword">from</span> pydantic.typing <span class="keyword">import</span> ForwardRef,evaluate_forwardref</span><br><span class="line"><span class="keyword">from</span> pydantic.fields <span class="keyword">import</span> ModelField</span><br><span class="line"><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> get_args, get_origin</span><br><span class="line"><span class="keyword">from</span> pydantic.typing <span class="keyword">import</span> is_union, is_none_type</span><br><span class="line"><span class="keyword">from</span> dependencies.exception <span class="keyword">import</span> TypeMisMatch</span><br><span class="line"></span><br><span class="line">T_Wrapped = TypeVar(<span class="string">&quot;T_Wrapped&quot;</span>,bound=<span class="type">Callable</span>)</span><br><span class="line">V = TypeVar(<span class="string">&quot;V&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">overrides</span>(<span class="params">InterfaceClass:<span class="built_in">object</span></span>)-&gt; <span class="type">Callable</span>[[T_Wrapped],T_Wrapped]:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    æ£€æŸ¥ä¸€ä¸ªæ–¹æ³•æ˜¯å¦ä¸ºçˆ¶ç±»çš„å®ç°</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func:T_Wrapped</span>):</span><br><span class="line">        <span class="keyword">assert</span> func.__name__ <span class="keyword">in</span> <span class="built_in">dir</span>(InterfaceClass),<span class="string">f&quot;Error! method:<span class="subst">&#123;func.__name__&#125;</span> not in class:<span class="subst">&#123;InterfaceClass&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_typed_signature</span>(<span class="params">call: <span class="type">Callable</span>[..., <span class="type">Any</span>]</span>) -&gt; inspect.Signature:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è·å–å¯è°ƒç”¨å¯¹è±¡ç­¾å&quot;&quot;&quot;</span></span><br><span class="line">    signature = inspect.signature(call)</span><br><span class="line">    globalns = <span class="built_in">getattr</span>(call, <span class="string">&quot;__globals__&quot;</span>, &#123;&#125;)</span><br><span class="line">    typed_params = [</span><br><span class="line">        inspect.Parameter(</span><br><span class="line">            name=param.name,</span><br><span class="line">            kind=param.kind,</span><br><span class="line">            default=param.default,</span><br><span class="line">            annotation=get_typed_annotation(param, globalns),</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">for</span> param <span class="keyword">in</span> signature.parameters.values()</span><br><span class="line">    ]</span><br><span class="line">    typed_signature = inspect.Signature(typed_params)</span><br><span class="line">    <span class="keyword">return</span> typed_signature</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_typed_annotation</span>(<span class="params">param: inspect.Parameter, globalns: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]</span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    è·å¾—å‚æ•°çš„ç±»å‹æ³¨è§£</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    annotation = param.annotation</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(annotation, <span class="built_in">str</span>):</span><br><span class="line">        annotation = ForwardRef(annotation)</span><br><span class="line">        annotation = evaluate_forwardref(annotation, globalns, globalns)</span><br><span class="line">    <span class="keyword">return</span> annotation</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generic_check_issubclass</span>(<span class="params"></span></span><br><span class="line"><span class="params">    cls: <span class="type">Any</span>, class_or_tuple: <span class="type">Union</span>[<span class="type">Type</span>[<span class="type">Any</span>], <span class="type">Tuple</span>[<span class="type">Type</span>[<span class="type">Any</span>], ...]]</span></span><br><span class="line"><span class="params"></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ£€æŸ¥ cls æ˜¯å¦æ˜¯ class_or_tuple ä¸­çš„ä¸€ä¸ªç±»å‹å­ç±»ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    ç‰¹åˆ«çš„ï¼Œå¦‚æœ cls æ˜¯ `typing.Union` æˆ– `types.UnionType` ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="string">    åˆ™ä¼šæ£€æŸ¥å…¶ä¸­çš„ç±»å‹æ˜¯å¦æ˜¯ class_or_tuple ä¸­çš„ä¸€ä¸ªç±»å‹å­ç±»ã€‚ï¼ˆNone ä¼šè¢«å¿½ç•¥ï¼‰</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">issubclass</span>(cls, class_or_tuple)</span><br><span class="line">    <span class="keyword">except</span> TypeError:</span><br><span class="line">        origin = get_origin(cls)</span><br><span class="line">        <span class="keyword">if</span> is_union(origin):</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">all</span>(</span><br><span class="line">                is_none_type(type_) <span class="keyword">or</span> generic_check_issubclass(type_, class_or_tuple)</span><br><span class="line">                <span class="keyword">for</span> type_ <span class="keyword">in</span> get_args(cls)</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">elif</span> origin:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">issubclass</span>(origin, class_or_tuple)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_field_type</span>(<span class="params">field: ModelField, value: V</span>) -&gt; V:</span><br><span class="line">    _, errs_ = field.validate(value, &#123;&#125;, loc=())</span><br><span class="line">    <span class="keyword">if</span> errs_:</span><br><span class="line">        <span class="keyword">raise</span> TypeMisMatch(field, value)</span><br><span class="line">    <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>
<h2 id="paramspy"><a class="markdownIt-Anchor" href="#paramspy"></a> <a href="http://params.py">params.py</a></h2>
<p>ä¸»è¦ä¸ºä¾èµ–æ³¨å…¥ç»„ä»¶çš„å®šä¹‰ã€å®¹å™¨çš„å®šä¹‰ä»¥åŠå¯¹ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹çš„åŒ…è£…</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic.fields <span class="keyword">import</span> FieldInfo, ModelField, Required, Undefined</span><br><span class="line"><span class="keyword">from</span> pydantic.schema <span class="keyword">import</span> get_annotation_from_field_info</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseConfig</span><br><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> (</span><br><span class="line">    TYPE_CHECKING,</span><br><span class="line">    <span class="type">Optional</span>,</span><br><span class="line">    <span class="type">Callable</span>,</span><br><span class="line">    <span class="type">Any</span>,</span><br><span class="line">    <span class="type">List</span>,</span><br><span class="line">    <span class="type">Type</span>,</span><br><span class="line">    <span class="type">Dict</span>,</span><br><span class="line">    cast,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> dependencies.utils <span class="keyword">import</span> (</span><br><span class="line">    get_typed_signature,</span><br><span class="line">    overrides,</span><br><span class="line">    generic_check_issubclass,</span><br><span class="line">    check_field_type,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">from</span> dependencies.exception <span class="keyword">import</span> TypeMisMatch</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> TYPE_CHECKING:</span><br><span class="line">    <span class="keyword">from</span> dependencies.model <span class="keyword">import</span> TestObj, Person</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomConfig</span>(<span class="title class_ inherited__">BaseConfig</span>):</span><br><span class="line">    arbitrary_types_allowed = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Param</span>(abc.ABC, FieldInfo):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¾èµ–æ³¨å…¥å•å…ƒ å‚æ•°</span></span><br><span class="line"><span class="string">    ç»§æ‰¿è‡ª `pydantic.fields.FieldInfo`ï¼Œç”¨äºæè¿°å‚æ•°ä¿¡æ¯ï¼ˆä¸åŒ…æ‹¬å‚æ•°åï¼‰ã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.__class__.__name__&#125;</span>(<span class="subst">&#123;self.default&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, name: <span class="built_in">str</span>, param: inspect.Parameter</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è§£æå‡ºParam</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params">self, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ä»**kwargsä¸­æå–å‡ºParamå¯¹åº”value</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestParam</span>(<span class="title class_ inherited__">Param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    TestObjå¯¹åº”çš„åŒ…è£…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, name: <span class="built_in">str</span>, param: inspect.Parameter</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="keyword">from</span> dependencies.model <span class="keyword">import</span> TestObj</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> param.default == param.empty:</span><br><span class="line">            <span class="keyword">if</span> generic_check_issubclass(param.annotation, TestObj):</span><br><span class="line">                <span class="comment"># å¯ä»¥åŠ å­ç±»æ£€æŸ¥ï¼ŒæŒ‰ç…§ç±»å‹æ³¨å…¥</span></span><br><span class="line">                <span class="keyword">return</span> cls(Required)</span><br><span class="line">            <span class="keyword">elif</span> param.annotation == param.empty <span class="keyword">and</span> name == <span class="string">&quot;test&quot;</span>:</span><br><span class="line">                <span class="comment"># æ²¡æœ‰æ ‡æ³¨ä½†æ˜¯å˜é‡åæ˜¯testï¼ŒæŒ‰ç…§åå­—æ³¨å…¥</span></span><br><span class="line">                <span class="keyword">return</span> cls(Required)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @overrides(<span class="params">Param</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params">self, test: <span class="string">&quot;TestObj&quot;</span>, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="keyword">return</span> test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PersonParam</span>(<span class="title class_ inherited__">Param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Personå¯¹åº”çš„åŒ…è£…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, name: <span class="built_in">str</span>, param: inspect.Parameter</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="keyword">from</span> dependencies.model <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> param.default == param.empty:</span><br><span class="line">            <span class="keyword">if</span> generic_check_issubclass(param.annotation, Person):</span><br><span class="line">                <span class="comment"># å¯ä»¥åŠ å­ç±»æ£€æŸ¥ï¼ŒæŒ‰ç…§ç±»å‹æ³¨å…¥</span></span><br><span class="line">                <span class="keyword">return</span> cls(Required)</span><br><span class="line">            <span class="keyword">elif</span> param.annotation == param.empty <span class="keyword">and</span> name == <span class="string">&quot;person&quot;</span>:</span><br><span class="line">                <span class="comment"># æ²¡æœ‰æ ‡æ³¨ä½†æ˜¯å˜é‡åæ˜¯personï¼ŒæŒ‰ç…§åå­—æ³¨å…¥</span></span><br><span class="line">                <span class="keyword">return</span> cls(Required)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @overrides(<span class="params">Param</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params">self, person: <span class="string">&quot;Person&quot;</span>, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="keyword">return</span> person</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DependsInner</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å¯¹ç”¨æˆ·è‡ªå®šä¹‰ä¾èµ–çš„åŒ…è£…</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dependency: <span class="type">Optional</span>[<span class="type">Callable</span>[..., <span class="type">Any</span>]]</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.dependency = dependency</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DependParam</span>(<span class="title class_ inherited__">Param</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    å­ä¾èµ–å‚æ•°</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_check_param</span>(<span class="params"></span></span><br><span class="line"><span class="params">        cls, dependent: <span class="string">&quot;Dependent&quot;</span>, name: <span class="built_in">str</span>, param: inspect.Parameter</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Optional</span>[<span class="string">&quot;Param&quot;</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(param.default, DependsInner):</span><br><span class="line">            dependency: <span class="type">Callable</span>[..., <span class="type">Any</span>]</span><br><span class="line">            <span class="keyword">if</span> param.default.dependency <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">assert</span> param.annotation <span class="keyword">is</span> <span class="keyword">not</span> param.empty, <span class="string">&quot;Dependency cannot be empty&quot;</span></span><br><span class="line">                dependency = param.annotation</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dependency = param.default.dependency</span><br><span class="line">            sub_dependent = Dependent.parse(call=dependency)</span><br><span class="line">            <span class="keyword">return</span> cls(Required, dependent=sub_dependent)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @overrides(<span class="params">Param</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_solve</span>(<span class="params">self, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="comment"># å­ä¾èµ–</span></span><br><span class="line">        sub_dependent: Dependent = self.extra[<span class="string">&quot;dependent&quot;</span>]</span><br><span class="line">        sub_dependent.call = cast(<span class="type">Callable</span>[..., <span class="type">Any</span>], sub_dependent.call)</span><br><span class="line">        call = sub_dependent.call</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£æå‡ºåµŒå¥—ä¾èµ–çš„è¿”å›å€¼</span></span><br><span class="line">        sub_values = sub_dependent.solve(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è§£æå½“å‰çš„è¿”å›å€¼</span></span><br><span class="line">        solved = call(**sub_values)</span><br><span class="line">        <span class="keyword">return</span> solved</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dependent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ä¾èµ–æ³¨å…¥å®¹å™¨</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    ALL_TYPES: <span class="type">List</span>[<span class="type">Type</span>[Param]] = [TestParam, PersonParam, DependParam]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        call: <span class="type">Optional</span>[<span class="type">Callable</span>[..., <span class="type">Any</span>]],</span></span><br><span class="line"><span class="params">        *,</span></span><br><span class="line"><span class="params">        params: <span class="type">Optional</span>[<span class="type">List</span>[ModelField]] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.call = call</span><br><span class="line">        self.params = params <span class="keyword">or</span> []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_param</span>(<span class="params">self, name: <span class="built_in">str</span>, param: inspect.Parameter</span>) -&gt; Param:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å°†æœªçŸ¥å‚æ•°è½¬ä¸ºä¾èµ–æ³¨å…¥Param</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> types <span class="keyword">in</span> self.ALL_TYPES:</span><br><span class="line">            field_info = types._check_param(self, name, param)</span><br><span class="line">            <span class="keyword">if</span> field_info:</span><br><span class="line">                <span class="keyword">return</span> field_info</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(</span><br><span class="line">                <span class="string">f&quot;Unknown parameter <span class="subst">&#123;name&#125;</span> for function <span class="subst">&#123;self.call&#125;</span> with type <span class="subst">&#123;param.annotation&#125;</span>&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">cls, *, call: <span class="type">Callable</span>[..., <span class="type">Any</span>]</span>) -&gt; <span class="string">&quot;Dependent&quot;</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        å¯¹Callableè§£æå‡ºå®¹å™¨</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        signature = get_typed_signature(call=call)  <span class="comment"># è·å–å‡½æ•°ç­¾å</span></span><br><span class="line">        params = signature.parameters  <span class="comment"># è·å–å‡½æ•°å‚æ•°ä¿¡æ¯</span></span><br><span class="line">        dependent = cls(call=call)  <span class="comment"># åˆ›å»ºå®¹å™¨</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> param_name, param <span class="keyword">in</span> params.items():</span><br><span class="line">            default_value = Required</span><br><span class="line">            <span class="keyword">if</span> param.default != param.empty:</span><br><span class="line">                default_value = param.default</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(default_value, Param):</span><br><span class="line">                <span class="comment"># param æœ¬èº«å°±æ˜¯FieldInfo</span></span><br><span class="line">                field_info = default_value</span><br><span class="line">                default_value = field_info.default</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># ä¸æ˜¯ Param ç±»å‹çš„éœ€è¦æ‰“åŒ…æˆParam</span></span><br><span class="line">                field_info = dependent.parse_param(param_name, param)</span><br><span class="line">                default_value = field_info.default</span><br><span class="line"></span><br><span class="line">            annotation: <span class="type">Any</span> = <span class="type">Any</span></span><br><span class="line">            required = default_value == Required</span><br><span class="line">            <span class="keyword">if</span> param.annotation != param.empty:</span><br><span class="line">                annotation = param.annotation</span><br><span class="line">            annotation = get_annotation_from_field_info(  <span class="comment"># éªŒè¯annotation</span></span><br><span class="line">                annotation, field_info, param_name</span><br><span class="line">            )</span><br><span class="line">            dependent.params.append(  <span class="comment"># å°†è§£æå‡ºçš„Paramæ·»åŠ åˆ°å®¹å™¨çš„ä¾èµ–ä¸­</span></span><br><span class="line">                ModelField(</span><br><span class="line">                    name=param_name,</span><br><span class="line">                    type_=annotation,</span><br><span class="line">                    class_validators=<span class="literal">None</span>,</span><br><span class="line">                    model_config=CustomConfig,</span><br><span class="line">                    default=<span class="literal">None</span> <span class="keyword">if</span> required <span class="keyword">else</span> default_value,</span><br><span class="line">                    required=required,</span><br><span class="line">                    field_info=field_info,</span><br><span class="line">                )</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dependent</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        **params: <span class="type">Any</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        values: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125;  <span class="comment"># è§£æå‡ºçš„ name:param_value</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> self.params:</span><br><span class="line">            field_info = field.field_info</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">isinstance</span>(field_info, Param), <span class="string">&quot;Params must be subclasses of Param&quot;</span></span><br><span class="line">            value = field_info._solve(**params)  <span class="comment"># è§£æå‡ºå½“å‰å‚æ•°å¯¹åº”çš„å€¼</span></span><br><span class="line">            <span class="keyword">if</span> value <span class="keyword">is</span> Undefined:</span><br><span class="line">                value = field.get_default()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                values[field.name] = check_field_type(field, value) <span class="comment"># æ£€æŸ¥ç±»å‹å’Œå€¼æ˜¯å¦å¯¹åº”ï¼Œå¹¶æ·»åŠ åˆ°å­—å…¸ä¸­</span></span><br><span class="line">            <span class="keyword">except</span> TypeMisMatch:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">f&quot;<span class="subst">&#123;field_info&#125;</span> &quot;</span></span><br><span class="line">                    <span class="string">f&quot;type <span class="subst">&#123;<span class="built_in">type</span>(value)&#125;</span> not match depends <span class="subst">&#123;self.call&#125;</span> &quot;</span></span><br><span class="line">                    <span class="string">f&quot;annotation <span class="subst">&#123;field._type_display()&#125;</span>, ignored&quot;</span></span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> values</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, **kwargs: <span class="type">Any</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        values = self.solve(**kwargs) <span class="comment"># è§£æå‡ºå‡½æ•°çš„éœ€è¦çš„å€¼ å­—å…¸å½¢å¼</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self.call(**values) <span class="comment"># æ³¨å…¥å‚æ•°è®¡ç®—è¿”å›</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Dependent <span class="subst">&#123;self.__class__.__name__&#125;</span> call=<span class="subst">&#123;self.call.__name__&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Depends</span>(<span class="params">dependency: <span class="type">Optional</span>[<span class="type">Callable</span>[..., <span class="type">Any</span>]] = <span class="literal">None</span></span>) -&gt; <span class="type">Any</span>:  <span class="comment"># noqa: N802</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    å¯¹ç”¨æˆ·ä¾èµ–è¿›è¡ŒåŒ…è£…</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> DependsInner(dependency=dependency) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="æµ‹è¯•ç»“æœ"><a class="markdownIt-Anchor" href="#æµ‹è¯•ç»“æœ"></a> æµ‹è¯•ç»“æœ</h1>
<p>demoå¦‚ä¸‹ï¼Œçœå»äº†<code>nonebot</code>ä¸­é€šè¿‡è£…é¥°å™¨æ³¨å†Œå®¹å™¨ï¼Œå’Œé€‰æ‹©handlerè¿è¡Œ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span></span><br><span class="line"><span class="keyword">from</span> dependencies.model <span class="keyword">import</span> TestObj,Person</span><br><span class="line"><span class="keyword">from</span> dependencies.params <span class="keyword">import</span> Depends,Dependent</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Fore</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provider1</span>(<span class="params">person</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>]:</span><br><span class="line">    <span class="built_in">print</span>(Fore.GREEN + <span class="string">&quot;----in provider1-----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;person&#x27;name :<span class="subst">&#123;person.name&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-------end-------&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;c&quot;</span>: <span class="number">123</span>,<span class="string">&quot;d&quot;</span>:<span class="number">999</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">provider2</span>(<span class="params">dep:<span class="type">Dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>]=Depends(<span class="params">provider1</span>)</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>]:</span><br><span class="line">    <span class="built_in">print</span>(Fore.RED + <span class="string">&quot;----in provider2-----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;in provider 2 dep are:<span class="subst">&#123;dep&#125;</span>&quot;</span>)</span><br><span class="line">    return_values:<span class="type">Dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>] = &#123;<span class="string">&quot;a&quot;</span>: <span class="number">123</span>,<span class="string">&quot;b&quot;</span>:<span class="number">999</span>&#125;</span><br><span class="line">    return_values.update(dep)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-------end-------&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> return_values</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_func</span>(<span class="params">test:TestObj,dep : <span class="type">Dict</span>[<span class="built_in">str</span>,<span class="built_in">int</span>] = Depends(<span class="params">provider2</span>)</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    åŸå§‹å‡½æ•°</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(Fore.CYAN + <span class="string">&quot;----in test_func-----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;testparam&#x27;s id:<span class="subst">&#123;test.<span class="built_in">id</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----print dict-----&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(dep)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-------end-------&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># è¿è¡Œå‰æ³¨å†Œ</span></span><br><span class="line">    d = Dependent.parse(call=test_func)</span><br><span class="line">    <span class="comment"># å¤–éƒ¨å‚æ•°</span></span><br><span class="line">    p = Person(<span class="string">&quot;test person&quot;</span>)</span><br><span class="line">    t = TestObj(<span class="number">6</span>)</span><br><span class="line">    <span class="comment"># çœå»æŒ‘é€‰handleræ­¥éª¤ï¼Œç›´æ¥æ‰§è¡ŒåŸå‡½æ•°</span></span><br><span class="line">    d(test = t,person=p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.1/result.png" alt="result" /></p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>ç®€å•å®ç°ä¸€ä¸‹<code>nonebot2</code>çš„ä¾èµ–æ³¨å…¥ï¼Œå…¶å®å¯ä»¥å‘ç°é‡Œé¢çš„é€»è¾‘éå¸¸ç®€å•ï¼Œå¯ä»¥ç®€åŒ–ä¸ºé€šè¿‡åå°„è·å–å‡½æ•°çš„å‚æ•°ä¿¡æ¯ï¼Œç„¶åå°†åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸valuesï¼Œkeyæ˜¯å‚æ•°åï¼Œvalueæ˜¯å‚æ•°å€¼ï¼Œç„¶åå°†å¤–éƒ¨çš„å…¨éƒ¨å‚æ•°æŒ‰ç…§å‚æ•°åæˆ–è€…å‚æ•°ç±»å‹æ”¾å…¥å­—å…¸ä¸­ï¼Œæœ€åé€šè¿‡<code>**kwargs</code>çš„å½¢å¼æ‰§è¡Œè¢«æ³¨å…¥å‡½æ•°ã€‚</p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<p><a href="https://v2.nonebot.dev/docs/">nonebot2æ–‡æ¡£</a></p>
<p><a href="https://github.com/nonebot/nonebot2">nonebot2</a></p>
<p><a href="https://stackoverflow.com/questions/14301967/bare-asterisk-in-function-arguments">Bare asterisk in function arguments?</a></p>
<p><a href="https://stackoverflow.com/questions/23038767/what-is-the-purpose-of-a-bare-asterisk-in-function-arguments">What is the purpose of a bare asterisk in function arguments?</a></p>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>nonebot</tag>
      </tags>
  </entry>
  <entry>
    <title>mann-kendallæ£€éªŒ</title>
    <url>/2022/12/22/mann-kendall-test/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºåœ¨é¡¹ç›®ä¸­å•æ¬¡çš„æ²»ç–—æ•ˆæœæ‰¾ä¸åˆ°ä»€ä¹ˆæŒ‡æ ‡ï¼Œç”¨çš„æ˜¯æ¨¡å‹å€’æ•°ç¬¬äºŒå±‚è¾“å‡ºçš„ç‰¹å¾å‘é‡å’Œä¸æ‚£ç—…çš„äººä¹‹é—´åšç‰¹å¾ç›¸ä¼¼åº¦çš„åˆ†æï¼Œä½†æ˜¯é•¿æœŸçš„æ²»ç–—åˆ†ææ‰¾ä¸åˆ°å¾ˆå¥½çš„æŒ‡æ ‡ï¼Œäºæ˜¯æƒ³åˆ°äº†ä½¿ç”¨æ—¶é—´åºåˆ—çš„è¶‹åŠ¿åšåˆ†æï¼Œå¯¹äºæ—¶é—´åºåˆ—è¶‹åŠ¿çš„æ£€éªŒæœ‰mann-kendallç®—æ³•ã€‚</p>
<h1 id="mann-kendallæ£€éªŒ"><a class="markdownIt-Anchor" href="#mann-kendallæ£€éªŒ"></a> mann-kendallæ£€éªŒ</h1>
<p>mann-kendallæ£€éªŒç”¨äºåˆ¤æ–­ç»™å®šçš„æ—¶é—´åºåˆ—æ˜¯å¦å­˜åœ¨çº¿æ€§å•è°ƒè¶‹åŠ¿ã€‚</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">H_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å‡è®¾ï¼šä¸å­˜åœ¨å•è°ƒè¶‹åŠ¿</li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å‡è®¾ï¼šä¸‰ç§
<ul>
<li>å­˜åœ¨å•è°ƒä¸Šå‡è¶‹åŠ¿</li>
<li>å­˜åœ¨å•è°ƒä¸‹é™è¶‹åŠ¿</li>
<li>å­˜åœ¨å•è°ƒä¸Šå‡æˆ–è€…å•è°ƒä¸‹é™è¶‹åŠ¿</li>
</ul>
</li>
</ul>
<h1 id="mann-kendallçš„å‡è®¾"><a class="markdownIt-Anchor" href="#mann-kendallçš„å‡è®¾"></a> mann-kendallçš„å‡è®¾</h1>
<p>ä»¥ä¸‹å‡è®¾æ˜¯mkæµ‹è¯•æ£€éªŒçš„åŸºç¡€</p>
<ul>
<li>åœ¨æ²¡æœ‰è¶‹åŠ¿çš„æ—¶å€™ï¼Œæ•°æ®æˆç‹¬ç«‹åŒåˆ†å¸ƒ</li>
<li>éšæ—¶é—´æ¨ç§»çš„è§‚å¯Ÿç»“æœä»£è¡¨çœŸå®æƒ…å†µçš„é‡‡æ ·</li>
<li>ç”¨äºé‡‡æ ·çš„æ–¹æ³•ã€ä»ªå™¨æµ‹é‡æ˜¯æ— åå·®çš„</li>
</ul>
<h1 id="ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#ä¼˜ç‚¹"></a> ä¼˜ç‚¹</h1>
<ul>
<li>
<p>ä¸å‡è®¾æ•°æ®æ˜¯ç¬¦åˆç‰¹å®šçš„åˆ†å¸ƒ</p>
</li>
<li>
<p>ä¸å—ç¼ºçœå€¼çš„å½±å“ï¼Œå—é‡‡æ ·å€¼æ•°é‡çš„å½±å“</p>
</li>
<li>
<p>ä¸å—é‡‡æ ·æ—¶é—´é—´è·ä¸è§„åˆ™å½±å“</p>
</li>
<li>
<p>ä¸å—æ—¶é—´åºåˆ—é•¿åº¦å½±å“</p>
</li>
</ul>
<h1 id="å±€é™æ€§"><a class="markdownIt-Anchor" href="#å±€é™æ€§"></a> å±€é™æ€§</h1>
<ul>
<li>ä¸é€‚ç”¨ä¸å…·æœ‰å‘¨æœŸæ€§çš„æ•°æ®ï¼Œä¸ºäº†ä½¿æ•°æ®æœ‰æ•ˆï¼Œå»ºå»ºè®®é¢„å¤„ç†å‰åˆ é™¤å·²çŸ¥çš„å‘¨æœŸæ€§å½±å“</li>
<li>æ£€éªŒå¯¹è¾ƒçŸ­çš„æ•°æ®ç»™å‡ºè¾ƒå¤šåç»“æœï¼Œåºåˆ—è¶Šé•¿è¶‹åŠ¿æ£€æµ‹è¶Šæœ‰æ•ˆ</li>
</ul>
<h1 id="è®¡ç®—æ–¹æ³•"><a class="markdownIt-Anchor" href="#è®¡ç®—æ–¹æ³•"></a> è®¡ç®—æ–¹æ³•</h1>
<ol>
<li>æŒ‰ç…§æ—¶é—´é¡ºåºåˆ—å‡ºæ‰€æœ‰æ•°æ®<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1, x_2, ..., x_n
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>è®¡ç®—æ‰€æœ‰<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n(n-1)/2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span></span></span></span>ç§çš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_j-x_k
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8694379999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>çš„å·®å€¼å…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi><mo>&gt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">j \gt k
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span></span></span></span></li>
<li>è®¡ç®—ä¸Šä¸€æ­¥ä¸­å·®å€¼çš„<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">sgn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span></span></span></span>å‡½æ•°ç»“æœ</li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>g</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo>&gt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo>&lt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">sgn(x_i - x_j) =
    \begin{cases}
                    1,  &amp; x_i - x_j &gt; 0\\
                    0,  &amp; x_i - x_j = 0\\
                    -1, &amp; x_i - x_j &lt; 0
    \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.1500100000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord">1</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ol start="4">
<li>è®¡ç®—æ‰€æœ‰<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>g</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">sgn</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span></span></span></span>çš„å’Œ</li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>=</mo><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>âˆ‘</mo><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></munderover><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>âˆ‘</mo><mrow><mi>j</mi><mo>âˆ’</mo><mi>k</mi><mo>+</mo><mn>1</mn></mrow><mi>n</mi></munderover><mtext>sgn</mtext><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mstyle></mstyle></mrow><annotation encoding="application/x-tex">S = \displaystyle\sum_{k-1}^{n-1}\displaystyle\sum_{j-k+1}^{n}\text{sgn}(x_j-x_k) 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2393340000000004em;vertical-align:-1.438221em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000002em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.360444em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.438221em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord text"><span class="mord">sgn</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ol start="5">
<li>è®¡ç®—æ–¹å·®<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">VAR(S)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mclose">)</span></span></span></span>ï¼Œå…¬å¼å¦‚ä¸‹ã€‚å…¶ä¸­gæ˜¯æœ‰ç›¸åŒæ•°æ®çš„ç»„çš„æ•°é‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mi>p</mi></msub></mrow><annotation encoding="application/x-tex">t_p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>æ˜¯ç›¸åŒæ•°æ®çš„æ•°é‡ã€‚ä¾‹å¦‚åºåˆ—[23, 24, 29, 6, 29, 24, 24, 29, 23]ä¸­ï¼Œæˆ‘ä»¬æœ‰g=3ä¸ªç›¸åŒæ•°æ®ç»„ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>1</mn></msub><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">t_1=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>ï¼Œå› ä¸ºåºåˆ—ä¸­æœ‰2ä¸ª23ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>2</mn></msub><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">t_2=3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>ï¼Œå› ä¸ºæ•°æ®ä¸­æœ‰3ä¸ª24ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>t</mi><mn>3</mn></msub><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">t_3=3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span>å› ä¸ºæ•°æ®ä¸­æœ‰3ä¸ª29</li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtext>VAR</mtext><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>18</mn></mfrac><mo fence="false">[</mo><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>2</mn><mi>n</mi><mo>+</mo><mn>5</mn><mo stretchy="false">)</mo><mo>âˆ’</mo><mstyle scriptlevel="0" displaystyle="true"><munderover><mo>âˆ‘</mo><mrow><mi>p</mi><mo>âˆ’</mo><mn>1</mn></mrow><mi>g</mi></munderover><msub><mi>t</mi><mi>p</mi></msub><mo stretchy="false">(</mo><msub><mi>t</mi><mi>p</mi></msub><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>2</mn><msub><mi>t</mi><mi>p</mi></msub><mo>+</mo><mn>5</mn><mo stretchy="false">)</mo><mo fence="false">]</mo></mstyle></mrow><annotation encoding="application/x-tex">\text{VAR}(S) = \frac{1}{18}\Big[n(n-1)(2n+5) 
 - \displaystyle\sum_{p-1}^{g}t_p(t_p-1)(2t_p+5)\Big] 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">VAR</span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="delimsizing size2">[</span></span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.101726em;vertical-align:-1.403221em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985050000000002em;"><span style="top:-1.8828869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">âˆ‘</span></span></span><span style="top:-4.347113em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">g</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.403221em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">2</span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">p</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.80002em;vertical-align:-0.65002em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mord"><span class="delimsizing size2">]</span></span></span></span></span></span></p>
<ol start="6">
<li>è®¡ç®—mann kendallæ£€éªŒçš„ç»Ÿè®¡é‡</li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Z</mi><mrow><mi>M</mi><mi>K</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi>S</mi><mo>âˆ’</mo><mn>1</mn></mrow><msqrt><mrow><mi>V</mi><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow></msqrt></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>S</mi><mo>&gt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>S</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi>S</mi><mo>+</mo><mn>1</mn></mrow><msqrt><mrow><mi>V</mi><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow></msqrt></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>S</mi><mo>&lt;</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">Z_{MK} =
    \begin{cases}
                    \frac{S - 1} {\sqrt{VAR(S)}},  &amp; S &gt; 0\\
                    0,  &amp; S = 0\\
                    \frac{S + 1} {\sqrt{VAR(S)}},  &amp; S &lt; 0\\
    \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:5.115200000000001em;vertical-align:-2.3076000000000003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65002em;"><span style="top:-1.8999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-1.8999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-2.1999899999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.90002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8076000000000003em;"><span style="top:-4.807600000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.4641625em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0369107142857144em;"><span class="svg-align" style="top:-3.428571428571429em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span><span style="top:-3.0089107142857143em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5428571428571431em;"><svg width='400em' height='1.5428571428571431em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4196607142857143em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8295999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span><span style="top:-2.9699999999999998em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-1.5299999999999996em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.4641625em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0369107142857144em;"><span class="svg-align" style="top:-3.428571428571429em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span><span style="top:-3.0089107142857143em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5428571428571431em;"><svg width='400em' height='1.5428571428571431em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4196607142857143em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8295999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3076000000000003em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8076000000000003em;"><span style="top:-4.807600000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-2.9699999999999998em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-1.5299999999999996em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3076000000000003em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<ol start="7">
<li>æ£€éªŒå‡è®¾ï¼šæ˜¾è‘—æ€§æ°´å¹³<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>ï¼ˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>a</mi><mo>&lt;</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">0&lt;a&lt;0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span>ï¼‰è¡¨ç¤ºäº†MKæ£€éªŒä¸­é”™è¯¯çš„æ‹’ç»åŸå‡è®¾çš„å¯å®¹å¿æ¦‚ç‡
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">H_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å‡è®¾:æ— è¶‹åŠ¿</li>
<li>å•è°ƒä¸Šå‡è¶‹åŠ¿
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å‡è®¾:å•è°ƒä¸Šå‡è¶‹åŠ¿</li>
<li>å¦‚æœ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Z</mi><mrow><mi>M</mi><mi>K</mi></mrow></msub><mo>â‰¥</mo><msub><mi>Z</mi><mrow><mn>1</mn><mo>âˆ’</mo><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{MK} \geq Z_{1-a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span> å°±æ¥å—å‡è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Z</mi><mrow><mn>1</mn><mo>âˆ’</mo><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Z_{1-a}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">a</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>è¡¨ç¤ºæ­£æ€åˆ†å¸ƒä¸­ç¬¬100(1-a)ä¸ªç™¾åˆ†ä½æ•°</li>
</ul>
</li>
<li>å•è°ƒä¸‹é™è¶‹åŠ¿
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å‡è®¾:å•è°ƒä¸‹é™è¶‹åŠ¿</li>
<li>å¦‚æœ$Z_{MK} \leq -Z_{1-a} $ å°±æ¥å—å‡è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
<li>å­˜åœ¨å•è°ƒä¸Šå‡æˆ–è€…å•è°ƒä¸‹é™è¶‹åŠ¿
<ul>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å‡è®¾:å­˜åœ¨å•è°ƒä¸Šå‡æˆ–è€…å•è°ƒä¸‹é™è¶‹åŠ¿</li>
<li>å¦‚æœ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">âˆ£</mi><msub><mi>Z</mi><mrow><mi>M</mi><mi>K</mi></mrow></msub><mi mathvariant="normal">âˆ£</mi><mo>â‰¥</mo><msub><mi>Z</mi><mrow><mn>1</mn><mo>âˆ’</mo><mi>a</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">|Z_{MK}| \geq Z_{1-a/2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.03853em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">a</span><span class="mord mtight">/</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span> å°±æ¥å—å‡è®¾ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>H</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">H_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.08125em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">a</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="ä¿®æ­£å…¬å¼"><a class="markdownIt-Anchor" href="#ä¿®æ­£å…¬å¼"></a> ä¿®æ­£å…¬å¼</h1>
<p>å› ä¸ºmkæ£€éªŒä¸­ä¸€ä¸ªé‡è¦çš„æ­¥éª¤å°±æ˜¯è®¡ç®—ä¸¤æ¬¡æµ‹é‡ä¹‹é—´çš„å·®å¼‚å¤§äºã€ç­‰äºè¿˜æ˜¯å°äº0.å¦‚æœæˆ‘ä»¬çš„æµ‹é‡çš„xç²¾åº¦<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Îµ</mi><mo>=</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">\varepsilon = 0.01</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">Îµ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">1</span></span></span></span>ï¼Œç”±äºå­˜åœ¨æµ®ç‚¹è®¡ç®—è¯¯å·®å¯èƒ½æœ‰<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>27</mn></msub><mo>âˆ’</mo><msub><mi>x</mi><mn>11</mn></msub><mo>=</mo><mn>0.000251</mn><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">x_{27} - x_{11} = 0.000251 &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">2</span><span class="mord">5</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>ï¼Œè¿™ä¸ªå¤§äº0çš„å€¼å…¶å®æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºåœ¨å®é™…çš„æµ‹é‡ä¸­æ˜¯æ— æ³•ç¡®å®šè¿™ä¹ˆå°çš„å·®å¼‚ï¼Œå› æ­¤åœ¨mkæ£€éªŒçš„å®ç°ä¸­æˆ‘ä»¬åŠ å…¥äº†ä¸€ä¸ª<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Îµ</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">Îµ</span></span></span></span>æ¥è§£å†³<br />
ä¿®æ”¹ä¸Šé¢ä¸¤ä¸ªå…¬å¼</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>s</mi><mi>g</mi><mi>n</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo>&gt;</mo><mi>Îµ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">âˆ£</mi><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mi mathvariant="normal">âˆ£</mi><mo>â‰¤</mo><mi>Îµ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><msub><mi>x</mi><mi>j</mi></msub><mo>&lt;</mo><mo>âˆ’</mo><mi>Îµ</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">sgn(x_i - x_j) =
    \begin{cases}
                    1,  &amp; x_i - x_j &gt; \varepsilon\\
                    0,  &amp; |x_i - x_j| \leq \varepsilon\\
                    -1, &amp; x_i - x_j &lt; -\varepsilon
    \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.1500100000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">1</span><span class="mpunct">,</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">âˆ’</span><span class="mord">1</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">Îµ</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">Îµ</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">âˆ’</span><span class="mord mathdefault">Îµ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Z</mi><mrow><mi>M</mi><mi>K</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi>S</mi><mo>âˆ’</mo><mn>1</mn></mrow><msqrt><mrow><mi>V</mi><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow></msqrt></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>S</mi><mo>&gt;</mo><mi>Îµ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">âˆ£</mi><mi>S</mi><mi mathvariant="normal">âˆ£</mi><mo>â‰¤</mo><mi>Îµ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi>S</mi><mo>+</mo><mn>1</mn></mrow><msqrt><mrow><mi>V</mi><mi>A</mi><mi>R</mi><mo stretchy="false">(</mo><mi>S</mi><mo stretchy="false">)</mo></mrow></msqrt></mfrac><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>S</mi><mo>&lt;</mo><mo>âˆ’</mo><mi>Îµ</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">Z_{MK} =
    \begin{cases}
                    \frac{S - 1} {\sqrt{VAR(S)}},  &amp; S &gt;
                    \varepsilon\\
                    0,  &amp; |S| \leq \varepsilon\\
                    \frac{S + 1} {\sqrt{VAR(S)}},  &amp; S &lt;
                    -\varepsilon\\
    \end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:5.115200000000001em;vertical-align:-2.3076000000000003em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.65002em;"><span style="top:-1.8999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-1.8999899999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-2.1999899999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.15001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.90002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.15002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8076000000000003em;"><span style="top:-4.807600000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.4641625em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0369107142857144em;"><span class="svg-align" style="top:-3.428571428571429em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span><span style="top:-3.0089107142857143em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5428571428571431em;"><svg width='400em' height='1.5428571428571431em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4196607142857143em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8295999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span><span style="top:-2.9699999999999998em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">0</span><span class="mpunct">,</span></span></span><span style="top:-1.5299999999999996em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.4641625em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0369107142857144em;"><span class="svg-align" style="top:-3.428571428571429em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mord mathdefault mtight" style="margin-right:0.22222em;">V</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mopen mtight">(</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mclose mtight">)</span></span></span><span style="top:-3.0089107142857143em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.5428571428571431em;"><svg width='400em' height='1.5428571428571431em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4196607142857143em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.8295999999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3076000000000003em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.8076000000000003em;"><span style="top:-4.807600000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">Îµ</span></span></span><span style="top:-2.9699999999999998em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">âˆ£</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord">âˆ£</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault">Îµ</span></span></span><span style="top:-1.5299999999999996em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">âˆ’</span><span class="mord mathdefault">Îµ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.3076000000000003em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h1 id="å®ç°ä»£ç "><a class="markdownIt-Anchor" href="#å®ç°ä»£ç "></a> å®ç°ä»£ç </h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> norm</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_preprocess</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    æ•°æ®é¢„å¤„ç† è¿”å›æ‹‰å¹³çš„xå’Œé€šé“æ•°</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    x = np.asarray(x).astype(<span class="built_in">float</span>)</span><br><span class="line">    dim = x.ndim</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> dim == <span class="number">1</span>:</span><br><span class="line">        c = <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> dim == <span class="number">2</span>:</span><br><span class="line">        (_, c) = x.shape</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> c == <span class="number">1</span>:</span><br><span class="line">            x = x.flatten()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="number">1</span> == dim, <span class="string">&quot;please check you input shape&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x, c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_missing_values_analysis</span>(<span class="params">x, method: <span class="built_in">str</span> = <span class="string">&quot;skip&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ç¼ºçœå€¼é¢„å¤„ç†ï¼Œé»˜è®¤æŠ›å¼ƒ</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    method = method.lower()</span><br><span class="line">    <span class="keyword">assert</span> method <span class="keyword">in</span> [<span class="string">&quot;skip&quot;</span>], <span class="string">f&quot;method: <span class="subst">&#123;method&#125;</span> is not allow&quot;</span></span><br><span class="line">    <span class="keyword">if</span> method == <span class="string">&quot;skip&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> x.ndim == <span class="number">1</span>:</span><br><span class="line">            x = x[~np.isnan(x)]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x = x[~np.isnan(x).<span class="built_in">any</span>(axis=<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">    n = <span class="built_in">len</span>(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x, n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_mk_score</span>(<span class="params">x, n, eps=<span class="number">1e-6</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®— mkç®—æ³•såˆ†æ•°</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    sgn = np.zeros((n, n), dtype=<span class="string">&quot;int&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        tmp = x - x[i]</span><br><span class="line">        tmp[np.where(np.fabs(tmp) &lt;= eps)] = <span class="number">0.0</span>  <span class="comment"># å¯¹0ç‰¹æ®Šå¤„ç†</span></span><br><span class="line">        sgn[i] = np.sign(tmp)</span><br><span class="line"></span><br><span class="line">    s = sgn[np.triu_indices(n, k=<span class="number">1</span>)].<span class="built_in">sum</span>()  <span class="comment"># å–ä¸Šä¸‰è§’ï¼Œä¸å«å¯¹è§’çº¿</span></span><br><span class="line">    <span class="keyword">return</span> s, sgn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_variance_s</span>(<span class="params">x, sgn, n,eps=<span class="number">1e-6</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    è®¡ç®—æ–¹å·®</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    np.fill_diagonal(sgn,eps*<span class="number">1e6</span>)</span><br><span class="line">    i,_ = np.where(sgn==<span class="number">0.</span>)</span><br><span class="line">    ties = np.unique(x[i]) <span class="comment">#é‡å¤çš„ç‚¹</span></span><br><span class="line">    p = <span class="built_in">len</span>(ties)</span><br><span class="line">    q = np.zeros(<span class="built_in">len</span>(ties), dtype=<span class="string">&quot;int&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(p):</span><br><span class="line">        idx = np.where(np.fabs(x-ties[k])&lt;eps)</span><br><span class="line">        q[k] = <span class="built_in">len</span>(idx)</span><br><span class="line"></span><br><span class="line">    term1 = n * (n - <span class="number">1</span>) * (<span class="number">2</span> * n + <span class="number">5</span>)</span><br><span class="line">    term2 = (q * (q - <span class="number">1</span>) * (<span class="number">2</span> * q + <span class="number">5</span>)).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">    var_s = <span class="built_in">float</span>(term1 - term2) / <span class="number">18.</span></span><br><span class="line">    <span class="keyword">return</span> var_s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_z_score</span>(<span class="params">s,var_s,eps=<span class="number">1e-6</span></span>):</span><br><span class="line">    <span class="keyword">if</span> s &gt; eps:</span><br><span class="line">        z = (s-<span class="number">1</span>)/np.sqrt(var_s)</span><br><span class="line">    <span class="keyword">elif</span> np.fabs(s) &lt;= eps:</span><br><span class="line">        z = <span class="number">0.</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        z = (s+<span class="number">1</span>) / np.sqrt(var_s)</span><br><span class="line">    <span class="keyword">return</span> z</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_p_value</span>(<span class="params">z,alpha</span>):</span><br><span class="line">    <span class="comment"># åŒç«¯æµ‹è¯•</span></span><br><span class="line">    p = <span class="number">2</span>*(<span class="number">1</span>-norm.cdf(<span class="built_in">abs</span>(z)))  </span><br><span class="line">    h = <span class="built_in">abs</span>(z) &gt; norm.ppf(<span class="number">1</span>-alpha/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (z &lt; <span class="number">0</span>) <span class="keyword">and</span> h:</span><br><span class="line">        trend = <span class="string">&#x27;decreasing&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> (z &gt; <span class="number">0</span>) <span class="keyword">and</span> h:</span><br><span class="line">        trend = <span class="string">&#x27;increasing&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        trend = <span class="string">&#x27;no trend&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> p, h, trend</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mann_kendall_test</span>(<span class="params">x,alpha = <span class="number">0.05</span>, eps=<span class="number">1e-6</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    x: å¾…æ£€éªŒæ•°æ®</span></span><br><span class="line"><span class="string">    alpha: æ˜¾è‘—æ€§æ°´å¹³ å…è®¸é”™è¯¯å¦å®šå‡è®¾çš„è¯¯å·® 0~0.5</span></span><br><span class="line"><span class="string">    eps: æœ€å°è®¡æ•°è¯¯å·®</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    res = namedtuple(<span class="string">&quot;mann_kendall_result&quot;</span>,[<span class="string">&#x27;trend&#x27;</span>,<span class="string">&#x27;h&#x27;</span>,<span class="string">&#x27;p&#x27;</span>])</span><br><span class="line">    x, _ = _preprocess(x)</span><br><span class="line">    x, n = _missing_values_analysis(x)</span><br><span class="line">    s, sgn = _mk_score(x, n, eps=eps)</span><br><span class="line">    var_s = _variance_s(x,sgn,n,eps=eps)</span><br><span class="line">    z = _z_score(s,var_s,eps=eps)</span><br><span class="line">    p,h,trend = _p_value(z,alpha)</span><br><span class="line">    <span class="comment"># å¯¹äºmkç®—æ³• pä¸æ˜¯å¿…é¡»çš„</span></span><br><span class="line">    <span class="comment"># å¯ä»¥ç®—æ–œç‡ï¼Œä½†ç”¨ä¸ä¸Š</span></span><br><span class="line">    <span class="keyword">return</span> res(trend,h,p)</span><br></pre></td></tr></table></figure>
<h1 id="æµ‹è¯•æ•ˆæœ"><a class="markdownIt-Anchor" href="#æµ‹è¯•æ•ˆæœ"></a> æµ‹è¯•æ•ˆæœ</h1>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">x = np.arange(<span class="number">9</span>)</span><br><span class="line"><span class="built_in">print</span>(mann_kendall_test(x))</span><br><span class="line">x = np.random.sample(<span class="number">60</span>)</span><br><span class="line"><span class="built_in">print</span>(mann_kendall_test(x)) </span><br><span class="line">x = np.random.sample(<span class="number">60</span>) - np.arange(<span class="number">60</span>)</span><br><span class="line"><span class="built_in">print</span>(mann_kendall_test(x))</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mann_kendall_result(trend=<span class="string">&#x27;increasing&#x27;</span>, h=<span class="literal">True</span>, p=<span class="number">0.00026326080270355767</span>)</span><br><span class="line">mann_kendall_result(trend=<span class="string">&#x27;no trend&#x27;</span>, h=<span class="literal">False</span>, p=<span class="number">0.754646525401216</span>)</span><br><span class="line">mann_kendall_result(trend=<span class="string">&#x27;decreasing&#x27;</span>, h=<span class="literal">True</span>, p=<span class="number">0.0</span>)</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<ul>
<li><a href="https://up-rs-esp.github.io/mkt/#module-mkt">Mann-Kendall Test (mkt)</a></li>
<li><a href="https://blog.minitab.com/en/adventures-in-statistics-2/understanding-hypothesis-tests-significance-levels-alpha-and-p-values-in-statistics">Understanding Hypothesis Tests: Significance Levels (Alpha) and P values in Statistics</a></li>
<li><a href="https://github.com/mmhs013/pyMannKendall">pyMannKendall</a></li>
<li><a href="https://vsp.pnnl.gov/help/vsample/design_trend_mann_kendall.htm">Mann-Kendall Test For Monotonic Trend</a></li>
</ul>
]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>jsæ£€æµ‹å¼€å‘è€…å·¥å…·æ˜¯å¦æ‰“å¼€</title>
    <url>/2023/01/26/js-check-devtool/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€ŠUnless Terminaliaã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>åœ¨ä½¿ç”¨æµè§ˆå™¨å¯¹ä¸€äº›ç½‘ç«™è¿›è¡Œåˆ†æçš„æ—¶å€™ç»å¸¸ä¼šé‡åˆ°æ‰“å¼€å¼€å‘è€…å·¥å…·åè·³å‡ºdebuggeræˆ–è€…è¯´æ˜¯è·³è½¬åˆ°äº†åˆ«çš„ç½‘é¡µã€‚ä¸‹é¢æˆ‘ä¼šè®²ä¸€äº›ç½‘ç«™æ˜¯å¦‚ä½•åšåˆ°çš„å’Œåº”å¯¹æ–¹æ³•ã€‚</p>
<h1 id="debugger"><a class="markdownIt-Anchor" href="#debugger"></a> debugger</h1>
<p>ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>debugger</code>ï¼Œæ¯”å¦‚ç±³æ¸¸ç¤¾ç”¨çš„æ˜¯è¿™ç§ï¼Œå½“æ‰“å¼€å¼€å‘è€…å·¥å…·æ—¶ä¼šæœ‰debuggerè·³å‡ºæ•ˆæœå¦‚ä¸‹ï¼Œæ•ˆæœç±»ä¼¼äºç¨‹åºä¸­çš„æ–­ç‚¹ï¼Œç‚¹ç»§ç»­è°ƒè¯•çš„æ—¶å€™ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè®©äººå¿™äºå¤„ç†debugger<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.2/debugger.png" alt="" /></p>
<p>å®ç°èµ·æ¥ä¸ºå¦‚ä¸‹ä»£ç </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">check</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">debugger</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="built_in">setTimeout</span>(check, <span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">check</span>();</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç ´è§£æ–¹æ³•"><a class="markdownIt-Anchor" href="#ç ´è§£æ–¹æ³•"></a> ç ´è§£æ–¹æ³•</h2>
<p>å¯¹äºè¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦ç¦ç”¨debuggerå°±è¡Œï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç‚¹å‡»å¼€å‘ä¸­å·¥å…·ä¸­çš„deactivated breakpoints<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.2/debugger-hack.png" alt="" /></p>
<h1 id="ç¦ç”¨å³é”®å’Œf12"><a class="markdownIt-Anchor" href="#ç¦ç”¨å³é”®å’Œf12"></a> ç¦ç”¨å³é”®å’ŒF12</h1>
<p>ç¦ç”¨F12å’Œå³é”®ï¼Œä½¿å¾—æ— æ³•æ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚è¿™ç§æ–¹æ³•æœ‰ç‚¹æ©è€³ç›—é“ƒ</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// F12</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">onkeydown</span> = <span class="variable language_">window</span>.<span class="property">onkeyup</span> = <span class="variable language_">window</span>.<span class="property">onkeypress</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// åˆ¤æ–­æ˜¯å¦æŒ‰ä¸‹F12ï¼ŒF12é”®ç ä¸º123  </span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (event.<span class="property">keyCode</span> = <span class="number">123</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                event.<span class="title function_">preventDefault</span>(); <span class="comment">// é˜»æ­¢é»˜è®¤äº‹ä»¶è¡Œä¸º  </span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">window</span>.<span class="property">event</span>.<span class="property">returnValue</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// å³é”®</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">oncontextmenu</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            event.<span class="property">returnValue</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç ´è§£æ–¹æ³•-2"><a class="markdownIt-Anchor" href="#ç ´è§£æ–¹æ³•-2"></a> ç ´è§£æ–¹æ³•</h2>
<p>æŒ‰ä¸‹<code>ctrl+shift+I</code>æˆ–è€…ç‚¹å‡»chromeæµè§ˆå™¨å¤´åƒå³ä¾§çš„åœ°æ–¹é‡Œé¢çš„<code>æ›´å¤šå·¥å…·-&gt;å¼€å‘è€…å·¥å…·</code></p>
<h1 id="æ£€æµ‹çª—å£å¤§å°å˜åŒ–"><a class="markdownIt-Anchor" href="#æ£€æµ‹çª—å£å¤§å°å˜åŒ–"></a> æ£€æµ‹çª—å£å¤§å°å˜åŒ–</h1>
<p><code>window.outerHeight</code>å’Œ<code>window.outerWidth</code>è¿”å›æ•´ä¸ªæµè§ˆå™¨çª—å£çš„é«˜åº¦ï¼Œå®½åº¦ï¼ŒåŒ…æ‹¬ä¾§è¾¹æ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚<code>window.innerHeight</code>å’Œ<code>window.innerWidth</code>è¿”å›æµè§ˆå™¨è§†çª—å¤§å°ï¼Œå¦‚æœæœ‰æ»šåŠ¨æ¡ä¹ŸåŒ…å«æ»šåŠ¨æ¡ã€‚å…·ä½“åŒºåˆ†å¯è§ä¸‹å›¾</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.2/height.png" alt="" /></p>
<p>è¿™é‡Œå®ç°ç›´æ¥ç…§æ¬åˆ«äººçš„<a href="https://github.com/sindresorhus/devtools-detect">github</a>ï¼Œé™„å¸¦ä¸Šè¯¥åº“çš„<a href="https://sindresorhus.com/devtools-detect/">ä¾‹ç¨‹</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> devtools = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">isOpen</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">orientation</span>: <span class="literal">undefined</span>,</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// innerå’Œouterä¹‹é—´å¤§å°çš„é˜ˆå€¼</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> threshold = <span class="number">170</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// å®šä¹‰ç›‘å¬å¼€å‘è€…å·¥å…·äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="title function_">emitEvent</span> = (<span class="params">isOpen, orientation</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">            globalThis.<span class="title function_">dispatchEvent</span>(<span class="keyword">new</span> globalThis.<span class="title class_">CustomEvent</span>(<span class="string">&#x27;devtoolschange&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">detail</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    isOpen,</span></span><br><span class="line"><span class="language-javascript">                    orientation,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;));</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> <span class="title function_">main</span> = (<span class="params">&#123; emitEvents = <span class="literal">true</span> &#125; = &#123;&#125;</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> widthThreshold = globalThis.<span class="property">outerWidth</span> - globalThis.<span class="property">innerWidth</span> &gt; threshold;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> heightThreshold = globalThis.<span class="property">outerHeight</span> - globalThis.<span class="property">innerHeight</span> &gt; threshold;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> orientation = widthThreshold ? <span class="string">&#x27;vertical&#x27;</span> : <span class="string">&#x27;horizontal&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (</span></span><br><span class="line"><span class="language-javascript">                !(heightThreshold &amp;&amp; widthThreshold)</span></span><br><span class="line"><span class="language-javascript">                &amp;&amp; ((globalThis.<span class="property">Firebug</span> &amp;&amp; globalThis.<span class="property">Firebug</span>.<span class="property">chrome</span> &amp;&amp; globalThis.<span class="property">Firebug</span>.<span class="property">chrome</span>.<span class="property">isInitialized</span>) || widthThreshold || heightThreshold)</span></span><br><span class="line"><span class="language-javascript">            ) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// æœ‰è¶…è¿‡é˜ˆå€¼ æ˜¯æ‰“å¼€çš„</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> ((!devtools.<span class="property">isOpen</span> || devtools.<span class="property">orientation</span> !== orientation) &amp;&amp; emitEvents) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">emitEvent</span>(<span class="literal">true</span>, orientation);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                devtools.<span class="property">isOpen</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">                devtools.<span class="property">orientation</span> = orientation;</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// å¼€å‘è€…å·¥å…·æœªæ‰“å¼€</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (devtools.<span class="property">isOpen</span> &amp;&amp; emitEvents) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">emitEvent</span>(<span class="literal">false</span>, <span class="literal">undefined</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                devtools.<span class="property">isOpen</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">                devtools.<span class="property">orientation</span> = <span class="literal">undefined</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">main</span>(&#123; <span class="attr">emitEvents</span>: <span class="literal">false</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setInterval</span>(main, <span class="number">500</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;devtoolschange&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(event.<span class="property">detail</span>.<span class="property">isOpen</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="ç ´è§£æ–¹æ³•-3"><a class="markdownIt-Anchor" href="#ç ´è§£æ–¹æ³•-3"></a> ç ´è§£æ–¹æ³•</h2>
<p>è¿™ç§æ–¹æ³•éœ€è¦è®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå®¹æ˜“è¯¯è§¦å‘ã€‚ç ´è§£æ–¹æ³•å°±æ˜¯å°†å¼€å‘è€…å·¥å…·è®¾ç½®ä¸ºç‹¬ç«‹çª—å£ï¼Œè¿™æ ·å°±æ— æ³•æ£€æµ‹åˆ°çª—å£å˜åŒ–ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.2/resize-hack.png" alt="" /></p>
<h1 id="é‡å†™tostring"><a class="markdownIt-Anchor" href="#é‡å†™tostring"></a> é‡å†™toString</h1>
<div class="note red icon-padding simple"><i class="note-icon fa-solid fa-triangle-exclamation"></i><p>åœ¨æˆ‘çš„chrome 109.0.5414.119ä¸Šæ²¡æœ‰å¤ç°æˆåŠŸ</p>
</div>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•1</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(x, <span class="string">&#x27;id&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">get</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// å¼€å‘è€…å·¥å…·è¢«æ‰“å¼€</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(x);</span><br><span class="line"><span class="comment">//æ–¹æ³•2</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">c.<span class="property">toString</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// å¼€å‘è€…å·¥å…·è¢«æ‰“å¼€</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c);</span><br></pre></td></tr></table></figure>
<h2 id="ç ´è§£æ–¹æ³•-4"><a class="markdownIt-Anchor" href="#ç ´è§£æ–¹æ³•-4"></a> ç ´è§£æ–¹æ³•</h2>
<p>å¯¹äºä¸€äº›ä½¿ç”¨<code>console</code>åˆ¤æ–­çš„å¯ä»¥æŠŠ<code>console</code>çš„è¾“å‡ºå¤±æ•ˆã€‚è¿™é‡Œå¯ä»¥ç”¨<a href="https://github.com/546669204/fuck-debugger-extensions">æ’ä»¶</a>å®Œæˆ</p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>ä»¥ä¸Šå°±æ˜¯ä¸€äº›å¸¸è§çš„æ£€æµ‹æ–¹æ³•äº†ï¼Œè¿˜æœ‰ä¸€äº›å¯èƒ½æ²¡æœ‰è¯´åˆ°ï¼Œå¯ä»¥çœ‹ä¸€çœ‹<a href="https://github.com/AEPKILL/devtools-detector">devtools-detector</a>é‡Œé¢çš„å®ç°ã€‚</p>
<p>å› ä¸ºå‰ç«¯æ˜¯æºç ç»™åˆ°æµè§ˆå™¨ç”¨æˆ·çš„ï¼Œå…¶å®æƒ³è¦é¿å…è¢«æ‰’è¿˜æ˜¯æœ‰ç‚¹å›°éš¾ï¼Œä¸€äº›ç»„ç»‡åŠæ³•åªæ˜¯å¢åŠ æ‰’ä»£ç ä¸€æ–¹çš„éº»çƒ¦ï¼Œæˆ–è€…è¿‡æ»¤æ‰ä¸€éƒ¨åˆ†äººã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://paper.seebug.org/1900/#_24">å‰ç«¯ JS æ”»é˜²å¯¹æŠ—</a></p>
<p><a href="https://segmentfault.com/a/1190000021510230">å¦‚ä½•è§£å†³åè°ƒè¯•å›°æ‰°-chrome extension</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/outerHeight">Window.outerHeight</a></p>
<p><a href="https://github.com/sindresorhus/devtools-detect">devtools-detect</a></p>
<p><a href="https://github.com/546669204/fuck-debugger-extensions">fuck-debugger-extensions</a></p>
<p><a href="https://stackoverflow.com/questions/7798748/find-out-whether-chrome-console-is-open">Find out whether Chrome console is open</a></p>
<p><a href="https://github.com/AEPKILL/devtools-detector">devtools-detector</a></p>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>çˆ¬è™«</tag>
        <tag>javascript</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>å´©å3rd 2023æ–°å¹´ç¤¼ç›’å¼€ç®±</title>
    <url>/2023/02/08/honkai-gift-box-2023/</url>
    <content><![CDATA[<blockquote>
<p>mihoyoæ——èˆ°åº—ä¹°çš„å´©å3rd 2023å¹´æ–°å¹´ç¤¼ç›’ï¼ŒåŒ…å«æ´»é¡µæœ¬ã€è™šä¸‰å®¶äºšå…‹åŠ›ç«‹ç‰Œã€æ˜¥è”ã€è´ºå¡ã€çº¢åŒ…å¥—è£…å’Œå¾®ä¿¡çº¢åŒ…å°é¢å…‘æ¢å¡ã€‚</p>
</blockquote>
<blockquote>
<p>å°é¢æ¥è‡ªæ·˜å®å•†å“ç•Œé¢</p>
</blockquote>
<h1 id="ç¤¼ç›’ä¸»é¢˜"><a class="markdownIt-Anchor" href="#ç¤¼ç›’ä¸»é¢˜"></a> ç¤¼ç›’ä¸»é¢˜</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/front.jpg" alt="æ­£é¢" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/back.jpg" alt="åé¢" /></p>
<h1 id="ç¬¬ä¸€å±‚"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€å±‚"></a> ç¬¬ä¸€å±‚</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/first.jpg" alt="ç¬¬ä¸€å±‚" /></p>
<h2 id="çº¢åŒ…åŒ…è£…"><a class="markdownIt-Anchor" href="#çº¢åŒ…åŒ…è£…"></a> çº¢åŒ…åŒ…è£…</h2>
<p>å¾¡ä¸‰å®¶çš„çº¢åŒ…å°é¢éƒ½æŒºå¥½çœ‹çš„ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_153527.jpg" alt="çº¢åŒ…" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_163940.jpg" alt="å¾®ä¿¡çº¢åŒ…å…‘æ¢å¡" /></p>
<h2 id="æ˜¥è”"><a class="markdownIt-Anchor" href="#æ˜¥è”"></a> æ˜¥è”</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/couplets.jpg" alt="æ˜¥è”" /></p>
<h2 id="æ´»é¡µæœ¬"><a class="markdownIt-Anchor" href="#æ´»é¡µæœ¬"></a> æ´»é¡µæœ¬</h2>
<p>é‡Œé¢ä¹Ÿæ˜¯å°é¢å¾¡ä¸‰å®¶<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_154046.jpg" alt="æ´»é¡µæœ¬" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/kiana.jpg" alt="çªäºšå¨œ" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/mei.jpg" alt="èŠ½è¡£" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/bronya.jpg" alt="æ¿é¸­" /></p>
<h1 id="ç¬¬äºŒå±‚"><a class="markdownIt-Anchor" href="#ç¬¬äºŒå±‚"></a> ç¬¬äºŒå±‚</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/second.jpg" alt="ç¬¬äºŒå±‚" /></p>
<h2 id="è´ºå¡"><a class="markdownIt-Anchor" href="#è´ºå¡"></a> è´ºå¡</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_154254.jpg" alt="" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_154305.jpg" alt="" /></p>
<h2 id="äºšå…‹åŠ›ç«‹ç‰Œ"><a class="markdownIt-Anchor" href="#äºšå…‹åŠ›ç«‹ç‰Œ"></a> äºšå…‹åŠ›ç«‹ç‰Œ</h2>
<p>è¿™ä¸ªäºšå…‹åŠ›ç«‹ç‰Œåº”è¯¥æ˜¯ç¤¼ç›’é‡Œæˆ‘æœ€å–œæ¬¢çš„ï¼Œåº•åº§å¯ä»¥åˆå¹¶ä¹Ÿå¯ä»¥åˆ†å¼€<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_163940.jpg" alt="" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_154615.jpg" alt="" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.3/IMG_20230206_154634.jpg" alt="" /></p>
]]></content>
      <categories>
        <category>ç”Ÿæ´»</category>
      </categories>
      <tags>
        <tag>ç”Ÿæ´»</tag>
      </tags>
  </entry>
  <entry>
    <title>react nativeä½¿ç”¨github actionè‡ªåŠ¨é›†æˆandroid</title>
    <url>/2023/02/20/react-native-github-action/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šã•ãã‚‰ã®é›²ï¼Šã‚¹ã‚«ã‚¢ãƒ¬ãƒƒãƒˆã®æ‹ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºå†™äº†ä¸€ä¸ªåŸºäº react native çš„ appï¼Œæƒ³è¦ä½¿ç”¨ github action æ¥è¿›è¡Œè‡ªåŠ¨ç»§æ‰¿å’Œè‡ªåŠ¨éƒ¨ç½²ã€‚å› ä¸ºæˆ‘è¿™é‡Œæ²¡æœ‰ ios å¼€å‘ç¯å¢ƒï¼Œå› æ­¤å°±åªå†™ android æ–¹é¢çš„è‡ªåŠ¨éƒ¨ç½²</p>
<h1 id="å‡†å¤‡"><a class="markdownIt-Anchor" href="#å‡†å¤‡"></a> å‡†å¤‡</h1>
<p>åœ¨è¿›è¡Œè„šæœ¬éƒ¨ç½²ä¹‹å‰å…ˆçœ‹ä¸€ä¸‹ react native ç»™çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ android ç”Ÿæˆçš„ apk è¿›è¡Œç­¾åï¼Œåœ¨ windows ä¸Šæ‰§è¡Œä»¥ä¸‹è„šæœ¬</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">keytool <span class="literal">-genkeypair</span> <span class="literal">-v</span> <span class="literal">-storetype</span> PKCS12 <span class="literal">-keystore</span> my<span class="literal">-upload-key</span>.keystore <span class="literal">-alias</span> my<span class="literal">-key-alias</span> <span class="literal">-keyalg</span> RSA <span class="literal">-keysize</span> <span class="number">2048</span> <span class="literal">-validity</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>
<p>æŠŠ<code>my-upload-key.keystore</code>å’Œ<code>my-key-alias</code>æ¢æˆä½ è‡ªå·±éœ€è¦çš„åå­—ã€‚è®°ä½è‡ªå·±çš„aliaså’Œå¯†ç ï¼Œå¹¶ä¸”ä¿å­˜å¥½keystoreæ–‡ä»¶ï¼Œä¸è¦ä¸Šä¼ åˆ°ç‰ˆæœ¬åº“æˆ–æ³„éœ²äº†ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.4/generate-key.png" alt="" /></p>
<h1 id="æ•´ä½“æµç¨‹"><a class="markdownIt-Anchor" href="#æ•´ä½“æµç¨‹"></a> æ•´ä½“æµç¨‹</h1>
<p>æˆ‘ä»¬çš„actionæ€»ä½“æµç¨‹å¦‚ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ‹‰å–ä»£ç  -&gt; åŠ è½½yarnå’Œgradleç¼“å­˜ -&gt; å®‰è£…ä¾èµ– -&gt; ç¼–è¯‘ä»£ç  -&gt; å¯¹åŒ…è¿›è¡Œç­¾å -&gt; å‘å¸ƒåˆ°release</span><br></pre></td></tr></table></figure>
<h2 id="æ‹‰å–ä»£ç "><a class="markdownIt-Anchor" href="#æ‹‰å–ä»£ç "></a> æ‹‰å–ä»£ç </h2>
<p>è¿™é‡Œç›´æ¥ä½¿ç”¨<a href="https://github.com/actions/checkout">action/checkout</a></p>
<h2 id="åŠ è½½ç¼“å­˜"><a class="markdownIt-Anchor" href="#åŠ è½½ç¼“å­˜"></a> åŠ è½½ç¼“å­˜</h2>
<p>è¿™é‡Œä½¿ç”¨<a href="https://github.com/actions/cache">action/cache</a>ï¼Œä½¿ç”¨cacheå­˜yarnå’Œgradleçš„ç¼“å­˜</p>
<p>è¿™é‡Œä¸å­˜<code>node_modules</code>æ˜¯ç”±äºä¸åŒnodeç‰ˆæœ¬å¯èƒ½ä¸ä¸€æ ·ï¼ŒåŒæ—¶å¯¹<code>npm ci</code>ä¸èµ·ä½œç”¨</p>
<p>gradleçš„ç¼“å­˜æ—¶è¦æ³¨æ„å…³é—­gradleçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå› ä¸ºgradleæœ‰é”ï¼Œå¯èƒ½å¯¼è‡´ç¼“å­˜åˆ›å»ºå¤±è´¥ï¼Œç”¨<code>gradle &lt;task&gt; --no-daemon</code>è¿›è¡Œå…³é—­</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.4/cache.png" alt="cache" /><br />
å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†ç¼“å­˜åæ€»ä½“é€Ÿåº¦å¿«äº†å¾ˆå¤šï¼Œ</p>
<h3 id="ç¼“å­˜é™åˆ¶"><a class="markdownIt-Anchor" href="#ç¼“å­˜é™åˆ¶"></a> ç¼“å­˜é™åˆ¶</h3>
<p>ä¸€ä¸ªä»“åº“æœ€å¤š10Gç¼“å­˜ï¼Œè¶…è¿‡ä¸Šé™ä¼šå°†æœ€æ—©çš„ç¼“å­˜å»é™¤ï¼Œå¦å¤–ä¸Šå‘¨çš„ç¼“å­˜ä¹Ÿä¼šå»é™¤ã€‚</p>
<h2 id="å®‰è£…ä¾èµ–"><a class="markdownIt-Anchor" href="#å®‰è£…ä¾èµ–"></a> å®‰è£…ä¾èµ–</h2>
<p>è¿™é‡Œç›´æ¥<code>yarn</code>å°±è¡Œ</p>
<h2 id="ç¼–è¯‘ä»£ç "><a class="markdownIt-Anchor" href="#ç¼–è¯‘ä»£ç "></a> ç¼–è¯‘ä»£ç </h2>
<p>æŒ‰ç…§react nativeå®˜æ–¹ç»™çš„æ•™ç¨‹ï¼Œè®°å¾—åŠ ä¸Š<code>--no-daemon</code>ã€‚å¯ä»¥ç”Ÿæˆ<code>aab</code>æ ¼å¼æˆ–è€…<code>apk</code>æ ¼å¼ï¼Œ<code>aab</code>æ ¼å¼æ— æ³•ç›´æ¥å®‰è£…ï¼Œéœ€è¦è°·æ­Œå•†åº—ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”Ÿæˆ<code>apk</code>æ ¼å¼ã€‚ä¸¤è€…åŒºåˆ«å¯ä»¥çœ‹<a href="https://stackoverflow.com/questions/52059339/difference-between-apk-apk-and-app-bundle-aab">è¿™</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> android &amp;&amp; ./gradlew assembleRelease --no-daemon</span><br></pre></td></tr></table></figure>
<p>å¯¹äºç¼–è¯‘debugä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gradlew assembleDebug</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦ç”Ÿæˆ<code>aab</code>æ ¼å¼</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gradlew bundleRelease</span><br></pre></td></tr></table></figure>
<h2 id="ç­¾å"><a class="markdownIt-Anchor" href="#ç­¾å"></a> ç­¾å</h2>
<p>åœ¨react-nativeç»™å‡ºçš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹<code>build.gradle</code>æ–‡ä»¶å¡«å†™æˆ‘ä»¬å‰é¢ç”Ÿæˆçš„keystoreç­‰ä¿¡æ¯ï¼Œä¸è¿‡åœ¨GitHub Actioné‡Œé¢æˆ‘ä»¬å¯ä»¥ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ¥å­˜æ”¾éœ€è¦ä¿å¯†çš„ä¿¡æ¯ï¼Œè€Œæ–‡ä»¶å½¢å¼æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p>å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯åŠ å¯†æˆå­—ç¬¦ä¸²åç„¶ååœ¨github actioné‡Œé¢è§£å¯†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ å¯†</span></span><br><span class="line">gpg -c --armor release.keystore</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‰åçœç•¥ è§£å¯†</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">checkout</span></span><br><span class="line">    <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        echo &quot;$&#123;&#123;secrets.RELEASE_KEYSTORE&#125;&#125;&quot; &gt; release.keystore.asc</span></span><br><span class="line"><span class="string">        gpg -d --passphrase &quot;$&#123;&#123;secrets.RELEASE_KEYSTORE_PASSWORD&#125;&#125;&quot; --batch release.keystore.asc &gt; andorid/app/release.keystore</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨åˆ«äººå†™å¥½çš„<a href="https://github.com/r0adkll/sign-android-release">r0adkll/sign-android-release@v1</a></p>
<p>è¿™ä¸ªactionç”¨çš„æ˜¯base64è¿›è¡ŒåŠ å¯†</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">openssl <span class="built_in">base64</span> &lt; release.keystore | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> | <span class="built_in">tee</span> release.keystore.base64.txt</span><br></pre></td></tr></table></figure>
<p>é…ç½®å¦‚ä¸‹</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">steps:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">r0adkll/sign-android-release@v1</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Sign</span> <span class="string">app</span> <span class="string">APK</span></span><br><span class="line">    <span class="comment"># ID used to access action output</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">sign_app</span></span><br><span class="line">    <span class="attr">with:</span></span><br><span class="line">      <span class="attr">releaseDirectory:</span> <span class="string">app/build/outputs/apk/release</span></span><br><span class="line">      <span class="attr">signingKeyBase64:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SIGNING_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">alias:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ALIAS</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">keyStorePassword:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_STORE_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      <span class="attr">keyPassword:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç­¾ååçš„æ–‡ä»¶è¾“å‡ºåœ¨<code>$&#123;&#123;steps.sign_app.outputs.signedReleaseFile&#125;&#125;</code></p>
<h2 id="å‘å¸ƒåˆ°release"><a class="markdownIt-Anchor" href="#å‘å¸ƒåˆ°release"></a> å‘å¸ƒåˆ°release</h2>
<p>è¿™é‡Œä½¿ç”¨<a href="https://github.com/softprops/action-gh-release">softprops/action-gh-release@v1</a>ã€‚</p>
<p>åœ¨å‘å¸ƒä¹‹å‰æˆ‘ä»¬å¯èƒ½æƒ³æ”¹ä¸€ä¸‹æ–‡ä»¶åï¼ŒåŠ ä¸Š<code>package.json</code>é‡Œé¢çš„ç‰ˆæœ¬å·ï¼Œè¿™é‡Œé€šè¿‡ä¸€æ¡å‘½ä»¤è·å–<code>package.json</code>çš„ç‰ˆæœ¬å·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> package.json | jq <span class="string">&#x27;.version&#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;&quot;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦è®©ä¸‹ä¸€ä¸ªstepè·å–ä¹‹å‰çš„stepè¾“å‡ºï¼Œåˆ™è¦åœ¨è¦è¾“å‡ºçš„stepä¸­åŠ ä¸Šidï¼Œè¦è¾“å‡ºçš„stepä¸­æ‰§è¡Œã€‚åœ¨å…¶ä»–çš„stepä¸­è¦ç”¨æ—¶ä½¿ç”¨<code>$&#123;&#123;steps.step_id.outputs.name&#125;&#125;</code>ï¼Œä¸è¦å¿˜è®°é‡Œ<code>outputs</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&#123;name&#125;=&#123;value&#125;&quot;</span> &gt;&gt; <span class="variable">$GITHUB_OUTPUT</span></span><br></pre></td></tr></table></figure>
<h1 id="å®Œæ•´actionæ–‡ä»¶"><a class="markdownIt-Anchor" href="#å®Œæ•´actionæ–‡ä»¶"></a> å®Œæ•´actionæ–‡ä»¶</h1>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å·¥ä½œæµåç§°</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">Assemble</span> <span class="string">Android</span> <span class="string">Release</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è§¦å‘æ¡ä»¶ æœ‰tagsæ—¶æˆ–è€…pushåˆ°masteræ—¶è§¦å‘</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;v*&quot;</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;master&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">assemble:</span></span><br><span class="line">    <span class="attr">environment:</span> <span class="string">release</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># ä½¿ç”¨checkout æ‹‰å»ä»£ç åº“</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">yarn</span> <span class="string">cache</span> <span class="string">directory</span> <span class="string">path</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">yarn-cache-dir-path</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;dir=$(yarn cache dir)&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">$GITHUB_OUTPUT</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/cache@v3</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">yarn-cache</span> <span class="comment"># use this to check for `cache-hit` (`steps.yarn-cache.outputs.cache-hit != &#x27;true&#x27;`)</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.yarn-cache-dir-path.outputs.dir</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-yarn-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/yarn.lock&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.os &#125;&#125;-yarn-</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          yarn</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cache</span> <span class="string">gradle</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            ~/.gradle/caches</span></span><br><span class="line"><span class="string">            ~/.gradle/wrapper</span></span><br><span class="line"><span class="string"></span>          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-gradle-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/*.gradle*&#x27;,</span> <span class="string">&#x27;**/gradle-wrapper.properties&#x27;</span><span class="string">)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.os &#125;&#125;-gradle-</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Make</span> <span class="string">Gradlew</span> <span class="string">Executable</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">cd</span> <span class="string">android</span> <span class="string">&amp;&amp;</span> <span class="string">chmod</span> <span class="string">+x</span> <span class="string">./gradlew</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Generate</span> <span class="string">App</span> <span class="string">APK</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          cd android &amp;&amp; ./gradlew assembleRelease --no-daemon</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Sign</span> <span class="string">app</span> <span class="string">APK</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">r0adkll/sign-android-release@v1</span></span><br><span class="line">        <span class="comment"># ID used to access action output</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">sign_app</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">releaseDirectory:</span> <span class="string">android/app/build/outputs/apk/release</span></span><br><span class="line">          <span class="attr">signingKeyBase64:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SIGNING_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">alias:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_ALIAS</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">keyStorePassword:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_STORE_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">keyPassword:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.KEY_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">get</span> <span class="string">version</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">rn_version</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo &quot;version=$(cat package.json | jq &#x27;.version&#x27; | tr -d &#x27;&quot;&#x27;)&quot; &gt;&gt; $GITHUB_OUTPUT</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">rename</span> <span class="string">file</span> <span class="string">with</span> <span class="string">version</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">rename</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          mv $&#123;&#123;steps.sign_app.outputs.signedReleaseFile&#125;&#125; android/app/build/outputs/apk/release/app-release-$&#123;&#123;steps.rn_version.outputs.version&#125;&#125;.apk</span></span><br><span class="line"><span class="string">          echo &quot;releaseFile=android/app/build/outputs/apk/release/app-release-$&#123;&#123;steps.rn_version.outputs.version&#125;&#125;.apk&quot; &gt;&gt; $GITHUB_OUTPUT</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Upload</span> <span class="string">release</span> <span class="string">assets</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">softprops/action-gh-release@v1</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">startsWith(github.ref,</span> <span class="string">&#x27;refs/tags/&#x27;</span><span class="string">)</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">files:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123;steps.rename.outputs.releaseFile&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<h1 id="æ‰§è¡Œaction"><a class="markdownIt-Anchor" href="#æ‰§è¡Œaction"></a> æ‰§è¡Œaction</h1>
<p>ç°åœ¨å¯ä»¥æ‰§è¡Œactionæ¥çœ‹çœ‹è¿è¡Œç»“æœï¼Œç›®å‰çš„è§¦å‘æ–¹å¼æœ‰pushã€åˆ›å»º<code>v*</code>å¼€å¤´çš„tagï¼Œæˆ–è€…æ‰‹åŠ¨è§¦å‘ã€‚æˆ‘ä»¬è¿™é‡Œåˆ›å»ºä¸€ä¸ª<code>v1.0.0</code>çš„tagï¼Œå¯ä»¥çœ‹åˆ°releaseé‡Œé¢åŠ ä¸Šäº†ç¼–è¯‘åçš„apkã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.4/release.png" alt="" /></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://reactnative.dev/docs/signed-apk-android">Publishing to Google Play Store</a></p>
<p><a href="https://github.com/actions/checkout">action/checkout</a></p>
<p><a href="https://github.com/actions/cache">action/cache</a></p>
<p><a href="https://docs.gradle.org/current/userguide/gradle_daemon.html">gradle daemon</a></p>
<p><a href="https://stackoverflow.com/questions/52059339/difference-between-apk-apk-and-app-bundle-aab">Difference between apk (.apk) and app bundle (.aab)</a></p>
<p><a href="https://stefma.medium.com/how-to-store-a-android-keystore-safely-on-github-actions-f0cef9413784">How to store a Android Keystore safely on GitHub Actions</a></p>
<p><a href="https://stackoverflow.com/questions/59191913/how-do-i-get-the-output-of-a-specific-step-in-github-actions">How do I get the output of a specific step in GitHub Actions?</a></p>
<p><a href="https://www.obytes.com/blog/react-native-ci-cd-github-action">react-native-ci-cd-github-action</a></p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>react</tag>
        <tag>react native</tag>
      </tags>
  </entry>
  <entry>
    <title>ControlNetè®ºæ–‡ç¬”è®°</title>
    <url>/2023/02/23/controlnet-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šç´…æœˆã‚†ã‚Œã‚‹æ‹ã‚ã‹ã‚Šã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æœ€è¿‘è¯»äº†ControlNetçš„è®ºæ–‡ï¼Œè§‰å¾—è¿˜æŒºæœ‰è¶£å°±å†™ä¸€ä¸‹ç¬”è®°å§ã€‚åœ¨ä»¥å¾€çš„AIç»˜ç”»ä¸­æˆ‘ä»¬é€šå¸¸ä½¿ç”¨è¾“å…¥promptæ¥ç”Ÿæˆæˆ‘ä»¬å›¾åƒï¼Œè¿™é‡Œä¼šæœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ä½¿ç”¨prompté€šå¸¸ä¸èƒ½å®Œç¾çš„æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦ï¼Œå¦‚ä½•å®ç°å¯¹ç»˜å›¾çš„æ§åˆ¶ï¼Œè¿™å°±æ˜¯ControlNetåšçš„äº‹æƒ…ã€‚</p>
<h1 id="ç»“æ„"><a class="markdownIt-Anchor" href="#ç»“æ„"></a> ç»“æ„</h1>
<p>ControlNetæ˜¯ä¸€ç§ç½‘ç»œç»“æ„ï¼Œå¯ä»¥å¢å¼ºç‰¹å®šä»»åŠ¡ä¸‹çš„é¢„è®­ç»ƒæ¨¡å‹ã€‚ControlNetå¯¹ç¥ç»ç½‘ç»œå—ä¸­çš„è¾“å…¥æ¡ä»¶è¿›è¡Œæ“ä½œä»è€Œæ§åˆ¶æ•´ä¸ªç¥ç»ç½‘ç»œï¼Œè¿™é‡Œç½‘ç»œå—æŒ‡çš„æ˜¯resnetå—ã€CBNå—ã€å¤šå¤´æ³¨æ„åŠ›å—ã€transformerå—ç­‰å¸¸ç”¨äºæ­å»ºç¥ç»ç½‘ç»œçš„å±‚ã€‚å…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.5/block.png" alt="block" /></p>
<p>ControlNeté”ä½åŸå§‹ç½‘ç»œçš„å‚æ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î˜</mi></mrow><annotation encoding="application/x-tex">\Theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Î˜</span></span></span></span>ï¼Œå¹¶ä¸”æ‹·è´äº†ä¸€ä»½å¯ä»¥è®­ç»ƒçš„å‚æ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi mathvariant="normal">Î˜</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\Theta_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord">Î˜</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ï¼Œé™¤æ­¤ä»¥å¤–è¿˜æœ‰é¢å¤–çš„æ¡ä»¶å‘é‡<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">c</span></span></span></span>ã€‚é‡‡ç”¨æ‹·è´è€Œä¸æ˜¯ç›´æ¥è®­ç»ƒåŸå§‹æƒé‡æ˜¯ä¸ºäº†é¿å…æ•°æ®é›†è¿‡å°çš„æ—¶å€™è¿‡æ‹Ÿåˆå¹¶ä¸”ä¿ç•™ä»æ•°åäº¿å¼ å›¾åƒä¸­è®­ç»ƒåˆ°çš„å¤§å‹æ¨¡å‹çš„è´¨é‡ã€‚</p>
<p>ç¥ç»ç½‘ç»œå—å’ŒControlNetä¹‹é—´æ˜¯é€šè¿‡é›¶å·ç§¯ï¼ˆzero<br />
convolutionï¼‰è¿›è¡Œè¿æ¥ï¼Œé›¶å·ç§¯å³1*1å¤§å°çš„å·ç§¯ï¼Œå…¶æƒé‡å’Œåå·®éƒ½è¢«åˆå§‹åŒ–ä¸º0ã€‚è¿™ä¹ˆè®¾ç½®ä½¿å¾—ä¸€å¼€å§‹å³ä½¿ControlNetä¸è¿›è¡Œè®­ç»ƒï¼ŒControlNetéƒ¨åˆ†çš„è¾“å…¥å’Œè¾“å‡ºéƒ½ä¸º0åŠ åˆ°åŸå§‹ç½‘ç»œé‡Œé¢ä¹Ÿä¸ä¼šå¯¹åŸå§‹ç½‘ç»œæœ‰ä»»ä½•å½±å“ã€‚å…¬å¼æ¨å¯¼å¦‚ä¸‹ï¼š</p>
<p>å‡å®šåŸå§‹çš„ç¥ç»ç½‘ç»œï¼Œå…¶ä¸­ä¸€å±‚çš„å®šä¹‰å¦‚ä¸‹ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span>ä¸ºè¯¥å±‚çš„è¾“å‡ºï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>ä¸ºè¯¥å±‚çš„è¾“å…¥ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î˜</mi></mrow><annotation encoding="application/x-tex">\Theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Î˜</span></span></span></span>ä¸ºè¯¥å±‚çš„å‚æ•°,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi mathvariant="normal">Î˜</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F(x;\Theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">Î˜</span><span class="mclose">)</span></span></span></span>è¡¨ç¤ºè¯¥å±‚çš„æ˜ å°„ã€‚</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi mathvariant="normal">Î˜</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y=F(x;\Theta)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">Î˜</span><span class="mclose">)</span></span></span></span></span></p>
<p>åŠ å…¥ControlNetåä¸€å±‚çš„è¡¨ç¤ºæ–¹å¼å¦‚ä¸‹ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">y_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºæ–°çš„è¾“å‡ºï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Z</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Z(x;\theta)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span></span>ä¸ºé›¶å·ç§¯æ˜ å°„ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î¸</mi><msub><mi>z</mi><mn>1</mn></msub></msub></mrow><annotation encoding="application/x-tex">\theta_{z_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9445399999999999em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î¸</mi><msub><mi>z</mi><mn>2</mn></msub></msub></mrow><annotation encoding="application/x-tex">\theta_{z_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9445399999999999em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºä¸¤ä¸ªé›¶å·ç§¯çš„å‚æ•°,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î¸</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">\theta_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºåŸå§‹ç½‘ç»œçš„æƒé‡å¤åˆ¶ã€‚</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>y</mi><mi>c</mi></msub><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi mathvariant="normal">Î˜</mi><mo stretchy="false">)</mo><mo>+</mo><mi>Z</mi><mo stretchy="false">(</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>Z</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>1</mn></msub></msub><mo stretchy="false">)</mo><mo separator="true">;</mo><msub><mi>Î¸</mi><mi>c</mi></msub><mo stretchy="false">)</mo><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>2</mn></msub></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y_c = F(x;\Theta) + Z(F(x+Z(c;\theta_{z_1});\theta_c);\theta_{z_2})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">Î˜</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0001em;vertical-align:-0.2501em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>å½“è®­ç»ƒåˆšå¼€å§‹æ—¶ï¼Œç”±äºé›¶å·ç§¯çš„æ•ˆæœå…¬å¼ä¼šæœ‰ä¸‹é¢çš„æ•ˆæœ</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>1</mn></msub></msub><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>Z</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>1</mn></msub></msub><mo stretchy="false">)</mo><mo separator="true">;</mo><msub><mi>Î¸</mi><mi>c</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><msub><mi>Î¸</mi><mi>c</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><mi>Î¸</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>Z</mi><mo stretchy="false">(</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>Z</mi><mo stretchy="false">(</mo><mi>c</mi><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>1</mn></msub></msub><mo stretchy="false">)</mo><mo separator="true">;</mo><msub><mi>Î¸</mi><mi>c</mi></msub><mo stretchy="false">)</mo><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>2</mn></msub></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Z</mi><mo stretchy="false">(</mo><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">;</mo><msub><mi>Î¸</mi><mi>c</mi></msub><mo stretchy="false">)</mo><mo separator="true">;</mo><msub><mi>Î¸</mi><msub><mi>z</mi><mn>2</mn></msub></msub><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
Z(c;\theta_{z_1}) = 0 \\
F(x+Z(c;\theta_{z_1});\theta_c) = F(x;\theta_c) = F(x;\theta) \\
Z(F(x+Z(c;\theta_{z_1});\theta_c);\theta_{z_2}) = Z(F(x;\theta_c);\theta_{z_2}) = 0
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.9099999999999997em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35002em;"><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â©</span></span></span><span style="top:-2.19999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-3.1500100000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â¨</span></span></span><span style="top:-4.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>âª</span></span></span><span style="top:-4.60002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>â§</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.8500199999999998em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span></span></span><span style="top:-1.5300000000000002em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">Î¸</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139199999999997em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:-0.04398em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">0</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.9099999999999997em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>å› æ­¤åœ¨æœ€å¼€å§‹çš„æ—¶å€™ControlNetå°±æœ‰åŸå§‹ç½‘ç»œçš„æ•ˆæœï¼Œåé¢å°±æ˜¯åœ¨ä¼˜åŒ–æ¡ä»¶ã€‚</p>
<h2 id="é›¶å·ç§¯æ˜¯æ€ä¹ˆå­¦ä¹ çš„"><a class="markdownIt-Anchor" href="#é›¶å·ç§¯æ˜¯æ€ä¹ˆå­¦ä¹ çš„"></a> é›¶å·ç§¯æ˜¯æ€ä¹ˆå­¦ä¹ çš„</h2>
<p>å½“ä¸€ä¸ªå·ç§¯æƒé‡ä¸º0ï¼Œè¾“å…¥çš„æ¢¯åº¦ä¹Ÿä¼šæ˜¯0ï¼Œé‚£ä¹ˆè¿™ä¸ªç½‘ç»œèƒ½å­¦åˆ°å‚æ•°å—ï¼Ÿ<br />
å‡è®¾æœ‰å¦‚ä¸‹å…¬å¼</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi><mo>=</mo><mi>w</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">y = wx + b
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span></span></p>
<p>æ­¤æ—¶æ¢¯åº¦è®¡ç®—å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac><mo>=</mo><mi>x</mi><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mi>w</mi><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>b</mi></mrow></mfrac><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\frac{\partial y}{\partial w}  = x 
\frac{\partial y}{\partial x}  = w 
\frac{\partial y}{\partial b}  = 1 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord mathdefault">x</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault">b</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p>
<p>å½“<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>=</mo><mn>0</mn><mi>x</mi><mi mathvariant="normal">â‰ </mi><mn>0</mn></mrow><annotation encoding="application/x-tex">w=0 x \ne 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>æ—¶ï¼Œæ¢¯åº¦å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>w</mi></mrow></mfrac><mi mathvariant="normal">â‰ </mi><mn>0</mn><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>x</mi></mrow></mfrac><mo>=</mo><mn>0</mn><mfrac><mrow><mi mathvariant="normal">âˆ‚</mi><mi>y</mi></mrow><mrow><mi mathvariant="normal">âˆ‚</mi><mi>b</mi></mrow></mfrac><mi mathvariant="normal">â‰ </mi><mn>0</mn></mrow><annotation encoding="application/x-tex">\frac{\partial y}{\partial w}  \ne 0 
\frac{\partial y}{\partial x}  = 0 
\frac{\partial y}{\partial b}  \ne 0 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord">0</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord">0</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault">b</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord" style="margin-right:0.05556em;">âˆ‚</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel"><span class="mrel"><span class="mord"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="rlap"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="inner"><span class="mrel">î€ </span></span><span class="fix"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.19444em;"><span></span></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></span></p>
<p>å› æ­¤åªè¦ä¸€æ¬¡æ¢¯åº¦è®¡ç®—ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>ä¸ä¸º0ï¼Œé‚£ä¹ˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>çš„æ¢¯åº¦å°±ä¸ä¸º0ï¼Œä½¿å¾—æ›´æ–°åçš„æƒé‡<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.02691em;">w</span></span></span></span>ä¸ä¸º0ï¼Œä½¿å¾—åç»­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span></span></span></span>çš„æ¢¯åº¦ä¸ä¸º0ï¼Œç½‘ç»œå¼€å§‹å­¦ä¹ </p>
<h1 id="æ•´ä½“ç»“æ„"><a class="markdownIt-Anchor" href="#æ•´ä½“ç»“æ„"></a> æ•´ä½“ç»“æ„</h1>
<p>åœ¨Image2Imageä¸ŠControlNetå¯¹Stable Diffusionçš„ä¿®æ”¹å¦‚ä¸‹<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.5/ControlNet.png" alt="ControlNet" /></p>
<h1 id="è®­ç»ƒ"><a class="markdownIt-Anchor" href="#è®­ç»ƒ"></a> è®­ç»ƒ</h1>
<p>åœ¨ControlNetè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œéšæœºå°†50%çš„promptsæ›¿æ¢æˆäº†ç©ºå­—ç¬¦ä¸²ï¼Œè¿™æœ‰åŠ©äºControlNetä»è¾“å…¥çš„æ¡ä»¶å‘é‡ä¸­è¯†åˆ«è¯­ä¹‰ä¿¡æ¯ï¼Œè¿™ä¸»è¦å› ä¸ºå½“promptå¯¹SD Modelä¸å¯è§æ—¶ï¼Œencoderå€¾å‘äºä»è¾“å…¥çš„æ¡ä»¶å‘é‡ä¸­å­¦ä¹ æ›´å¤šè¯­ä¹‰ä»¥æ›¿ä»£promptã€‚</p>
<h2 id="å°è§„æ¨¡è®­ç»ƒ"><a class="markdownIt-Anchor" href="#å°è§„æ¨¡è®­ç»ƒ"></a> å°è§„æ¨¡è®­ç»ƒ</h2>
<p>å½“è®¡ç®—é‡æœ‰é™çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡é€‰æ‹©æ€§çš„æ–­å¼€ControlNetå’ŒSD Modelçš„éƒ¨åˆ†è¿æ¥åŠ é€Ÿè®­ç»ƒï¼Œé»˜è®¤çš„æ¨¡å‹å¦‚ä¸Šæ‰€ç¤ºï¼ŒControlNetå’ŒSD Middle Blockã€SD Decoder Block 1,2,3,4ç›¸è¿æ¥ï¼Œå½“ä¸SD Decoder Block 1,2,3,4çš„è¿æ¥æ–­å¼€æ—¶å¯ä»¥åœ¨3070TIçš„ç¬”è®°æœ¬ä¸Šæå‡1.6å€é€Ÿåº¦ï¼Œå½“è¾“å‡ºç»“æ„å’Œæ¡ä»¶ä¹‹é—´æœ‰å…³è”æ—¶å¯ä»¥å°†è¿™äº›è¿æ¥é‡æ–°å…³è”ã€‚</p>
<h2 id="å¤§è§„æ¨¡è®­ç»ƒ"><a class="markdownIt-Anchor" href="#å¤§è§„æ¨¡è®­ç»ƒ"></a> å¤§è§„æ¨¡è®­ç»ƒ</h2>
<p>å½“è®¡ç®—é‡å’Œæ•°æ®é›†è¾ƒå¤§æ—¶ï¼Œè¿‡æ‹Ÿåˆçš„é£é™©è¾ƒä½ï¼Œå¯ä»¥å…ˆè®­ç»ƒControlNetåˆ°è¶³å¤Ÿçš„è¿­ä»£æ¬¡æ•°ï¼Œç„¶åè§£é”stable diffusionçš„å…¨éƒ¨æƒé‡å…±åŒè®­ç»ƒã€‚</p>
<h1 id="æ¡ä»¶å˜é‡"><a class="markdownIt-Anchor" href="#æ¡ä»¶å˜é‡"></a> æ¡ä»¶å˜é‡</h1>
<p>å®˜æ–¹ç»™çš„æ¡ä»¶å˜é‡æœ‰Cannyç®—å­è®¡ç®—çš„åŸå›¾è¾¹ç¼˜ã€éœå¤«å˜æ¢è®¡ç®—çš„ã€å§¿æ€æ£€æµ‹å¾—åˆ°çš„è¿˜æœ‰ç”¨æˆ·æ¶‚é¸¦çº¿ç¨¿ï¼Œä¸»è¦éƒ½æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªæ¡ä»¶ï¼Œåç»­stable diffusionç”Ÿæˆçš„å›¾ç‰‡éƒ½ä¸æ¡ä»¶æœ‰ä¸€å®šçš„ç›¸ä¼¼åº¦ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/2302.05543">Adding Conditional Control to Text-to-Image Diffusion Models</a></p>
<p><a href="https://github.com/lllyasviel/ControlNet">ControlNet</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>SegResNetè®ºæ–‡ç¬”è®°</title>
    <url>/2023/02/25/segresnet-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€ŠAMBITIOUS MISSIONã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æœ€è¿‘è¯»äº†ã€ŠAutomated head and neck tumor segmentation from 3D PET/CT HECKTOR 2022 challenge reportã€‹è¿™ç¯‡è®ºæ–‡ï¼Œé‡Œé¢æåˆ°ä½¿ç”¨çš„autosegresnetæ˜¯ä½¿ç”¨çš„segresnetä½œä¸ºbackboneã€‚å› æ­¤æ¥è¯»ä¸€ä¸‹SegResNetçš„è®ºæ–‡ã€‚è¿™é‡Œçš„SegResNetæ˜¯monaié¡¹ç›®ä¸­çš„å«æ³•ï¼Œmonaiæ˜¯ä¸€ä¸ªç”¨äºåŒ»ç–—å½±åƒçš„åº“ï¼Œè¯¥ç½‘ç»œçš„apiæ–‡æ¡£åœ¨<a href="https://docs.monai.io/en/stable/networks.html#segresnet">è¿™</a>æºç åœ¨<a href="https://docs.monai.io/en/stable/_modules/monai/networks/nets/segresnet.html">è¿™</a>ã€‚æ¯”è¾ƒç®€å•æ˜“æ‡‚çš„æºç åœ¨è¿™<a href="https://github.com/IAmSuyogJadhav/3d-mri-brain-tumor-segmentation-using-autoencoder-regularization">github</a></p>
<h1 id="ç½‘ç»œç»“æ„"><a class="markdownIt-Anchor" href="#ç½‘ç»œç»“æ„"></a> ç½‘ç»œç»“æ„</h1>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.6/SegResNet.png" alt="ç½‘ç»œç»“æ„" /><br />
SegResNetçš„ç½‘ç»œç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé‡‡ç”¨CNNçš„encoder-decoderç»“æ„ï¼Œencoderæ¥æå–å›¾åƒç‰¹å¾ï¼Œdecoderæ¥é‡æ„åˆ†å‰²ç»“æœï¼Œæ­¤å¤–è¿˜å¼•å…¥äº†VAEç»“æ„æ¥æ¢å¤åŸå§‹å›¾åƒï¼ŒVAEéƒ¨åˆ†åªåœ¨è®­ç»ƒæœŸé—´è®­ç»ƒencoderã€‚å…¶ä¸­ç»¿è‰²çš„éƒ¨åˆ†æ˜¯ä¸€ä¸ªç±»ä¼¼äºResNetçš„éƒ¨åˆ†ï¼Œå…¶ä¸­ç”±GN-RELU-CONV3x3x3-GN-RELU-CONV3x3x3ç»„æˆã€‚</p>
<h2 id="encoder"><a class="markdownIt-Anchor" href="#encoder"></a> encoder</h2>
<p>encoderéƒ¨åˆ†ä¸­ï¼Œæ¯ä¸ªres blockç”±2ç»„convã€normå’Œreluç»„æˆï¼Œnorméƒ¨åˆ†é‡‡ç”¨Group Normï¼Œåœ¨Batchè¾ƒå°çš„æ—¶å€™æ•ˆæœæ¯”Batch Normæ•ˆæœå¥½ï¼Œencoderéƒ¨åˆ†ä¸­å’ŒCNNç±»ä¼¼ï¼Œæ¯æ¬¡ä¸‹é‡‡æ ·çš„æ—¶å€™é€šé“æ•°ç¿»ä¸€å€ã€‚å·ç§¯çš„åˆå§‹é€šé“æ•°ä¸º32ï¼Œæ€»å…±ä¸‹é‡‡æ ·8å€ã€‚</p>
<h2 id="decoder"><a class="markdownIt-Anchor" href="#decoder"></a> decoder</h2>
<p>decoderéƒ¨åˆ†ä¸encoderéƒ¨åˆ†ç±»ä¼¼ï¼Œä½†æ˜¯æ¯å±‚åªæœ‰ä¸€ä¸ªblockã€‚ä¸Šé‡‡æ ·é‡‡ç”¨1x1x1å¤§å°çš„å·ç§¯è¾“å‡ºé€šé“æ•°å‡åŠï¼Œå’Œ3DåŒçº¿æ€§ä¸Šé‡‡æ ·å†åŠ ä¸ŠåŒå±‚çš„encoderçš„è¾“å‡ºã€‚æœ€åä¸€å±‚çš„å·ç§¯é‡‡ç”¨1x1x1çš„å·ç§¯ï¼Œè¾“å‡ºé€šé“æ•°ä¸ºåˆ†å‰²çš„ç±»åˆ«ï¼Œæ¿€æ´»å‡½æ•°ä½¿ç”¨sigmoidã€‚</p>
<h2 id="vae"><a class="markdownIt-Anchor" href="#vae"></a> VAE</h2>
<p>SegResNetçš„è¾“å…¥å¤§å°ä¸º4x160x192x128ï¼Œå…¶ä¸­encoderéƒ¨åˆ†çš„è¾“å‡ºä¸º256x20x24x16ï¼Œè¿™é‡ŒSegResNeté‡‡ç”¨äº†VAEç»“æ„ã€‚VAEçš„ç»“æ„å’Œå†…å®¹ä¸‹æ¬¡å†è®²ï¼Œè¿™é‡Œéœ€è¦çŸ¥é“çš„æ˜¯VAEéœ€è¦é€šè¿‡è®­ç»ƒè·å–å‡å€¼å‘é‡meanå’Œæ–¹å·®å‘é‡stdï¼Œç„¶åé€šè¿‡é‡å‚åŒ–è¿›è¡Œé‡‡æ ·ï¼Œé¿å…ç›´æ¥é‡‡æ ·ä½¿å¾—ç½‘ç»œä¸å¯å¯¼ã€‚</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Z</mi><mo>=</mo><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mo>+</mo><mi>Îµ</mi><mo>Ã—</mo><mi>s</mi><mi>t</mi><mi>d</mi><mspace width="2em"/><mi>Îµ</mi><mo>âˆ¼</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Z = mean + \varepsilon \times std \qquad   \varepsilon \sim \mathcal{N}(0, 1)   
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">Z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">Îµ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:2em;"></span><span class="mord mathdefault">Îµ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.14736em;">N</span></span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p>
<p>SegResNetä¸­å°†è¾“å‡ºçš„256é€šé“æ‹†åˆ†ä¸º2ä¸ª128é€šé“åˆ†åˆ«ä½œä¸ºå‡å€¼å’Œæ–¹å·®ã€‚ç»“æ„ç±»ä¼¼äºdecoderéƒ¨åˆ†ï¼Œä½†æ˜¯ä¸ä½¿ç”¨encoderéƒ¨åˆ†çš„è¾“å‡ºã€‚</p>
<h1 id="loss"><a class="markdownIt-Anchor" href="#loss"></a> loss</h1>
<p>SegResNetçš„LossåŒ…å«3éƒ¨åˆ†ï¼Œå…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>=</mo><msub><mi>L</mi><mrow><mi>d</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></msub><mo>+</mo><mn>0.1</mn><mo>âˆ—</mo><msub><mi>L</mi><msub><mi>L</mi><mn>2</mn></msub></msub><mo>+</mo><mn>0.1</mn><mo>âˆ—</mo><msub><mi>L</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub></mrow><annotation encoding="application/x-tex">L = L_{dice} + 0.1 * L_{L_2} + 0.1 * L_{KL} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.93343em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31731428571428577em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="dice-loss"><a class="markdownIt-Anchor" href="#dice-loss"></a> dice loss</h2>
<p>dice lossç”¨äºdecoderéƒ¨åˆ†è¾“å‡ºå’Œgtä¹‹é—´çš„æ¯”è¾ƒï¼ŒåŸå§‹æ˜¯åˆ†å‰²3ä¸ªç±»ï¼Œè¿™é‡Œæ¯ä¸ªåˆ†å‰²ç±»åˆ«éƒ½ç®—äº†ä¸€ä¸ªdice loss</p>
<h2 id="l2-loss"><a class="markdownIt-Anchor" href="#l2-loss"></a> l2 loss</h2>
<p>l2 lossç”¨äºè®¡ç®—VAEéƒ¨åˆ†é‡æ„è¾“å‡ºå’ŒåŸå§‹å›¾åƒä¹‹é—´çš„loss</p>
<h2 id="kl-loss"><a class="markdownIt-Anchor" href="#kl-loss"></a> kl loss</h2>
<p>è¿™æ˜¯æ¥è‡ªäºVAEéƒ¨åˆ†çš„lossï¼Œåœ¨è¿™è®¡ç®—å…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>L</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo>=</mo><mn>1</mn><mfrac><mn>1</mn><mrow><mo>âˆ‘</mo><msup><mi>Î¼</mi><mn>2</mn></msup><mo>+</mo><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo>âˆ’</mo><mi>l</mi><mi>o</mi><mi>g</mi><msup><mi>Ïƒ</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">L_{KL} = 1 \frac{1}{\sum \mu^2 + \sigma^2 - log\sigma^2 - 1 }
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.25745em;vertical-align:-0.93601em;"></span><span class="mord">1</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">Î¼</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93601em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>ä¸ªäººçœ‹æ¥åœ¨SegResNetä¸­é‡‡ç”¨VAEä½œä¸ºå…¶ä¸­æ˜¯å¾ˆæœ‰åˆ›æ–°æ„ä¹‰ï¼Œé‡‡ç”¨åŸå§‹æ•°æ®æ¥åè°ƒè®­ç»ƒencoderéƒ¨åˆ†ï¼Œæé«˜äº†ç½‘ç»œæ€§èƒ½ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/2209.10809">Automated head and neck tumor segmentation from 3D PET/CT HECKTOR 2022 challenge report</a></p>
<p><a href="https://arxiv.org/abs/1810.11654">3D MRI brain tumor segmentation using autoencoder regularization</a></p>
<p><a href="https://docs.monai.io/en/stable/index.html">monai</a></p>
<p><a href="https://docs.monai.io/en/stable/networks.html#segresnet">SegResNet</a></p>
<p><a href="https://github.com/IAmSuyogJadhav/3d-mri-brain-tumor-segmentation-using-autoencoder-regularization">3D MRI Brain Tumor Segmentation Using Autoencoder Regularization (Github)</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>UNETRè®ºæ–‡ç¬”è®°</title>
    <url>/2023/10/05/unetr-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€Šæ®»ãƒå°‘å¥³ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æœ€è¿‘è¯»äº†UNETRçš„è®ºæ–‡ï¼Œéœ€è¦äº†è§£è¿™ä¸ªæ¨¡å‹ï¼Œå› æ­¤å°±è®°å½•ä¸€ä¸‹å­¦ä¹ ç¬”è®°ã€‚UNETRæ˜¯ä¸€ç§å°†UNetå’ŒTransformerç»“åˆçš„ç½‘ç»œç»“æ„ï¼Œå¯ä»¥ç”¨äºå›¾åƒåˆ†å‰²ä»»åŠ¡ã€‚</p>
<h1 id="ç»“æ„"><a class="markdownIt-Anchor" href="#ç»“æ„"></a> ç»“æ„</h1>
<p>ä¼ ç»ŸCNNç½‘ç»œåœ¨åˆ†å‰²é¢†åŸŸæœ‰äº†å¾ˆå¤§çš„æˆåŠŸï¼Œä½†æ˜¯CNNå› å…¶ç»“æ„åŸå› åœ¨å…¨å±€ç‰¹å¾ä¿¡æ¯å’Œé•¿èŒƒå›´ç©ºé—´ä¾èµ–æ€§ä¸Šè¡¨ç°è¾ƒå·®ï¼Œè¿™å¯¹åˆ†å‰²ç»“æœæœ‰å¾ˆå¤§çš„å½±å“ã€‚</p>
<p>Transformerå› å…¶attentionæœºåˆ¶ï¼Œåœ¨å…¨å±€ç‰¹å¾æ–¹é¢æœ‰å¾ˆå¥½çš„è¡¨ç°ï¼Œå› æ­¤UNETRæå‡ºäº†ä¸€ç§æ–°çš„ç½‘ç»œç»“æ„ï¼Œå°†UNetå’ŒTransformerç»“åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br />
å…¶ç›¸å¯¹å…¶ä»–ä»¥å¾€çš„åˆ†å‰²ç½‘ç»œæœ‰ä¸€ä¸‹ç‰¹å¾</p>
<ul>
<li>ç›´æ¥ä¸º3Dåˆ†å‰²é‡èº«å®šåˆ¶ï¼Œç›´æ¥ä½¿ç”¨ä½“ç§¯æ•°æ®</li>
<li>ç›´æ¥å°†transformerä½œä¸ºç½‘ç»œçš„ç¼–ç å™¨ï¼Œè€Œéä½¿ç”¨å…¶ä½œä¸ºç½‘ç»œä¸­çš„attentionå±‚ã€‚æ‰€æœ‰ViTä¸­é—´å±‚çš„è¾“å‡ºå¤§å°éƒ½æ˜¯ä¸€æ ·çš„</li>
<li>ä¸ä¾èµ–CNN backboneç”Ÿæˆè¾“å…¥åºåˆ—ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨tokenized patch</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.7/UNETR.png" alt="UNETR" /></p>
<p>åœ¨backboneæ–¹é¢å®Œå…¨é‡‡ç”¨äº†ViTçš„ç»“æ„ï¼Œå…¶ç»“æ„ä¸Transformerä¸€æ ·ï¼Œpatch embeddingé‡‡ç”¨äº†å·ç§¯ç½‘ç»œç»“æ„ï¼Œpatch sizeå’Œstride sizeéƒ½ä¸º16ï¼Œå¹¶å°†å¤§å°ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mi>H</mi><mo separator="true">,</mo><mi>W</mi><mo separator="true">,</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N,C,H,W,D)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mclose">)</span></span></span></span>çš„å›¾åƒè½¬æ¢ä¸º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>L</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N,L,C)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mclose">)</span></span></span></span>ï¼Œå…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo>=</mo><mfrac><mi>H</mi><mn>4</mn></mfrac><mo>Ã—</mo><mfrac><mi>W</mi><mn>4</mn></mfrac><mo>Ã—</mo><mfrac><mi>D</mi><mn>4</mn></mfrac></mrow><annotation encoding="application/x-tex">L=\frac{H}{4} Ã— \frac{W}{4} Ã— \frac{D}{4}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p>åœ¨ç‰¹å¾é‡‘å­—å¡”çš„è·¯å¾„ä¸Šå…ˆå°†ViTä¸­3ã€6ã€9ã€12å±‚çš„è¾“å‡ºä»<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>L</mi><mo separator="true">,</mo><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N,L,C)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mclose">)</span></span></span></span> reshapeæˆ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo stretchy="false">(</mo><mi>N</mi><mo separator="true">,</mo><mi>C</mi><mo separator="true">,</mo><mfrac><mi>H</mi><mn>16</mn></mfrac><mo separator="true">,</mo><mfrac><mi>W</mi><mn>16</mn></mfrac><mo separator="true">,</mo><mfrac><mi>D</mi><mn>16</mn></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(N,C,\frac{H}{16},\frac{W}{16},\frac{D}{16})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span>å†è¿›è¡Œåå·ç§¯ä¸Šé‡‡æ ·ï¼Œå¯¹äºä¸‹æ–¹çš„ç‰¹å¾åˆ™æ˜¯ç›´æ¥åå·ç§¯ä¸Šé‡‡æ ·ï¼Œä¸¤è€…ç‰¹å¾ç›´æ¥æ‹¼æ¥å†å·ç§¯æå–ç‰¹å¾ã€‚</p>
<h1 id="æŸå¤±å‡½æ•°"><a class="markdownIt-Anchor" href="#æŸå¤±å‡½æ•°"></a> æŸå¤±å‡½æ•°</h1>
<p>æŸå¤±å‡½æ•°æ–¹é¢é‡‡ç”¨soff dice loss + CE lossï¼Œå…¶å®šä¹‰å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi><mo stretchy="false">(</mo><mi>G</mi><mo separator="true">,</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mo>âˆ’</mo><mfrac><mn>2</mn><mi>J</mi></mfrac><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></msubsup><mfrac><mrow><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></msubsup><msub><mi>G</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msub><mi>Y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow><mrow><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></msubsup><msub><mi>G</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo>+</mo><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></msubsup><msub><mi>Y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub></mrow></mfrac><mo>âˆ’</mo><mfrac><mn>1</mn><mi>I</mi></mfrac><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></msubsup><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></msubsup><msub><mi>G</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><msub><mi>Y</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex"> L(G,Y) = 1 - \frac{2}{J} \Sigma_{j=1}^J \frac{\Sigma_{i=1}^I G_{i,j}Y_{i,j} }{\Sigma_{i=1}^I G_{i,j} + \Sigma_{i=1}^I Y_{i,j}} 
 - \frac{1}{I} \Sigma_{i=1}^I \Sigma_{j=1}^J G_{i,j}log(Y_{i,j})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">L</span><span class="mopen">(</span><span class="mord mathdefault">G</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.51757em;vertical-align:-0.999239em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.09618em;">J</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.09618em;">J</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183309999999999em;"><span style="top:-2.286869em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8231310000000001em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8231310000000001em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-2.441336em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.258664em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.999239em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">I</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8913309999999999em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.891331em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.09618em;">J</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.383108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>å…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span></span></span></span>æ˜¯ä½“ç´ æ•°é‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span></span></span></span>æ˜¯ç±»åˆ«æ•°é‡ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">G</span></span></span></span>æ˜¯ground truthï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span></span></span></span>æ˜¯é¢„æµ‹å€¼ã€‚</p>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>ç¬”è€…åœ¨<a href="http://www.isles-challenge.org/">ISLES2022</a>æ•°æ®é›†ä¸Šä»¥è¾“å…¥å¤§å°(2,96,96,96)ï¼Œä¼˜åŒ–å™¨ä¸ºadamwï¼ŒæŸå¤±å‡½æ•°ä¸ºdice lossçš„æƒ…å†µä¸‹è®­ç»ƒäº†UNETRï¼Œæ˜¯ç›®å‰å„ä¸ªç½‘ç»œè¿™æ•ˆæœæœ€å¥½çš„ï¼Œå…¶diceç³»æ•°åœ¨79.9%ã€‚ä½†æ˜¯ç”±äºä½¿ç”¨äº†transformerå…¶è®¡ç®—é‡å’Œæ˜¾å­˜å¼€é”€ä¾ç„¶ä¸å¯å¿½è§†ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/2103.10504">UNETR</a></p>
<p><a href="http://www.isles-challenge.org/">ISLES</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>metaformerè®ºæ–‡ç¬”è®°</title>
    <url>/2023/10/06/metaformer-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šå¤©çµã„ã‚­ãƒ£ãƒƒã‚¹ãƒ«ãƒã‚¤ã‚¹ã‚¿ãƒ¼ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºæœ€è¿‘çš„ç”¨çš„ç½‘ç»œé‡Œé¢é‡‡ç”¨äº† Metaformer ä½œä¸º backboneï¼Œå› æ­¤è¯»ä¸€ä¸‹ Metaformer çš„è®ºæ–‡ï¼Œé¡ºä¾¿è®°å½•ä¸€ä¸‹ã€‚</p>
<h1 id="ç»“æ„"><a class="markdownIt-Anchor" href="#ç»“æ„"></a> ç»“æ„</h1>
<p>Transformer block ä¸€èˆ¬ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ªæ˜¯ä»¤ç‰Œæ··åˆå™¨ï¼ˆtoken mixerï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯èåˆé€šé“ä¿¡æ¯çš„ï¼ˆchannel mlpï¼‰ã€‚ä¸€ä¸ªæ™®éçš„è§‚ç‚¹æ˜¯ï¼Œattention æœºåˆ¶åœ¨ transformer ä¸­å…±äº«æœ€å¤§ï¼Œä½†æ˜¯æœ€è¿‘çš„å·¥ä½œè¡¨æ˜å°† attention æ¢æˆ Spatial MLP åæ¨¡å‹çš„è¡¨ç°ä»ç„¶è‰¯å¥½ã€‚åŸºäºè¿™ä¸ªè§‚å¯Ÿ Metaformer çš„ä½œè€…æå‡ºäº† Metaformerï¼Œå°† transformer ä¸­çš„ token mixer æ¢æˆå…¶ä»–æ¨¡å—ï¼Œå…¶è®¤ä¸º transformer çš„å®è§‚è®¾è®¡æ¯” token mixer æ›´ä¸ºé‡è¦ã€‚</p>
<p>metaformer çš„ç»“æ„å¦‚ä¸‹ï¼Œå…¶ä¸€å…±æœ‰ 4 ç§ formerï¼Œåˆ†åˆ«ä¸º IdentityFormerï¼ŒRandFormer,ConvFormer,TransFormerã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.8/metaformer.png" alt="" /></p>
<p>Metaformer block çš„å…¬å¼æ€»ç»“å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>X</mi><mo mathvariant="normal">â€²</mo></msup><mo>=</mo><mi>X</mi><mo>+</mo><mi>T</mi><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>M</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>r</mi><mo stretchy="false">(</mo><mi>N</mi><mi>o</mi><mi>r</mi><msub><mi>m</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><msup><mi>X</mi><mrow><mo mathvariant="normal">â€²</mo><mo mathvariant="normal">â€²</mo></mrow></msup><mo>=</mo><msup><mi>X</mi><mo mathvariant="normal">â€²</mo></msup><mo>+</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mi>N</mi><mi>o</mi><mi>r</mi><msub><mi>m</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msup><mi>X</mi><mo mathvariant="normal">â€²</mo></msup><mo stretchy="false">)</mo><msub><mi>W</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>W</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">X&#x27; = X + TokenMixer(Norm_1(X)) \\

X&#x27;&#x27; = X&#x27; + \sigma(Norm_2(X&#x27;)W_1)W_2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">i</span><span class="mord mathdefault">x</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8852220000000001em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.051892em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>å…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>o</mi><mi>r</mi><msub><mi>m</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Norm_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>o</mi><mi>r</mi><msub><mi>m</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Norm_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸ºæ­£åˆ™åŒ–ï¼ŒTokenMixer ä¸º metaformer çš„ä»¤ç‰Œæ··åˆå™¨ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span></span></span></span>ä¸ºæ¿€æ´»å‡½æ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">W_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>å’Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">W_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸º channel MLP çš„å¯å­¦ä¹ å‚æ•°</p>
<h2 id="identityformer"><a class="markdownIt-Anchor" href="#identityformer"></a> IdentityFormer</h2>
<p>IdentityFormer ä¸­ç»™ IdentityMapping å°±æ˜¯ç›´æ¥è¿›è¡Œæ’ç­‰æ˜ å°„</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>t</mi><mi>y</mi><mi>M</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mi>X</mi></mrow><annotation encoding="application/x-tex">IdentityMapping(X) = X
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span><span class="mord mathdefault">d</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord mathdefault">p</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span></span></span></span></span></p>
<h2 id="randomformer"><a class="markdownIt-Anchor" href="#randomformer"></a> RandomFormer</h2>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>m</mi><mi>M</mi><mi>i</mi><mi>x</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mi>X</mi><msub><mi>W</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">RandomMixing(X) = XW_R
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mord mathdefault">o</span><span class="mord mathdefault">m</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">i</span><span class="mord mathdefault">x</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>å…¶ä¸­ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>X</mi><mo>âˆˆ</mo><msup><mi>R</mi><mrow><mi>N</mi><mo>Ã—</mo><mi>C</mi></mrow></msup></mrow><annotation encoding="application/x-tex">X \in R^{N \times C}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">Ã—</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span></span></span></span></span></span></span></span> æ˜¯è¾“å…¥åºåˆ—é•¿åº¦ä¸º Nï¼Œé€šé“æ•°ä¸º Cï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>W</mi><mi>R</mi></msub><mo>âˆˆ</mo><msup><mi>R</mi><mrow><mi>N</mi><mo>Ã—</mo><mi>N</mi></mrow></msup></mrow><annotation encoding="application/x-tex">W_R \in R^{N \times N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8413309999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">Ã—</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span></span>ï¼Œä¸ºä¸€ä¸ªçŸ©é˜µï¼Œå…¶åœ¨éšæœºåˆå§‹åŒ–åå†»ç»“ä¸å¯è®­ç»ƒ</p>
<h2 id="convformer"><a class="markdownIt-Anchor" href="#convformer"></a> ConvFormer</h2>
<p>å·ç§¯é‡‡ç”¨mobileNetV2çš„ç»“æ„ä¸­ç¿»è½¬å¯åˆ†ç¦»å·ç§¯çš„è®¾è®¡ï¼Œé‡‡ç”¨pointwiseå·ç§¯å’Œdepthwiseå·ç§¯çš„ç»“æ„ï¼Œå…¶å…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>C</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>o</mi><mi>l</mi><mi>u</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><mo>=</mo><mrow><mi>C</mi><mi>o</mi><mi>n</mi><msub><mi>v</mi><mrow><mi>p</mi><mi>w</mi><mn>2</mn></mrow></msub></mrow><mo stretchy="false">(</mo><mrow><mi>C</mi><mi>o</mi><mi>n</mi><msub><mi>v</mi><mrow><mi>d</mi><mi>w</mi></mrow></msub></mrow><mo stretchy="false">(</mo><mi>Ïƒ</mi><mo stretchy="false">(</mo><mrow><mi>C</mi><mi>o</mi><mi>n</mi><msub><mi>v</mi><mrow><mi>p</mi><mi>w</mi><mn>1</mn></mrow></msub></mrow><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{Convolutions(X)} = {Conv_{pw2}}( {Conv_{dw}}(\sigma ({Conv_{pw1}}(X))))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">o</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault">s</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">d</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight" style="margin-right:0.02691em;">w</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<h2 id="caformer"><a class="markdownIt-Anchor" href="#caformer"></a> CAFormer</h2>
<p>CAFormerå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå³backboneçš„éƒ¨åˆ†ä¸ºconvformerï¼Œéƒ¨åˆ†ä¸ºtransformerã€‚</p>
<h1 id="starreluæ¿€æ´»å‡½æ•°"><a class="markdownIt-Anchor" href="#starreluæ¿€æ´»å‡½æ•°"></a> StarRELUæ¿€æ´»å‡½æ•°</h1>
<h2 id="relu"><a class="markdownIt-Anchor" href="#relu"></a> ReLU</h2>
<p>åœ¨å¤§å¤štransformerä¸­ä½¿ç”¨ReLUæ¿€æ´»å‡½æ•°,æ¯ä¸ªReLUæ¶ˆè€—1FLOPè®¡ç®—å•å…ƒ</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ReLU(x) = max(0,x)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span></span></p>
<h2 id="gelu"><a class="markdownIt-Anchor" href="#gelu"></a> GELU</h2>
<p>è€ŒGPTã€Bertå’ŒViTç­‰ç½‘ç»œé»˜è®¤ä½¿ç”¨GELUæ¿€æ´»å‡½æ•°ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mi>E</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>â‰ˆ</mo><mn>0.5</mn><mo>Ã—</mo><mi>x</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>tanh</mi><mo>â¡</mo><mo stretchy="false">(</mo><msqrt><mfrac><mn>2</mn><mi>Ï€</mi></mfrac></msqrt><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>0.044715</mn><msup><mi>x</mi><mn>3</mn></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">GELU(x) = x\Phi(x) \approx 0.5 \times x(1 + \tanh(\sqrt{\frac{2}{\pi}}(x + 0.044715x^3)))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.44em;vertical-align:-0.788405em;"></span><span class="mop">tanh</span><span class="mopen">(</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.651595em;"><span class="svg-align" style="top:-4.4em;"><span class="pstrut" style="height:4.4em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.6115950000000003em;"><span class="pstrut" style="height:4.4em;"></span><span class="hide-tail" style="min-width:1.02em;height:2.48em;"><svg width='400em' height='2.48em' viewBox='0 0 400000 2592' preserveAspectRatio='xMinYMin slice'><path d='M424,2478c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,
-342,-109.8,-513.3,-110.5,-514c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,
25c-5.7,9.3,-9.8,16,-12.5,20s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,
-13s76,-122,76,-122s77,-121,77,-121s209,968,209,968c0,-2,84.7,-361.7,254,-1079
c169.3,-717.3,254.7,-1077.7,256,-1081c4,-6.7,10,-10,18,-10H400000v40H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M1001 80H400000v40H1014z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.788405em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">4</span><span class="mord">4</span><span class="mord">7</span><span class="mord">1</span><span class="mord">5</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<p>å…¶ä¸­<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î¦</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Phi(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Î¦</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span></span></span></span>ä¸ºé«˜æ–¯åˆ†å¸ƒçš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°(Cumulative Distribution Function for Gaussian Distribution ,CDFGD)ï¼Œæ¯ä¸ªè®¡ç®—å•å…ƒæ¶ˆè€—14FLOPS,tanhç®€å•è§†ä½œæ¶ˆè€—6ä¸ªFLOPSï¼Œä¹˜åŠ ç®—ä¸€ä¸ª</p>
<h2 id="squaredrelu"><a class="markdownIt-Anchor" href="#squaredrelu"></a> SquaredReLU</h2>
<p>ä¸ºäº†ç®€åŒ–GELUï¼Œä½œè€…å‘ç°å¯ä»¥å°†CDFGDæ›¿æ¢ä¸ºReLUï¼Œ,æ¯ä¸ªè®¡ç®—å•å…ƒæ¶ˆè€—2FLOPS</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>q</mi><mi>u</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>x</mi><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">SquaredReLU(x) = xReLU(x) = (ReLU(x))^2
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class="mord mathdefault">u</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="starrelu"><a class="markdownIt-Anchor" href="#starrelu"></a> StarReLU</h2>
<p>ä½œè€…å‘ç°SquaredReLUçš„æ€§èƒ½åœ¨æŸäº›ä»»åŠ¡ä¸å¤ªè¡Œï¼Œå…¶å‡è®¾è¾“å…¥æ€§èƒ½å·®æ˜¯è¾“å‡ºçš„åˆ†å¸ƒå˜åŒ–å¯¼è‡´ï¼Œå‡è®¾è¾“å…¥éµå¾ªå‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1çš„é«˜æ–¯åˆ†å¸ƒï¼Œå³<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi><mo>âˆ¼</mo><mi>N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x \sim N(0,1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span>ï¼Œæ­¤æ—¶æˆ‘ä»¬æœ‰</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn><mspace linebreak="newline"></mspace><mi>E</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>E</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>0.5</mn><mspace linebreak="newline"></mspace><mi>E</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mn>4</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>Ï€</mi></mrow></msqrt></mfrac><msubsup><mo>âˆ«</mo><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow></msubsup><msup><mi>z</mi><mn>4</mn></msup><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><mfrac><msup><mi>z</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo stretchy="false">)</mo><mi>d</mi><mi>z</mi><mspace linebreak="newline"></mspace><mo>=</mo><mo>âˆ’</mo><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>Ï€</mi></mrow></msqrt></mfrac><msubsup><mo>âˆ«</mo><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow></msubsup><msup><mi>z</mi><mn>3</mn></msup><mi>d</mi><mo stretchy="false">(</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><mfrac><msup><mi>z</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mo>=</mo><mo stretchy="false">(</mo><mo>âˆ’</mo><msup><mi>z</mi><mn>3</mn></msup><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>Ï€</mi></mrow></msqrt></mfrac><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><mfrac><msup><mi>z</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo stretchy="false">)</mo><mo stretchy="false">)</mo><msubsup><mi mathvariant="normal">âˆ£</mi><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow></msubsup><mo>+</mo><mn>3</mn><msubsup><mo>âˆ«</mo><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><mrow><mo>+</mo><mi mathvariant="normal">âˆ</mi></mrow></msubsup><msup><mi>z</mi><mn>2</mn></msup><mfrac><mn>1</mn><msqrt><mrow><mn>2</mn><mi>Ï€</mi></mrow></msqrt></mfrac><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo>âˆ’</mo><mfrac><msup><mi>z</mi><mn>2</mn></msup><mn>2</mn></mfrac><mo stretchy="false">)</mo><mi>d</mi><mi>z</mi><mspace linebreak="newline"></mspace><mo>=</mo><mn>0</mn><mo>+</mo><mn>3</mn><mi>E</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mn>2</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>3</mn><mspace linebreak="newline"></mspace><mi>E</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>4</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>E</mi><mo stretchy="false">(</mo><msup><mi>x</mi><mn>4</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>1.5</mn><mspace linebreak="newline"></mspace><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mi>E</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>4</mn></msup><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>E</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>=</mo><mn>1.5</mn><mo>âˆ’</mo><mn>0.</mn><msup><mn>5</mn><mn>2</mn></msup><mo>=</mo><mn>1.25</mn></mrow><annotation encoding="application/x-tex">E(x^2) = Var(x) = 1 \\
E((ReLU(x))^2) = \frac{1}{2}E(x^2) = 0.5 \\
E(x^4) = \frac{1}{\sqrt{2\pi}}\int_{-\infty}^{+\infty} z^4exp(-\frac{z^2}{2})dz  \\
     =  -\frac{1}{\sqrt{2\pi}}\int_{-\infty}^{+\infty} z^3d(exp(-\frac{z^2}{2})) \\
  = (-z^3\frac{1}{\sqrt{2\pi}}exp(-\frac{z^2}{2}))|_{-\infty}^{+\infty} + 3\int_{-\infty}^{+\infty}  z^2\frac{1}{\sqrt{2\pi}}exp(-\frac{z^2}{2})dz \\
  = 0 + 3E(x^2) = 3 \\
E((ReLU(x))^4) = \frac{1}{2}E(x^4) = 1.5 \\
Var((ReLU(x))^2) = E((ReLU(x))^4) - E((ReLU(x))^2)^2 = 1.5 - 0.5^2 = 1.25
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.491512em;vertical-align:-0.970281em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5212310000000002em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span><span style="top:-3.8129000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.970281em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.491512em;vertical-align:-0.970281em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5212310000000002em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span><span style="top:-3.8129000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.970281em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mord mathdefault">d</span><span class="mopen">(</span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4211080000000003em;vertical-align:-0.93em;"></span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mord"><span class="mord">âˆ£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.821331em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.491512em;vertical-align:-0.970281em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5212310000000002em;"><span style="top:-1.7880500000000001em;margin-left:-0.44445em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span><span style="top:-3.8129000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">+</span><span class="mord mtight">âˆ</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.970281em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">2</span><span class="mord mathdefault" style="margin-right:0.03588em;">Ï€</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">e</span><span class="mord mathdefault">x</span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.04398em;">z</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord"><span class="mord">5</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span><span class="mord">5</span></span></span></span></span></p>
<p>ä¸ºäº†æ¶ˆé™¤åå·®å½±å“ï¼Œé‡‡ç”¨å‡å»å‡å€¼é™¤ä»¥æ–¹å·®çš„å½¢å¼ï¼Œå…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>âˆ’</mo><mi>E</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><msqrt><mrow><mi>V</mi><mi>a</mi><mi>r</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">)</mo></mrow></msqrt></mfrac><mo>=</mo><mfrac><mrow><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>âˆ’</mo><mn>0.5</mn></mrow><msqrt><mn>1.25</mn></msqrt></mfrac><mspace linebreak="newline"></mspace><mo>â‰ˆ</mo><mn>0.8944</mn><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>âˆ’</mo><mn>0.4472</mn></mrow><annotation encoding="application/x-tex">StarReLU(x) = \frac{(ReLU(x))^2 - E((ReLU(x))^2)}{\sqrt{Var((ReLU(x))^2)}} = \frac{(ReLU(x))^2 - 0.5}{\sqrt{1.25}} \\
\approx  0.8944(ReLU(x))^2 - 0.4472
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.621108em;vertical-align:-1.13em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.175em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.935em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-2.8950000000000005em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.30499999999999994em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.13em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.4211080000000003em;vertical-align:-0.93em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.2027799999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.90722em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">1</span><span class="mord">.</span><span class="mord">2</span><span class="mord">5</span></span></span><span style="top:-2.86722em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.13278em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.48312em;vertical-align:0em;"></span><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mord">9</span><span class="mord">4</span><span class="mord">4</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">4</span><span class="mord">7</span><span class="mord">2</span></span></span></span></span></p>
<p>ä½œè€…å‡å®šè¾“å…¥æˆé«˜æ–¯åˆ†å¸ƒï¼Œä¸ºäº†é€‚åº”ä¸åŒæƒ…å†µï¼Œå°†å°†å…¶æ”¹ä¸ºå¯å­¦ä¹ çš„ç¼©æ”¾å’Œåç§»å‚æ•°ï¼Œå…¬å¼å¦‚ä¸‹ï¼Œè¿™æ ·åªæ¶ˆè€—4ä¸ªFLOPS</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mo>â‹…</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>L</mi><mi>U</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>Î²</mi></mrow><annotation encoding="application/x-tex">StarReLU(x) = s \cdot (ReLU(x))^2 + \beta
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault">e</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">U</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span></span></span></span></span></p>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h1>
<p>æœ¬ç¯‡è®ºæ–‡è®¤ä¸ºtransformerçš„å®è§‚è®¾è®¡æ¯”token mixeræ›´ä¸ºé‡è¦ï¼Œåœ¨å°†token mixeræ¢æˆpoolingï¼Œidentityï¼Œconvç­‰æ“ä½œåï¼Œæ¨¡å‹çš„è¡¨ç°ä¾ç„¶è‰¯å¥½ã€‚å¹¶ä¸”æå‡ºäº†ä¸€ç§æ–°çš„æ¿€æ´»å‡½æ•°StarReLUï¼Œå…¶æ¶ˆè€—çš„FLOPSæ›´å°‘ã€‚</p>
<p>ç¬”è€…åœ¨è‡ªå·±çš„æ•°æ®é›†ä¸Šå°è¯•ä½¿ç”¨metaformerï¼Œå…¶å‚æ•°é‡æ¯”UNETRå°‘ï¼Œä¸”æ•ˆæœæ¥è¿‘UNETRã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/2111.11418">MetaFormer Is Actually What You Need for Vision</a></p>
<p><a href="https://arxiv.org/abs/2210.13452">MetaFormer Baselines for Vision</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>åŠ¨æ€è›‡å½¢å·ç§¯ç¬”è®°</title>
    <url>/2023/11/14/dynamic-snake-convolution-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Šæ™‚è¨ˆä»•æ›ã‘ã®ãƒ¬ã‚¤ãƒ©ã‚¤ãƒ³ -é™½ç‚ã«å½·å¾¨ã†é­”å¥³-ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æœ€è¿‘çœ‹åˆ°äº†åŠ¨æ€è›‡å½¢å·ç§¯è¿™ä¸€æ¨¡å—ï¼Œæ„Ÿè§‰å…¶æè¿°çš„æŒ‰è¡€ç®¡å·ç§¯å’Œé€‚åˆç»†é•¿ç»“æ„æ¯”è¾ƒé€‚åˆæˆ‘çš„åœºæ™¯ï¼Œå› æ­¤é˜…è¯»äº†è§£ä¸€ä¸‹ï¼Œå¹¶è®°å½•ä¸€ä¸‹è®ºæ–‡ç¬”è®°ã€‚</p>
<h1 id="ç»“æ„"><a class="markdownIt-Anchor" href="#ç»“æ„"></a> ç»“æ„</h1>
<p>å°½ç®¡ç°åœ¨æœ‰SAMã€Universal Modelç­‰ä¼˜ç§€æ¨¡å‹ï¼Œè®¸å¤šåˆ†å‰²ä»»åŠ¡åªéœ€è¦åœ¨è¿™ä¸Šé¢è¿›è¡Œç®€å•å¾®è°ƒå³å¯ï¼Œä½†æ˜¯åœ¨ä¸€äº›å¤æ‚é¢†åŸŸï¼Œå¤§æ¨¡å‹æš‚æ—¶æ²¡æœ‰å¾ˆå¥½çš„è¦†ç›–ï¼Œä¾‹å¦‚ä¸€äº›å¤æ‚ç»“æ„ç®¡çŠ¶ç»“æ„ï¼Œå¦‚ï¼ˆ3Dè¡€ç®¡ã€æ°”ç®¡ï¼‰ã€‚æ•´ä¸ªåŠ¨æ€è›‡å½¢å·ç§¯å—åˆ°å¯å½¢å˜å·ç§¯(Deformable Convolution)çš„å¯å‘ï¼Œå…¶å°†å¯å½¢å˜å·ç§¯çš„åç§»é‡ä»å›ºå®šçš„åç§»é‡å˜æˆäº†åŠ¨æ€çš„åç§»é‡ï¼Œä»è€Œä½¿å¾—å…¶å¯ä»¥æ›´å¥½çš„é€‚åº”ç»†é•¿ç»“æ„ã€‚</p>
<p>å¯å½¢å˜å·ç§¯æ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡ä¸€ä¸ªå·ç§¯è®¡ç®—ç‰¹å¾å›¾çš„åç§»é‡ï¼Œçœ‹èµ·ä»£ç å¯ä»¥çœ‹åˆ°è¿™äº›åç½®åªæœ‰ä¸€ä¸ªèŒƒå›´çº¦æŸï¼Œå½¢å˜èŒƒå›´éå¸¸çš„è‡ªç”±ï¼Œè€Œè›‡å½¢å·ç§¯ä½œè€…è®¤ä¸ºè¿™æ ·å­å®¹æ˜“è®©æ¨¡å‹ä¸¢å¤±å æ¯”å°çš„ç»†å°ç»“æ„ï¼Œå¯¹äºç»†é•¿ç®¡çŠ¶ç»“æ„åˆ†å‰²ä»»åŠ¡æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§æŒ‘æˆ˜ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.9/DeformConv.png" alt="å¯å½¢å˜å·ç§¯" /></p>
<p>å…¶æå‡ºå¯¹å¯å½¢å˜å·ç§¯å¢åŠ ä¸€ä¸ªè¿ç»­æ€§çš„çº¦æŸï¼Œä½¿å…¶åƒè›‡ä¸€æ ·è¿ç»­ç§»åŠ¨ï¼Œä¸€èŠ‚èŠ‚å¦‚è›‡ä¸€æ ·ç§»åŠ¨ï¼Œä»è€Œä½¿å¾—å…¶å¯ä»¥æ›´å¥½çš„é€‚åº”ç»†é•¿ç»“æ„ï¼Œæ¯ä¸ªå·ç§¯é‡‡ç”¨ä¸€ä¸ªæ–¹å‘ä½œä¸ºåŸºå‡†è‡ªç”±æ‘†åŠ¨ã€‚<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.9/DSConv.png" alt="è›‡å½¢å·ç§¯" /><br />
xæ–¹å‘çš„è›‡å½¢å·ç§¯ï¼Œå¯ä»¥çœ‹åˆ°é€šè¿‡çº¦æŸï¼Œç›¸é‚»ä¸¤ä¸ªæ„Ÿå—é‡yåæ ‡ç›¸å·®<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>Â±</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\pm1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">Â±</span><span class="mord">1</span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>K</mi><mrow><mi>i</mi><mo>Â±</mo><mi>c</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>+</mo><mi>c</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>+</mo><mi>c</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>c</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><msubsup><mi mathvariant="normal">Î£</mi><mi>i</mi><mrow><mi>i</mi><mo>+</mo><mi>c</mi></mrow></msubsup><mi mathvariant="normal">Î”</mi><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>i</mi><mo>âˆ’</mo><mi>c</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>i</mi><mo>âˆ’</mo><mi>c</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>âˆ’</mo><mi>c</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>+</mo><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>i</mi><mo>âˆ’</mo><mi>c</mi></mrow><mi>i</mi></msubsup><mi mathvariant="normal">Î”</mi><mi>y</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex"> K_{i\pm c}= 
    \left\{ 
        \begin {aligned} 
            (x_{i+c}, y_{i+c}) = (x_i+c, y_i + \Sigma _{i}^{i+c} \Delta y) \\ 
            (x_{i-c}, y_{i-c}) = (x_i-c, y_i + \Sigma _{i-c}^{i} \Delta y) \\ 
        \end {aligned}    
    \right.  
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.891661em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">Â±</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.069328em;vertical-align:-1.284664em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.784664em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8746639999999999em;"><span style="top:-2.433005em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.266995em;"><span></span></span></span></span></span></span><span class="mord">Î”</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-2.375336em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">c</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.874664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">c</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.305331em;"><span></span></span></span></span></span></span><span class="mord">Î”</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.284664em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>åŒç†yæ–¹å‘è›‡å½¢å·ç§¯å…¬å¼å¦‚ä¸‹</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>K</mi><mrow><mi>j</mi><mo>Â±</mo><mi>c</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>j</mi><mo>+</mo><mi>c</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>j</mi><mo>+</mo><mi>c</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>+</mo><msubsup><mi mathvariant="normal">Î£</mi><mi>j</mi><mrow><mi>j</mi><mo>+</mo><mi>c</mi></mrow></msubsup><mi mathvariant="normal">Î”</mi><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>j</mi></msub><mo>+</mo><mi>c</mi><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>j</mi><mo>âˆ’</mo><mi>c</mi></mrow></msub><mo separator="true">,</mo><msub><mi>y</mi><mrow><mi>j</mi><mo>âˆ’</mo><mi>c</mi></mrow></msub><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo>+</mo><msubsup><mi mathvariant="normal">Î£</mi><mrow><mi>j</mi><mo>âˆ’</mo><mi>c</mi></mrow><mi>j</mi></msubsup><mi mathvariant="normal">Î”</mi><mi>x</mi><mo separator="true">,</mo><msub><mi>y</mi><mi>j</mi></msub><mo>âˆ’</mo><mi>c</mi><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex"> K_{j\pm c}=\left \{ \begin {aligned} (x_{j+c}, y_{j+c}) = (x_{j} + \Sigma _{j}^{j+c} \Delta x, y_j+c), \\ (x_{j-c}, y_{j-c}) = (x_{j} + \Sigma _{j-c}^{j} \Delta x, y_j-c), \\ \end {aligned} \right. 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">Â±</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.311088em;vertical-align:-1.405544em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.905544em;"><span style="top:-3.962972em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.942572em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mord">Î”</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">c</span><span class="mclose">)</span><span class="mpunct">,</span></span></span><span style="top:-2.3074280000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord">Î£</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.942572em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">âˆ’</span><span class="mord mathdefault mtight">c</span></span></span></span><span style="top:-3.1809080000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.412972em;"><span></span></span></span></span></span></span><span class="mord">Î”</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">c</span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.405544em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>è›‡å½¢å·ç§¯å’Œå…¶ä»–å·ç§¯çš„å¯¹æ¯”æ•ˆæœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ„Ÿå—é‡çš„ä¸åŒéå¸¸æ˜æ˜¾ï¼Œä¸”çœ‹åœ¨å®é™…å›¾åƒä¸Šçš„æ„Ÿå—é‡ï¼Œå’Œå¯å½¢å˜å·ç§¯æ¯”è·Ÿé€‚åˆç»†é•¿ç®¡çŠ¶ç»“æ„ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.9/conv-compare.png" alt="å·ç§¯æ„Ÿå—é‡å¯¹æ¯”" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.9/conv-effect.png" alt="å·ç§¯æ•ˆæœå¯¹æ¯”,ä¸€å…±ä¸‰å±‚å·ç§¯729ä¸ªç‚¹ï¼ˆçº¢è‰²ï¼‰çš„æ„Ÿå—é‡ï¼Œé»„è‰²ä¸ºå·ç§¯æ ¸çš„ä½ç½®" /></p>
<h1 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h1>
<p>åŠ¨æ€è›‡å½¢å·ç§¯çš„ä»£ç å¦‚ä¸‹ï¼Œæ˜¯ç›´æ¥ä»å®˜æ–¹åº“ä¿®æ”¹ï¼Œå®˜æ–¹ä»£ç ä¸­åœ¨è›‡å½¢å·ç§¯ä¸­æœ‰ä¸€äº›é‡å¤ä»£ç ï¼Œä½†æ˜¯ä¸ºäº†è¿˜åŸæ•ˆæœè¿›è¡ŒéªŒè¯è¿˜å…ˆä¸æ”¹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> monai.networks.blocks.convolutions <span class="keyword">import</span> Convolution</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DSConv3d</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_ch: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_ch: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        kernel_size: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">        extend_scope: <span class="built_in">int</span> = <span class="number">1</span>,</span></span><br><span class="line"><span class="params">        morph: <span class="built_in">int</span> = <span class="number">0</span>,</span></span><br><span class="line"><span class="params">        if_offset: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>(DSConv3d, self).__init__()</span><br><span class="line">        <span class="keyword">assert</span> out_ch &gt;= <span class="number">4</span>, <span class="string">&quot;out_ch must be larger than 4&quot;</span></span><br><span class="line">        self.offset_conv = nn.Conv3d(in_ch, <span class="number">3</span> * <span class="number">2</span> * kernel_size, <span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.bn = nn.BatchNorm3d(<span class="number">3</span> * <span class="number">2</span> * kernel_size)</span><br><span class="line">        self.kernel_size = kernel_size</span><br><span class="line"></span><br><span class="line">        self.if_offset = if_offset</span><br><span class="line">        self.morph = morph</span><br><span class="line">        self.extend_scope = extend_scope</span><br><span class="line"></span><br><span class="line">        self.dcn_conv_x = nn.Conv3d(</span><br><span class="line">            in_ch,</span><br><span class="line">            out_ch,</span><br><span class="line">            kernel_size=(<span class="number">1</span>, <span class="number">1</span>, kernel_size),</span><br><span class="line">            stride=(<span class="number">1</span>, <span class="number">1</span>, kernel_size),</span><br><span class="line">            padding=<span class="number">0</span>,</span><br><span class="line">        )  <span class="comment">#</span></span><br><span class="line">        self.dcn_conv_y = nn.Conv3d(</span><br><span class="line">            in_ch,</span><br><span class="line">            out_ch,</span><br><span class="line">            kernel_size=(<span class="number">1</span>, kernel_size, <span class="number">1</span>),</span><br><span class="line">            stride=(<span class="number">1</span>, kernel_size, <span class="number">1</span>),</span><br><span class="line">            padding=<span class="number">0</span>,</span><br><span class="line">        )  <span class="comment">#</span></span><br><span class="line">        self.dcn_conv_z = nn.Conv3d(</span><br><span class="line">            in_ch,</span><br><span class="line">            out_ch,</span><br><span class="line">            kernel_size=(kernel_size, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">            stride=(kernel_size, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">            padding=<span class="number">0</span>,</span><br><span class="line">        )  <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">        self.dcn_conv = nn.Conv3d(</span><br><span class="line">            in_ch, out_ch, kernel_size=kernel_size, stride=kernel_size, padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        self.gn = nn.GroupNorm(out_ch // <span class="number">4</span>, out_ch)</span><br><span class="line">        self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, f</span>):</span><br><span class="line">        offset = self.offset_conv(f)</span><br><span class="line">        offset = self.bn(offset)</span><br><span class="line">        offset = torch.tanh(offset)</span><br><span class="line">        input_shape = f.shape</span><br><span class="line"></span><br><span class="line">        dcn = DCN3d(input_shape, self.kernel_size, self.extend_scope, self.morph)</span><br><span class="line">        deformed_feature = dcn.deform_conv(f, offset, self.if_offset)</span><br><span class="line">        <span class="keyword">if</span> self.morph == <span class="number">0</span>:</span><br><span class="line">            x = self.dcn_conv_x(deformed_feature)</span><br><span class="line">            x = self.gn(x)</span><br><span class="line">            x = self.relu(x)</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">elif</span> self.morph == <span class="number">1</span>:</span><br><span class="line">            x = self.dcn_conv_y(deformed_feature)</span><br><span class="line">            x = self.gn(x)</span><br><span class="line">            x = self.relu(x)</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x = self.dcn_conv_z(deformed_feature)</span><br><span class="line">            x = self.gn(x)</span><br><span class="line">            x = self.relu(x)</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DCN3d</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_shape, kernel_size, extend_scope, morph</span>):</span><br><span class="line">        self.num_points = kernel_size</span><br><span class="line">        self.depth = input_shape[<span class="number">2</span>]</span><br><span class="line">        self.width = input_shape[<span class="number">3</span>]</span><br><span class="line">        self.height = input_shape[<span class="number">4</span>]</span><br><span class="line">        self.morph = morph</span><br><span class="line">        self.extend_scope = extend_scope  <span class="comment"># offset (-1 ~ 1) * extend_scope</span></span><br><span class="line">        self.num_batch = input_shape[<span class="number">0</span>]  <span class="comment"># (N,C,D,W,H)</span></span><br><span class="line">        self.num_channels = input_shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    input: offset [N,3*K,D,W,H]</span></span><br><span class="line"><span class="string">    output: [N,1,K*D,W,H]   coordinate map</span></span><br><span class="line"><span class="string">    output: [N,1,K,K*W,H]   coordinate map</span></span><br><span class="line"><span class="string">    output: [N,1,D,W,K*H]   coordinate map</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_coordinate_map_3D</span>(<span class="params">self, offset, if_offset</span>):</span><br><span class="line">        device = offset.device</span><br><span class="line">        <span class="comment"># offset</span></span><br><span class="line">        offset1, offset2 = torch.split(offset, <span class="number">3</span> * self.num_points, dim=<span class="number">1</span>)</span><br><span class="line">        z_offset1, y_offset1, x_offset1 = torch.split(offset1, self.num_points, dim=<span class="number">1</span>)</span><br><span class="line">        z_offset2, y_offset2, x_offset2 = torch.split(offset2, self.num_points, dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        z_center = torch.arange(<span class="number">0</span>, self.depth).repeat([self.width * self.height])</span><br><span class="line">        z_center = z_center.reshape(self.width, self.height, self.depth)</span><br><span class="line">        z_center = z_center.permute(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        z_center = z_center.reshape([-<span class="number">1</span>, self.depth, self.width, self.height])</span><br><span class="line">        z_center = z_center.repeat([self.num_points, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]).<span class="built_in">float</span>()</span><br><span class="line">        z_center = z_center.unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        y_center = torch.arange(<span class="number">0</span>, self.width).repeat([self.height * self.depth])</span><br><span class="line">        y_center = y_center.reshape(self.height, self.depth, self.width)</span><br><span class="line">        y_center = y_center.permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        y_center = y_center.reshape([-<span class="number">1</span>, self.depth, self.width, self.height])</span><br><span class="line">        y_center = y_center.repeat([self.num_points, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]).<span class="built_in">float</span>()</span><br><span class="line">        y_center = y_center.unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        x_center = torch.arange(<span class="number">0</span>, self.height).repeat([self.depth * self.width])</span><br><span class="line">        x_center = x_center.reshape(self.depth, self.width, self.height)</span><br><span class="line">        x_center = x_center.permute(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">        x_center = x_center.reshape([-<span class="number">1</span>, self.depth, self.width, self.height])</span><br><span class="line">        x_center = x_center.repeat([self.num_points, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]).<span class="built_in">float</span>()</span><br><span class="line">        x_center = x_center.unsqueeze(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.morph == <span class="number">0</span>:</span><br><span class="line">            z = torch.linspace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            y = torch.linspace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            x = torch.linspace(</span><br><span class="line">                -<span class="built_in">int</span>(self.num_points // <span class="number">2</span>),</span><br><span class="line">                <span class="built_in">int</span>(self.num_points // <span class="number">2</span>),</span><br><span class="line">                <span class="built_in">int</span>(self.num_points),</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">with</span> warnings.catch_warnings():</span><br><span class="line">                warnings.simplefilter(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">                z, y, x = torch.meshgrid(z, y, x)</span><br><span class="line">            z_spread = z.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            y_spread = y.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            x_spread = x.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            z_grid = z_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            z_grid = z_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            z_grid = z_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N,K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            y_grid = y_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            y_grid = y_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            y_grid = y_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N,K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            x_grid = x_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            x_grid = x_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            x_grid = x_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N,K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            z_new = z_center + z_grid</span><br><span class="line">            y_new = y_center + y_grid</span><br><span class="line">            x_new = x_center + x_grid  <span class="comment"># [N,K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            z_new = z_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            y_new = y_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            x_new = x_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            z_new = z_new.to(device)</span><br><span class="line">            y_new = y_new.to(device)</span><br><span class="line">            x_new = x_new.to(device)</span><br><span class="line"></span><br><span class="line">            z_offset1_new = z_offset1.detach().clone()</span><br><span class="line">            y_offset1_new = y_offset1.detach().clone()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> if_offset:</span><br><span class="line">                z_offset1_new = z_offset1_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                y_offset1_new = y_offset1_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                z_offset1 = z_offset1.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                y_offset1 = y_offset1.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                center = <span class="built_in">int</span>(self.num_points // <span class="number">2</span>)</span><br><span class="line">                z_offset1_new[center] = <span class="number">0</span></span><br><span class="line">                y_offset1_new[center] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, center + <span class="number">1</span>):</span><br><span class="line">                    z_offset1_new[center + index] = (</span><br><span class="line">                        z_offset1_new[center + index - <span class="number">1</span>] + z_offset1[center + index]</span><br><span class="line">                    )</span><br><span class="line">                    z_offset1_new[center - index] = (</span><br><span class="line">                        z_offset1_new[center - index + <span class="number">1</span>] + z_offset1[center - index]</span><br><span class="line">                    )</span><br><span class="line">                    y_offset1_new[center + index] = (</span><br><span class="line">                        y_offset1_new[center + index - <span class="number">1</span>] + y_offset1[center + index]</span><br><span class="line">                    )</span><br><span class="line">                    y_offset1_new[center - index] = (</span><br><span class="line">                        y_offset1_new[center - index + <span class="number">1</span>] + y_offset1[center - index]</span><br><span class="line">                    )</span><br><span class="line">                z_offset1_new = z_offset1_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).to(device)</span><br><span class="line">                y_offset1_new = y_offset1_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).to(device)</span><br><span class="line">                z_new = z_new.add(z_offset1_new.mul(self.extend_scope))</span><br><span class="line">                y_new = y_new.add(y_offset1_new.mul(self.extend_scope))</span><br><span class="line"></span><br><span class="line">                z_new = z_new.reshape(</span><br><span class="line">                    [</span><br><span class="line">                        self.num_batch,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        self.num_points,</span><br><span class="line">                        self.depth,</span><br><span class="line">                        self.width,</span><br><span class="line">                        self.height,</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line">                z_new = z_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">                z_new = z_new.reshape(</span><br><span class="line">                    [</span><br><span class="line">                        self.num_batch,</span><br><span class="line">                        self.depth,</span><br><span class="line">                        self.width,</span><br><span class="line">                        self.num_points * self.height,</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                y_new = y_new.reshape(</span><br><span class="line">                    [</span><br><span class="line">                        self.num_batch,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        self.num_points,</span><br><span class="line">                        self.depth,</span><br><span class="line">                        self.width,</span><br><span class="line">                        self.height,</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line">                y_new = y_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">                y_new = y_new.reshape(</span><br><span class="line">                    [</span><br><span class="line">                        self.num_batch,</span><br><span class="line">                        self.depth,</span><br><span class="line">                        self.width,</span><br><span class="line">                        self.num_points * self.height,</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                x_new = x_new.reshape(</span><br><span class="line">                    [</span><br><span class="line">                        self.num_batch,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        <span class="number">1</span>,</span><br><span class="line">                        self.num_points,</span><br><span class="line">                        self.depth,</span><br><span class="line">                        self.width,</span><br><span class="line">                        self.height,</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line">                x_new = x_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">                x_new = x_new.reshape(</span><br><span class="line">                    [</span><br><span class="line">                        self.num_batch,</span><br><span class="line">                        self.depth,</span><br><span class="line">                        self.width,</span><br><span class="line">                        self.num_points * self.height,</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">return</span> z_new, y_new, x_new</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> self.morph == <span class="number">1</span>:</span><br><span class="line">            z = torch.linspace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            y = torch.linspace(</span><br><span class="line">                -<span class="built_in">int</span>(self.num_points // <span class="number">2</span>),</span><br><span class="line">                <span class="built_in">int</span>(self.num_points // <span class="number">2</span>),</span><br><span class="line">                <span class="built_in">int</span>(self.num_points),</span><br><span class="line">            )</span><br><span class="line">            x = torch.linspace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">with</span> warnings.catch_warnings():</span><br><span class="line">                warnings.simplefilter(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">                z, y, x = torch.meshgrid(z, y, x)</span><br><span class="line">            z_spread = z.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            y_spread = y.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            x_spread = x.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            z_grid = z_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            z_grid = z_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            z_grid = z_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            y_grid = y_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            y_grid = y_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            y_grid = y_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N*K*K*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            x_grid = x_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            x_grid = x_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            x_grid = x_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N*K*K*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            z_new = z_center + z_grid</span><br><span class="line">            y_new = y_center + y_grid</span><br><span class="line">            x_new = x_center + x_grid  <span class="comment"># [N*K*K*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            z_new = z_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            y_new = y_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            x_new = x_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            z_new = z_new.to(device)</span><br><span class="line">            y_new = y_new.to(device)</span><br><span class="line">            x_new = x_new.to(device)</span><br><span class="line">            x_offset1_new = x_offset1.detach().clone()</span><br><span class="line">            z_offset2_new = z_offset2.detach().clone()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> if_offset:</span><br><span class="line">                x_offset1_new = x_offset1_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                z_offset2_new = z_offset2_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                x_offset1 = x_offset1.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                z_offset2 = z_offset2.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                center = <span class="built_in">int</span>(self.num_points // <span class="number">2</span>)</span><br><span class="line">                x_offset1_new[center] = <span class="number">0</span></span><br><span class="line">                z_offset2_new[center] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, center + <span class="number">1</span>):</span><br><span class="line">                    x_offset1_new[center + index] = (</span><br><span class="line">                        x_offset1_new[center + index - <span class="number">1</span>] + x_offset1[center + index]</span><br><span class="line">                    )</span><br><span class="line">                    x_offset1_new[center - index] = (</span><br><span class="line">                        x_offset1_new[center - index + <span class="number">1</span>] + x_offset1[center - index]</span><br><span class="line">                    )</span><br><span class="line">                    z_offset2_new[center + index] = (</span><br><span class="line">                        z_offset2_new[center + index - <span class="number">1</span>] + z_offset2[center + index]</span><br><span class="line">                    )</span><br><span class="line">                    z_offset2_new[center - index] = (</span><br><span class="line">                        z_offset2_new[center - index + <span class="number">1</span>] + z_offset2[center - index]</span><br><span class="line">                    )</span><br><span class="line">                x_offset1_new = x_offset1_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).to(device)</span><br><span class="line">                z_offset2_new = z_offset2_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).to(device)</span><br><span class="line">                z_new = z_new.add(z_offset2_new.mul(self.extend_scope))</span><br><span class="line">                x_new = x_new.add(x_offset1_new.mul(self.extend_scope))</span><br><span class="line">            z_new = z_new.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.num_points,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            z_new = z_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">            z_new = z_new.reshape(</span><br><span class="line">                [self.num_batch, self.depth, self.num_points * self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            y_new = y_new.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.num_points,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            y_new = y_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">            y_new = y_new.reshape(</span><br><span class="line">                [self.num_batch, self.depth, self.num_points * self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            x_new = x_new.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.num_points,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            x_new = x_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">            x_new = x_new.reshape(</span><br><span class="line">                [self.num_batch, self.depth, self.num_points * self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> z_new, y_new, x_new</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            z = torch.linspace(</span><br><span class="line">                -<span class="built_in">int</span>(self.num_points // <span class="number">2</span>),</span><br><span class="line">                <span class="built_in">int</span>(self.num_points // <span class="number">2</span>),</span><br><span class="line">                <span class="built_in">int</span>(self.num_points),</span><br><span class="line">            )</span><br><span class="line">            y = torch.linspace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            x = torch.linspace(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">with</span> warnings.catch_warnings():</span><br><span class="line">                warnings.simplefilter(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">                z, y, x = torch.meshgrid(z, y, x)</span><br><span class="line">            z_spread = z.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            y_spread = y.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            x_spread = x.reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            z_grid = z_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            z_grid = z_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            z_grid = z_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            y_grid = y_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            y_grid = y_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            y_grid = y_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N*K*K*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            x_grid = x_spread.repeat([<span class="number">1</span>, self.depth * self.width * self.height])</span><br><span class="line">            x_grid = x_grid.reshape(</span><br><span class="line">                [self.num_points, self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            x_grid = x_grid.unsqueeze(<span class="number">0</span>)  <span class="comment"># [N*K*K*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            z_new = z_center + z_grid</span><br><span class="line">            y_new = y_center + y_grid</span><br><span class="line">            x_new = x_center + x_grid  <span class="comment"># [N*K*K*K,D,W,H]</span></span><br><span class="line"></span><br><span class="line">            z_new = z_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            y_new = y_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">            x_new = x_new.repeat(self.num_batch, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            z_new = z_new.to(device)</span><br><span class="line">            y_new = y_new.to(device)</span><br><span class="line">            x_new = x_new.to(device)</span><br><span class="line">            x_offset2_new = x_offset2.detach().clone()</span><br><span class="line">            y_offset2_new = y_offset2.detach().clone()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> if_offset:</span><br><span class="line">                x_offset2_new = x_offset2_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                y_offset2_new = y_offset2_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                x_offset2 = x_offset2.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                y_offset2 = y_offset2.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">                center = <span class="built_in">int</span>(self.num_points // <span class="number">2</span>)</span><br><span class="line">                x_offset2_new[center] = <span class="number">0</span></span><br><span class="line">                x_offset2_new[center] = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, center + <span class="number">1</span>):</span><br><span class="line">                    x_offset2_new[center + index] = (</span><br><span class="line">                        x_offset2_new[center + index - <span class="number">1</span>] + x_offset2[center + index]</span><br><span class="line">                    )</span><br><span class="line">                    x_offset2_new[center - index] = (</span><br><span class="line">                        x_offset2_new[center - index + <span class="number">1</span>] + x_offset2[center - index]</span><br><span class="line">                    )</span><br><span class="line">                    y_offset2_new[center + index] = (</span><br><span class="line">                        y_offset2_new[center + index - <span class="number">1</span>] + y_offset2[center + index]</span><br><span class="line">                    )</span><br><span class="line">                    y_offset2_new[center - index] = (</span><br><span class="line">                        y_offset2_new[center - index + <span class="number">1</span>] + y_offset2[center - index]</span><br><span class="line">                    )</span><br><span class="line">                x_offset2_new = x_offset2_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).to(device)</span><br><span class="line">                y_offset2_new = y_offset2_new.permute(<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).to(device)</span><br><span class="line">                x_new = x_new.add(x_offset2_new.mul(self.extend_scope))</span><br><span class="line">                y_new = y_new.add(y_offset2_new.mul(self.extend_scope))</span><br><span class="line"></span><br><span class="line">            z_new = z_new.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    self.num_points,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            z_new = z_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">            z_new = z_new.reshape(</span><br><span class="line">                [self.num_batch, self.num_points * self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            y_new = y_new.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    self.num_points,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            y_new = y_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">            y_new = y_new.reshape(</span><br><span class="line">                [self.num_batch, self.num_points * self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            x_new = x_new.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    self.num_points,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    <span class="number">1</span>,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            x_new = x_new.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>)</span><br><span class="line">            x_new = x_new.reshape(</span><br><span class="line">                [self.num_batch, self.num_points * self.depth, self.width, self.height]</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> z_new, y_new, x_new</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    input: input feature map [N,C,D,W,H]ï¼›coordinate map [N,K*D,K*W,K*H] </span></span><br><span class="line"><span class="string">    output: [N,1,K*D,K*W,K*H]  deformed feature map</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_bilinear_interpolate_3D</span>(<span class="params">self, input_feature, z, y, x</span>):</span><br><span class="line">        device = input_feature.device</span><br><span class="line">        z = z.reshape([-<span class="number">1</span>]).<span class="built_in">float</span>()</span><br><span class="line">        y = y.reshape([-<span class="number">1</span>]).<span class="built_in">float</span>()</span><br><span class="line">        x = x.reshape([-<span class="number">1</span>]).<span class="built_in">float</span>()  <span class="comment"># [N*KD*KW*KH]</span></span><br><span class="line"></span><br><span class="line">        zero = torch.zeros([]).<span class="built_in">int</span>()</span><br><span class="line">        max_z = self.depth - <span class="number">1</span></span><br><span class="line">        max_y = self.width - <span class="number">1</span></span><br><span class="line">        max_x = self.height - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># find 8 grid locations</span></span><br><span class="line">        z0 = torch.floor(z).<span class="built_in">int</span>()</span><br><span class="line">        z1 = z0 + <span class="number">1</span></span><br><span class="line">        y0 = torch.floor(y).<span class="built_in">int</span>()</span><br><span class="line">        y1 = y0 + <span class="number">1</span></span><br><span class="line">        x0 = torch.floor(x).<span class="built_in">int</span>()</span><br><span class="line">        x1 = x0 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># clip out coordinates exceeding feature map volumeä»¥å¤–çš„ç‚¹</span></span><br><span class="line">        z0 = torch.clamp(z0, zero, max_z)</span><br><span class="line">        z1 = torch.clamp(z1, zero, max_z)</span><br><span class="line">        y0 = torch.clamp(y0, zero, max_y)</span><br><span class="line">        y1 = torch.clamp(y1, zero, max_y)</span><br><span class="line">        x0 = torch.clamp(x0, zero, max_x)</span><br><span class="line">        x1 = torch.clamp(x1, zero, max_x)  <span class="comment"># [N*KD*KW*KH]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># convert input_feature and coordinate X, Y to 3Dï¼Œfor gathering</span></span><br><span class="line">        <span class="comment"># input_feature_flat = input_feature.reshape([-1, self.num_channels])   # [N*D*W*H, C]</span></span><br><span class="line">        input_feature_flat = input_feature.flatten()</span><br><span class="line">        input_feature_flat = input_feature_flat.reshape(</span><br><span class="line">            self.num_batch, self.num_channels, self.depth, self.width, self.height</span><br><span class="line">        )</span><br><span class="line">        input_feature_flat = input_feature_flat.permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line">        input_feature_flat = input_feature_flat.reshape(-<span class="number">1</span>, self.num_channels)</span><br><span class="line">        dimension = self.height * self.width * self.depth</span><br><span class="line"></span><br><span class="line">        base = torch.arange(self.num_batch) * dimension</span><br><span class="line">        base = base.reshape([-<span class="number">1</span>, <span class="number">1</span>]).<span class="built_in">float</span>()  <span class="comment"># [N,1]</span></span><br><span class="line"></span><br><span class="line">        repeat = torch.ones(</span><br><span class="line">            [self.num_points * self.depth * self.width * self.height]</span><br><span class="line">        ).unsqueeze(<span class="number">0</span>)</span><br><span class="line">        repeat = repeat.<span class="built_in">float</span>()  <span class="comment"># [1,D*W*H*K*K*K]</span></span><br><span class="line"></span><br><span class="line">        base = torch.matmul(</span><br><span class="line">            base, repeat</span><br><span class="line">        )  <span class="comment"># [N,1] * [1,D*W*H*K*K*K]  ==&gt; [N,D*W*H*K*K*K]</span></span><br><span class="line">        base = base.reshape([-<span class="number">1</span>])  <span class="comment"># [D*W*H*K*K*K]</span></span><br><span class="line"></span><br><span class="line">        base = base.to(device)</span><br><span class="line"></span><br><span class="line">        base_z0 = base + z0 * self.height * self.width</span><br><span class="line">        base_z1 = base + z1 * self.height * self.width</span><br><span class="line">        base_y0 = base + y0 * self.height</span><br><span class="line">        base_y1 = base + y1 * self.height</span><br><span class="line"></span><br><span class="line">        <span class="comment"># top rectangle of the neighbourhood volume</span></span><br><span class="line">        index_a0 = base_y0 + base_z0 - base + x0</span><br><span class="line">        index_b0 = base_y0 + base_z1 - base + x0</span><br><span class="line">        index_c0 = base_y0 + base_z0 - base + x1</span><br><span class="line">        index_d0 = base_y0 + base_z1 - base + x1  <span class="comment"># [N*KD*KW*KH]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># bottom rectangle of the neighbourhood volume</span></span><br><span class="line">        index_a1 = base_y1 + base_z0 - base + x0</span><br><span class="line">        index_b1 = base_y1 + base_z1 - base + x0</span><br><span class="line">        index_c1 = base_y1 + base_z0 - base + x1</span><br><span class="line">        index_d1 = base_y1 + base_z1 - base + x1  <span class="comment"># [N*KD*KW*KH]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># get 8 grid values  ([N*D*W*H,C], [N*D*W*H*27])</span></span><br><span class="line">        value_a0 = input_feature_flat[index_a0.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_b0 = input_feature_flat[index_b0.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_c0 = input_feature_flat[index_c0.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_d0 = input_feature_flat[index_d0.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_a1 = input_feature_flat[index_a1.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_b1 = input_feature_flat[index_b1.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_c1 = input_feature_flat[index_c1.<span class="built_in">type</span>(torch.int64)]</span><br><span class="line">        value_d1 = input_feature_flat[index_d1.<span class="built_in">type</span>(torch.int64)]  <span class="comment"># [N*KD*KW*KH, C]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># find 8 grid locations</span></span><br><span class="line">        z0 = torch.floor(z).<span class="built_in">int</span>()</span><br><span class="line">        z1 = z0 + <span class="number">1</span></span><br><span class="line">        y0 = torch.floor(y).<span class="built_in">int</span>()</span><br><span class="line">        y1 = y0 + <span class="number">1</span></span><br><span class="line">        x0 = torch.floor(x).<span class="built_in">int</span>()</span><br><span class="line">        x1 = x0 + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># clip out coordinates exceeding feature map volumeä»¥å¤–çš„ç‚¹</span></span><br><span class="line">        z0 = torch.clamp(z0, zero, max_z + <span class="number">1</span>)</span><br><span class="line">        z1 = torch.clamp(z1, zero, max_z + <span class="number">1</span>)</span><br><span class="line">        y0 = torch.clamp(y0, zero, max_y + <span class="number">1</span>)</span><br><span class="line">        y1 = torch.clamp(y1, zero, max_y + <span class="number">1</span>)</span><br><span class="line">        x0 = torch.clamp(x0, zero, max_x + <span class="number">1</span>)</span><br><span class="line">        x1 = torch.clamp(x1, zero, max_x + <span class="number">1</span>)  <span class="comment"># [N*KD*KW*KH]</span></span><br><span class="line"></span><br><span class="line">        x0_float = x0.<span class="built_in">float</span>()</span><br><span class="line">        x1_float = x1.<span class="built_in">float</span>()</span><br><span class="line">        y0_float = y0.<span class="built_in">float</span>()</span><br><span class="line">        y1_float = y1.<span class="built_in">float</span>()</span><br><span class="line">        z0_float = z0.<span class="built_in">float</span>()</span><br><span class="line">        z1_float = z1.<span class="built_in">float</span>()</span><br><span class="line"></span><br><span class="line">        vol_a0 = ((z1_float - z) * (y1_float - y) * (x1_float - x)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_b0 = ((z - z0_float) * (y1_float - y) * (x1_float - x)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_c0 = ((z1_float - z) * (y1_float - y) * (x - x0_float)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_d0 = ((z - z0_float) * (y1_float - y) * (x - x0_float)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_a1 = ((z1_float - z) * (y - y0_float) * (x1_float - x)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_b1 = ((z - z0_float) * (y - y0_float) * (x1_float - x)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_c1 = ((z1_float - z) * (y - y0_float) * (x - x0_float)).unsqueeze(-<span class="number">1</span>)</span><br><span class="line">        vol_d1 = ((z - z0_float) * (y - y0_float) * (x - x0_float)).unsqueeze(</span><br><span class="line">            -<span class="number">1</span></span><br><span class="line">        )  <span class="comment"># [N*KD*KW*KH, C]</span></span><br><span class="line"></span><br><span class="line">        outputs = (</span><br><span class="line">            value_a0 * vol_a0</span><br><span class="line">            + value_b0 * vol_b0</span><br><span class="line">            + value_c0 * vol_c0</span><br><span class="line">            + value_d0 * vol_d0</span><br><span class="line">            + value_a1 * vol_a1</span><br><span class="line">            + value_b1 * vol_b1</span><br><span class="line">            + value_c1 * vol_c1</span><br><span class="line">            + value_d1 * vol_d1</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.morph == <span class="number">0</span>:</span><br><span class="line">            outputs = outputs.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.num_points * self.height,</span><br><span class="line">                    self.num_channels,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            outputs = outputs.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">elif</span> self.morph == <span class="number">1</span>:</span><br><span class="line">            outputs = outputs.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    self.depth,</span><br><span class="line">                    self.num_points * self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                    self.num_channels,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            outputs = outputs.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            outputs = outputs.reshape(</span><br><span class="line">                [</span><br><span class="line">                    self.num_batch,</span><br><span class="line">                    self.num_points * self.depth,</span><br><span class="line">                    self.width,</span><br><span class="line">                    self.height,</span><br><span class="line">                    self.num_channels,</span><br><span class="line">                ]</span><br><span class="line">            )</span><br><span class="line">            outputs = outputs.permute(<span class="number">0</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">return</span> outputs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deform_conv</span>(<span class="params">self, <span class="built_in">input</span>, offset, if_offset</span>):</span><br><span class="line">        z, y, x = self._coordinate_map_3D(offset, if_offset)</span><br><span class="line">        deformed_feature = self._bilinear_interpolate_3D(<span class="built_in">input</span>, z, y, x)</span><br><span class="line">        <span class="keyword">return</span> deformed_feature</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DSConv3dBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        kernel_size: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">        extend_scope: <span class="built_in">int</span> = <span class="number">1</span>,</span></span><br><span class="line"><span class="params">        if_offset: <span class="built_in">bool</span> = <span class="literal">True</span>,</span></span><br><span class="line"><span class="params">        res_block: <span class="built_in">bool</span> = <span class="literal">False</span>,</span></span><br><span class="line"><span class="params">        dropout_rate: <span class="built_in">float</span> = <span class="number">0.0</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>(DSConv3dBlock, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.res_block = res_block</span><br><span class="line"></span><br><span class="line">        self.conv = Convolution(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            in_channels=in_channels,</span><br><span class="line">            out_channels=out_channels,</span><br><span class="line">            dropout=dropout_rate,</span><br><span class="line">        )</span><br><span class="line">        self.ds_conv_x = DSConv3d(</span><br><span class="line">            in_channels, out_channels, kernel_size, extend_scope, <span class="number">0</span>, if_offset</span><br><span class="line">        )</span><br><span class="line">        self.ds_conv_y = DSConv3d(</span><br><span class="line">            in_channels, out_channels, kernel_size, extend_scope, <span class="number">1</span>, if_offset</span><br><span class="line">        )</span><br><span class="line">        self.ds_conv_z = DSConv3d(</span><br><span class="line">            in_channels, out_channels, kernel_size, extend_scope, <span class="number">2</span>, if_offset</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.out_conv = Convolution(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            in_channels=<span class="number">4</span> * out_channels,</span><br><span class="line">            out_channels=out_channels,</span><br><span class="line">            dropout=dropout_rate,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, inp</span>):</span><br><span class="line">        residual = inp</span><br><span class="line">        conv_out = self.conv(inp)</span><br><span class="line">        x = self.ds_conv_x(inp)</span><br><span class="line">        y = self.ds_conv_y(inp)</span><br><span class="line">        z = self.ds_conv_z(inp)</span><br><span class="line"></span><br><span class="line">        out = torch.cat([conv_out, x, y, z], dim=<span class="number">1</span>)</span><br><span class="line">        out = self.out_conv(out)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.res_block:</span><br><span class="line">            out += residual</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="å®éªŒç»“æœ"><a class="markdownIt-Anchor" href="#å®éªŒç»“æœ"></a> å®éªŒç»“æœ</h1>
<p>ç¬”è€…åœ¨ISLES2017æ•°æ®é›†ä¸Šé‡‡ç”¨äº†DSCNetï¼Œå…¶ä¸­UNERTå’ŒSegResNetçš„Diceç³»æ•°éƒ½æ˜¯0.5ï¼Œè€ŒDSCNetæ•ˆæœæ˜¯0.6ï¼Œæå‡äº†0.1ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ISLES2017æ•°æ®é›†æœ¬èº«å°±å¾ˆå°ï¼Œè¯¥æ•ˆæœéœ€è¦è¿›ä¸€æ­¥éªŒè¯ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.5.9/dice.png" alt="result" /></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<ul>
<li><a href="https://arxiv.org/abs/2307.08388">Dynamic Snake Convolution based on Topological Geometric Constraints for Tubular Structure Segmentation</a></li>
<li><a href="https://github.com/YaoleiQi/DSCNet">DSCNet</a></li>
<li><a href="https://arxiv.org/abs/1703.06211">Deformable Convolutional Networks</a></li>
</ul>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>DUCK-Net è®ºæ–‡ç¬”è®°</title>
    <url>/2023/11/16/ducknet-note/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€ŠFLIPï¼ŠFLOP ã€œINNOCENCE OVERCLOCKã€œã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>å› ä¸ºåœ¨<a href="https://paperswithcode.com/paper/using-duck-net-for-polyp-image-segmentation-1">paper with code</a>ä¸Šçœ‹åˆ°äº†åŒ»å­¦åˆ†å‰²çš„æ’è¡Œæ¦œä¸Šçš„DUCK-Net(Deep Understanding Convolutional Kernel Net)çš„åå­—ï¼Œå› æ­¤æ¥çœ‹ä¸€ä¸‹è¿™ç¯‡è®ºæ–‡æ˜¯å¦‚ä½•åšçš„ã€‚</p>
<h1 id="duck-netè´¡çŒ®"><a class="markdownIt-Anchor" href="#duck-netè´¡çŒ®"></a> DUCK-Netè´¡çŒ®</h1>
<ul>
<li>å®šåˆ¶DUCKå·ç§¯å—ï¼Œå…è®¸æ›´æ·±å…¥çš„ç‰¹å¾æå–ï¼Œè®©æ¨¡å‹æ›´å¥½çš„å®šä½è¾¹ç•Œä¿¡æ¯</li>
<li>é‡‡ç”¨æ®‹å·®ä¸‹é‡‡æ ·ï¼Œåœ¨ç¼–ç å™¨çš„æ¯å±‚åˆ†è¾¨ç‡ä¸­æœ‰åŸå§‹å›¾åƒçš„ä¿¡æ¯</li>
<li>ä¸ä½¿ç”¨å¤–éƒ¨æ¨¡å—ï¼Œä¸”åªåœ¨ç›®æ ‡é›†ä¸Šè®­ç»ƒï¼ˆæ— é¢„è®­ç»ƒï¼‰</li>
<li>æ–¹æ³•æ— è®ºå®åœ¨æ•°é‡ã€å½¢çŠ¶ã€å¤§å°è¿˜æ˜¯è´¨åœ°ä¸Šå‡†ç¡®è¯†åˆ«æ¯è‚‰</li>
</ul>
<h1 id="duck-netç»“æ„"><a class="markdownIt-Anchor" href="#duck-netç»“æ„"></a> DUCK-Netç»“æ„</h1>
<p>DUCK-Netçš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/ducknet.png" alt="DUCK-Netç»“æ„" /></p>
<p>å…¶ä¸­è“è‰²çš„ä¸‹é‡‡æ ·éƒ¨åˆ†å’Œç°è‰²çš„åŠ æ¨¡å—ä¸ºDUCK-Netæå‡ºçš„æ®‹å·®ä¸‹é‡‡æ ·ã€‚</p>
<p>çº¢è‰²éƒ¨åˆ†ä¸ºDUCK-Netæå‡ºçš„Duck Blockç»“æ„</p>
<h2 id="duck-block"><a class="markdownIt-Anchor" href="#duck-block"></a> DUCK Block</h2>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/duck-block.png" alt="DUCK Blockç»“æ„" /></p>
<p>DUCK Blockç”±å¤šä»½å·ç§¯å¹¶è¡Œä½¿ç”¨ï¼Œè¿™æ ·ç½‘ç»œå¯ä»¥åœ¨æ¯ä¸€æ­¥ä¸­ä½¿ç”¨å…¶è®¤ä¸ºçš„æœ€å¥½çš„è¡Œä¸ºã€‚å…¶é‡‡ç”¨ä¸åŒå†…æ ¸å¤§å°æ¥æ¨¡æ‹Ÿä¸‰ç§ä¸åŒæ–¹å¼ï¼Œè¿™æ ·ç½‘ç»œç½‘ç»œå¯ä»¥å·ç§¯å¦‚ä½•å¼¥è¡¥ä¸€ç§æ¨¡æ‹Ÿæ–¹æ³•çš„ç¼ºç‚¹ã€‚åŒæ—¶åŠ å…¥äº†1-2-3ä¸‰å±‚æ®‹å·®æ¨¡å—ï¼Œå®éªŒè¡¨æ˜å¢åŠ WideScopeå’ŒMidScopeå’ŒSparableçš„æ•°é‡å¯¹ç»“æœæ²¡æœ‰æ˜¾è‘—å˜åŒ–ã€‚</p>
<h3 id="residual-block"><a class="markdownIt-Anchor" href="#residual-block"></a> Residual Block</h3>
<p>æ®‹å·®æ¨¡å—å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/residual-block.png" alt="Residual Block" /></p>
<p>å…¶æ˜¯DUCKä¸­çš„ç¬¬ä¸€ä¸ªç»„ä»¶ï¼Œé¦–æ¬¡åœ¨ResUNet++ä¸­è¢«å¼•å…¥ï¼Œå…¶ç›®çš„æ˜¯äº†è§£æ¯è‚‰å°ç»†èŠ‚ï¼Œ<br />
é‡‡ç”¨è¿æ¥1ã€2ã€3ä¸ªæ®‹å·®å—æ¥æ¨¡æ‹Ÿ5Ã—5ã€9Ã—9ã€13Ã—13çš„å·ç§¯æ ¸</p>
<h3 id="midscope-block"><a class="markdownIt-Anchor" href="#midscope-block"></a> MidScope Block</h3>
<p>MidScope Blockå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶é‡‡ç”¨è†¨èƒ€å·ç§¯æ¥å‡å°‘è¾ƒå¤§å·ç§¯å†…æ ¸éœ€è¦çš„å‚æ•°ï¼Œè®©ç½‘ç»œç†è§£æ›´é«˜çº§ç‰¹å¾ã€‚è¯¥æ¨¡å—å› ä¸ºè†¨èƒ€å·ç§¯å‰¯ä½œç”¨ä¸¢å¤±ä¿¡æ¯ï¼Œå­¦ä¹ ä¸€ç‚¹éœ€è¦ç¨å¾®æ³¨æ„çš„ç»†èŠ‚çš„çªå‡ºç‰¹å¾ã€‚MidScopeé‡‡ç”¨è†¨èƒ€å·ç§¯æ¨¡æ‹Ÿäº†7Ã—7çš„å·ç§¯æ ¸</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/midscope-block.png" alt="MidScope Block" /></p>
<h3 id="widescope-block"><a class="markdownIt-Anchor" href="#widescope-block"></a> WideScope Block</h3>
<p>WideScope Blockå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸MidScope Blockç±»ä¼¼ï¼Œä½†æ˜¯æ˜¯æ¨¡æ‹Ÿçš„15Ã—15çš„å·ç§¯æ ¸<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/widescope-block.png" alt="WideScope Block" /></p>
<h3 id="separated-block"><a class="markdownIt-Anchor" href="#separated-block"></a> Separated Block</h3>
<p>Separated Blockå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶é‡‡ç”¨1Ã—Nå’ŒNÃ—1ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äºNÃ—Nçš„å·ç§¯ï¼Œä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´ä¸€ç§â€œå¯¹è§’åŒ–â€é—®é¢˜ï¼Œåœ¨åŸæœ¬äºŒç»´å·ç§¯ä¸Šï¼Œå› ä¸ºå…¶äºŒç»´ç‰¹å¾ä¿ç•™äº†å¯¹è§’çº¿å…ƒç´ ï¼Œæ•æ‰å‚ç›´å’Œæ°´å¹³æ–¹å‘åŒ…æ‹¬äº†å¯¹è§’çº¿æ–¹å‘çš„å­¦ä¹ ï¼Œç„¶è€Œåˆ†ç¦»ä¹‹åï¼Œä¸€æ¬¡åœ¨ä¸€ç»´ä¸Šæ“ä½œï¼Œé˜»ç¢æœ‰æ•ˆç¼–ç å¯¹è§’ç‰¹å¾ï¼Œå¯¼è‡´äº†â€œå¯¹è§’åŒ–æŸå¤±â€ã€‚è¿™ç§å¯¹è§’çº¿å…³ç³»å¯ä»¥è¢«è¯æ˜å¯¹æ£€æµ‹å›¾åƒä¸­ç‰¹å®šçš„å¤æ‚å›¾æ¡ˆæˆ–å½¢çŠ¶æœ‰ç”¨ï¼Œå› æ­¤å…¶ä»–å—è¢«è®¾è®¡ä¸ºè¡¥å¿</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/separated-block.png" alt="Separated Block" /></p>
<h1 id="ä»£ç "><a class="markdownIt-Anchor" href="#ä»£ç "></a> ä»£ç </h1>
<p>å®˜æ–¹ä»£ç åœ¨githubæ”¾å‡º<a href="https://github.com/RazvanDu/DUCK-Net">é“¾æ¥</a><br />
è€ƒè™‘åˆ°å…¶æ˜¯2Dï¼Œæˆ‘è‡ªå·±åœ¨monaiä¸Šåšäº†ä¸€ä¸ª3Dç‰ˆæœ¬,ä¸è¿‡æˆ‘æ²¡è®­ç»ƒå› ä¸ºOut of CUDA Memory</p>
<blockquote>
<p>/layers/duck.py</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Sequence</span>, <span class="type">Tuple</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> monai.networks.blocks.convolutions <span class="keyword">import</span> Convolution</span><br><span class="line"><span class="keyword">from</span> monai.networks.layers.utils <span class="keyword">import</span> get_norm_layer, get_act_layer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WideScope</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        act_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;RELU&quot;</span>,</span></span><br><span class="line"><span class="params">        norm_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;INSTANCE&quot;</span>,</span></span><br><span class="line"><span class="params">        adn_ordering: <span class="built_in">str</span> = <span class="string">&quot;ADN&quot;</span>,</span></span><br><span class="line"><span class="params">        spatial_dims: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>(WideScope, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.conv1 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            in_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=<span class="number">1</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.conv2 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            out_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=<span class="number">2</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.conv3 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            out_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=<span class="number">3</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line">        x = self.conv3(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MidScope</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        act_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;RELU&quot;</span>,</span></span><br><span class="line"><span class="params">        norm_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;INSTANCE&quot;</span>,</span></span><br><span class="line"><span class="params">        adn_ordering: <span class="built_in">str</span> = <span class="string">&quot;ADN&quot;</span>,</span></span><br><span class="line"><span class="params">        spatial_dims: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>(MidScope, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.conv1 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            in_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=<span class="number">1</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.conv2 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            out_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=<span class="number">2</span>,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DuckResidualBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        act_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;RELU&quot;</span>,</span></span><br><span class="line"><span class="params">        norm_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;INSTANCE&quot;</span>,</span></span><br><span class="line"><span class="params">        adn_ordering: <span class="built_in">str</span> = <span class="string">&quot;ADN&quot;</span>,</span></span><br><span class="line"><span class="params">        dilation: <span class="type">Union</span>[<span class="type">Sequence</span>[<span class="built_in">int</span>], <span class="built_in">int</span>] = <span class="number">1</span>,</span></span><br><span class="line"><span class="params">        spatial_dims: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>(DuckResidualBlock, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.residual = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            in_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=dilation,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.conv1 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            in_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=dilation,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.conv2 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            out_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">3</span>,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">            dilation=dilation,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.norm = get_norm_layer(</span><br><span class="line">            name=norm_name, spatial_dims=spatial_dims, channels=out_channels</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        identity = x</span><br><span class="line"></span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line"></span><br><span class="line">        identity = self.residual(identity)</span><br><span class="line"></span><br><span class="line">        x += identity</span><br><span class="line"></span><br><span class="line">        x = self.norm(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SeparatedConvBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        size: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">        act_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;RELU&quot;</span>,</span></span><br><span class="line"><span class="params">        norm_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;INSTANCE&quot;</span>,</span></span><br><span class="line"><span class="params">        adn_ordering: <span class="built_in">str</span> = <span class="string">&quot;ADN&quot;</span>,</span></span><br><span class="line"><span class="params">        spatial_dims: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">    </span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">super</span>(SeparatedConvBlock, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.conv1 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            in_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=(size, <span class="number">1</span>, <span class="number">1</span>) <span class="keyword">if</span> spatial_dims == <span class="number">3</span> <span class="keyword">else</span> (size, <span class="number">1</span>),</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.conv2 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            out_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=(<span class="number">1</span>, size, <span class="number">1</span>) <span class="keyword">if</span> spatial_dims == <span class="number">3</span> <span class="keyword">else</span> (<span class="number">1</span>, size),</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">            act=act_name,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> spatial_dims == <span class="number">3</span>:</span><br><span class="line">            self.conv3 = Convolution(</span><br><span class="line">                spatial_dims,</span><br><span class="line">                out_channels,</span><br><span class="line">                out_channels,</span><br><span class="line">                kernel_size=(<span class="number">1</span>, <span class="number">1</span>, size),</span><br><span class="line">                adn_ordering=adn_ordering,</span><br><span class="line">                norm=norm_name,</span><br><span class="line">                act=act_name,</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.conv3 = nn.Identity()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = self.conv1(x)</span><br><span class="line">        x = self.conv2(x)</span><br><span class="line">        x = self.conv3(x)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DuckBlock</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        act_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;RELU&quot;</span>,</span></span><br><span class="line"><span class="params">        norm_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;INSTANCE&quot;</span>,</span></span><br><span class="line"><span class="params">        adn_ordering: <span class="built_in">str</span> = <span class="string">&quot;ADN&quot;</span>,</span></span><br><span class="line"><span class="params">        spatial_dims: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>(DuckBlock, self).__init__()</span><br><span class="line"></span><br><span class="line">        self.norm1 = get_norm_layer(</span><br><span class="line">            name=norm_name, spatial_dims=spatial_dims, channels=in_channels</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.ws = WideScope(</span><br><span class="line">            in_channels=in_channels,</span><br><span class="line">            out_channels=out_channels,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.ms = MidScope(</span><br><span class="line">            in_channels=in_channels,</span><br><span class="line">            out_channels=out_channels,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.res1 = DuckResidualBlock(</span><br><span class="line">            in_channels=in_channels,</span><br><span class="line">            out_channels=out_channels,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.res2 = nn.Sequential(</span><br><span class="line">            *[</span><br><span class="line">                DuckResidualBlock(</span><br><span class="line">                    in_channels=in_channels <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">else</span> out_channels,</span><br><span class="line">                    out_channels=out_channels,</span><br><span class="line">                    act_name=act_name,</span><br><span class="line">                    norm_name=norm_name,</span><br><span class="line">                    adn_ordering=adn_ordering,</span><br><span class="line">                    spatial_dims=spatial_dims,</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.res3 = nn.Sequential(</span><br><span class="line">            *[</span><br><span class="line">                DuckResidualBlock(</span><br><span class="line">                    in_channels=in_channels <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">else</span> out_channels,</span><br><span class="line">                    out_channels=out_channels,</span><br><span class="line">                    act_name=act_name,</span><br><span class="line">                    norm_name=norm_name,</span><br><span class="line">                    adn_ordering=adn_ordering,</span><br><span class="line">                    spatial_dims=spatial_dims,</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.sepconv = SeparatedConvBlock(</span><br><span class="line">            in_channels=in_channels,</span><br><span class="line">            out_channels=out_channels,</span><br><span class="line">            size=<span class="number">5</span>,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.norm2 = get_norm_layer(</span><br><span class="line">            name=norm_name, spatial_dims=spatial_dims, channels=out_channels</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x_in</span>):</span><br><span class="line">        x_in = self.norm1(x_in)</span><br><span class="line"></span><br><span class="line">        ws = self.ws(x_in)</span><br><span class="line">        ms = self.ms(x_in)</span><br><span class="line">        res1 = self.res1(x_in)</span><br><span class="line">        res2 = self.res2(x_in)</span><br><span class="line">        res3 = self.res3(x_in)</span><br><span class="line">        sepconv = self.sepconv(x_in)</span><br><span class="line"></span><br><span class="line">        x_final = ws + ms + res1 + res2 + res3 + sepconv</span><br><span class="line"></span><br><span class="line">        x_final = self.norm2(x_final)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> x_final</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>/nets/ducket.py</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span>, <span class="type">Sequence</span>, <span class="type">Tuple</span>, <span class="type">Union</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> monai.networks.blocks.upsample <span class="keyword">import</span> UpSample</span><br><span class="line"><span class="keyword">from</span> monai.networks.blocks.convolutions <span class="keyword">import</span> Convolution</span><br><span class="line"><span class="keyword">from</span> monai.utils <span class="keyword">import</span> ensure_tuple_rep</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> layers <span class="keyword">import</span> DuckBlock, DuckResidualBlock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DuckNet</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params"></span></span><br><span class="line"><span class="params">        self,</span></span><br><span class="line"><span class="params">        in_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        out_channels: <span class="built_in">int</span>,</span></span><br><span class="line"><span class="params">        start_channels: <span class="built_in">int</span> = <span class="number">17</span>,</span></span><br><span class="line"><span class="params">        act_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;RELU&quot;</span>,</span></span><br><span class="line"><span class="params">        norm_name: <span class="type">Optional</span>[<span class="type">Union</span>[<span class="type">Tuple</span>, <span class="built_in">str</span>]] = <span class="string">&quot;INSTANCE&quot;</span>,</span></span><br><span class="line"><span class="params">        adn_ordering: <span class="built_in">str</span> = <span class="string">&quot;ADN&quot;</span>,</span></span><br><span class="line"><span class="params">        interp_mode: <span class="built_in">str</span> = <span class="string">&quot;nearest&quot;</span>,</span></span><br><span class="line"><span class="params">        align_corners: <span class="type">Optional</span>[<span class="built_in">bool</span>] = <span class="literal">None</span>,</span></span><br><span class="line"><span class="params">        spatial_dims: <span class="built_in">int</span> = <span class="number">3</span>,</span></span><br><span class="line"><span class="params">    </span>):</span><br><span class="line">        <span class="built_in">super</span>(DuckNet, self).__init__()</span><br><span class="line"></span><br><span class="line">        upsamle_size = ensure_tuple_rep(<span class="number">2</span>, spatial_dims)</span><br><span class="line"></span><br><span class="line">        self.down1 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            in_channels,</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.down2 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.down3 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.down4 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.down5 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            start_channels * <span class="number">32</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.duck1 = DuckBlock(</span><br><span class="line">            in_channels,</span><br><span class="line">            start_channels,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line">        self.sub_down1 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels,</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.duck2 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.sub_down2 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        self.duck3 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.sub_down3 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        self.duck4 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.sub_down4 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        self.duck5 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.sub_down5 = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            start_channels * <span class="number">32</span>,</span><br><span class="line">            kernel_size=<span class="number">2</span>,</span><br><span class="line">            strides=<span class="number">2</span>,</span><br><span class="line">            padding=<span class="number">0</span></span><br><span class="line">        )</span><br><span class="line">        self.res1 = nn.Sequential(</span><br><span class="line">            DuckResidualBlock(</span><br><span class="line">                start_channels * <span class="number">32</span>,</span><br><span class="line">                start_channels * <span class="number">32</span>,</span><br><span class="line">                act_name=act_name,</span><br><span class="line">                norm_name=norm_name,</span><br><span class="line">                adn_ordering=adn_ordering,</span><br><span class="line">                spatial_dims=spatial_dims,</span><br><span class="line">            ),</span><br><span class="line">            DuckResidualBlock(</span><br><span class="line">                start_channels * <span class="number">32</span>,</span><br><span class="line">                start_channels * <span class="number">32</span>,</span><br><span class="line">                act_name=act_name,</span><br><span class="line">                norm_name=norm_name,</span><br><span class="line">                adn_ordering=adn_ordering,</span><br><span class="line">                spatial_dims=spatial_dims,</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line">        self.res2 = nn.Sequential(</span><br><span class="line">            DuckResidualBlock(</span><br><span class="line">                start_channels * <span class="number">32</span>,</span><br><span class="line">                start_channels * <span class="number">16</span>,</span><br><span class="line">                act_name=act_name,</span><br><span class="line">                norm_name=norm_name,</span><br><span class="line">                adn_ordering=adn_ordering,</span><br><span class="line">                spatial_dims=spatial_dims,</span><br><span class="line">            ),</span><br><span class="line">            DuckResidualBlock(</span><br><span class="line">                start_channels * <span class="number">16</span>,</span><br><span class="line">                start_channels * <span class="number">16</span>,</span><br><span class="line">                act_name=act_name,</span><br><span class="line">                norm_name=norm_name,</span><br><span class="line">                adn_ordering=adn_ordering,</span><br><span class="line">                spatial_dims=spatial_dims,</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.up1 = UpSample(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            scale_factor=upsamle_size,</span><br><span class="line">            mode=<span class="string">&quot;nontrainable&quot;</span>,</span><br><span class="line">            interp_mode=interp_mode,</span><br><span class="line">            align_corners=align_corners</span><br><span class="line">        )</span><br><span class="line">        self.duck6 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">16</span>,</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.up2 = UpSample(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            scale_factor=upsamle_size,</span><br><span class="line">            mode=<span class="string">&quot;nontrainable&quot;</span>,</span><br><span class="line">            interp_mode=interp_mode,</span><br><span class="line">            align_corners=align_corners</span><br><span class="line">        )</span><br><span class="line">        self.duck7 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">8</span>,</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.up3 = UpSample(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            scale_factor=upsamle_size,</span><br><span class="line">            mode=<span class="string">&quot;nontrainable&quot;</span>,</span><br><span class="line">            interp_mode=interp_mode,</span><br><span class="line">            align_corners=align_corners</span><br><span class="line">        )</span><br><span class="line">        self.duck8 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">4</span>,</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        self.up4 = UpSample(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            scale_factor=upsamle_size,</span><br><span class="line">            mode=<span class="string">&quot;nontrainable&quot;</span>,</span><br><span class="line">            interp_mode=interp_mode,</span><br><span class="line">            align_corners=align_corners</span><br><span class="line">        )</span><br><span class="line">        self.duck9 = DuckBlock(</span><br><span class="line">            start_channels * <span class="number">2</span>,</span><br><span class="line">            start_channels,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.up5 = UpSample(</span><br><span class="line">            spatial_dims=<span class="number">3</span>,</span><br><span class="line">            scale_factor=upsamle_size,</span><br><span class="line">            mode=<span class="string">&quot;nontrainable&quot;</span>,</span><br><span class="line">            interp_mode=interp_mode,</span><br><span class="line">            align_corners=align_corners</span><br><span class="line">        )</span><br><span class="line">        self.duck10 = DuckBlock(</span><br><span class="line">            start_channels,</span><br><span class="line">            start_channels,</span><br><span class="line">            spatial_dims=spatial_dims,</span><br><span class="line">            act_name=act_name,</span><br><span class="line">            norm_name=norm_name,</span><br><span class="line">            adn_ordering=adn_ordering,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        self.final_conv = Convolution(</span><br><span class="line">            spatial_dims,</span><br><span class="line">            start_channels,</span><br><span class="line">            out_channels,</span><br><span class="line">            kernel_size=<span class="number">1</span>,</span><br><span class="line">            act=act_name,</span><br><span class="line">            norm=norm_name,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        p1 = self.down1(x)</span><br><span class="line">        p2 = self.down2(p1)</span><br><span class="line">        p3 = self.down3(p2)</span><br><span class="line">        p4 = self.down4(p3)</span><br><span class="line">        p5 = self.down5(p4)</span><br><span class="line"></span><br><span class="line">        t0 = self.duck1(x)</span><br><span class="line">        l1i = self.sub_down1(t0)</span><br><span class="line">        s1 = p1 + l1i</span><br><span class="line">        t1 = self.duck2(s1)</span><br><span class="line"></span><br><span class="line">        l2i = self.sub_down2(t1)</span><br><span class="line">        s2 = p2 + l2i</span><br><span class="line">        t2 = self.duck3(s2)</span><br><span class="line"></span><br><span class="line">        l3i = self.sub_down3(t2)</span><br><span class="line">        s3 = p3 + l3i</span><br><span class="line">        t3 = self.duck4(s3)</span><br><span class="line"></span><br><span class="line">        l4i = self.sub_down4(t3)</span><br><span class="line">        s4 = p4 + l4i</span><br><span class="line">        t4 = self.duck5(s4)</span><br><span class="line"></span><br><span class="line">        l5i = self.sub_down5(t4)</span><br><span class="line">        s5 = p5 + l5i</span><br><span class="line">        t51 = self.res1(s5)</span><br><span class="line">        t53 = self.res2(t51)</span><br><span class="line"></span><br><span class="line">        l5o = self.up1(t53)</span><br><span class="line">        c4 = l5o + t4</span><br><span class="line">        q4 = self.duck6(c4)</span><br><span class="line"></span><br><span class="line">        l4o = self.up2(q4)</span><br><span class="line">        c3 = l4o + t3</span><br><span class="line">        q3 = self.duck7(c3)</span><br><span class="line"></span><br><span class="line">        l3o = self.up3(q3)</span><br><span class="line">        c2 = l3o + t2</span><br><span class="line">        q2 = self.duck8(c2)</span><br><span class="line"></span><br><span class="line">        l2o = self.up4(q2)</span><br><span class="line">        c1 = l2o + t1</span><br><span class="line">        q1 = self.duck9(c1)</span><br><span class="line"></span><br><span class="line">        l1o = self.up5(q1)</span><br><span class="line">        c0 = l1o + t0</span><br><span class="line">        z1 = self.duck10(c0)</span><br><span class="line"></span><br><span class="line">        y = self.final_conv(z1)</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h1>
<p>å› ä¸ºæˆ‘è‡ªå·±Out of CUDA Memoryæ— æ³•ç»™å‡ºä¸€ä¸ªå¾ˆå¥½çš„æ•ˆæœï¼Œå› æ­¤æ”¾ä¸€ä¸‹paperä¸Šçš„æ•ˆæœ<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/result1.png" alt="æ•ˆæœ1" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.0/result2.png" alt="æ•ˆæœ2" /></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://www.nature.com/articles/s41598-023-36940-5">Using DUCK-Net for polyp image segmentation</a></p>
<p><a href="https://github.com/RazvanDu/DUCK-Net">DUCK-Net</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>live2d-widgetæ·»åŠ moc3æ¨¡å‹æ”¯æŒ</title>
    <url>/2023/11/25/live2d-widget-moc3/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ã€ŠFLIP * FLOP ~RAMBLING OVERRUN~ã€‹</p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>æ¯æ¬¡çœ‹åˆ°ç½‘ç«™çš„live2dæ¨¡å‹çš„æ—¶å€™éƒ½ä¼šæƒ³åªæœ‰nepæ˜¯å–œæ¬¢çš„ï¼Œæƒ³è¦æ·»åŠ æ¨¡å‹å‘ç°è¿™ä¸ªåº“åªæ”¯æŒmoc2æ¨¡å‹ï¼Œä¸æ”¯æŒmoc3æ¨¡å‹ï¼Œè™½ç„¶å¯ä»¥åŠ ä½†æ˜¯ä½œè€…å¹¶æ²¡æœ‰åŠ ï¼Œåªæ˜¯ç»™äº†ä¸€ä»½prï¼Œä½†æ˜¯è¿™ä¸ªprå·²ç»æ˜¯ä¸¤å¹´å‰äº†ï¼Œä¸å¦‚è‡ªå·±é‡æ–°å†™ä¸€ä¸‹ã€‚</p>
<h1 id="åšæ³•"><a class="markdownIt-Anchor" href="#åšæ³•"></a> åšæ³•</h1>
<p>å‚è€ƒprä¸­çš„ä»£ç ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯é‡‡ç”¨äº†<code>pixi-live2d-display</code>è¿™ä¸ªåº“æ¥åŠ è½½æ¨¡å‹ï¼Œè¯¥åº“æ”¯æŒå„ä¸ªç‰ˆæœ¬çš„live2dæ¨¡å‹ï¼Œå› æ­¤åªéœ€è¦ä¿®æ”¹åŸæ¥çš„åŠ è½½æ¨¡å‹ä»£ç <code>loadlive2d</code>å‡½æ•°å³å¯ã€‚</p>
<p>é¦–å…ˆæŒ‰ç…§<code>pixi-live2d-display</code>è¿™ä¸ªåº“æ¥å®‰è£…ï¼Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install pixi-live2d-display</span><br></pre></td></tr></table></figure>
<p>ç„¶åä¸‹è½½live2d-widgetçš„æºç ï¼Œä¿®æ”¹<code>src/model.js</code>æ–‡ä»¶ï¼Œæ–°å¢ä¸‹é¢å‡½æ•°ï¼Œå°†<code>loadlive2d</code>å‡½æ•°ä¿®æ”¹ä¸ºè¯¥å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">PIXI</span> <span class="keyword">from</span> <span class="string">&quot;pixi.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Live2DModel</span> &#125; <span class="keyword">from</span> <span class="string">&quot;pixi-live2d-display&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// expose PIXI to window so that this plugin is able to</span></span><br><span class="line"><span class="comment">// reference window.PIXI.Ticker to automatically update Live2D models</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">PIXI</span> = <span class="variable constant_">PIXI</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">async</span> <span class="title function_">loadModelPixi</span>(<span class="params">id, jsonpath</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(id);</span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">new</span> <span class="variable constant_">PIXI</span>.<span class="title class_">Application</span>(&#123;</span><br><span class="line">      <span class="attr">view</span>: element,</span><br><span class="line">      <span class="attr">transparent</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> model = <span class="keyword">await</span> <span class="title class_">Live2DModel</span>.<span class="title function_">from</span>(jsonpath);</span><br><span class="line"></span><br><span class="line">    app.<span class="property">stage</span>.<span class="title function_">addChild</span>(model);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> parentWidth = element.<span class="property">width</span>;</span><br><span class="line">    <span class="keyword">const</span> parentHeight = element.<span class="property">height</span>;</span><br><span class="line">    <span class="comment">// Scale to fit the stage</span></span><br><span class="line">    <span class="keyword">const</span> ratio = <span class="title class_">Math</span>.<span class="title function_">min</span>(</span><br><span class="line">      parentWidth / model.<span class="property">width</span>,</span><br><span class="line">      parentHeight / model.<span class="property">height</span></span><br><span class="line">    );</span><br><span class="line">    model.<span class="property">scale</span>.<span class="title function_">set</span>(ratio, ratio);</span><br><span class="line">    <span class="comment">// Align bottom and center horizontally</span></span><br><span class="line">    </span><br><span class="line">    model.<span class="property">x</span> = (parentWidth - model.<span class="property">width</span>) / <span class="number">2</span>;</span><br><span class="line">    model.<span class="property">y</span> =  parentHeight - model.<span class="property">height</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥å‡½æ•°æ˜¾è€Œæ˜“è§ï¼ŒåŠ è½½æ¨¡å‹åè®¾ç½®ç¼©æ”¾å’Œä½ç½®ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨ä»£ç é‡Œé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>&lt;canvas id=&quot;live2d&quot; width=&quot;800&quot; height=&quot;800&quot;&gt;&lt;/canvas&gt;</code>ï¼Œè€Œcssé‡Œé¢å¯ä»¥çœ‹åˆ°</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#live2d</span> &#123;</span><br><span class="line">	<span class="attribute">cursor</span>: grab;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">	<span class="attribute">position</span>: relative;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…¶å®æ˜¯live2då…ˆåœ¨800Ã—800ä¸Šé¢ç”»ï¼Œç„¶åé€šè¿‡cssç¼©æ”¾åˆ°300Ã—300ï¼Œè¿™æ ·å­ä¼šçœ‹çš„é«˜æ¸…ä¸€ç‚¹ï¼Œlive2dçœ‹èµ·æ¥ä¼šå¾ˆæ¨¡ç³Š</p>
<p>æ•ˆæœå¦‚ä¸‹ï¼Œå…¶å®æ¯”ä¾‹ä¸Šè¿˜æ˜¯æœ‰ç‚¹å°é—®é¢˜éœ€è¦è°ƒæ•´ä¸€ä¸‹<br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.1/result.png" alt="result" /></p>
<p>å®Œæ•´ä»£ç åœ¨<a href="https://github.com/qxdn/live2d-widget">github</a>ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç›´æ¥åœ¨ç½‘é¡µä¸­æ·»åŠ ä¸‹é¢è¿™è¡Œä»£ç æ·»åŠ live2dåˆ°ç½‘ç«™</p>
<pre class="highlight"><code class="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/gh/qxdn/live2d-widget@latest/autoload.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>è¯¥ä»£ç å…¶å®è¿˜æ˜¯æœ‰ç‚¹å°ç¼ºé™·ï¼Œå³æ¨¡å‹å¯¹å‡†buttomå…¶å®è¿˜æ˜¯æœ‰ç‚¹å¯¹ä¸å‡†ï¼Œå¦‚æœå¯ä»¥çœ‹åˆ°<code>loadlive2d</code>çš„å®ç°å¯èƒ½æ•ˆæœä¼šå¥½ä¸€ç‚¹ã€‚</p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<ul>
<li>
<p><a href="https://github.com/stevenjoezhang/live2d-widget">stevenjoezhang/live2d-widget</a></p>
</li>
<li>
<p><a href="https://github.com/stevenjoezhang/live2d-widget/pull/82">pull request 82</a></p>
</li>
<li>
<p><a href="https://github.com/guansss/pixi-live2d-display">guansss/pixi-live2d-display</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
      <tags>
        <tag>javascript</tag>
        <tag>å‰ç«¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”¨TTSæ¨¡å‹åšæ˜¥é£å­¦å§çš„è¯­éŸ³åˆæˆ</title>
    <url>/2023/11/29/tts-haruka/</url>
    <content><![CDATA[<blockquote>
<p>å°é¢ ã€Š9-nine-æ˜¥è‰²æ˜¥æ‹æ˜¥ç†™é£ã€‹</p>
</blockquote>
<blockquote>
<p>çœæµç‰ˆæœ¬<br />
<strong>æ„Ÿè§‰ hugging face çš„ cpu è·‘çš„æ•ˆæœå’Œæˆ‘æœ¬åœ°è·‘çš„æ•ˆæœå®Œå…¨ä¸ä¸€æ ·</strong><br />
demo: <a href="https://huggingface.co/spaces/qxdn/tts-9nine">demo</a><br />
æµ‹è¯•æ–‡æœ¬ï¼š èª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™<br />
æ•ˆæœè¯­éŸ³ï¼š <audio id="audio" controls src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/haruka_birthday.wav"></p>
</blockquote>
<source  src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/haruka_birthday.wav">
</audio>
<blockquote>
<p>æµ‹è¯•è§†é¢‘ï¼š <iframe src="//player.bilibili.com/player.html?aid=964019251&bvid=BV1MH4y117Dh&cid=1347616172&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe></p>
</blockquote>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€"></a> å‰è¨€</h1>
<p>ä¸´è¿‘ç”Ÿæ—¥æƒ³æ•´ä¸ªæ´»ï¼Œå°±åšä¸€ä¸ªå–œæ¬¢è§’è‰²çš„TTSæ¨¡å‹å§</p>
<h1 id="è°ƒç ”"><a class="markdownIt-Anchor" href="#è°ƒç ”"></a> è°ƒç ”</h1>
<p>ä¸Šæ¬¡æ TTS è¿˜æ˜¯å»å¹´ï¼ˆ2022ï¼‰çš„æ—¶å€™æƒ³ç”¨ vits æ¥åšä¸€ä¸ªçˆ±è‰å¸Œé›…çš„ TTS æ¨¡å‹ï¼Œæ ¹æ®ç½‘ä¸Šçš„æ‹†åŒ…å·¥å…·æ‹†å‡ºæ¥å´©å 3 çš„è¯­éŸ³åŒ…ï¼Œä½†æ˜¯æ²¡æ‰¾å‡ºæ–‡æœ¬ï¼Œä¸æƒ³è‡ªå·±æ ‡æ³¨å’Œç”¨è¯­éŸ³è¯†åˆ«æ ‡æ³¨å°±æç½®äº†ï¼Œå¦‚ä»Šè¿‡äº†ä¸€å¹´å¤šæŠ€æœ¯ä¸Šåº”è¯¥æœ‰è¿›æ­¥æ‰€ä»¥æ¥çœ‹çœ‹æ–°çš„æ–¹æ³•ï¼Œè€Œä¸”ç›¸å¯¹äºå´©å 3ï¼Œgalgame æ›´åŠ å¥½æ‹†ä¸”ç›¸å½“äºä¸€ä¸ªè‡ªå¸¦æ ‡æ³¨çš„æ•°æ®é›†ï¼Œç”¨æ¥è®­ç»ƒå†åˆé€‚ä¸è¿‡äº†ã€‚</p>
<p>æœ€ç®€å•çš„æ˜¯å»çœ‹ tts çš„<a href="https://arxiv.org/abs/2106.15561">ç»¼è¿°</a>ï¼Œä½†æ˜¯è¿™ç¯‡æ˜¯ 21 å¹´çš„ï¼Œä¸å«è¿™å‡ å¹´çš„è¿›å±•ï¼Œåé¢åœ¨çŸ¥ä¹ä¸Šæ‰¾åˆ°ä¸€ä¸ªå®æ—¶æ›´æ–°<a href="https://zhuanlan.zhihu.com/p/474601997">æ–‡ç« </a>ã€‚</p>
<p>æ‰€ä»¥å…ˆè¯•è¯• HierSpeech++ï¼Œé¦–å…ˆæ˜¯æœ€æ–°ï¼Œå…¶æ¬¡æ˜¯ zero-shot æ¨¡å‹ï¼Œè¿™æ ·çš„è¯å°±ä¸éœ€è¦æ€ä¹ˆè®­ç»ƒå¾®è°ƒã€‚å…¶é¡¹ç›®å’Œæ¼”ç¤ºå¦‚ä¸‹åœ°å€</p>
<p><a href="https://huggingface.co/spaces/LeeSangHoon/HierSpeech_TTS">demo</a><br />
å°è¯•è¾“å…¥éŸ³é¢‘ä½œä¸º prompt,æ–‡æœ¬ prompt ç”¨â€œå¤±æ•—ã—ãŸâ€</p>
<blockquote>
<p>è¾“å…¥éŸ³é¢‘ prompt<br />
<audio id="audio" controls src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/haruka1391.ogg"></p>
</blockquote>
<source  src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/haruka1391.ogg">
</audio>
<p>è°ƒäº†è°ƒè¾“å‡ºéŸ³é¢‘ç»“æœå¦‚ä¸‹ï¼Œæ•ˆæœæœ‰ç‚¹éš¾å´©ï¼Œå¯è§åœ¨åˆ†è¯å’Œé¢„æµ‹æ—¶é•¿ä¸Šè¿˜æ˜¯æœ‰ç‚¹é—®é¢˜éœ€è¦å¾®è°ƒï¼Œä¸å¦‚æ¢ä¸ªæ–¹æ³•ã€‚</p>
<blockquote>
<p>è¾“å‡ºç»“æœ<br />
<audio id="audio" controls src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/zo_output.wav"></p>
</blockquote>
<source  src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/zo_output.wav">
</audio>
<blockquote>
<p>æ¨ç‰¹åæ§½äº†ä¸€ä¸‹ï¼Œè¢«ä¸€ä½œæ‰¾ä¸Šé—¨äº†ï¼ŒåŸå› æ˜¯æ²¡æœ‰æ—¥è¯­è®­ç»ƒï¼Œåº•ä¸‹ç”¨ phoneme åº“è½¬éŸ³æ ‡æ‰€ä»¥å¯ä»¥å‘é€ã€‚å’Œä½œè€…è¯´äº†ä¸€ä¸‹å‘äº†ä»½<a href="https://github.com/CjangCjengh/MoeGoe">MoeGoe</a>çš„cleanersä»£ç <br />
ç›¸å…³é“¾æ¥ <a href="https://twitter.com/Al_Fe2O3/status/1727633489061949897">æ¨ç‰¹</a></p>
</blockquote>
<h1 id="æ‹†åŒ…"><a class="markdownIt-Anchor" href="#æ‹†åŒ…"></a> æ‹†åŒ…</h1>
<p>9nine çš„æ‹†åŒ…å¯ä»¥ç›´æ¥ç”¨ç°æˆçš„ GARbro è¿›è¡Œæ‹†åŒ…ï¼Œæˆ‘è§‰å¾—æ¯” escu:de é‚£äº›å¥½æ‹†å¤šäº†ï¼Œé‚£ç§æ‹†åŒ…å°åŒ…æ‰¾ä¸åˆ°å•¥ç°æˆç¨‹åºï¼Œè¿˜å¾—è‡ªå·±å†™ï¼Œæœ‰ç©ºçš„è¯å¯ä»¥å†™ä¸€ä¸‹æ€ä¹ˆæ‹† escu:de çš„æ¸¸æˆã€‚æ˜¥æ˜¥æ˜¥æ‹†åŒ…å¦‚ä¸‹ï¼Œ<code>voice.xp3</code>é‡Œé¢æ˜¯è¯­éŸ³åŒ…ï¼Œ<code>data.xp3</code>é‡Œé¢åŒ…å«äº†æ–‡æœ¬åŒ…ï¼Œåœ¨<code>scn</code>é‡Œé¢ã€‚</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/garbro1.png" alt="garbroé¢„è§ˆ" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/voice_xp3.png" alt="voice.xp3" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/scn.png" alt="scn" /></p>
<p>å…³äº scn æˆ‘æœæ€ä¹ˆè§£åŒ…çš„æ—¶å€™åˆšå¥½çœ‹åˆ°æœ‰äººä¹Ÿæ‹†åŒ…æ˜¥æ˜¥æ˜¥åš ttsï¼Œé‚£ä¹ˆç›´æ¥å‚è€ƒä»–çš„æ–¹æ¡ˆç”¨<a href="https://github.com/UlyssesWu/FreeMote">freemote</a></p>
<p>è§‚å¯Ÿ<code>freemote</code>è§£ç å‡ºæ¥çš„ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸»è¦æœ‰ä¸¤ç±» jsonï¼Œæˆ‘ä»¬è¦çš„ä¸»è¦åœ¨<code>.json</code>é‡Œé¢ï¼Œç»è¿‡è§‚å¯Ÿæ–‡æœ¬å’Œå¯¹éŸ³çš„è¯­éŸ³æ–‡ä»¶ä¸»è¦åœ¨<code>texts</code>å’Œ<code>voices</code>é‡Œé¢</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/text_json.png" alt=".text.json" /><br />
<img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/resx_json.png" alt=".resx.json" /></p>
<h1 id="æå–"><a class="markdownIt-Anchor" href="#æå–"></a> æå–</h1>
<p>æˆ‘åªæƒ³è¦å››ä½å¥³ä¸»<s>å…¶ä»–äººæ˜¯ä»€ä¹ˆ</s>çš„å£°éŸ³æ–‡ä»¶ï¼Œå› æ­¤ç›´æ¥åœ¨åˆ«äººçš„æå–è„šæœ¬ä¸Šå°æ”¹ä¸€ä¸‹ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">character = [<span class="string">&quot;éƒ½&quot;</span>, <span class="string">&quot;å¤©&quot;</span>, <span class="string">&quot;æ˜¥é¢¨&quot;</span>, <span class="string">&quot;å¸Œäºœ&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_json_files</span>(<span class="params">base_path</span>):</span><br><span class="line">    file_lists = []</span><br><span class="line">    files = os.listdir(base_path)</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> tqdm(files):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&quot;.txt.json&quot;</span>):</span><br><span class="line">            file_lists.append(file)</span><br><span class="line">    <span class="keyword">return</span> file_lists</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_voice_and_text_from_json</span>(<span class="params">json_file: <span class="built_in">str</span>, collapse_LF: <span class="built_in">bool</span> = <span class="literal">True</span></span>):</span><br><span class="line">    train_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(json_file, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json_text = json.load(f)</span><br><span class="line">        scenes = json_text[<span class="string">&quot;scenes&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> scene <span class="keyword">in</span> scenes:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;texts&quot;</span> <span class="keyword">in</span> scene.keys():</span><br><span class="line">                texts = scene[<span class="string">&quot;texts&quot;</span>]</span><br><span class="line">                <span class="keyword">for</span> text_list <span class="keyword">in</span> texts:</span><br><span class="line">                    <span class="comment"># å…ˆç¡®ä¿æ˜¯list</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(text_list, <span class="built_in">list</span>):</span><br><span class="line">                        <span class="keyword">if</span> text_list[<span class="number">0</span>] <span class="keyword">in</span> character:</span><br><span class="line">                            <span class="keyword">if</span> text_list[<span class="number">3</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                                txt = text_list[<span class="number">2</span>][<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">                                voice = text_list[<span class="number">3</span>][<span class="number">0</span>][<span class="string">&quot;voice&quot;</span>]</span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> collapse_LF:</span><br><span class="line">                                    txt = txt.replace(<span class="string">&quot;\\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">                                train_list.append(<span class="string">f&quot;<span class="subst">&#123;text_list[<span class="number">0</span>]  &#125;</span>|<span class="subst">&#123;txt&#125;</span>|<span class="subst">&#123;voice&#125;</span>.ogg\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> train_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    base_path = <span class="string">&quot;./data/scn&quot;</span></span><br><span class="line">    file_lists = load_json_files(base_path)</span><br><span class="line">    <span class="comment"># print(file_lists)</span></span><br><span class="line">    voices = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> tqdm(file_lists):</span><br><span class="line">        voice = load_voice_and_text_from_json(os.path.join(base_path, file))</span><br><span class="line"></span><br><span class="line">        voices.extend(voice)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./train.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.writelines(voices)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å…¶å®è¿™æ ·æå–è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹å°é—®é¢˜ï¼Œæ¯”å¦‚è¯­éŸ³æ–‡æœ¬æœ‰ä¸€ä¸‹ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å•çº¯çš„?ï¼Œè¿˜æœ‰ä¸€äº›ç‰¹æ®Šç¬¦å·ï¼Œè¿™äº›ä¸»è¦æ˜¯æ¸¸æˆä¸­ä¸€äº›ç‰¹æ®Šæ–‡æœ¬æ˜¾ç¤ºã€‚å¯¹äºå‰è€…é‡‡ç”¨<a href="https://github.com/CjangCjengh/tacotron2-japanese">tacotron2-japanese</a>è¿›è¡Œæ¸…ç†ï¼Œä¸ç”¨ bert-vits2 çš„ cleaner æ˜¯å› ä¸ºæœ‰æ’å…¥åœæ­¢è¯ä¸å¥½å¤„ç†ï¼Œåè€…ç›´æ¥è®­ç»ƒé›†é‡Œé¢å»æ‰</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">æ˜¥é¢¨|ï¼Ÿ|hk0154.ogg</span><br><span class="line">å¤©|ã‚ãâ€¦â€¦ã†ã‚“ã€ã£ã½ã„ã€ã‘ã©ã€%D$vl1;ãˆï¼Ÿã€€ãƒ©ãƒ–ãƒ¬ã‚¿ãƒ¼ï¼Ÿ|sr0679_ep2.ogg</span><br></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+ import torch</span></span><br><span class="line"><span class="addition">+ from text import text_to_sequence</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"></span><br><span class="line">def load_voice_and_text_from_json(json_file: str, collapse_LF: bool = True):</span><br><span class="line">    train_list = []</span><br><span class="line"></span><br><span class="line">    with open(json_file, encoding=&quot;utf-8&quot;) as f:</span><br><span class="line">        json_text = json.load(f)</span><br><span class="line">        scenes = json_text[&quot;scenes&quot;]</span><br><span class="line">        for scene in scenes:</span><br><span class="line">            if &quot;texts&quot; in scene.keys():</span><br><span class="line">                texts = scene[&quot;texts&quot;]</span><br><span class="line">                for text_list in texts:</span><br><span class="line">                    # å…ˆç¡®ä¿æ˜¯list</span><br><span class="line">                    if isinstance(text_list, list):</span><br><span class="line">                        if text_list[0] in character:</span><br><span class="line"><span class="deletion">-                            if text_list[3] is not None:</span></span><br><span class="line"><span class="deletion">-                                txt = text_list[2][1:-1]</span></span><br><span class="line"><span class="deletion">-                                voice = text_list[3][0][&quot;voice&quot;]</span></span><br><span class="line"><span class="addition">+                            txt:str = text_list[2][1:-1]</span></span><br><span class="line"><span class="addition">+                            if txt.find(&#x27;%&#x27;) != -1:</span></span><br><span class="line"><span class="addition">+                                continue</span></span><br><span class="line"><span class="addition">+                            if (</span></span><br><span class="line"><span class="addition">+                                len(</span></span><br><span class="line"><span class="addition">+                                    torch.IntTensor(</span></span><br><span class="line"><span class="addition">+                                        text_to_sequence(txt, [&quot;japanese_cleaners&quot;])</span></span><br><span class="line"><span class="addition">+                                    )</span></span><br><span class="line"><span class="addition">+                                )</span></span><br><span class="line"><span class="addition">+                                &gt; 1</span></span><br><span class="line"><span class="addition">+                            ):</span></span><br><span class="line"><span class="addition">+                                if text_list[3] is not None:</span></span><br><span class="line"><span class="addition">+                                    voice = text_list[3][0][&quot;voice&quot;]</span></span><br><span class="line"></span><br><span class="line">                                    if collapse_LF:</span><br><span class="line">                                        txt = txt.replace(&quot;\\n&quot;, &quot;&quot;)</span><br><span class="line"></span><br><span class="line">                                    train_list.append(</span><br><span class="line">                                        f&quot;&#123;text_list[0]  &#125;|&#123;txt&#125;|&#123;voice&#125;.ogg\n&quot;</span><br><span class="line">                                    )</span><br><span class="line"></span><br><span class="line">    return train_list</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>äºŒæ¬¡æ¸…ç†æ•°æ®</strong><br />
è®­ç»ƒè¿‡ç¨‹ä¸­å‘ç°å­˜åœ¨ä¸€äº›å•çº¯çš„<code>â€¦</code>è¿˜æœ‰<s>hs æ—¶å€™çš„å‘»åŸ</s>ï¼Œè¿™äº›å¯¹è®­ç»ƒç»“æœå½±å“è¾ƒå¤§ï¼Œå› æ­¤éœ€è¦å»é™¤ä¸€ä¸‹</p>
</blockquote>
<h2 id="ç®€å•-eda"><a class="markdownIt-Anchor" href="#ç®€å•-eda"></a> ç®€å• eda</h2>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹æ•°æ®åˆ†å¸ƒ</p>
<p><img src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/voice_count.png" alt="è¯­éŸ³æ•°é‡" /></p>
<ul>
<li>å¸Œäºœ: 370 æ¡</li>
<li>å¤©: 576 æ¡</li>
<li>æ˜¥é¢¨: 2031 æ¡ï¼ˆä¸æ„§æ˜¯å­¦å§ä¸»åœºï¼‰</li>
<li>éƒ½: 190 æ¡ï¼ˆä¸æ„§æ˜¯å¥³è·¯äººï¼‰</li>
</ul>
<p>è¯­éŸ³æ€»æ—¶é•¿ï¼š 3.92h</p>
<h1 id="è®­ç»ƒ"><a class="markdownIt-Anchor" href="#è®­ç»ƒ"></a> è®­ç»ƒ</h1>
<p>æˆ‘è¿™é‡Œé‡‡ç”¨çš„æ˜¯<code>Bert-Vits2</code>æ¨¡å‹ï¼Œè¿™ä¸ªé¡¹ç›®å°† bert å’Œ vits ç»“åˆèµ·æ¥ï¼Œä¸»é¢˜æ¥è¯´å°±æ˜¯ä½¿ç”¨ Bert é¢„å…ˆå¯¹æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œåé¢å†é€å…¥ï¼Œæ­¤å¤–ä»–ä»¬è¿˜åŠ äº†ä¸ª emotion æƒ…ç»ªç¼–ç å™¨ï¼Œå¯ä»¥ä½¿å¾—è¯­éŸ³å¸¦ä¸Šæƒ…ç»ªã€‚<code>Bert-VITS2</code>é¡¹ç›®çš„æ–‡æ¡£è¾ƒå°‘ï¼Œä¸»è¦éƒ½éœ€è¦è‡ªå·±æ¥è¯»ä»£ç è¿›è¡Œç†è§£ã€‚å¦å¤–è¯¥é¡¹ç›®ä½¿ç”¨<code>.wav</code>æ–‡ä»¶ä½œä¸ºè¾“å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—äº‹å…ˆè½¬æ¢ä¸€ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ogg2wav</span>(<span class="params">ogg,out_base</span>):</span><br><span class="line">    filename,ext = os.path.splitext(ogg)</span><br><span class="line">    filename = os.path.basename(filename)</span><br><span class="line">    y,sr = librosa.load(ogg)</span><br><span class="line">    sf.write(os.path.join(out_base,filename+<span class="string">&quot;.wav&quot;</span>),y,sr)</span><br></pre></td></tr></table></figure>
<p>å¦å¤–æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä»½<code>file.list</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯ç”¨æ¥æŒ‡å®šè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„ï¼Œæ ¼å¼å¦‚ä¸‹</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line"># wave_path è¦æ˜¯ç»å¯¹è·¯å¾„</span><br><span class="line">&#123;wav_path&#125;|&#123;speaker_name&#125;|&#123;language&#125;|&#123;text&#125;</span><br><span class="line">ä¾‹å¦‚</span><br><span class="line">hk1447.wav|æ˜¥é¢¨|JP|ãã®â€¦â€¦ãã€ä¹æ¢ã•ã‚“ãŒã€ä½œã£ãŸã“ã¨ã‚ã‚‹ã£ã¦ã€ã€€èã„ã¦â€¦â€¦</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹<code>config.yml</code>ï¼Œé»˜è®¤è¯»å– config.ymlï¼Œæ‰€ä»¥ä¸ç”¨æ”¹ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åšä¸€ä¸‹ç®€å•ä¿®æ”¹</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€é…ç½®</span></span><br><span class="line"><span class="comment"># å¯¹äºå¸Œæœ›åœ¨åŒä¸€æ—¶é—´ä½¿ç”¨å¤šä¸ªé…ç½®æ–‡ä»¶çš„æƒ…å†µï¼Œä¾‹å¦‚ä¸¤ä¸ªGPUåŒæ—¶è·‘ä¸¤ä¸ªè®­ç»ƒé›†ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šé…ç½®æ–‡ä»¶ï¼Œä¸æŒ‡å®šåˆ™é»˜è®¤ä¸º./config.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹Ÿæä¾›é€šç”¨è·¯å¾„é…ç½®ï¼Œç»Ÿä¸€å­˜æ”¾æ•°æ®ï¼Œé¿å…æ•°æ®æ”¾å¾—å¾ˆä¹±</span></span><br><span class="line"><span class="comment"># æ¯ä¸ªæ•°æ®é›†ä¸å…¶å¯¹åº”çš„æ¨¡å‹å­˜æ”¾è‡³ç»Ÿä¸€è·¯å¾„ä¸‹ï¼Œåç»­æ‰€æœ‰çš„è·¯å¾„é…ç½®å‡ä¸ºç›¸å¯¹äºdatasetPathçš„è·¯å¾„</span></span><br><span class="line"><span class="comment"># ä¸å¡«æˆ–è€…å¡«ç©ºåˆ™è·¯å¾„ä¸ºç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„è·¯å¾„</span></span><br><span class="line"><span class="attr">dataset_path:</span> <span class="string">&quot;Data/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹é•œåƒæºï¼Œé»˜è®¤huggingfaceï¼Œä½¿ç”¨openié•œåƒæºéœ€æŒ‡å®šopeni_token</span></span><br><span class="line"><span class="attr">mirror:</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="attr">openi_token:</span> <span class="string">&quot;&quot;</span> <span class="comment"># openi token</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># resample éŸ³é¢‘é‡é‡‡æ ·é…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="attr">resample:</span></span><br><span class="line">  <span class="comment"># ç›®æ ‡é‡é‡‡æ ·ç‡</span></span><br><span class="line">  <span class="attr">sampling_rate:</span> <span class="number">44100</span></span><br><span class="line">  <span class="comment"># éŸ³é¢‘æ–‡ä»¶è¾“å…¥è·¯å¾„ï¼Œé‡é‡‡æ ·ä¼šå°†è¯¥è·¯å¾„ä¸‹æ‰€æœ‰.wavéŸ³é¢‘æ–‡ä»¶é‡é‡‡æ ·</span></span><br><span class="line">  <span class="comment"># è¯·å¡«å…¥ç›¸å¯¹äºdatasetPathçš„ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">  <span class="attr">in_dir:</span> <span class="string">&quot;audios/raw&quot;</span> <span class="comment"># ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„ä¸º /datasetPath/in_dir</span></span><br><span class="line">  <span class="comment"># éŸ³é¢‘æ–‡ä»¶é‡é‡‡æ ·åè¾“å‡ºè·¯å¾„</span></span><br><span class="line">  <span class="attr">out_dir:</span> <span class="string">&quot;audios/wavs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># preprocess_text æ•°æ®é›†é¢„å¤„ç†ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="attr">preprocess_text:</span></span><br><span class="line">  <span class="comment"># åŸå§‹æ–‡æœ¬æ–‡ä»¶è·¯å¾„ï¼Œæ–‡æœ¬æ ¼å¼åº”ä¸º&#123;wav_path&#125;|&#123;speaker_name&#125;|&#123;language&#125;|&#123;text&#125;ã€‚</span></span><br><span class="line">  <span class="attr">transcription_path:</span> <span class="string">&quot;filelists/haruka.list&quot;</span></span><br><span class="line">  <span class="comment"># æ•°æ®æ¸…æ´—åæ–‡æœ¬è·¯å¾„ï¼Œå¯ä»¥ä¸å¡«ã€‚ä¸å¡«åˆ™å°†åœ¨åŸå§‹æ–‡æœ¬ç›®å½•ç”Ÿæˆ</span></span><br><span class="line">  <span class="attr">cleaned_path:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># è®­ç»ƒé›†è·¯å¾„</span></span><br><span class="line">  <span class="attr">train_path:</span> <span class="string">&quot;filelists/train.list&quot;</span></span><br><span class="line">  <span class="comment"># éªŒè¯é›†è·¯å¾„</span></span><br><span class="line">  <span class="attr">val_path:</span> <span class="string">&quot;filelists/val.list&quot;</span></span><br><span class="line">  <span class="comment"># é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">config_path:</span> <span class="string">&quot;haruka.json&quot;</span></span><br><span class="line">  <span class="comment"># æ¯ä¸ªspeakerçš„éªŒè¯é›†æ¡æ•°</span></span><br><span class="line">  <span class="attr">val_per_spk:</span> <span class="number">40</span></span><br><span class="line">  <span class="comment"># éªŒè¯é›†æœ€å¤§æ¡æ•°ï¼Œå¤šäºçš„ä¼šè¢«æˆªæ–­å¹¶æ”¾åˆ°è®­ç»ƒé›†ä¸­</span></span><br><span class="line">  <span class="attr">max_val_total:</span> <span class="number">200</span></span><br><span class="line">  <span class="comment"># æ˜¯å¦è¿›è¡Œæ•°æ®æ¸…æ´—</span></span><br><span class="line">  <span class="attr">clean:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bert_gen ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="attr">bert_gen:</span></span><br><span class="line">  <span class="comment"># è®­ç»ƒæ•°æ®é›†é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">config_path:</span> <span class="string">&quot;haruka.json&quot;</span></span><br><span class="line">  <span class="comment"># å¹¶è¡Œæ•°</span></span><br><span class="line">  <span class="attr">num_processes:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># ä½¿ç”¨è®¾å¤‡ï¼šå¯é€‰é¡¹ &quot;cuda&quot; æ˜¾å¡æ¨ç†ï¼Œ&quot;cpu&quot; cpuæ¨ç†</span></span><br><span class="line">  <span class="comment"># è¯¥é€‰é¡¹åŒæ—¶å†³å®šäº†get_bert_featureçš„é»˜è®¤è®¾å¤‡</span></span><br><span class="line">  <span class="attr">device:</span> <span class="string">&quot;cuda&quot;</span></span><br><span class="line">  <span class="comment"># ä½¿ç”¨å¤šå¡æ¨ç†</span></span><br><span class="line">  <span class="attr">use_multi_device:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># emo_gen ç›¸å…³é…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="attr">emo_gen:</span></span><br><span class="line">  <span class="comment"># è®­ç»ƒæ•°æ®é›†é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">config_path:</span> <span class="string">&quot;haruka.json&quot;</span></span><br><span class="line">  <span class="comment"># å¹¶è¡Œæ•°</span></span><br><span class="line">  <span class="attr">num_processes:</span> <span class="number">2</span></span><br><span class="line">  <span class="comment"># ä½¿ç”¨è®¾å¤‡ï¼šå¯é€‰é¡¹ &quot;cuda&quot; æ˜¾å¡æ¨ç†ï¼Œ&quot;cpu&quot; cpuæ¨ç†</span></span><br><span class="line">  <span class="attr">device:</span> <span class="string">&quot;cuda&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># train è®­ç»ƒé…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="attr">train_ms:</span></span><br><span class="line">  <span class="attr">env:</span></span><br><span class="line">    <span class="attr">MASTER_ADDR:</span> <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    <span class="attr">MASTER_PORT:</span> <span class="number">10086</span></span><br><span class="line">    <span class="attr">WORLD_SIZE:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">LOCAL_RANK:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">RANK:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># å¯ä»¥å¡«å†™ä»»æ„åçš„ç¯å¢ƒå˜é‡</span></span><br><span class="line">    <span class="comment"># THE_ENV_VAR_YOU_NEED_TO_USE: &quot;1234567&quot;</span></span><br><span class="line">  <span class="comment"># åº•æ¨¡è®¾ç½®</span></span><br><span class="line">  <span class="attr">base:</span></span><br><span class="line">    <span class="attr">use_base_model:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">repo_id:</span> <span class="string">&quot;Stardust_minus/Bert-VITS2&quot;</span></span><br><span class="line">    <span class="attr">model_image:</span> <span class="string">&quot;Bert-VITS2_2.1-Emoåº•æ¨¡&quot;</span> <span class="comment"># openiç½‘é¡µçš„æ¨¡å‹å</span></span><br><span class="line">  <span class="comment"># è®­ç»ƒæ¨¡å‹å­˜å‚¨ç›®å½•ï¼šä¸æ—§ç‰ˆæœ¬çš„åŒºåˆ«ï¼ŒåŸå…ˆæ•°æ®é›†æ˜¯å­˜æ”¾åœ¨logs/model_nameä¸‹çš„ï¼Œç°åœ¨æ”¹ä¸ºç»Ÿä¸€å­˜æ”¾åœ¨Data/ä½ çš„æ•°æ®é›†/modelsä¸‹</span></span><br><span class="line">  <span class="attr">model:</span> <span class="string">&quot;models&quot;</span></span><br><span class="line">  <span class="comment"># é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">config_path:</span> <span class="string">&quot;haruka.json&quot;</span></span><br><span class="line">  <span class="comment"># è®­ç»ƒä½¿ç”¨çš„workerï¼Œä¸å»ºè®®è¶…è¿‡CPUæ ¸å¿ƒæ•°</span></span><br><span class="line">  <span class="attr">num_workers:</span> <span class="number">16</span></span><br><span class="line">  <span class="comment"># å…³é—­æ­¤é¡¹å¯ä»¥èŠ‚çº¦æ¥è¿‘50%çš„ç£ç›˜ç©ºé—´ï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´å®é™…è®­ç»ƒé€Ÿåº¦å˜æ…¢å’Œæ›´é«˜çš„CPUä½¿ç”¨ç‡ã€‚</span></span><br><span class="line">  <span class="attr">spec_cache:</span> <span class="literal">True</span></span><br><span class="line">  <span class="comment"># ä¿å­˜çš„æ£€æŸ¥ç‚¹æ•°é‡ï¼Œå¤šäºæ­¤æ•°ç›®çš„æƒé‡ä¼šè¢«åˆ é™¤æ¥èŠ‚çœç©ºé—´ã€‚</span></span><br><span class="line">  <span class="attr">keep_ckpts:</span> <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># webui webuié…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="attr">webui:</span></span><br><span class="line">  <span class="comment"># æ¨ç†è®¾å¤‡</span></span><br><span class="line">  <span class="attr">device:</span> <span class="string">&quot;cuda&quot;</span></span><br><span class="line">  <span class="comment"># æ¨¡å‹è·¯å¾„</span></span><br><span class="line">  <span class="attr">model:</span> <span class="string">&quot;models/G_18000.pth&quot;</span></span><br><span class="line">  <span class="comment"># é…ç½®æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">config_path:</span> <span class="string">&quot;configs/haruka.json&quot;</span></span><br><span class="line">  <span class="comment"># ç«¯å£å·</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">7860</span></span><br><span class="line">  <span class="comment"># æ˜¯å¦å…¬å¼€éƒ¨ç½²ï¼Œå¯¹å¤–ç½‘å¼€æ”¾</span></span><br><span class="line">  <span class="attr">share:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># æ˜¯å¦å¼€å¯debugæ¨¡å¼</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># è¯­ç§è¯†åˆ«åº“ï¼Œå¯é€‰langid, fastlid</span></span><br><span class="line">  <span class="attr">language_identification_library:</span> <span class="string">&quot;langid&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># server apié…ç½®</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œ â€œ:â€ åéœ€è¦åŠ ç©ºæ ¼</span></span><br><span class="line"><span class="comment"># æ³¨æ„ï¼Œæœ¬é…ç½®ä¸‹çš„æ‰€æœ‰é…ç½®å‡ä¸ºç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="comment"># ç«¯å£å·</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">5000</span></span><br><span class="line">  <span class="comment"># æ¨¡å‹é»˜è®¤ä½¿ç”¨è®¾å¤‡ï¼šä½†æ˜¯å½“å‰å¹¶æ²¡æœ‰å®ç°è¿™ä¸ªé…ç½®ã€‚</span></span><br><span class="line">  <span class="attr">device:</span> <span class="string">&quot;cuda&quot;</span></span><br><span class="line">  <span class="comment"># éœ€è¦åŠ è½½çš„æ‰€æœ‰æ¨¡å‹çš„é…ç½®</span></span><br><span class="line">  <span class="comment"># æ³¨æ„ï¼Œæ‰€æœ‰æ¨¡å‹éƒ½å¿…é¡»æ­£ç¡®é…ç½®modelä¸configçš„è·¯å¾„ï¼Œç©ºè·¯å¾„ä¼šå¯¼è‡´åŠ è½½é”™è¯¯ã€‚</span></span><br><span class="line">  <span class="attr">models:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="comment"># æ¨¡å‹çš„è·¯å¾„</span></span><br><span class="line">      <span class="attr">model:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹config.jsonçš„è·¯å¾„</span></span><br><span class="line">      <span class="attr">config:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹ä½¿ç”¨è®¾å¤‡ï¼Œè‹¥å¡«å†™åˆ™ä¼šè¦†ç›–é»˜è®¤é…ç½®</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&quot;cuda&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹é»˜è®¤ä½¿ç”¨çš„è¯­è¨€</span></span><br><span class="line">      <span class="attr">language:</span> <span class="string">&quot;ZH&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹äººç‰©é»˜è®¤å‚æ•°</span></span><br><span class="line">      <span class="comment"># ä¸å¿…å¡«å†™æ‰€æœ‰äººç‰©ï¼Œä¸å¡«çš„ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">      <span class="comment"># æš‚æ—¶ä¸ç”¨å¡«å†™ï¼Œå½“å‰å°šæœªå®ç°æŒ‰äººåŒºåˆ†é…ç½®</span></span><br><span class="line">      <span class="attr">speakers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">speaker:</span> <span class="string">&quot;ç§‘æ¯”&quot;</span></span><br><span class="line">          <span class="attr">sdp_ratio:</span> <span class="number">0.2</span></span><br><span class="line">          <span class="attr">noise_scale:</span> <span class="number">0.6</span></span><br><span class="line">          <span class="attr">noise_scale_w:</span> <span class="number">0.8</span></span><br><span class="line">          <span class="attr">length_scale:</span> <span class="number">1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">speaker:</span> <span class="string">&quot;äº”æ¡æ‚Ÿ&quot;</span></span><br><span class="line">          <span class="attr">sdp_ratio:</span> <span class="number">0.3</span></span><br><span class="line">          <span class="attr">noise_scale:</span> <span class="number">0.7</span></span><br><span class="line">          <span class="attr">noise_scale_w:</span> <span class="number">0.8</span></span><br><span class="line">          <span class="attr">length_scale:</span> <span class="number">0.5</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">speaker:</span> <span class="string">&quot;å®‰å€æ™‹ä¸‰&quot;</span></span><br><span class="line">          <span class="attr">sdp_ratio:</span> <span class="number">0.2</span></span><br><span class="line">          <span class="attr">noise_scale:</span> <span class="number">0.6</span></span><br><span class="line">          <span class="attr">noise_scale_w:</span> <span class="number">0.8</span></span><br><span class="line">          <span class="attr">length_scale:</span> <span class="number">1.2</span></span><br><span class="line">    <span class="bullet">-</span> <span class="comment"># æ¨¡å‹çš„è·¯å¾„</span></span><br><span class="line">      <span class="attr">model:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹config.jsonçš„è·¯å¾„</span></span><br><span class="line">      <span class="attr">config:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹ä½¿ç”¨è®¾å¤‡ï¼Œè‹¥å¡«å†™åˆ™ä¼šè¦†ç›–é»˜è®¤é…ç½®</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹é»˜è®¤ä½¿ç”¨çš„è¯­è¨€</span></span><br><span class="line">      <span class="attr">language:</span> <span class="string">&quot;JP&quot;</span></span><br><span class="line">      <span class="comment"># æ¨¡å‹äººç‰©é»˜è®¤å‚æ•°</span></span><br><span class="line">      <span class="comment"># ä¸å¿…å¡«å†™æ‰€æœ‰äººç‰©ï¼Œä¸å¡«çš„ä½¿ç”¨é»˜è®¤å€¼</span></span><br><span class="line">      <span class="attr">speakers:</span> [] <span class="comment"># ä¹Ÿå¯ä»¥ä¸å¡«</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™¾åº¦ç¿»è¯‘å¼€æ”¾å¹³å° apié…ç½®</span></span><br><span class="line"><span class="comment"># apiæ¥å…¥æ–‡æ¡£ https://api.fanyi.baidu.com/doc/21</span></span><br><span class="line"><span class="comment"># è¯·ä¸è¦åœ¨githubç­‰ç½‘ç«™å…¬å¼€åˆ†äº«ä½ çš„app id ä¸ key</span></span><br><span class="line"><span class="attr">translate:</span></span><br><span class="line">  <span class="comment"># ä½ çš„APPID</span></span><br><span class="line">  <span class="attr">&quot;app_key&quot;:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="comment"># ä½ çš„å¯†é’¥</span></span><br><span class="line">  <span class="attr">&quot;secret_key&quot;:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="æ–‡æœ¬é¢„å¤„ç†"><a class="markdownIt-Anchor" href="#æ–‡æœ¬é¢„å¤„ç†"></a> æ–‡æœ¬é¢„å¤„ç†</h2>
<p>éœ€è¦æ³¨æ„ä¸€ä¸‹æˆ‘ä»¬è¦å…ˆå» hugging face ä¸ŠæŠŠç¼ºå°‘çš„æƒé‡å…ˆä¸‹è½½ä¸‹æ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python preprocess_text.py</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¸»è¦æ‰§è¡Œ text2sequenceï¼Œä¸”æ£€æŸ¥èƒ½å¦æ‰¾åˆ°éŸ³é¢‘å’Œæ˜¯å¦æœ‰é‡å¤éŸ³é¢‘</p>
<h2 id="é‡é‡‡æ ·"><a class="markdownIt-Anchor" href="#é‡é‡‡æ ·"></a> é‡é‡‡æ ·</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python resample.py</span><br></pre></td></tr></table></figure>
<h2 id="bert-é¢„å¤„ç†"><a class="markdownIt-Anchor" href="#bert-é¢„å¤„ç†"></a> Bert é¢„å¤„ç†</h2>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python bert_gen.py</span><br></pre></td></tr></table></figure>
<h2 id="emo-é¢„å¤„ç†"><a class="markdownIt-Anchor" href="#emo-é¢„å¤„ç†"></a> Emo é¢„å¤„ç†</h2>
<p>è¿™é‡Œä¸»è¦è·å–æƒ…æ„Ÿä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python emo_gen.py</span><br></pre></td></tr></table></figure>
<h2 id="è®­ç»ƒ-2"><a class="markdownIt-Anchor" href="#è®­ç»ƒ-2"></a> è®­ç»ƒ</h2>
<p>éœ€è¦æ³¨æ„æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹<code>config.json</code>é‡Œé¢çš„å†…å®¹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python train_ms.py</span><br></pre></td></tr></table></figure>
<h1 id="æ•ˆæœ"><a class="markdownIt-Anchor" href="#æ•ˆæœ"></a> æ•ˆæœ</h1>
<p>ä¸‹é¢ä¸ºç¬¬ 23000iter çš„æ•ˆæœï¼Œå¤©çš„å£°éŸ³ä¾ç„¶æœ‰ä¸€äº›ç”µéŸ³</p>
<iframe src="//player.bilibili.com/player.html?aid=918952876&bvid=BV19u4y157p3&cid=1346290722&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>
<p>åç»­ç»§ç»­è®­ç»ƒä¸€ä¸‹<br />
è¾“å…¥æ–‡æœ¬ â€œèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™â€ï¼Œè¾“å‡º<br />
<audio id="audio" controls src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/haruka_birthday.wav"></p>
<source  src="https://cdn.jsdelivr.net/gh/qxdn/qxdn-assert@0.6.2/haruka_birthday.wav">
</audio>
<p>æ”¾ä¸€ä¸ª hugging face çš„ demo é“¾æ¥ï¼Œå¯ä»¥å»ä½“éªŒä¸€ä¸‹<br />
<a href="https://huggingface.co/spaces/qxdn/tts-9nine">demo</a><br />
æœ€ç»ˆæ•ˆæœ</p>
<iframe src="//player.bilibili.com/player.html?aid=964019251&bvid=BV1MH4y117Dh&cid=1347616172&p=1&autoplay=0" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>
<h1 id="åè®°"><a class="markdownIt-Anchor" href="#åè®°"></a> åè®°</h1>
<p>vitsç³»åˆ—æ¨¡å‹éƒ½éœ€è¦å¤§è§„æ¨¡æ•°æ®ï¼Œè™½ç„¶æˆ‘å·²ç»åŠ å…¥äº†ç»è¿‡åŸç¥è®­ç»ƒçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥çœ‹åˆ°å¤©å’Œå–µéƒ½çš„æ•°æ®é‡ä¸å¤ªå¤šå®¹æ˜“ç”µéŸ³ï¼Œæ˜¥é£å­¦å§çš„å°±å¥½ä¸€ç‚¹</p>
<p><s>è™½ç„¶æˆ‘å–œæ¬¢æ˜¥é£å­¦å§ï¼Œä½†æˆ‘å…¶å®æ˜¯å–µéƒ½å¨</s></p>
<h1 id="å‚è€ƒæ–‡çŒ®"><a class="markdownIt-Anchor" href="#å‚è€ƒæ–‡çŒ®"></a> å‚è€ƒæ–‡çŒ®</h1>
<p><a href="https://arxiv.org/abs/2106.15561">A Survey on Neural Speech Synthesis</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/474601997">ä¸¾ä¸–æ— åŒè¯­éŸ³åˆæˆç³»ç»Ÿ VITS å‘å±•å†ç¨‹ï¼ˆ2023.11.22 HierSpeech++ï¼‰</a></p>
<p><a href="https://github.com/sh-lee-prml/HierSpeechpp">HierSpeech++</a></p>
<p><a href="https://huggingface.co/spaces/LeeSangHoon/HierSpeech_TTS">HierSpeech++ demo</a></p>
<p><a href="https://www.bilibili.com/read/cv21397170/">åŸºäº tacotron2 çš„ galgame è§’è‰²è¯­éŸ³åˆæˆ+galgame è§£åŒ… ä¿å§†çº§æ•™ç¨‹ï¼ˆåƒæ‹ä¸‡èŠ±ç‰ˆï¼‰</a></p>
<p><a href="https://github.com/UlyssesWu/FreeMote">freemote</a></p>
<p><a href="https://github.com/CjangCjengh/tacotron2-japanese">tacotron2-japanese</a></p>
<p><a href="https://github.com/fishaudio/Bert-VITS2">Bert-VITS2</a></p>
]]></content>
      <categories>
        <category>æœºå™¨å­¦ä¹ </category>
      </categories>
      <tags>
        <tag>æœºå™¨å­¦ä¹ </tag>
        <tag>è¯­éŸ³åˆæˆ</tag>
      </tags>
  </entry>
</search>
